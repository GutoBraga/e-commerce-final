import { InjectionToken, Injectable, Inject, Optional, NgModule } from '@angular/core';
import { __extends, __spread } from 'tslib';
import { forkJoin, of, BehaviorSubject, timer, EMPTY } from 'rxjs';
import { map, flatMap, mergeMap, take, tap, switchMap, distinctUntilChanged, debounce } from 'rxjs/operators';
import { FormGroup, FormBuilder, FormControl, FormArray } from '@angular/forms';
import { CommonModule } from '@angular/common';

/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes} checked by tsc
 */
/**
 * Injection token for providing an array of model settings
 */
var /** @type {?} */ MODEL_SETTINGS_TOKEN = new InjectionToken('ngfr.model-settings');

/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes} checked by tsc
 */
/**
 * Injection token for enabling ng-form-rules tracing
 */
var /** @type {?} */ TRACE_SETTINGS_TOKEN = new InjectionToken('ngfr.trace-settings');

/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes} checked by tsc
 */
var TraceService = /** @class */ (function () {
    function TraceService(doTrace) {
        if (doTrace === void 0) { doTrace = false; }
        this.doTrace = doTrace;
    }
    /**
     * @param {?} msg
     * @return {?}
     */
    TraceService.prototype.trace = /**
     * @param {?} msg
     * @return {?}
     */
    function (msg) {
        if (!this.doTrace)
            return;
        var /** @type {?} */ fullMsg = "[NGFR - " + this.getTimeStamp() + "] " + msg;
        console.log(fullMsg);
    };
    /**
     * @return {?}
     */
    TraceService.prototype.getTimeStamp = /**
     * @return {?}
     */
    function () {
        return (new Date).toLocaleTimeString();
    };
    TraceService.decorators = [
        { type: Injectable },
    ];
    /** @nocollapse */
    TraceService.ctorParameters = function () { return [
        { type: undefined, decorators: [{ type: Optional }, { type: Inject, args: [TRACE_SETTINGS_TOKEN,] },] },
    ]; };
    return TraceService;
}());

/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes} checked by tsc
 */
var CommonService = /** @class */ (function () {
    function CommonService() {
    }
    /**
     * Gets unique values from an array
     * @param values Values to get unique items from
     * @returns Unique values array
     */
    /**
     * Gets unique values from an array
     * @param {?} values Values to get unique items from
     * @return {?} Unique values array
     */
    CommonService.prototype.unique = /**
     * Gets unique values from an array
     * @param {?} values Values to get unique items from
     * @return {?} Unique values array
     */
    function (values) {
        if (!Array.isArray(values))
            return [];
        return Array.from(new Set(values));
    };
    /**
     * Determines if number is zero or greater
     * @param value If number is greater than or equal zero
     */
    /**
     * Determines if number is zero or greater
     * @param {?} value If number is greater than or equal zero
     * @return {?}
     */
    CommonService.prototype.isZeroOrGreater = /**
     * Determines if number is zero or greater
     * @param {?} value If number is greater than or equal zero
     * @return {?}
     */
    function (value) {
        if (!value && value === 0)
            return true;
        if (!value || typeof value !== "number")
            return false;
        return value > 0;
    };
    CommonService.decorators = [
        { type: Injectable },
    ];
    return CommonService;
}());

/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes} checked by tsc
 */
/**
 * Results of executing a collection of tests
 * @template T
 */
var  /**
 * Results of executing a collection of tests
 * @template T
 */
TestResultsBase = /** @class */ (function () {
    function TestResultsBase(results) {
        this.results = results;
        this.results = this.results || [];
    }
    Object.defineProperty(TestResultsBase.prototype, "passed", {
        /**
         * Whether the tests passed
         */
        get: /**
         * Whether the tests passed
         * @return {?}
         */
        function () {
            return !this.failedResults.length;
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(TestResultsBase.prototype, "passedResults", {
        /**
         * Array of test results that passed
         */
        get: /**
         * Array of test results that passed
         * @return {?}
         */
        function () {
            return this.results.filter(function (x) { return !!x.passed && !x.skipped; });
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(TestResultsBase.prototype, "failedResults", {
        /**
         * Array of test results that failed
         */
        get: /**
         * Array of test results that failed
         * @return {?}
         */
        function () {
            return this.results.filter(function (x) { return !x.passed; });
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(TestResultsBase.prototype, "skippedResults", {
        /**
         * Array of test results that were skipped
         */
        get: /**
         * Array of test results that were skipped
         * @return {?}
         */
        function () {
            return this.results.filter(function (x) { return !!x.skipped; });
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(TestResultsBase.prototype, "message", {
        /**
         * Message of the first test that failed
         */
        get: /**
         * Message of the first test that failed
         * @return {?}
         */
        function () {
            return this.messages[0];
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(TestResultsBase.prototype, "messages", {
        /**
         * Messages of all failed tests
         */
        get: /**
         * Messages of all failed tests
         * @return {?}
         */
        function () {
            var /** @type {?} */ messages = this.failedResults.map(function (x) { return x.message; });
            return Array.from(new Set(messages));
        },
        enumerable: true,
        configurable: true
    });
    return TestResultsBase;
}());

/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes} checked by tsc
 */
/**
 * Base class for a property
 * @abstract
 * @template T
 */
var  /**
 * Base class for a property
 * @abstract
 * @template T
 */
PropertyBase = /** @class */ (function () {
    function PropertyBase() {
        this._dependencyPropertySubscriptions = [];
        /**
         * Validation tests
         */
        this.valid = [];
        /**
         * Editability tests
         */
        this.edit = [];
        /**
         * The event name for control to update upon.
         */
        this.updateOn = 'change';
        /**
         * Options for how to respond to value changes on property control and dependency controls
         */
        this.valueChangeOptions = {
            dependencyProperties: {
                valid: { distinctUntilChanged: false, debounceMilliseconds: 0 },
                edit: { distinctUntilChanged: false, debounceMilliseconds: 0 }
            },
            self: {
                asyncValid: { distinctUntilChanged: false, debounceMilliseconds: 0 },
                edit: { distinctUntilChanged: false, debounceMilliseconds: 0 }
            }
        };
    }
    Object.defineProperty(PropertyBase.prototype, "absolutePath", {
        /**
         * Absolute path to the property from root
         */
        get: /**
         * Absolute path to the property from root
         * @return {?}
         */
        function () {
            return this._absolutePath;
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(PropertyBase.prototype, "dependencyPropertySubscriptions", {
        /**
         * Absolute path to property from root
         */
        get: /**
         * Absolute path to property from root
         * @return {?}
         */
        function () {
            return this._dependencyPropertySubscriptions;
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(PropertyBase.prototype, "ownerModelSettingsName", {
        /**
         * Absolute path to property from root
         */
        get: /**
         * Absolute path to property from root
         * @return {?}
         */
        function () {
            return this._ownerModelSettingsName;
        },
        enumerable: true,
        configurable: true
    });
    /**
     * Determines if the property is an ArrayItemProperty
     * @param property Property to check
     * @returns Whether or not the property is an ArrayItemProperty
     */
    /**
     * Determines if the property is an ArrayItemProperty
     * @template T
     * @param {?} property Property to check
     * @return {?} Whether or not the property is an ArrayItemProperty
     */
    PropertyBase.isArrayItemProperty = /**
     * Determines if the property is an ArrayItemProperty
     * @template T
     * @param {?} property Property to check
     * @return {?} Whether or not the property is an ArrayItemProperty
     */
    function (property) {
        return !(/** @type {?} */ (property)).name;
    };
    /**
     * DO NOT CALL! Internal use only
     * @param absolutePath Absolute path to the property from the root
     */
    /**
     * DO NOT CALL! Internal use only
     * @param {?} absolutePath Absolute path to the property from the root
     * @return {?}
     */
    PropertyBase.prototype.setAbsolutePath = /**
     * DO NOT CALL! Internal use only
     * @param {?} absolutePath Absolute path to the property from the root
     * @return {?}
     */
    function (absolutePath) {
        this._absolutePath = absolutePath;
    };
    /**
     * DO NOT CALL! Internal use only
     * @param subscription Subscription for the dependency property
     */
    /**
     * DO NOT CALL! Internal use only
     * @param {?} subscription Subscription for the dependency property
     * @return {?}
     */
    PropertyBase.prototype.addDependencyPropertySubscription = /**
     * DO NOT CALL! Internal use only
     * @param {?} subscription Subscription for the dependency property
     * @return {?}
     */
    function (subscription) {
        this._dependencyPropertySubscriptions.push(subscription);
    };
    /**
     * DO NOT CALL! Internal use only
     */
    /**
     * DO NOT CALL! Internal use only
     * @return {?}
     */
    PropertyBase.prototype.clearDependencyPropertySubscriptions = /**
     * DO NOT CALL! Internal use only
     * @return {?}
     */
    function () {
        this.dependencyPropertySubscriptions.forEach(function (sub$) { return sub$.unsubscribe(); });
        this._dependencyPropertySubscriptions = [];
    };
    /**
     * DO NOT CALL! Internal use only
     * @param name Name of the owner model settings
     */
    /**
     * DO NOT CALL! Internal use only
     * @param {?} name Name of the owner model settings
     * @return {?}
     */
    PropertyBase.prototype.setOwnerModelSettingsName = /**
     * DO NOT CALL! Internal use only
     * @param {?} name Name of the owner model settings
     * @return {?}
     */
    function (name) {
        this._ownerModelSettingsName = name;
    };
    return PropertyBase;
}());

/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes} checked by tsc
 */
/** @enum {number} */
var ProcessResultType = {
    Passed: 0,
    Failed: 1,
    Skipped: 2,
};
ProcessResultType[ProcessResultType.Passed] = "Passed";
ProcessResultType[ProcessResultType.Failed] = "Failed";
ProcessResultType[ProcessResultType.Skipped] = "Skipped";

/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes} checked by tsc
 */
/** @enum {number} */
var ResultsPassRequirement = {
    /**
         * All results must pass
         */
    AllPass: 0,
    /**
         * Any results have passed
         */
    AnyPass: 1,
};
ResultsPassRequirement[ResultsPassRequirement.AllPass] = "AllPass";
ResultsPassRequirement[ResultsPassRequirement.AnyPass] = "AnyPass";

/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes} checked by tsc
 */
/**
 * Engine that digests model settings and applies their rules appropriately
 */
var RulesEngineService = /** @class */ (function () {
    function RulesEngineService(settings, traceSvc, commonSvc) {
        var _this = this;
        this.traceSvc = traceSvc;
        this.commonSvc = commonSvc;
        this.registeredSettings = {};
        if (!Array.isArray(settings))
            return;
        settings.forEach(function (setting) {
            _this.initializeModelSetting(setting);
            _this.registeredSettings[setting.name] = setting;
        });
    }
    /**
     * Initializes model settings and prepares them to be used in a form group
     * @param setting Model setting to initialize
     */
    /**
     * Initializes model settings and prepares them to be used in a form group
     * @param {?} setting Model setting to initialize
     * @return {?}
     */
    RulesEngineService.prototype.initializeModelSetting = /**
     * Initializes model settings and prepares them to be used in a form group
     * @param {?} setting Model setting to initialize
     * @return {?}
     */
    function (setting) {
        this.traceSvc.trace("Initializing model settings \"" + setting.name + "\"");
        this.setPropertyMetadata(setting.properties, setting.name);
    };
    /**
     * Gets model settings with the provided name
     * @param name Name of model setting
     * @returns Model settings with the provided name
     */
    /**
     * Gets model settings with the provided name
     * @template T
     * @param {?} name Name of model setting
     * @return {?} Model settings with the provided name
     */
    RulesEngineService.prototype.getModelSettings = /**
     * Gets model settings with the provided name
     * @template T
     * @param {?} name Name of model setting
     * @return {?} Model settings with the provided name
     */
    function (name) {
        this.traceSvc.trace("Retrieving model settings \"" + name + "\"");
        var /** @type {?} */ settings = this.registeredSettings[name];
        // create new object
        return settings
            ? Object.assign({}, this.registeredSettings[name])
            : null;
    };
    /**
     * Gets the dependency properties for an array of tests
     * @param tests Tests to get the dependency properties for
     * @returns Dependency properties
     */
    /**
     * Gets the dependency properties for an array of tests
     * @template T
     * @param {?} tests Tests to get the dependency properties for
     * @return {?} Dependency properties
     */
    RulesEngineService.prototype.getDependencyProperties = /**
     * Gets the dependency properties for an array of tests
     * @template T
     * @param {?} tests Tests to get the dependency properties for
     * @return {?} Dependency properties
     */
    function (tests) {
        var _this = this;
        if (!tests)
            return [];
        var /** @type {?} */ deps = tests
            .map(function (t) { return _this.getDependencyPropertiesFromTest(t); })
            .reduce(function (prev, current) { return prev.concat(current); }, []);
        return this.commonSvc.unique(deps);
    };
    /**
     * Gets tests grouped by their sync type (e.g. sync vs. async)
     * @param tests Test to groups
     * @returns Tests grouped by sync type
     */
    /**
     * Gets tests grouped by their sync type (e.g. sync vs. async)
     * @template T
     * @param {?} tests Test to groups
     * @return {?} Tests grouped by sync type
     */
    RulesEngineService.prototype.groupTestsBySyncType = /**
     * Gets tests grouped by their sync type (e.g. sync vs. async)
     * @template T
     * @param {?} tests Test to groups
     * @return {?} Tests grouped by sync type
     */
    function (tests) {
        var _this = this;
        var /** @type {?} */ testGroups = /** @type {?} */ ({
            sync: [],
            async: []
        });
        if (!tests)
            return testGroups;
        tests.forEach(function (test) {
            var /** @type {?} */ testFuncTypes = /** @type {?} */ ({
                sync: false,
                async: false
            });
            var /** @type {?} */ conditionResults = _this.getConfiguredFuncTypes(test.condition);
            var /** @type {?} */ checkResults = _this.getConfiguredFuncTypes(test.check);
            testFuncTypes.sync = conditionResults.sync || checkResults.sync;
            testFuncTypes.async = conditionResults.async || checkResults.async;
            // if there is an async func anywhere in the test's rule sets, then it is considered an async test
            if (testFuncTypes.sync && !testFuncTypes.async)
                testGroups.sync.push(test);
            if (testFuncTypes.async)
                testGroups.async.push(test);
        });
        return testGroups;
    };
    /**
     * Runs validation tests
     * @param data Data to run validation tests against
     * @param property Property to run validation tests for
     * @returns Results of validation tests
     */
    /**
     * Runs validation tests
     * @template T
     * @param {?} data Data to run validation tests against
     * @param {?} property Property to run validation tests for
     * @param {?=} state
     * @return {?} Results of validation tests
     */
    RulesEngineService.prototype.validate = /**
     * Runs validation tests
     * @template T
     * @param {?} data Data to run validation tests against
     * @param {?} property Property to run validation tests for
     * @param {?=} state
     * @return {?} Results of validation tests
     */
    function (data, property, state) {
        return this.runAllTests(data, property.valid, state)
            .pipe(map(function (results) {
            results.propertyName = property.absolutePath;
            return /** @type {?} */ (results);
        }));
    };
    /**
     * Runs editability tests
     * @param data Data to run editability tests against
     * @param property Property to run editability tests for
     * * @returns Results of editability tests
     */
    /**
     * Runs editability tests
     * @template T
     * @param {?} data Data to run editability tests against
     * @param {?} property Property to run editability tests for
     * * \@returns Results of editability tests
     * @param {?=} state
     * @return {?}
     */
    RulesEngineService.prototype.editable = /**
     * Runs editability tests
     * @template T
     * @param {?} data Data to run editability tests against
     * @param {?} property Property to run editability tests for
     * * \@returns Results of editability tests
     * @param {?=} state
     * @return {?}
     */
    function (data, property, state) {
        return this.runAllTests(data, property.edit, state)
            .pipe(map(function (results) {
            results.propertyName = property.absolutePath;
            return /** @type {?} */ (results);
        }));
    };
    /**
     * Runs visibility tests
     * @param data Data to run visibility tests against
     * @param property Property to run visibility tests for
     * * @returns Results of visibility tests
     */
    // visible<T>(data: T, property: Property<T>, state?: TestRunState): Observable<PropertyTestResults<T>> {
    //     return this.runAllTests(data, property.view, state)
    //         .pipe(
    //             map((results: PropertyTestResults<T>) => {
    //                 results.propertyName = property.absolutePath;
    //                 return results as PropertyTestResults<T>;
    //             })
    //         );
    // }
    /**
     * Runs an array of sync tests
     * @param data Data to perform tests against
     * @param tests Tests to run
     * @returns Result of tests
     */
    /**
     * Runs an array of sync tests
     * @template T
     * @param {?} data Data to perform tests against
     * @param {?} tests Tests to run
     * @param {?=} state
     * @return {?} Result of tests
     */
    RulesEngineService.prototype.runTests = /**
     * Runs an array of sync tests
     * @template T
     * @param {?} data Data to perform tests against
     * @param {?} tests Tests to run
     * @param {?=} state
     * @return {?} Result of tests
     */
    function (data, tests, state) {
        var _this = this;
        if (!tests || !tests.length)
            return new TestResultsBase([]);
        var /** @type {?} */ testResults = tests
            .map(function (t) { return _this.runTest(data, t, state); })
            .filter(function (x) { return !!x; });
        return new TestResultsBase(testResults);
    };
    /**
     * Runs an array of async tests
     * @param data Data to perform tests against
     * @param tests Tests to run
     * @returns Result of tests
     */
    /**
     * Runs an array of async tests
     * @template T
     * @param {?} data Data to perform tests against
     * @param {?} tests Tests to run
     * @param {?=} state
     * @return {?} Result of tests
     */
    RulesEngineService.prototype.runTestsAsync = /**
     * Runs an array of async tests
     * @template T
     * @param {?} data Data to perform tests against
     * @param {?} tests Tests to run
     * @param {?=} state
     * @return {?} Result of tests
     */
    function (data, tests, state) {
        var _this = this;
        if (!tests || !tests.length)
            return of(new TestResultsBase([]));
        var /** @type {?} */ runTest$ = tests
            .map(function (test) { return _this.runTestAsync(data, test, state); });
        return forkJoin(runTest$)
            .pipe(map(function (testResults) { return new TestResultsBase(testResults.filter(function (x) { return !!x; })); }));
    };
    /**
     * Runs an array of sync and async tests
     * @param data Data to perform tests against
     * @param tests Tests to run
     * @returns Result of tests
     */
    /**
     * Runs an array of sync and async tests
     * @template T
     * @param {?} data Data to perform tests against
     * @param {?} tests Tests to run
     * @param {?=} state
     * @return {?} Result of tests
     */
    RulesEngineService.prototype.runAllTests = /**
     * Runs an array of sync and async tests
     * @template T
     * @param {?} data Data to perform tests against
     * @param {?} tests Tests to run
     * @param {?=} state
     * @return {?} Result of tests
     */
    function (data, tests, state) {
        var _this = this;
        if (!tests || !tests.length)
            return of(new TestResultsBase([]));
        var /** @type {?} */ syncGroups = this.groupTestsBySyncType(tests);
        var /** @type {?} */ syncTestResults = of(this.runTests(data, syncGroups.sync, state));
        return syncTestResults.pipe(mergeMap(function (result) {
            if (!result.passed)
                return of(result);
            return _this.runTestsAsync(data, syncGroups.async, state);
        }), take(1));
    };
    /**
     * Performs sync test on a set of data
     * @param data Data to perform test against
     * @param test Test to run
     * @returns Result of test
     */
    /**
     * Performs sync test on a set of data
     * @template T
     * @param {?} data Data to perform test against
     * @param {?} test Test to run
     * @param {?=} state
     * @return {?} Result of test
     */
    RulesEngineService.prototype.runTest = /**
     * Performs sync test on a set of data
     * @template T
     * @param {?} data Data to perform test against
     * @param {?} test Test to run
     * @param {?=} state
     * @return {?} Result of test
     */
    function (data, test, state) {
        if (!test)
            return null;
        var /** @type {?} */ passedTestResult = { passed: true, name: test.name, message: null };
        var /** @type {?} */ failedTestResult = { passed: false, name: test.name, message: test.message };
        var /** @type {?} */ skippedTestResult = { passed: true, skipped: true, name: test.name, message: null };
        var /** @type {?} */ conditionsRuleSetResult = this.processRuleSet(data, test.condition, state);
        if (conditionsRuleSetResult === ProcessResultType.Failed)
            return skippedTestResult;
        var /** @type {?} */ checkRuleSetResult = this.processRuleSet(data, test.check, state);
        switch (checkRuleSetResult) {
            case ProcessResultType.Passed:
                return passedTestResult;
            case ProcessResultType.Failed:
                return failedTestResult;
            case ProcessResultType.Skipped:
            default:
                return skippedTestResult;
        }
    };
    /**
     * Performs async test on a set of data
     * @param data Data to perform test against
     * @param test Test to run
     * @returns Result of test
     */
    /**
     * Performs async test on a set of data
     * @template T
     * @param {?} data Data to perform test against
     * @param {?} test Test to run
     * @param {?=} state
     * @return {?} Result of test
     */
    RulesEngineService.prototype.runTestAsync = /**
     * Performs async test on a set of data
     * @template T
     * @param {?} data Data to perform test against
     * @param {?} test Test to run
     * @param {?=} state
     * @return {?} Result of test
     */
    function (data, test, state) {
        if (!test)
            return of(null);
        var /** @type {?} */ passedTestResult = { passed: true, name: test.name, message: null };
        var /** @type {?} */ failedTestResult = { passed: false, name: test.name, message: test.message };
        var /** @type {?} */ skippedTestResult = { passed: true, skipped: true, name: test.name, message: null };
        var /** @type {?} */ conditionsRuleSetResult$ = this.processRuleSetAsync(data, test.condition, state);
        var /** @type {?} */ checkRuleSetResult$ = this.processRuleSetAsync(data, test.check, state);
        return conditionsRuleSetResult$
            .pipe(flatMap(function (conditionsRuleSetResult) {
            if (conditionsRuleSetResult === ProcessResultType.Failed)
                return of(skippedTestResult);
            return checkRuleSetResult$
                .pipe(map(function (checkRuleSetResult) {
                switch (checkRuleSetResult) {
                    case ProcessResultType.Passed:
                        return passedTestResult;
                    case ProcessResultType.Failed:
                        return failedTestResult;
                    case ProcessResultType.Skipped:
                    default:
                        return skippedTestResult;
                }
            }));
        }));
    };
    /**
     * Processes a sync rule set
     * @param data Data to process rule set against
     * @param ruleSet Rule set to process
     * @returns Result of rule set processing
     */
    /**
     * Processes a sync rule set
     * @template T
     * @param {?} data Data to process rule set against
     * @param {?} ruleSet Rule set to process
     * @param {?=} state
     * @return {?} Result of rule set processing
     */
    RulesEngineService.prototype.processRuleSet = /**
     * Processes a sync rule set
     * @template T
     * @param {?} data Data to process rule set against
     * @param {?} ruleSet Rule set to process
     * @param {?=} state
     * @return {?} Result of rule set processing
     */
    function (data, ruleSet, state) {
        if (!ruleSet)
            return ProcessResultType.Skipped;
        var /** @type {?} */ isRuleGroup = this.isRuleGroup(ruleSet);
        return isRuleGroup
            ? this.processRuleGroup(data, /** @type {?} */ (ruleSet), state)
            : this.processRule(data, /** @type {?} */ (ruleSet), state);
    };
    /**
     * Processes an async rule set
     * @param data Data to process rule set against
     * @param ruleSet Rule set to process
     * @returns Result of rule set processing
     */
    /**
     * Processes an async rule set
     * @template T
     * @param {?} data Data to process rule set against
     * @param {?} ruleSet Rule set to process
     * @param {?=} state
     * @return {?} Result of rule set processing
     */
    RulesEngineService.prototype.processRuleSetAsync = /**
     * Processes an async rule set
     * @template T
     * @param {?} data Data to process rule set against
     * @param {?} ruleSet Rule set to process
     * @param {?=} state
     * @return {?} Result of rule set processing
     */
    function (data, ruleSet, state) {
        if (!ruleSet)
            return of(ProcessResultType.Skipped);
        var /** @type {?} */ isRuleGroup = this.isRuleGroup(ruleSet);
        return isRuleGroup
            ? this.processRuleGroupAsync(data, /** @type {?} */ (ruleSet), state)
            : this.processRuleAsync(data, /** @type {?} */ (ruleSet), state);
    };
    /**
     * @template T
     * @param {?} data
     * @param {?} ruleGroup
     * @param {?=} state
     * @return {?}
     */
    RulesEngineService.prototype.processRuleGroup = /**
     * @template T
     * @param {?} data
     * @param {?} ruleGroup
     * @param {?=} state
     * @return {?}
     */
    function (data, ruleGroup, state) {
        if (!ruleGroup.rules)
            return ProcessResultType.Skipped;
        var /** @type {?} */ passedCount = 0;
        var /** @type {?} */ skippedCount = 0;
        for (var /** @type {?} */ i = 0; i < ruleGroup.rules.length; i++) {
            var /** @type {?} */ rule = ruleGroup.rules[i];
            var /** @type {?} */ ruleSetResult = this.processRuleSet(data, rule, state);
            if (this.canShortCircuitRuleGroup(ruleSetResult, ruleGroup))
                return ruleSetResult;
            if (ruleSetResult == ProcessResultType.Passed)
                passedCount++;
            else if (ruleSetResult == ProcessResultType.Skipped)
                skippedCount++;
        }
        // if we skipped them all, then return skipped
        if (skippedCount === ruleGroup.rules.length)
            return ProcessResultType.Skipped;
        // if we got this far, make sure all tests were passed
        return passedCount === ruleGroup.rules.length ? ProcessResultType.Passed : ProcessResultType.Failed;
    };
    /**
     * @template T
     * @param {?} data
     * @param {?} ruleGroup
     * @param {?=} state
     * @return {?}
     */
    RulesEngineService.prototype.processRuleGroupAsync = /**
     * @template T
     * @param {?} data
     * @param {?} ruleGroup
     * @param {?=} state
     * @return {?}
     */
    function (data, ruleGroup, state) {
        var _this = this;
        if (!ruleGroup.rules)
            return of(ProcessResultType.Skipped);
        var /** @type {?} */ asyncRuleSetResults$ = ruleGroup.rules.map(function (x) { return _this.processRuleSetAsync(data, x, state); });
        return forkJoin(asyncRuleSetResults$).pipe(map(function (ruleSetResults) {
            var /** @type {?} */ counts = {
                passed: ruleSetResults.filter(function (x) { return x === ProcessResultType.Passed; }).length,
                failed: ruleSetResults.filter(function (x) { return x === ProcessResultType.Failed; }).length,
                skipped: ruleSetResults.filter(function (x) { return x === ProcessResultType.Skipped; }).length,
            };
            var /** @type {?} */ ruleGroupOptions = ruleGroup.options || { resultRequirements: ResultsPassRequirement.AllPass };
            if (ruleGroupOptions.resultRequirements == ResultsPassRequirement.AnyPass && counts.passed > 0)
                return ProcessResultType.Passed;
            if (ruleGroupOptions.resultRequirements == ResultsPassRequirement.AllPass && counts.passed === ruleSetResults.length)
                return ProcessResultType.Passed;
            if (counts.skipped === ruleSetResults.length)
                return ProcessResultType.Skipped;
            return ProcessResultType.Failed;
        }));
    };
    /**
     * @template T
     * @param {?} data
     * @param {?} rule
     * @param {?=} state
     * @return {?}
     */
    RulesEngineService.prototype.processRule = /**
     * @template T
     * @param {?} data
     * @param {?} rule
     * @param {?=} state
     * @return {?}
     */
    function (data, rule, state) {
        if (!rule.func)
            return ProcessResultType.Skipped;
        var /** @type {?} */ rootData = state ? state.rootData : null;
        return rule.func(data, rootData) ? ProcessResultType.Passed : ProcessResultType.Failed;
    };
    /**
     * @template T
     * @param {?} data
     * @param {?} rule
     * @param {?=} state
     * @return {?}
     */
    RulesEngineService.prototype.processRuleAsync = /**
     * @template T
     * @param {?} data
     * @param {?} rule
     * @param {?=} state
     * @return {?}
     */
    function (data, rule, state) {
        if (!rule.func && !rule.asyncFunc)
            return of(ProcessResultType.Skipped);
        var /** @type {?} */ rootData = state ? state.rootData : null;
        var /** @type {?} */ funcResult = rule.func
            ? of(rule.func(data, rootData))
            : rule.asyncFunc(data, rootData);
        return funcResult
            .pipe(map(function (passed) { return passed ? ProcessResultType.Passed : ProcessResultType.Failed; }));
    };
    /**
     * @template T
     * @param {?} ruleSetResult
     * @param {?} ruleGroup
     * @return {?}
     */
    RulesEngineService.prototype.canShortCircuitRuleGroup = /**
     * @template T
     * @param {?} ruleSetResult
     * @param {?} ruleGroup
     * @return {?}
     */
    function (ruleSetResult, ruleGroup) {
        var /** @type {?} */ ruleGroupOptions = ruleGroup.options || { resultRequirements: ResultsPassRequirement.AllPass };
        return (
        // it passed, and we only need one to pass
        (ruleSetResult == ProcessResultType.Passed && ruleGroupOptions.resultRequirements == ResultsPassRequirement.AnyPass)
            ||
                // if failed, and we need all to pass
                (ruleSetResult == ProcessResultType.Failed && ruleGroupOptions.resultRequirements == ResultsPassRequirement.AllPass));
    };
    /**
     * @template T
     * @param {?} ruleSet
     * @return {?}
     */
    RulesEngineService.prototype.isRuleGroup = /**
     * @template T
     * @param {?} ruleSet
     * @return {?}
     */
    function (ruleSet) {
        var /** @type {?} */ rule = /** @type {?} */ (ruleSet);
        return !rule.func && !rule.asyncFunc;
    };
    /**
     * @template T
     * @param {?} test
     * @return {?}
     */
    RulesEngineService.prototype.getDependencyPropertiesFromTest = /**
     * @template T
     * @param {?} test
     * @return {?}
     */
    function (test) {
        var /** @type {?} */ checkDeps = this.getDependencyPropertiesFromRuleSet(test.check);
        var /** @type {?} */ conditionDeps = this.getDependencyPropertiesFromRuleSet(test.condition);
        return this.commonSvc.unique(checkDeps.concat(conditionDeps));
    };
    /**
     * @template T
     * @param {?} ruleSet
     * @return {?}
     */
    RulesEngineService.prototype.getDependencyPropertiesFromRuleSet = /**
     * @template T
     * @param {?} ruleSet
     * @return {?}
     */
    function (ruleSet) {
        var _this = this;
        if (!ruleSet)
            return [];
        var /** @type {?} */ result = [];
        if (this.isRuleGroup(ruleSet)) {
            var /** @type {?} */ ruleGroup = /** @type {?} */ (ruleSet);
            ruleGroup.rules.forEach(function (x) {
                result.push.apply(result, __spread(_this.commonSvc.unique(_this.getDependencyPropertiesFromRuleSet(x))));
            });
        }
        var /** @type {?} */ rule = /** @type {?} */ (ruleSet);
        if (rule.options && Array.isArray(rule.options.dependencyProperties)) {
            result.push.apply(result, __spread(this.commonSvc.unique(rule.options.dependencyProperties)));
        }
        return this.commonSvc.unique(result);
    };
    /**
     * @param {?} properties
     * @param {?} modelSettingsName
     * @param {?=} currentAbsolutePath
     * @return {?}
     */
    RulesEngineService.prototype.setPropertyMetadata = /**
     * @param {?} properties
     * @param {?} modelSettingsName
     * @param {?=} currentAbsolutePath
     * @return {?}
     */
    function (properties, modelSettingsName, currentAbsolutePath) {
        var _this = this;
        if (currentAbsolutePath === void 0) { currentAbsolutePath = ''; }
        if (!properties)
            return;
        properties.forEach(function (prop) {
            var /** @type {?} */ newAbsolutePath = _this.setPropertyAbsolutePath(prop, currentAbsolutePath);
            _this.fillInEmptyTestNames(prop);
            prop.setOwnerModelSettingsName(modelSettingsName);
            if (prop.properties) {
                _this.setPropertyMetadata(prop.properties, modelSettingsName, newAbsolutePath);
            }
            else if (prop.arrayItemProperty) {
                _this.setPropertyMetadata([prop.arrayItemProperty], modelSettingsName, newAbsolutePath);
            }
        });
    };
    /**
     * @param {?} property
     * @param {?=} currentAbsolutePath
     * @return {?}
     */
    RulesEngineService.prototype.setPropertyAbsolutePath = /**
     * @param {?} property
     * @param {?=} currentAbsolutePath
     * @return {?}
     */
    function (property, currentAbsolutePath) {
        if (currentAbsolutePath === void 0) { currentAbsolutePath = ''; }
        var /** @type {?} */ isArrayItemProperty = PropertyBase.isArrayItemProperty(property);
        var /** @type {?} */ newAbsolutePathSegment = isArrayItemProperty ? '[]' : (/** @type {?} */ (property)).name;
        var /** @type {?} */ isAtRoot = !currentAbsolutePath;
        var /** @type {?} */ newAbsolutePath = "" + currentAbsolutePath + (isAtRoot ? '' : '.') + newAbsolutePathSegment;
        // set absolute path for property
        property.setAbsolutePath(newAbsolutePath);
        return newAbsolutePath;
    };
    /**
     * @param {?} property
     * @return {?}
     */
    RulesEngineService.prototype.fillInEmptyTestNames = /**
     * @param {?} property
     * @return {?}
     */
    function (property) {
        property.valid
            .filter(function (test) { return !test.name; })
            .forEach(function (test, i) { return test.name = "validTest" + i; });
        property.edit
            .filter(function (test) { return !test.name; })
            .forEach(function (test, i) { return test.name = "editTest" + i; });
    };
    /**
     * @template T
     * @param {?} ruleSet
     * @return {?}
     */
    RulesEngineService.prototype.getConfiguredFuncTypes = /**
     * @template T
     * @param {?} ruleSet
     * @return {?}
     */
    function (ruleSet) {
        var _this = this;
        if (!ruleSet)
            return { sync: false, async: false };
        var /** @type {?} */ isRuleGroup = this.isRuleGroup(ruleSet);
        if (isRuleGroup) {
            var /** @type {?} */ ruleGroup = /** @type {?} */ (ruleSet);
            var /** @type {?} */ results = ruleGroup.rules
                .map(function (rs) {
                return _this.getConfiguredFuncTypes(rs);
            });
            return {
                sync: results.findIndex(function (x) { return !!x.sync; }) >= 0,
                async: results.findIndex(function (x) { return !!x.async; }) >= 0,
            };
        }
        else {
            var /** @type {?} */ rule = /** @type {?} */ (ruleSet);
            return {
                sync: !!rule.func,
                async: !!rule.asyncFunc
            };
        }
    };
    RulesEngineService.decorators = [
        { type: Injectable },
    ];
    /** @nocollapse */
    RulesEngineService.ctorParameters = function () { return [
        { type: Array, decorators: [{ type: Optional }, { type: Inject, args: [MODEL_SETTINGS_TOKEN,] },] },
        { type: TraceService, },
        { type: CommonService, },
    ]; };
    return RulesEngineService;
}());

/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes} checked by tsc
 */
/**
 * State of an Angular AbstractControl at the time of running a test
 */
var  /**
 * State of an Angular AbstractControl at the time of running a test
 */
ControlState = /** @class */ (function () {
    function ControlState(control) {
        this._pristine = control.pristine;
        this._untouched = control.untouched;
    }
    /**
     * Creates a ControlState object based on an Angular control
     * @param control Angular control to generate state from
     * @returns Control state base on Angular control
     */
    /**
     * Creates a ControlState object based on an Angular control
     * @param {?} control Angular control to generate state from
     * @return {?} Control state base on Angular control
     */
    ControlState.create = /**
     * Creates a ControlState object based on an Angular control
     * @param {?} control Angular control to generate state from
     * @return {?} Control state base on Angular control
     */
    function (control) {
        return new ControlState(control);
    };
    return ControlState;
}());

/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes} checked by tsc
 */
/**
 * Builds reactive forms using configured model settings
 */
var ReactiveFormsRuleService = /** @class */ (function () {
    function ReactiveFormsRuleService(rulesEngineSvc, formBuilder, traceSvc, commonSvc) {
        this.rulesEngineSvc = rulesEngineSvc;
        this.formBuilder = formBuilder;
        this.traceSvc = traceSvc;
        this.commonSvc = commonSvc;
    }
    /**
     * Gets model settings with the provided name
     * @param name Name of model setting
     * @returns Model settings with the provided name
     */
    /**
     * Gets model settings with the provided name
     * @template T
     * @param {?} name Name of model setting
     * @return {?} Model settings with the provided name
     */
    ReactiveFormsRuleService.prototype.getModelSettings = /**
     * Gets model settings with the provided name
     * @template T
     * @param {?} name Name of model setting
     * @return {?} Model settings with the provided name
     */
    function (name) {
        return this.rulesEngineSvc.getModelSettings(name);
    };
    /**
     * Creates a form group using an instance of model settings
     * @param modelSettings Name of the model setting or an instance of model settings to use
     * @param initialValue Initial data to set the form values to
     * @returns Form group created according to defined model settings
     */
    /**
     * Creates a form group using an instance of model settings
     * @template T
     * @param {?} modelSettings Name of the model setting or an instance of model settings to use
     * @param {?=} initialValue Initial data to set the form values to
     * @return {?} Form group created according to defined model settings
     */
    ReactiveFormsRuleService.prototype.createFormGroup = /**
     * Creates a form group using an instance of model settings
     * @template T
     * @param {?} modelSettings Name of the model setting or an instance of model settings to use
     * @param {?=} initialValue Initial data to set the form values to
     * @return {?} Form group created according to defined model settings
     */
    function (modelSettings, initialValue) {
        var /** @type {?} */ settings;
        if (typeof modelSettings === "string") {
            settings = this.rulesEngineSvc.getModelSettings(/** @type {?} */ (modelSettings));
            if (!settings)
                throw new Error("No model setting found with the name \"" + modelSettings + "\"");
        }
        else {
            if (!modelSettings)
                throw new Error("Adhoc model setting provided is invalid");
            settings = /** @type {?} */ (modelSettings);
            this.rulesEngineSvc.initializeModelSetting(settings);
        }
        this.traceSvc.trace("Creating form group using model settings \"" + settings.name + "\"");
        var /** @type {?} */ formGroup = this.buildGroup(settings.properties, initialValue);
        this.traceSvc.trace("Setting up dependency subscriptions");
        this.resetDependencySubscriptions(formGroup, settings.properties);
        this.traceSvc.trace("Patching form group with initial value");
        this.triggerValueChange(formGroup);
        this.traceSvc.trace("Attaching model settings to form");
        this.attachModelSettingsToForm(formGroup, settings);
        return formGroup;
    };
    /**
     * Adds an array item property to an existing form array
     * @param property ArrayItemProperty to for the array item to be added
     * @param parentFormArray The parent FormArray
     * @param initialValue Initial value of the form array item
     * @param options Options for adding new array item property
     */
    /**
     * Adds an array item property to an existing form array
     * @template T
     * @param {?} property ArrayItemProperty to for the array item to be added
     * @param {?} parentFormArray The parent FormArray
     * @param {?=} initialValue Initial value of the form array item
     * @param {?=} options Options for adding new array item property
     * @return {?}
     */
    ReactiveFormsRuleService.prototype.addArrayItemPropertyControl = /**
     * Adds an array item property to an existing form array
     * @template T
     * @param {?} property ArrayItemProperty to for the array item to be added
     * @param {?} parentFormArray The parent FormArray
     * @param {?=} initialValue Initial value of the form array item
     * @param {?=} options Options for adding new array item property
     * @return {?}
     */
    function (property, parentFormArray, initialValue, options) {
        var /** @type {?} */ control = this.buildAbstractControl(property, initialValue);
        var /** @type {?} */ willBeLastItem = !options || !this.commonSvc.isZeroOrGreater(options.index) || options.index >= parentFormArray.length;
        if (willBeLastItem)
            parentFormArray.push(control);
        else
            parentFormArray.insert(options.index, control);
        var /** @type {?} */ modelSettings = this.getModelSettingsFromForm(/** @type {?} */ (parentFormArray.root));
        this.resetDependencySubscriptions(parentFormArray.root, modelSettings.properties);
        // we need to do this because the item could have been added at any index in the array, and we need
        // trigger a value change to trigger any dependency propertiy valdidations
        this.triggerValueChange(parentFormArray);
    };
    /**
     * Extends validators generated by ng-form-rules with your own validators
     * @param control Control to extends the validators for
     * @param validator Validator to add
     */
    /**
     * Extends validators generated by ng-form-rules with your own validators
     * @param {?} control Control to extends the validators for
     * @param {?} validator Validator to add
     * @return {?}
     */
    ReactiveFormsRuleService.prototype.extendValidator = /**
     * Extends validators generated by ng-form-rules with your own validators
     * @param {?} control Control to extends the validators for
     * @param {?} validator Validator to add
     * @return {?}
     */
    function (control, validator) {
        if (!validator)
            return;
        var /** @type {?} */ validatorArray = Array.isArray(validator) ? validator : [validator];
        control.setValidators(__spread([control.validator], validatorArray).filter(function (validatorFn) { return !!validatorFn; }));
    };
    /**
     * Extends async validators generated by ng-form-rules with your own async validators
     * @param control Control to extends the async validators for
     * @param asyncValidator Async validator to add
     */
    /**
     * Extends async validators generated by ng-form-rules with your own async validators
     * @param {?} control Control to extends the async validators for
     * @param {?} asyncValidator Async validator to add
     * @return {?}
     */
    ReactiveFormsRuleService.prototype.extendAsyncValidator = /**
     * Extends async validators generated by ng-form-rules with your own async validators
     * @param {?} control Control to extends the async validators for
     * @param {?} asyncValidator Async validator to add
     * @return {?}
     */
    function (control, asyncValidator) {
        if (!asyncValidator)
            return;
        var /** @type {?} */ asyncValidatorArray = Array.isArray(asyncValidator) ? asyncValidator : [asyncValidator];
        control.setAsyncValidators(__spread([control.asyncValidator], asyncValidatorArray).filter(function (asyncValidatorFn) { return !!asyncValidatorFn; }));
    };
    /**
     * @template T
     * @param {?} property
     * @param {?=} initialValue
     * @return {?}
     */
    ReactiveFormsRuleService.prototype.buildAbstractControl = /**
     * @template T
     * @param {?} property
     * @param {?=} initialValue
     * @return {?}
     */
    function (property, initialValue) {
        var _this = this;
        var /** @type {?} */ control;
        if (property.arrayItemProperty)
            control = this.buildArray(property.arrayItemProperty, initialValue, property.updateOn);
        else if (property.properties)
            control = this.buildGroup(property.properties, initialValue, property.updateOn);
        else
            control = this.buildControl(initialValue, property.updateOn);
        // setup validation tests on value change
        control.setValidators(this.buildValidatorFunction(property));
        control.setAsyncValidators(this.buildAsyncValidatorFunction(property));
        // setup edit tests on value change
        control.valueChanges
            .pipe(this.applyValueChangeOptions(property.valueChangeOptions.self.edit))
            .subscribe(function (value) {
            _this.persistEditTests(control, property);
        });
        return control;
    };
    /**
     * @template T
     * @param {?} initialValue
     * @param {?=} updateOn
     * @return {?}
     */
    ReactiveFormsRuleService.prototype.buildControl = /**
     * @template T
     * @param {?} initialValue
     * @param {?=} updateOn
     * @return {?}
     */
    function (initialValue, updateOn) {
        return new FormControl(initialValue, { updateOn: updateOn });
    };
    /**
     * @template T
     * @param {?} properties
     * @param {?} initialValue
     * @param {?=} updateOn
     * @return {?}
     */
    ReactiveFormsRuleService.prototype.buildGroup = /**
     * @template T
     * @param {?} properties
     * @param {?} initialValue
     * @param {?=} updateOn
     * @return {?}
     */
    function (properties, initialValue, updateOn) {
        var _this = this;
        var /** @type {?} */ formGroup = new FormGroup({}, { updateOn: updateOn });
        (properties || []).forEach(function (p) {
            var /** @type {?} */ propertyValue = initialValue ? initialValue[p.name] : null;
            var /** @type {?} */ ctrl = _this.buildAbstractControl(p, propertyValue);
            formGroup.addControl(p.name, ctrl);
        });
        return formGroup;
    };
    /**
     * @template T
     * @param {?} property
     * @param {?} initialValue
     * @param {?=} updateOn
     * @return {?}
     */
    ReactiveFormsRuleService.prototype.buildArray = /**
     * @template T
     * @param {?} property
     * @param {?} initialValue
     * @param {?=} updateOn
     * @return {?}
     */
    function (property, initialValue, updateOn) {
        var _this = this;
        initialValue = Array.isArray(initialValue) ? initialValue : [];
        return new FormArray(initialValue.map(function (v) { return _this.buildAbstractControl(property, v); }), { updateOn: updateOn });
    };
    /**
     * @template T
     * @param {?} property
     * @return {?}
     */
    ReactiveFormsRuleService.prototype.buildValidatorFunction = /**
     * @template T
     * @param {?} property
     * @return {?}
     */
    function (property) {
        var _this = this;
        var /** @type {?} */ syncGroups = this.rulesEngineSvc.groupTestsBySyncType(property.valid);
        if (!syncGroups.sync.length)
            return null;
        return function (control) {
            var /** @type {?} */ controlContextValues = _this.getControlContextValues(control, property);
            var /** @type {?} */ testResults = _this.rulesEngineSvc
                .runTests(controlContextValues.relative, syncGroups.sync, {
                rootData: controlContextValues.root,
                controlState: ControlState.create(control)
            });
            if (testResults.results.length) {
                _this.traceSvc.trace("Validated property \"" + property.absolutePath + "\". " +
                    _this.buildTestResultStatsString(testResults));
            }
            return _this.mapToReactiveFormsValidationErrors(testResults);
        };
    };
    /**
     * @template T
     * @param {?} property
     * @return {?}
     */
    ReactiveFormsRuleService.prototype.buildAsyncValidatorFunction = /**
     * @template T
     * @param {?} property
     * @return {?}
     */
    function (property) {
        var _this = this;
        var /** @type {?} */ rawAsyncFunc = this.buildAsyncValidatorFunctionRaw(property);
        if (!rawAsyncFunc)
            return null;
        var /** @type {?} */ values = new BehaviorSubject(null);
        var /** @type {?} */ valid$ = values.pipe(this.applyAsyncValidValueChangeOptions(property.valueChangeOptions.self.asyncValid), switchMap(function (x) {
            // pass through means we did not execute the ng-form-rules async tests
            if (x.passthrough) {
                var /** @type {?} */ currentErrors = x.control.errors || {};
                var /** @type {?} */ lastNgFormRulesErrors = _this.getLastErrorForControl(x.control);
                // return the last ng-form-rules errors (if any) alongside non ng-form-rules errors.
                // this handles scenario where debounce and distinct are used and state goes from:
                //    invalid -> make changes and back them out -> valid
                return of(Object.assign(currentErrors, /** @type {?} */ ({ ngFormRules: lastNgFormRulesErrors })));
            }
            else {
                return rawAsyncFunc(x.control);
            }
        }), take(1));
        return function (control) {
            values.next(control);
            return valid$;
        };
    };
    /**
     * @template T
     * @param {?} property
     * @return {?}
     */
    ReactiveFormsRuleService.prototype.buildAsyncValidatorFunctionRaw = /**
     * @template T
     * @param {?} property
     * @return {?}
     */
    function (property) {
        var _this = this;
        var /** @type {?} */ syncGroups = this.rulesEngineSvc.groupTestsBySyncType(property.valid);
        if (!syncGroups.async.length)
            return null;
        return function (control) {
            var /** @type {?} */ controlContextValues = _this.getControlContextValues(control, property);
            return _this.rulesEngineSvc.runTestsAsync(controlContextValues.relative, syncGroups.async, {
                rootData: controlContextValues.root,
                controlState: ControlState.create(control)
            }).pipe(tap(function (testResults) {
                if (testResults.results.length) {
                    _this.traceSvc.trace("Validated (async) property \"" + property.absolutePath + "\". " +
                        _this.buildTestResultStatsString(testResults));
                }
            }), map(_this.mapToReactiveFormsValidationErrors), tap(function (x) { return _this.setLastErrorForControl(control, (x || {})["ngFormRules"]); }));
        };
    };
    /**
     * @template T
     * @param {?} parentControl
     * @param {?} properties
     * @return {?}
     */
    ReactiveFormsRuleService.prototype.resetDependencySubscriptions = /**
     * @template T
     * @param {?} parentControl
     * @param {?} properties
     * @return {?}
     */
    function (parentControl, properties) {
        this.removeDependencySubscriptions(properties);
        this.addDependencySubscriptions(parentControl, properties);
    };
    /**
     * @template T
     * @param {?} properties
     * @return {?}
     */
    ReactiveFormsRuleService.prototype.removeDependencySubscriptions = /**
     * @template T
     * @param {?} properties
     * @return {?}
     */
    function (properties) {
        var _this = this;
        (properties || []).forEach(function (property) {
            property.clearDependencyPropertySubscriptions();
            if (property.properties) {
                _this.removeDependencySubscriptions(property.properties);
            }
            if (property.arrayItemProperty) {
                _this.removeDependencySubscriptions([property.arrayItemProperty]);
            }
        });
    };
    /**
     * @template T
     * @param {?} parentControl
     * @param {?} properties
     * @param {?=} arrayIndex
     * @return {?}
     */
    ReactiveFormsRuleService.prototype.addDependencySubscriptions = /**
     * @template T
     * @param {?} parentControl
     * @param {?} properties
     * @param {?=} arrayIndex
     * @return {?}
     */
    function (parentControl, properties, arrayIndex) {
        var _this = this;
        (properties || []).forEach(function (property) {
            var /** @type {?} */ propertyControl = _this.getPropertyFromParent(parentControl, property, arrayIndex);
            if (!propertyControl)
                return;
            _this.setupEditabilityDependencySubscriptions(propertyControl, parentControl, property);
            _this.setupValidationDependencySubscriptions(propertyControl, parentControl, property);
            if (property.properties) {
                _this.addDependencySubscriptions(propertyControl, property.properties);
            }
            if (property.arrayItemProperty) {
                // if there is an arrayItemProperty we know that we are working with a FormArray control
                var /** @type {?} */ formArrayControl = (/** @type {?} */ (propertyControl));
                for (var /** @type {?} */ i = 0; i < formArrayControl.length; i++) {
                    _this.addDependencySubscriptions(formArrayControl, [property.arrayItemProperty], i);
                }
            }
        });
    };
    /**
     * @template T
     * @param {?} propertyControl
     * @param {?} parentControl
     * @param {?} property
     * @return {?}
     */
    ReactiveFormsRuleService.prototype.setupValidationDependencySubscriptions = /**
     * @template T
     * @param {?} propertyControl
     * @param {?} parentControl
     * @param {?} property
     * @return {?}
     */
    function (propertyControl, parentControl, property) {
        var _this = this;
        var /** @type {?} */ dependencyPropNames = this.rulesEngineSvc.getDependencyProperties(property.valid);
        dependencyPropNames.forEach(function (d) {
            var /** @type {?} */ dependencyControl = _this.findControlRelatively(parentControl, d);
            if (!dependencyControl)
                return;
            var /** @type {?} */ sub$ = dependencyControl.valueChanges
                .pipe(_this.applyValueChangeOptions(property.valueChangeOptions.dependencyProperties.valid))
                .subscribe(function (value) {
                _this.setForceAsyncValidationTestForControl(propertyControl, true);
                propertyControl.updateValueAndValidity({ onlySelf: true, emitEvent: false });
            });
            property.addDependencyPropertySubscription(sub$);
        });
    };
    /**
     * @template T
     * @param {?} propertyControl
     * @param {?} parentControl
     * @param {?} property
     * @return {?}
     */
    ReactiveFormsRuleService.prototype.setupEditabilityDependencySubscriptions = /**
     * @template T
     * @param {?} propertyControl
     * @param {?} parentControl
     * @param {?} property
     * @return {?}
     */
    function (propertyControl, parentControl, property) {
        var _this = this;
        var /** @type {?} */ dependencyPropNames = this.rulesEngineSvc.getDependencyProperties(property.edit);
        dependencyPropNames.forEach(function (dpn) {
            var /** @type {?} */ dependencyControl = _this.findControlRelatively(parentControl, dpn);
            if (!dependencyControl)
                return;
            // setup control to perform edit tests when dependency property changes
            var /** @type {?} */ sub$ = dependencyControl.valueChanges
                .pipe(_this.applyValueChangeOptions(property.valueChangeOptions.dependencyProperties.edit))
                .subscribe(function (value) {
                _this.persistEditTests(propertyControl, property);
            });
            property.addDependencyPropertySubscription(sub$);
        });
    };
    /**
     * @template T
     * @param {?} propertyControl
     * @param {?} property
     * @return {?}
     */
    ReactiveFormsRuleService.prototype.persistEditTests = /**
     * @template T
     * @param {?} propertyControl
     * @param {?} property
     * @return {?}
     */
    function (propertyControl, property) {
        var _this = this;
        var /** @type {?} */ controlContextValues = this.getControlContextValues(propertyControl, property);
        this.rulesEngineSvc.editable(controlContextValues.relative, property, {
            rootData: controlContextValues.root,
            controlState: ControlState.create(propertyControl)
        }).subscribe(function (testResults) {
            if (testResults.results.length) {
                _this.traceSvc.trace("Editable property \"" + property.absolutePath + "\". " +
                    _this.buildTestResultStatsString(testResults));
            }
            if (testResults.passed && propertyControl.disabled)
                propertyControl.enable({ emitEvent: false });
            else if (!testResults.passed && propertyControl.enabled)
                propertyControl.disable({ emitEvent: false });
        });
    };
    /**
     * @param {?} valueChangeOptions
     * @return {?}
     */
    ReactiveFormsRuleService.prototype.applyAsyncValidValueChangeOptions = /**
     * @param {?} valueChangeOptions
     * @return {?}
     */
    function (valueChangeOptions) {
        var _this = this;
        return function (source$) {
            var /** @type {?} */ lastValue;
            var /** @type {?} */ isForce;
            return source$.pipe(tap(function (control) {
                isForce = _this.doesControlHaveForcedAsyncValidation(control);
                _this.setForceAsyncValidationTestForControl(control, false);
            }), debounce(function (x) {
                return isForce || valueChangeOptions.debounceMilliseconds > 0
                    ? timer(valueChangeOptions.debounceMilliseconds)
                    : EMPTY;
            }), map(function (control) {
                return /** @type {?} */ ({
                    control: control,
                    passthrough: !(control.value !== lastValue || !valueChangeOptions.distinctUntilChanged || isForce)
                });
            }), tap(function (x) {
                if (!x.passthrough)
                    lastValue = x.control.value;
            }));
        };
    };
    /**
     * @param {?} valueChangeOptions
     * @return {?}
     */
    ReactiveFormsRuleService.prototype.applyValueChangeOptions = /**
     * @param {?} valueChangeOptions
     * @return {?}
     */
    function (valueChangeOptions) {
        return function (source$) {
            return source$.pipe(debounce(function (x) {
                return valueChangeOptions.debounceMilliseconds > 0
                    ? timer(valueChangeOptions.debounceMilliseconds)
                    : EMPTY;
            }), valueChangeOptions.distinctUntilChanged ? distinctUntilChanged() : tap());
        };
    };
    /**
     * @template T
     * @param {?} control
     * @param {?} property
     * @return {?}
     */
    ReactiveFormsRuleService.prototype.getControlContextValues = /**
     * @template T
     * @param {?} control
     * @param {?} property
     * @return {?}
     */
    function (control, property) {
        var /** @type {?} */ rootValue = (/** @type {?} */ (control.root)).getRawValue();
        // use the control value if an array item, otherwise use the parent control
        var /** @type {?} */ relativeValue = PropertyBase.isArrayItemProperty(property)
            ? control.value
            : control.parent.getRawValue();
        return {
            root: rootValue,
            relative: relativeValue
        };
    };
    /**
     * @template T
     * @param {?} parentControl
     * @param {?} property
     * @param {?=} arrayIndex
     * @return {?}
     */
    ReactiveFormsRuleService.prototype.getPropertyFromParent = /**
     * @template T
     * @param {?} parentControl
     * @param {?} property
     * @param {?=} arrayIndex
     * @return {?}
     */
    function (parentControl, property, arrayIndex) {
        return PropertyBase.isArrayItemProperty(property)
            ? (/** @type {?} */ (parentControl)).at(arrayIndex)
            : parentControl.get((/** @type {?} */ (property)).name);
    };
    /**
     * @template T
     * @param {?} testResults
     * @return {?}
     */
    ReactiveFormsRuleService.prototype.mapToReactiveFormsValidationErrors = /**
     * @template T
     * @param {?} testResults
     * @return {?}
     */
    function (testResults) {
        // if passed, Angular reactive forms wants us to return null, otherwise return an object with the validation info
        if (!testResults || testResults.passed)
            return null;
        var /** @type {?} */ failed = {};
        testResults.failedResults.forEach(function (test) {
            failed[test.name] = { message: test.message };
        });
        return {
            ngFormRules: /** @type {?} */ ({
                message: testResults.message,
                failed: failed
            })
        };
    };
    /**
     * @param {?} control
     * @param {?} path
     * @return {?}
     */
    ReactiveFormsRuleService.prototype.findControlRelatively = /**
     * @param {?} control
     * @param {?} path
     * @return {?}
     */
    function (control, path) {
        var _this = this;
        var /** @type {?} */ relativePaths = this.buildControlRelativePathArray(path);
        if (!relativePaths.length)
            return null;
        var /** @type {?} */ result;
        relativePaths.forEach(function (pathSegment) {
            result = _this.getControlByPathSegment(result || control, pathSegment);
            if (!result)
                return;
        });
        return result;
    };
    /**
     * @param {?} relativePath
     * @return {?}
     */
    ReactiveFormsRuleService.prototype.buildControlRelativePathArray = /**
     * @param {?} relativePath
     * @return {?}
     */
    function (relativePath) {
        var /** @type {?} */ result = [];
        if (!relativePath || typeof relativePath !== "string")
            return result;
        // takes care of './', '../', and '/'
        var /** @type {?} */ slashSeparated = relativePath.split("/");
        slashSeparated.forEach(function (slashItem) {
            var /** @type {?} */ dotSeparated = slashItem.split(".")
                .filter(function (dotItem) { return !!dotItem; });
            if (dotSeparated.length)
                result.push.apply(result, __spread(dotSeparated));
            else
                result.push(slashItem);
        });
        return result;
    };
    /**
     * @param {?} control
     * @param {?} pathSegment
     * @return {?}
     */
    ReactiveFormsRuleService.prototype.getControlByPathSegment = /**
     * @param {?} control
     * @param {?} pathSegment
     * @return {?}
     */
    function (control, pathSegment) {
        switch (pathSegment) {
            case "":
                return control.root;
            case "..":
                return control.parent;
            case ".":
                return control;
            default:
                return control.get(pathSegment);
        }
    };
    /**
     * @template T
     * @param {?} testResults
     * @return {?}
     */
    ReactiveFormsRuleService.prototype.buildTestResultStatsString = /**
     * @template T
     * @param {?} testResults
     * @return {?}
     */
    function (testResults) {
        return "Executed " + testResults.results.length + " tests " +
            ("(" + testResults.passedResults.length + " PASS | ") +
            (testResults.failedResults.length + " FAIL | ")
            + (testResults.skippedResults.length + " SKIP)");
    };
    /**
     * @template T
     * @param {?} formGroup
     * @param {?} modelSettings
     * @return {?}
     */
    ReactiveFormsRuleService.prototype.attachModelSettingsToForm = /**
     * @template T
     * @param {?} formGroup
     * @param {?} modelSettings
     * @return {?}
     */
    function (formGroup, modelSettings) {
        formGroup[ReactiveFormsRuleService.FORM_MODEL_SETTINGS_PROPERTY_NAME] = modelSettings;
    };
    /**
     * @template T
     * @param {?} formGroup
     * @return {?}
     */
    ReactiveFormsRuleService.prototype.getModelSettingsFromForm = /**
     * @template T
     * @param {?} formGroup
     * @return {?}
     */
    function (formGroup) {
        return /** @type {?} */ (formGroup[ReactiveFormsRuleService.FORM_MODEL_SETTINGS_PROPERTY_NAME]);
    };
    /**
     * @param {?} control
     * @param {?} force
     * @return {?}
     */
    ReactiveFormsRuleService.prototype.setForceAsyncValidationTestForControl = /**
     * @param {?} control
     * @param {?} force
     * @return {?}
     */
    function (control, force) {
        control[ReactiveFormsRuleService.FORCE_ASYNC_VALID_TEST_RUN_PROPERTY_NAME] = force;
    };
    /**
     * @param {?} control
     * @param {?} errors
     * @return {?}
     */
    ReactiveFormsRuleService.prototype.setLastErrorForControl = /**
     * @param {?} control
     * @param {?} errors
     * @return {?}
     */
    function (control, errors) {
        control[ReactiveFormsRuleService.CONTROL_LAST_ERROR] = errors;
    };
    /**
     * @param {?} control
     * @return {?}
     */
    ReactiveFormsRuleService.prototype.getLastErrorForControl = /**
     * @param {?} control
     * @return {?}
     */
    function (control) {
        return control[ReactiveFormsRuleService.CONTROL_LAST_ERROR];
    };
    /**
     * @param {?} control
     * @return {?}
     */
    ReactiveFormsRuleService.prototype.doesControlHaveForcedAsyncValidation = /**
     * @param {?} control
     * @return {?}
     */
    function (control) {
        return !!(control[ReactiveFormsRuleService.FORCE_ASYNC_VALID_TEST_RUN_PROPERTY_NAME]);
    };
    /**
     * @param {?} control
     * @return {?}
     */
    ReactiveFormsRuleService.prototype.triggerValueChange = /**
     * @param {?} control
     * @return {?}
     */
    function (control) {
        control.patchValue(control.value);
    };
    ReactiveFormsRuleService.FORM_MODEL_SETTINGS_PROPERTY_NAME = 'ngFormRulesModelSetting';
    ReactiveFormsRuleService.FORCE_ASYNC_VALID_TEST_RUN_PROPERTY_NAME = 'ngFormRulesForceAsyncValidTestRun';
    ReactiveFormsRuleService.CONTROL_LAST_ERROR = 'ngFormRulesControlLastError';
    ReactiveFormsRuleService.decorators = [
        { type: Injectable },
    ];
    /** @nocollapse */
    ReactiveFormsRuleService.ctorParameters = function () { return [
        { type: RulesEngineService, },
        { type: FormBuilder, },
        { type: TraceService, },
        { type: CommonService, },
    ]; };
    return ReactiveFormsRuleService;
}());

/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes} checked by tsc
 */
var UtilsModule = /** @class */ (function () {
    function UtilsModule() {
    }
    UtilsModule.decorators = [
        { type: NgModule, args: [{
                    imports: [],
                    declarations: [],
                    providers: [
                        TraceService,
                        CommonService
                    ]
                },] },
    ];
    return UtilsModule;
}());

/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes} checked by tsc
 */
var RulesEngineModule = /** @class */ (function () {
    function RulesEngineModule() {
    }
    RulesEngineModule.decorators = [
        { type: NgModule, args: [{
                    imports: [
                        CommonModule,
                        UtilsModule
                    ],
                    providers: [
                        RulesEngineService,
                        ReactiveFormsRuleService
                    ],
                    declarations: []
                },] },
    ];
    return RulesEngineModule;
}());

/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes} checked by tsc
 */
/**
 * Main module for ng-form-rules
 */
var FormRulesModule = /** @class */ (function () {
    function FormRulesModule() {
    }
    FormRulesModule.decorators = [
        { type: NgModule, args: [{
                    imports: [
                        CommonModule,
                        RulesEngineModule,
                    ],
                    declarations: [],
                    exports: [
                        RulesEngineModule,
                    ]
                },] },
    ];
    return FormRulesModule;
}());

/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes} checked by tsc
 */
/**
 * Non-array item property
 * @template T
 */
var  /**
 * Non-array item property
 * @template T
 */
Property = /** @class */ (function (_super) {
    __extends(Property, _super);
    function Property(name) {
        var _this = _super.call(this) || this;
        _this._name = name;
        return _this;
    }
    Object.defineProperty(Property.prototype, "name", {
        /**
         * Name of the property
         */
        get: /**
         * Name of the property
         * @return {?}
         */
        function () {
            return this._name;
        },
        enumerable: true,
        configurable: true
    });
    return Property;
}(PropertyBase));

/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes} checked by tsc
 */
/**
 * A property representing an array item (e.g. an array of Address objects)
 * @template T
 */
var  /**
 * A property representing an array item (e.g. an array of Address objects)
 * @template T
 */
ArrayItemProperty = /** @class */ (function (_super) {
    __extends(ArrayItemProperty, _super);
    function ArrayItemProperty() {
        return _super !== null && _super.apply(this, arguments) || this;
    }
    return ArrayItemProperty;
}(PropertyBase));

/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes} checked by tsc
 */
/**
 * Utility class for building model settings
 */
var  /**
 * Utility class for building model settings
 */
ModelSettingsBuilder = /** @class */ (function () {
    function ModelSettingsBuilder() {
    }
    /**
     * Creates a property
     * @param propertyName Property name
     * @param extend Function to extend the property
     * @returns Created property
     */
    /**
     * Creates a property
     * @template T
     * @param {?} propertyName Property name
     * @param {?=} extend Function to extend the property
     * @return {?} Created property
     */
    ModelSettingsBuilder.prototype.property = /**
     * Creates a property
     * @template T
     * @param {?} propertyName Property name
     * @param {?=} extend Function to extend the property
     * @return {?} Created property
     */
    function (propertyName, extend) {
        if (!propertyName || typeof propertyName !== 'string')
            throw Error('Invalid property name');
        var /** @type {?} */ property = new Property(propertyName);
        if (extend)
            extend(property);
        return property;
    };
    /**
     * Creates an array item property
     * @param extend Function to extend the array item property
     * @returns Created array item property
     */
    /**
     * Creates an array item property
     * @template T
     * @param {?=} extend Function to extend the array item property
     * @return {?} Created array item property
     */
    ModelSettingsBuilder.prototype.arrayItemProperty = /**
     * Creates an array item property
     * @template T
     * @param {?=} extend Function to extend the array item property
     * @return {?} Created array item property
     */
    function (extend) {
        var /** @type {?} */ property = new ArrayItemProperty();
        if (extend)
            extend(property);
        return property;
    };
    /**
     * Creates a validation test
     * @param message Message when the test fails
     * @param check Check rule set for the test
     * @param condition Condition rule set for the test
     * @returns Created validation test
     */
    /**
     * Creates a validation test
     * @template T
     * @param {?} message Message when the test fails
     * @param {?} check Check rule set for the test
     * @param {?=} condition Condition rule set for the test
     * @return {?} Created validation test
     */
    ModelSettingsBuilder.prototype.validTest = /**
     * Creates a validation test
     * @template T
     * @param {?} message Message when the test fails
     * @param {?} check Check rule set for the test
     * @param {?=} condition Condition rule set for the test
     * @return {?} Created validation test
     */
    function (message, check, condition) {
        return this.validNamedTest(null, message, check, condition);
    };
    /**
     * Creates a named validation test
     * @param name Name of the test
     * @param message Message when the test fails
     * @param check Check rule set for the test
     * @param condition Condition rule set for the test
     * @returns Created named validation test
     */
    /**
     * Creates a named validation test
     * @template T
     * @param {?} name Name of the test
     * @param {?} message Message when the test fails
     * @param {?} check Check rule set for the test
     * @param {?=} condition Condition rule set for the test
     * @return {?} Created named validation test
     */
    ModelSettingsBuilder.prototype.validNamedTest = /**
     * Creates a named validation test
     * @template T
     * @param {?} name Name of the test
     * @param {?} message Message when the test fails
     * @param {?} check Check rule set for the test
     * @param {?=} condition Condition rule set for the test
     * @return {?} Created named validation test
     */
    function (name, message, check, condition) {
        return /** @type {?} */ ({
            name: name,
            message: message,
            check: check,
            condition: condition
        });
    };
    /**
     * Creates an edit test
     * @param check Check rule set for the test
     * @param condition Condition rule set for the test
     * @returns Created edit test
     */
    /**
     * Creates an edit test
     * @template T
     * @param {?} check Check rule set for the test
     * @param {?=} condition Condition rule set for the test
     * @return {?} Created edit test
     */
    ModelSettingsBuilder.prototype.editTest = /**
     * Creates an edit test
     * @template T
     * @param {?} check Check rule set for the test
     * @param {?=} condition Condition rule set for the test
     * @return {?} Created edit test
     */
    function (check, condition) {
        return this.editNamedTest(null, check, condition);
    };
    /**
     * Creates a named edit test
     * @param name Name of the test
     * @param check Check rule set for the test
     * @param condition Condition rule set for the test
     * @returns Created named edit test
     */
    /**
     * Creates a named edit test
     * @template T
     * @param {?} name Name of the test
     * @param {?} check Check rule set for the test
     * @param {?=} condition Condition rule set for the test
     * @return {?} Created named edit test
     */
    ModelSettingsBuilder.prototype.editNamedTest = /**
     * Creates a named edit test
     * @template T
     * @param {?} name Name of the test
     * @param {?} check Check rule set for the test
     * @param {?=} condition Condition rule set for the test
     * @return {?} Created named edit test
     */
    function (name, check, condition) {
        return /** @type {?} */ ({
            name: name,
            check: check,
            condition: condition
        });
    };
    /**
     * Creates a rule
     * @param func Function for the rule
     * @param options Additional rule options
     * @returns Created rule
     */
    /**
     * Creates a rule
     * @template T, R
     * @param {?} func Function for the rule
     * @param {?=} options Additional rule options
     * @return {?} Created rule
     */
    ModelSettingsBuilder.prototype.rule = /**
     * Creates a rule
     * @template T, R
     * @param {?} func Function for the rule
     * @param {?=} options Additional rule options
     * @return {?} Created rule
     */
    function (func, options) {
        return this.ruleCombo(func, null, options);
    };
    /**
     * Creates an async rule
     * @param asyncFunc Async function for the rule
     * @param options Additional rule options
     * @returns Created rule
     */
    /**
     * Creates an async rule
     * @template T, R
     * @param {?} asyncFunc Async function for the rule
     * @param {?=} options Additional rule options
     * @return {?} Created rule
     */
    ModelSettingsBuilder.prototype.ruleAsync = /**
     * Creates an async rule
     * @template T, R
     * @param {?} asyncFunc Async function for the rule
     * @param {?=} options Additional rule options
     * @return {?} Created rule
     */
    function (asyncFunc, options) {
        return this.ruleCombo(null, asyncFunc, options);
    };
    /**
     * Creates a combo rule that has both syncronous and async functions
     * @param func Function for the rule
     * @param asyncFunc Async function for the rule
     * @param options Additional rule options
     * @returns Created rule
     */
    /**
     * Creates a combo rule that has both syncronous and async functions
     * @template T, R
     * @param {?} func Function for the rule
     * @param {?} asyncFunc Async function for the rule
     * @param {?=} options Additional rule options
     * @return {?} Created rule
     */
    ModelSettingsBuilder.prototype.ruleCombo = /**
     * Creates a combo rule that has both syncronous and async functions
     * @template T, R
     * @param {?} func Function for the rule
     * @param {?} asyncFunc Async function for the rule
     * @param {?=} options Additional rule options
     * @return {?} Created rule
     */
    function (func, asyncFunc, options) {
        return /** @type {?} */ ({
            func: func,
            asyncFunc: asyncFunc,
            options: options
        });
    };
    /**
     * Creates a rule group
     * @param ruleSets Rule sets for the rule group
     * @param options Additional rule group options
     * @returns Created rule group
     */
    /**
     * Creates a rule group
     * @template T
     * @param {?} ruleSets Rule sets for the rule group
     * @param {?=} options Additional rule group options
     * @return {?} Created rule group
     */
    ModelSettingsBuilder.prototype.ruleGroup = /**
     * Creates a rule group
     * @template T
     * @param {?} ruleSets Rule sets for the rule group
     * @param {?=} options Additional rule group options
     * @return {?} Created rule group
     */
    function (ruleSets, options) {
        return /** @type {?} */ ({
            rules: ruleSets,
            options: options || { resultRequirements: ResultsPassRequirement.AllPass }
        });
    };
    return ModelSettingsBuilder;
}());

/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes} checked by tsc
 */
/**
 * Base class for model settings
 * @abstract
 * @template T
 */
var  /**
 * Base class for model settings
 * @abstract
 * @template T
 */
AbstractModelSettings = /** @class */ (function () {
    /**
     * Creates model settings
     * @param name Name of the model settings
     */
    function AbstractModelSettings(name) {
        this.builder = new ModelSettingsBuilder();
        this._name = name;
        this.properties = this.buildProperties() || [];
    }
    Object.defineProperty(AbstractModelSettings.prototype, "name", {
        /**
         * Name of the model setting
         */
        get: /**
         * Name of the model setting
         * @return {?}
         */
        function () {
            return this._name;
        },
        enumerable: true,
        configurable: true
    });
    return AbstractModelSettings;
}());

/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes} checked by tsc
 */
/**
 * @template T
 */
var  /**
 * @template T
 */
PropertyTestResults = /** @class */ (function (_super) {
    __extends(PropertyTestResults, _super);
    function PropertyTestResults(propertyName, results) {
        var _this = _super.call(this, results) || this;
        _this.propertyName = propertyName;
        return _this;
    }
    return PropertyTestResults;
}(TestResultsBase));

/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes} checked by tsc
 */
/**
 * Class for creating adhoc (non-registered) model settings
 * @template T
 */
var  /**
 * Class for creating adhoc (non-registered) model settings
 * @template T
 */
AdhocModelSettings = /** @class */ (function (_super) {
    __extends(AdhocModelSettings, _super);
    function AdhocModelSettings() {
        // since these settings are not registered, just use a static name
        return _super.call(this, 'adhoc') || this;
    }
    /**
     * Creates model settings
     * @param propertyBuilderFunc Function that takes a ModelSettingsBuilder and uses it to return an array of properties
     * @returns Model settings configured with properties returned from the 'propertyBuilderFunc' function parameter
     */
    /**
     * Creates model settings
     * @template T
     * @param {?} propertyBuilderFunc Function that takes a ModelSettingsBuilder and uses it to return an array of properties
     * @return {?} Model settings configured with properties returned from the 'propertyBuilderFunc' function parameter
     */
    AdhocModelSettings.create = /**
     * Creates model settings
     * @template T
     * @param {?} propertyBuilderFunc Function that takes a ModelSettingsBuilder and uses it to return an array of properties
     * @return {?} Model settings configured with properties returned from the 'propertyBuilderFunc' function parameter
     */
    function (propertyBuilderFunc) {
        var /** @type {?} */ instance = new AdhocModelSettings();
        instance.properties = !!propertyBuilderFunc ? propertyBuilderFunc(instance.builder) || [] : [];
        return instance;
    };
    /**
     * @return {?}
     */
    AdhocModelSettings.prototype.buildProperties = /**
     * @return {?}
     */
    function () {
        // this is just needed to satisfy the AbstractModelSettings<T> contract
        return [];
    };
    return AdhocModelSettings;
}(AbstractModelSettings));

/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes} checked by tsc
 */
/**
 * Options for how and when to process value changes in a form control
 */
var  /**
 * Options for how and when to process value changes in a form control
 */
ValueChangeOptions = /** @class */ (function () {
    function ValueChangeOptions() {
    }
    return ValueChangeOptions;
}());

/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes} checked by tsc
 */

/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes} checked by tsc
 */

export { FormRulesModule, MODEL_SETTINGS_TOKEN, TRACE_SETTINGS_TOKEN, ReactiveFormsRuleService, AbstractModelSettings, ArrayItemProperty, ControlState, PropertyBase, PropertyTestResults, Property, TestResultsBase, AdhocModelSettings, ValueChangeOptions, ResultsPassRequirement, ModelSettingsBuilder, RulesEngineModule as a, RulesEngineService as e, CommonService as d, TraceService as c, UtilsModule as b };

//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibmctZm9ybS1ydWxlcy5qcy5tYXAiLCJzb3VyY2VzIjpbIm5nOi8vbmctZm9ybS1ydWxlcy9saWIvZm9ybS1ydWxlcy9pbmplY3Rpb24tdG9rZW5zL21vZGVsLXNldHRpbmdzLnRva2VuLnRzIiwibmc6Ly9uZy1mb3JtLXJ1bGVzL2xpYi9mb3JtLXJ1bGVzL2luamVjdGlvbi10b2tlbnMvdHJhY2Utc2V0dGluZ3MudG9rZW4udHMiLCJuZzovL25nLWZvcm0tcnVsZXMvbGliL3V0aWxzL3RyYWNlL3RyYWNlLnNlcnZpY2UudHMiLCJuZzovL25nLWZvcm0tcnVsZXMvbGliL3V0aWxzL2NvbW1vbi9jb21tb24uc2VydmljZS50cyIsIm5nOi8vbmctZm9ybS1ydWxlcy9saWIvZm9ybS1ydWxlcy9tb2RlbHMvdGVzdC1yZXN1bHRzLWJhc2UudHMiLCJuZzovL25nLWZvcm0tcnVsZXMvbGliL2Zvcm0tcnVsZXMvbW9kZWxzL3Byb3BlcnR5LWJhc2UudHMiLCJuZzovL25nLWZvcm0tcnVsZXMvbGliL3J1bGVzLWVuZ2luZS9zZXJ2aWNlcy9ydWxlcy1lbmdpbmUvcnVsZXMtZW5naW5lLnNlcnZpY2UudHMiLCJuZzovL25nLWZvcm0tcnVsZXMvbGliL2Zvcm0tcnVsZXMvbW9kZWxzL2NvbnRyb2wtc3RhdGUudHMiLCJuZzovL25nLWZvcm0tcnVsZXMvbGliL3J1bGVzLWVuZ2luZS9zZXJ2aWNlcy9yZWFjdGl2ZS1mb3Jtcy1ydWxlL3JlYWN0aXZlLWZvcm1zLXJ1bGUuc2VydmljZS50cyIsIm5nOi8vbmctZm9ybS1ydWxlcy9saWIvdXRpbHMvdXRpbHMubW9kdWxlLnRzIiwibmc6Ly9uZy1mb3JtLXJ1bGVzL2xpYi9ydWxlcy1lbmdpbmUvcnVsZXMtZW5naW5lLm1vZHVsZS50cyIsIm5nOi8vbmctZm9ybS1ydWxlcy9saWIvZm9ybS1ydWxlcy9mb3JtLXJ1bGVzLm1vZHVsZS50cyIsIm5nOi8vbmctZm9ybS1ydWxlcy9saWIvZm9ybS1ydWxlcy9tb2RlbHMvcHJvcGVydHkudHMiLCJuZzovL25nLWZvcm0tcnVsZXMvbGliL2Zvcm0tcnVsZXMvbW9kZWxzL2FycmF5LWl0ZW0tcHJvcGVydHkudHMiLCJuZzovL25nLWZvcm0tcnVsZXMvbGliL2Zvcm0tcnVsZXMvaGVscGVyL21vZGVsLXNldHRpbmdzLWJ1aWxkZXIudHMiLCJuZzovL25nLWZvcm0tcnVsZXMvbGliL2Zvcm0tcnVsZXMvbW9kZWxzL2Fic3RyYWN0LW1vZGVsLXNldHRpbmdzLnRzIiwibmc6Ly9uZy1mb3JtLXJ1bGVzL2xpYi9mb3JtLXJ1bGVzL21vZGVscy9wcm9wZXJ0eS10ZXN0LXJlc3VsdC50cyIsIm5nOi8vbmctZm9ybS1ydWxlcy9saWIvZm9ybS1ydWxlcy9tb2RlbHMvYWRob2MtbW9kZWwtc2V0dGluZ3MudHMiLCJuZzovL25nLWZvcm0tcnVsZXMvbGliL2Zvcm0tcnVsZXMvbW9kZWxzL3ZhbHVlLWNoYW5nZS1vcHRpb25zLnRzIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IEluamVjdGlvblRva2VuIH0gZnJvbSBcIkBhbmd1bGFyL2NvcmVcIjtcclxuXHJcbi8qKlxyXG4gKiBJbmplY3Rpb24gdG9rZW4gZm9yIHByb3ZpZGluZyBhbiBhcnJheSBvZiBtb2RlbCBzZXR0aW5nc1xyXG4gKi9cclxuZXhwb3J0IGxldCBNT0RFTF9TRVRUSU5HU19UT0tFTiA9IG5ldyBJbmplY3Rpb25Ub2tlbjxzdHJpbmc+KCduZ2ZyLm1vZGVsLXNldHRpbmdzJyk7IiwiaW1wb3J0IHsgSW5qZWN0aW9uVG9rZW4gfSBmcm9tIFwiQGFuZ3VsYXIvY29yZVwiO1xyXG5cclxuLyoqXHJcbiAqIEluamVjdGlvbiB0b2tlbiBmb3IgZW5hYmxpbmcgbmctZm9ybS1ydWxlcyB0cmFjaW5nXHJcbiAqL1xyXG5leHBvcnQgbGV0IFRSQUNFX1NFVFRJTkdTX1RPS0VOID0gbmV3IEluamVjdGlvblRva2VuPHN0cmluZz4oJ25nZnIudHJhY2Utc2V0dGluZ3MnKTsiLCJpbXBvcnQgeyBJbmplY3RhYmxlLCBJbmplY3QsIE9wdGlvbmFsIH0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XHJcbmltcG9ydCB7IFRSQUNFX1NFVFRJTkdTX1RPS0VOIH0gZnJvbSAnLi4vLi4vZm9ybS1ydWxlcy9pbmplY3Rpb24tdG9rZW5zL3RyYWNlLXNldHRpbmdzLnRva2VuJztcclxuXHJcbkBJbmplY3RhYmxlKClcclxuZXhwb3J0IGNsYXNzIFRyYWNlU2VydmljZSB7XHJcbiAgICBjb25zdHJ1Y3RvcihcclxuICAgICAgICBAT3B0aW9uYWwoKSBASW5qZWN0KFRSQUNFX1NFVFRJTkdTX1RPS0VOKSBwcml2YXRlIGRvVHJhY2U6IGJvb2xlYW4gPSBmYWxzZVxyXG4gICAgKSB7XHJcbiAgICB9XHJcblxyXG4gICAgdHJhY2UobXNnOiBzdHJpbmcpIHtcclxuICAgICAgICBpZiAoIXRoaXMuZG9UcmFjZSkgcmV0dXJuO1xyXG5cclxuICAgICAgICBjb25zdCBmdWxsTXNnID0gYFtOR0ZSIC0gJHt0aGlzLmdldFRpbWVTdGFtcCgpfV0gJHttc2d9YDtcclxuICAgICAgICBjb25zb2xlLmxvZyhmdWxsTXNnKTtcclxuICAgIH1cclxuXHJcbiAgICBwcml2YXRlIGdldFRpbWVTdGFtcCgpOiBzdHJpbmcge1xyXG4gICAgICAgIHJldHVybiAobmV3IERhdGUpLnRvTG9jYWxlVGltZVN0cmluZygpO1xyXG4gICAgfVxyXG59XHJcbiIsImltcG9ydCB7IEluamVjdGFibGUgfSBmcm9tICdAYW5ndWxhci9jb3JlJztcclxuXHJcbkBJbmplY3RhYmxlKClcclxuZXhwb3J0IGNsYXNzIENvbW1vblNlcnZpY2Uge1xyXG4gICAgLyoqXHJcbiAgICAgKiBHZXRzIHVuaXF1ZSB2YWx1ZXMgZnJvbSBhbiBhcnJheVxyXG4gICAgICogQHBhcmFtIHZhbHVlcyBWYWx1ZXMgdG8gZ2V0IHVuaXF1ZSBpdGVtcyBmcm9tXHJcbiAgICAgKiBAcmV0dXJucyBVbmlxdWUgdmFsdWVzIGFycmF5XHJcbiAgICAgKi9cclxuICAgIHVuaXF1ZSh2YWx1ZXM6IGFueVtdKTogYW55W10ge1xyXG4gICAgICAgIGlmICghQXJyYXkuaXNBcnJheSh2YWx1ZXMpKSByZXR1cm4gW107XHJcblxyXG4gICAgICAgIHJldHVybiBBcnJheS5mcm9tKG5ldyBTZXQodmFsdWVzKSk7XHJcbiAgICB9XHJcblxyXG4gICAgLyoqXHJcbiAgICAgKiBEZXRlcm1pbmVzIGlmIG51bWJlciBpcyB6ZXJvIG9yIGdyZWF0ZXJcclxuICAgICAqIEBwYXJhbSB2YWx1ZSBJZiBudW1iZXIgaXMgZ3JlYXRlciB0aGFuIG9yIGVxdWFsIHplcm9cclxuICAgICAqL1xyXG4gICAgaXNaZXJvT3JHcmVhdGVyKHZhbHVlOiBudW1iZXIpOiBib29sZWFuIHtcclxuICAgICAgICBpZiAoIXZhbHVlICYmIHZhbHVlID09PSAwKSByZXR1cm4gdHJ1ZTtcclxuXHJcbiAgICAgICAgaWYgKCF2YWx1ZSB8fCB0eXBlb2YgdmFsdWUgIT09IFwibnVtYmVyXCIpIHJldHVybiBmYWxzZTtcclxuXHJcbiAgICAgICAgcmV0dXJuIHZhbHVlID4gMDtcclxuICAgIH1cclxufVxyXG4iLCJpbXBvcnQgeyBUZXN0UmVzdWx0IH0gZnJvbSBcIi4vdGVzdC1yZXN1bHRcIjtcclxuXHJcbi8qKlxyXG4gKiBSZXN1bHRzIG9mIGV4ZWN1dGluZyBhIGNvbGxlY3Rpb24gb2YgdGVzdHNcclxuICovXHJcbmV4cG9ydCBjbGFzcyBUZXN0UmVzdWx0c0Jhc2U8VD4ge1xyXG4gICAgY29uc3RydWN0b3IocHVibGljIHJlc3VsdHM6IFRlc3RSZXN1bHQ8VD5bXSkge1xyXG4gICAgICAgIHRoaXMucmVzdWx0cyA9IHRoaXMucmVzdWx0cyB8fCBbXTtcclxuICAgIH1cclxuXHJcbiAgICAvKipcclxuICAgICAqIFdoZXRoZXIgdGhlIHRlc3RzIHBhc3NlZFxyXG4gICAgICovXHJcbiAgICBnZXQgcGFzc2VkKCk6IGJvb2xlYW4ge1xyXG4gICAgICAgIHJldHVybiAhdGhpcy5mYWlsZWRSZXN1bHRzLmxlbmd0aDtcclxuICAgIH1cclxuXHJcbiAgICAvKipcclxuICAgICAqIEFycmF5IG9mIHRlc3QgcmVzdWx0cyB0aGF0IHBhc3NlZFxyXG4gICAgICovXHJcbiAgICBnZXQgcGFzc2VkUmVzdWx0cygpOiBUZXN0UmVzdWx0PFQ+W10ge1xyXG4gICAgICAgIHJldHVybiB0aGlzLnJlc3VsdHMuZmlsdGVyKHggPT4gISF4LnBhc3NlZCAmJiAheC5za2lwcGVkKTtcclxuICAgIH1cclxuXHJcbiAgICAvKipcclxuICAgICAqIEFycmF5IG9mIHRlc3QgcmVzdWx0cyB0aGF0IGZhaWxlZFxyXG4gICAgICovXHJcbiAgICBnZXQgZmFpbGVkUmVzdWx0cygpOiBUZXN0UmVzdWx0PFQ+W10ge1xyXG4gICAgICAgIHJldHVybiB0aGlzLnJlc3VsdHMuZmlsdGVyKHggPT4gIXgucGFzc2VkKTtcclxuICAgIH1cclxuXHJcbiAgICAvKipcclxuICAgICAqIEFycmF5IG9mIHRlc3QgcmVzdWx0cyB0aGF0IHdlcmUgc2tpcHBlZFxyXG4gICAgICovXHJcbiAgICBnZXQgc2tpcHBlZFJlc3VsdHMoKTogVGVzdFJlc3VsdDxUPltdIHtcclxuICAgICAgICByZXR1cm4gdGhpcy5yZXN1bHRzLmZpbHRlcih4ID0+ICEheC5za2lwcGVkKTtcclxuICAgIH1cclxuXHJcbiAgICAvKipcclxuICAgICAqIE1lc3NhZ2Ugb2YgdGhlIGZpcnN0IHRlc3QgdGhhdCBmYWlsZWRcclxuICAgICAqL1xyXG4gICAgZ2V0IG1lc3NhZ2UoKTogc3RyaW5nIHtcclxuICAgICAgICByZXR1cm4gdGhpcy5tZXNzYWdlc1swXTtcclxuICAgIH1cclxuXHJcbiAgICAvKipcclxuICAgICAqIE1lc3NhZ2VzIG9mIGFsbCBmYWlsZWQgdGVzdHNcclxuICAgICAqL1xyXG4gICAgZ2V0IG1lc3NhZ2VzKCk6IHN0cmluZ1tdIHtcclxuICAgICAgICBjb25zdCBtZXNzYWdlcyA9IHRoaXMuZmFpbGVkUmVzdWx0cy5tYXAoeCA9PiB4Lm1lc3NhZ2UpO1xyXG4gICAgICAgIHJldHVybiBBcnJheS5mcm9tKG5ldyBTZXQobWVzc2FnZXMpKTtcclxuICAgIH1cclxufSIsImltcG9ydCB7IFRlc3QgfSBmcm9tIFwiLi90ZXN0XCI7XHJcbmltcG9ydCB7IFByb3BlcnR5IH0gZnJvbSBcIi4vcHJvcGVydHlcIjtcclxuaW1wb3J0IHsgQXJyYXlJdGVtUHJvcGVydHkgfSBmcm9tIFwiLi9hcnJheS1pdGVtLXByb3BlcnR5XCI7XHJcbmltcG9ydCB7IFN1YnNjcmlwdGlvbiB9IGZyb20gXCJyeGpzXCI7XHJcbmltcG9ydCB7IFZhbHVlQ2hhbmdlT3B0aW9ucyB9IGZyb20gXCIuL3ZhbHVlLWNoYW5nZS1vcHRpb25zXCI7XHJcbmltcG9ydCB7IFVwZGF0ZU9uIH0gZnJvbSBcIi4vdXBkYXRlLW9uXCI7XHJcblxyXG4vKipcclxuICogQmFzZSBjbGFzcyBmb3IgYSBwcm9wZXJ0eVxyXG4gKi9cclxuZXhwb3J0IGFic3RyYWN0IGNsYXNzIFByb3BlcnR5QmFzZTxUPiB7XHJcbiAgICBwcml2YXRlIF9hYnNvbHV0ZVBhdGg6IHN0cmluZztcclxuICAgIHByaXZhdGUgX2RlcGVuZGVuY3lQcm9wZXJ0eVN1YnNjcmlwdGlvbnM6IFN1YnNjcmlwdGlvbltdID0gW107XHJcbiAgICBwcml2YXRlIF9vd25lck1vZGVsU2V0dGluZ3NOYW1lOiBzdHJpbmc7XHJcblxyXG4gICAgLyoqXHJcbiAgICAgKiBWYWxpZGF0aW9uIHRlc3RzXHJcbiAgICAgKi9cclxuICAgIHZhbGlkOiBUZXN0PFQ+W10gPSBbXTtcclxuXHJcbiAgICAvKipcclxuICAgICAqIEVkaXRhYmlsaXR5IHRlc3RzXHJcbiAgICAgKi9cclxuICAgIGVkaXQ6IFRlc3Q8VD5bXSA9IFtdO1xyXG5cclxuICAgIC8qKlxyXG4gICAgICogVmlld2FiaWxpdHkgdGVzdHNcclxuICAgICAqL1xyXG4gICAgLy8gdmlldzogVGVzdDxUPltdID0gW107XHJcblxyXG4gICAgLyoqXHJcbiAgICAgKiBQcm9wZXJ0aWVzIGZvciBhIGNvbXBsZXggb2JqZWN0XHJcbiAgICAgKi9cclxuICAgIHByb3BlcnRpZXM/OiBQcm9wZXJ0eTxhbnk+W107XHJcblxyXG4gICAgLyoqXHJcbiAgICAgKiBQcm9wZXJ0eSBmb3IgYW4gaXRlbSBvZiBhbiBhcnJheVxyXG4gICAgICovXHJcbiAgICBhcnJheUl0ZW1Qcm9wZXJ0eT86IEFycmF5SXRlbVByb3BlcnR5PGFueT47XHJcblxyXG4gICAgLyoqXHJcbiAgICAgKiBUaGUgZXZlbnQgbmFtZSBmb3IgY29udHJvbCB0byB1cGRhdGUgdXBvbi5cclxuICAgICAqL1xyXG4gICAgdXBkYXRlT24/OiBVcGRhdGVPbiA9ICdjaGFuZ2UnO1xyXG5cclxuICAgIC8qKlxyXG4gICAgICogQWJzb2x1dGUgcGF0aCB0byB0aGUgcHJvcGVydHkgZnJvbSByb290XHJcbiAgICAgKi9cclxuICAgIGdldCBhYnNvbHV0ZVBhdGgoKTogc3RyaW5nIHtcclxuICAgICAgICByZXR1cm4gdGhpcy5fYWJzb2x1dGVQYXRoO1xyXG4gICAgfVxyXG5cclxuICAgIC8qKlxyXG4gICAgICogQWJzb2x1dGUgcGF0aCB0byBwcm9wZXJ0eSBmcm9tIHJvb3RcclxuICAgICAqL1xyXG4gICAgZ2V0IGRlcGVuZGVuY3lQcm9wZXJ0eVN1YnNjcmlwdGlvbnMoKTogU3Vic2NyaXB0aW9uW10ge1xyXG4gICAgICAgIHJldHVybiB0aGlzLl9kZXBlbmRlbmN5UHJvcGVydHlTdWJzY3JpcHRpb25zO1xyXG4gICAgfVxyXG5cclxuICAgIC8qKlxyXG4gICAgICogQWJzb2x1dGUgcGF0aCB0byBwcm9wZXJ0eSBmcm9tIHJvb3RcclxuICAgICAqL1xyXG4gICAgZ2V0IG93bmVyTW9kZWxTZXR0aW5nc05hbWUoKTogc3RyaW5nIHtcclxuICAgICAgICByZXR1cm4gdGhpcy5fb3duZXJNb2RlbFNldHRpbmdzTmFtZTtcclxuICAgIH1cclxuXHJcbiAgICAvKipcclxuICAgICAqIE9wdGlvbnMgZm9yIGhvdyB0byByZXNwb25kIHRvIHZhbHVlIGNoYW5nZXMgb24gcHJvcGVydHkgY29udHJvbCBhbmQgZGVwZW5kZW5jeSBjb250cm9sc1xyXG4gICAgICovXHJcbiAgICB2YWx1ZUNoYW5nZU9wdGlvbnM6IHtcclxuICAgICAgICBkZXBlbmRlbmN5UHJvcGVydGllczoge1xyXG4gICAgICAgICAgICB2YWxpZDogVmFsdWVDaGFuZ2VPcHRpb25zLFxyXG4gICAgICAgICAgICBlZGl0OiBWYWx1ZUNoYW5nZU9wdGlvbnNcclxuICAgICAgICB9LFxyXG4gICAgICAgIHNlbGY6IHtcclxuICAgICAgICAgICAgYXN5bmNWYWxpZDogVmFsdWVDaGFuZ2VPcHRpb25zLFxyXG4gICAgICAgICAgICBlZGl0OiBWYWx1ZUNoYW5nZU9wdGlvbnNcclxuICAgICAgICB9XHJcbiAgICB9ID0ge1xyXG4gICAgICAgIGRlcGVuZGVuY3lQcm9wZXJ0aWVzOiB7XHJcbiAgICAgICAgICAgIHZhbGlkOiB7IGRpc3RpbmN0VW50aWxDaGFuZ2VkOiBmYWxzZSwgZGVib3VuY2VNaWxsaXNlY29uZHM6IDAgfSxcclxuICAgICAgICAgICAgZWRpdDogeyBkaXN0aW5jdFVudGlsQ2hhbmdlZDogZmFsc2UsIGRlYm91bmNlTWlsbGlzZWNvbmRzOiAwIH1cclxuICAgICAgICB9LFxyXG4gICAgICAgIHNlbGY6IHtcclxuICAgICAgICAgICAgYXN5bmNWYWxpZDogeyBkaXN0aW5jdFVudGlsQ2hhbmdlZDogZmFsc2UsIGRlYm91bmNlTWlsbGlzZWNvbmRzOiAwIH0sXHJcbiAgICAgICAgICAgIGVkaXQ6IHsgZGlzdGluY3RVbnRpbENoYW5nZWQ6IGZhbHNlLCBkZWJvdW5jZU1pbGxpc2Vjb25kczogMCB9XHJcbiAgICAgICAgfVxyXG4gICAgfTtcclxuXHJcbiAgICAvKipcclxuICAgICAqIERldGVybWluZXMgaWYgdGhlIHByb3BlcnR5IGlzIGFuIEFycmF5SXRlbVByb3BlcnR5XHJcbiAgICAgKiBAcGFyYW0gcHJvcGVydHkgUHJvcGVydHkgdG8gY2hlY2tcclxuICAgICAqIEByZXR1cm5zIFdoZXRoZXIgb3Igbm90IHRoZSBwcm9wZXJ0eSBpcyBhbiBBcnJheUl0ZW1Qcm9wZXJ0eVxyXG4gICAgICovXHJcbiAgICBzdGF0aWMgaXNBcnJheUl0ZW1Qcm9wZXJ0eTxUPihwcm9wZXJ0eTogUHJvcGVydHlCYXNlPFQ+KTogYm9vbGVhbiB7XHJcbiAgICAgICAgcmV0dXJuICEocHJvcGVydHkgYXMgUHJvcGVydHk8VD4pLm5hbWU7XHJcbiAgICB9XHJcblxyXG4gICAgLyoqXHJcbiAgICAgKiBETyBOT1QgQ0FMTCEgSW50ZXJuYWwgdXNlIG9ubHlcclxuICAgICAqIEBwYXJhbSBhYnNvbHV0ZVBhdGggQWJzb2x1dGUgcGF0aCB0byB0aGUgcHJvcGVydHkgZnJvbSB0aGUgcm9vdFxyXG4gICAgICovXHJcbiAgICBzZXRBYnNvbHV0ZVBhdGgoYWJzb2x1dGVQYXRoOiBzdHJpbmcpOiB2b2lkIHtcclxuICAgICAgICB0aGlzLl9hYnNvbHV0ZVBhdGggPSBhYnNvbHV0ZVBhdGg7XHJcbiAgICB9XHJcblxyXG4gICAgLyoqXHJcbiAgICAgKiBETyBOT1QgQ0FMTCEgSW50ZXJuYWwgdXNlIG9ubHlcclxuICAgICAqIEBwYXJhbSBzdWJzY3JpcHRpb24gU3Vic2NyaXB0aW9uIGZvciB0aGUgZGVwZW5kZW5jeSBwcm9wZXJ0eVxyXG4gICAgICovXHJcbiAgICBhZGREZXBlbmRlbmN5UHJvcGVydHlTdWJzY3JpcHRpb24oc3Vic2NyaXB0aW9uOiBTdWJzY3JpcHRpb24pOiB2b2lkIHtcclxuICAgICAgICB0aGlzLl9kZXBlbmRlbmN5UHJvcGVydHlTdWJzY3JpcHRpb25zLnB1c2goc3Vic2NyaXB0aW9uKTtcclxuICAgIH1cclxuXHJcbiAgICAvKipcclxuICAgICAqIERPIE5PVCBDQUxMISBJbnRlcm5hbCB1c2Ugb25seVxyXG4gICAgICovXHJcbiAgICBjbGVhckRlcGVuZGVuY3lQcm9wZXJ0eVN1YnNjcmlwdGlvbnMoKTogdm9pZCB7XHJcbiAgICAgICAgdGhpcy5kZXBlbmRlbmN5UHJvcGVydHlTdWJzY3JpcHRpb25zLmZvckVhY2goc3ViJCA9PiBzdWIkLnVuc3Vic2NyaWJlKCkpO1xyXG4gICAgICAgIHRoaXMuX2RlcGVuZGVuY3lQcm9wZXJ0eVN1YnNjcmlwdGlvbnMgPSBbXTtcclxuICAgIH1cclxuXHJcbiAgICAvKipcclxuICAgICAqIERPIE5PVCBDQUxMISBJbnRlcm5hbCB1c2Ugb25seVxyXG4gICAgICogQHBhcmFtIG5hbWUgTmFtZSBvZiB0aGUgb3duZXIgbW9kZWwgc2V0dGluZ3NcclxuICAgICAqL1xyXG4gICAgc2V0T3duZXJNb2RlbFNldHRpbmdzTmFtZShuYW1lOiBzdHJpbmcpOiB2b2lkIHtcclxuICAgICAgICB0aGlzLl9vd25lck1vZGVsU2V0dGluZ3NOYW1lID0gbmFtZTtcclxuICAgIH1cclxufSIsImltcG9ydCB7IEluamVjdGFibGUsIEluamVjdCwgT3B0aW9uYWwgfSBmcm9tICdAYW5ndWxhci9jb3JlJztcclxuaW1wb3J0IHsgTU9ERUxfU0VUVElOR1NfVE9LRU4gfSBmcm9tICcuLi8uLi8uLi9mb3JtLXJ1bGVzL2luamVjdGlvbi10b2tlbnMvbW9kZWwtc2V0dGluZ3MudG9rZW4nO1xyXG5pbXBvcnQgeyBBYnN0cmFjdE1vZGVsU2V0dGluZ3MgfSBmcm9tICcuLi8uLi8uLi9mb3JtLXJ1bGVzL21vZGVscy9hYnN0cmFjdC1tb2RlbC1zZXR0aW5ncyc7XHJcbmltcG9ydCB7IFByb3BlcnR5IH0gZnJvbSAnLi4vLi4vLi4vZm9ybS1ydWxlcy9tb2RlbHMvcHJvcGVydHknO1xyXG5pbXBvcnQgeyBSdWxlR3JvdXAgfSBmcm9tICcuLi8uLi8uLi9mb3JtLXJ1bGVzL21vZGVscy9ydWxlLWdyb3VwJztcclxuaW1wb3J0IHsgUnVsZSB9IGZyb20gJy4uLy4uLy4uL2Zvcm0tcnVsZXMvbW9kZWxzL3J1bGUnO1xyXG5pbXBvcnQgeyBUZXN0IH0gZnJvbSAnLi4vLi4vLi4vZm9ybS1ydWxlcy9tb2RlbHMvdGVzdCc7XHJcbmltcG9ydCB7IFRlc3RSZXN1bHQgfSBmcm9tICcuLi8uLi8uLi9mb3JtLXJ1bGVzL21vZGVscy90ZXN0LXJlc3VsdCc7XHJcbmltcG9ydCB7IFJ1bGVTZXQgfSBmcm9tICcuLi8uLi8uLi9mb3JtLXJ1bGVzL21vZGVscy9ydWxlLXNldCc7XHJcbmltcG9ydCB7IFRlc3RSdW5TdGF0ZSB9IGZyb20gJy4uLy4uLy4uL2Zvcm0tcnVsZXMvbW9kZWxzL3Rlc3QtcnVuLXN0YXRlJztcclxuaW1wb3J0IHsgVHJhY2VTZXJ2aWNlIH0gZnJvbSAnLi4vLi4vLi4vdXRpbHMvdHJhY2UvdHJhY2Uuc2VydmljZSc7XHJcbmltcG9ydCB7IENvbW1vblNlcnZpY2UgfSBmcm9tICcuLi8uLi8uLi91dGlscy9jb21tb24vY29tbW9uLnNlcnZpY2UnO1xyXG5pbXBvcnQgeyBPYnNlcnZhYmxlLCBmb3JrSm9pbiwgb2YgfSBmcm9tICdyeGpzJztcclxuaW1wb3J0IHsgIG1hcCwgZmxhdE1hcCwgbWVyZ2VNYXAsIHRha2UsIHRhcCB9IGZyb20gJ3J4anMvb3BlcmF0b3JzJztcclxuaW1wb3J0IHsgVGVzdFJlc3VsdHNCYXNlIH0gZnJvbSAnLi4vLi4vLi4vZm9ybS1ydWxlcy9tb2RlbHMvdGVzdC1yZXN1bHRzLWJhc2UnO1xyXG5pbXBvcnQgeyBQcm9wZXJ0eVRlc3RSZXN1bHRzIH0gZnJvbSAnLi4vLi4vLi4vZm9ybS1ydWxlcy9tb2RlbHMvcHJvcGVydHktdGVzdC1yZXN1bHQnO1xyXG5pbXBvcnQgeyBQcm9wZXJ0eUJhc2UgfSBmcm9tICcuLi8uLi8uLi9mb3JtLXJ1bGVzL21vZGVscy9wcm9wZXJ0eS1iYXNlJztcclxuaW1wb3J0IHsgUHJvY2Vzc1Jlc3VsdFR5cGUgfSBmcm9tICcuLi8uLi8uLi9mb3JtLXJ1bGVzL21vZGVscy9wcm9jY2Vzcy1yZXN1bHQtdHlwZSc7XHJcbmltcG9ydCB7IFRlc3RTeW5jR3JvdXBzIH0gZnJvbSAnLi4vLi4vLi4vZm9ybS1ydWxlcy9tb2RlbHMvdGVzdC1zeW5jLWdyb3Vwcyc7XHJcbmltcG9ydCB7IFJlc3VsdHNQYXNzUmVxdWlyZW1lbnQgfSBmcm9tICcuLi8uLi8uLi9mb3JtLXJ1bGVzL21vZGVscy9yZXN1bHRzLXBhc3MtcmVxdWlyZW1lbnQnO1xyXG5cclxuLyoqXHJcbiAqIEVuZ2luZSB0aGF0IGRpZ2VzdHMgbW9kZWwgc2V0dGluZ3MgYW5kIGFwcGxpZXMgdGhlaXIgcnVsZXMgYXBwcm9wcmlhdGVseVxyXG4gKi9cclxuQEluamVjdGFibGUoKVxyXG5leHBvcnQgY2xhc3MgUnVsZXNFbmdpbmVTZXJ2aWNlIHtcclxuICAgIHByaXZhdGUgcmVnaXN0ZXJlZFNldHRpbmdzOiB7IFtrZXk6IHN0cmluZ106IEFic3RyYWN0TW9kZWxTZXR0aW5nczxhbnk+OyB9O1xyXG5cclxuICAgIGNvbnN0cnVjdG9yKFxyXG4gICAgICAgIEBPcHRpb25hbCgpIEBJbmplY3QoTU9ERUxfU0VUVElOR1NfVE9LRU4pIHNldHRpbmdzOiBBYnN0cmFjdE1vZGVsU2V0dGluZ3M8YW55PltdLFxyXG4gICAgICAgIHByaXZhdGUgdHJhY2VTdmM6IFRyYWNlU2VydmljZSxcclxuICAgICAgICBwcml2YXRlIGNvbW1vblN2YzogQ29tbW9uU2VydmljZVxyXG4gICAgKSB7XHJcbiAgICAgICAgdGhpcy5yZWdpc3RlcmVkU2V0dGluZ3MgPSB7fTtcclxuXHJcbiAgICAgICAgaWYgKCFBcnJheS5pc0FycmF5KHNldHRpbmdzKSkgcmV0dXJuO1xyXG5cclxuICAgICAgICBzZXR0aW5ncy5mb3JFYWNoKHNldHRpbmcgPT4ge1xyXG4gICAgICAgICAgICB0aGlzLmluaXRpYWxpemVNb2RlbFNldHRpbmcoc2V0dGluZyk7XHJcbiAgICAgICAgICAgIHRoaXMucmVnaXN0ZXJlZFNldHRpbmdzW3NldHRpbmcubmFtZV0gPSBzZXR0aW5nO1xyXG4gICAgICAgIH0pO1xyXG4gICAgfVxyXG5cclxuICAgIC8qKlxyXG4gICAgICogSW5pdGlhbGl6ZXMgbW9kZWwgc2V0dGluZ3MgYW5kIHByZXBhcmVzIHRoZW0gdG8gYmUgdXNlZCBpbiBhIGZvcm0gZ3JvdXBcclxuICAgICAqIEBwYXJhbSBzZXR0aW5nIE1vZGVsIHNldHRpbmcgdG8gaW5pdGlhbGl6ZVxyXG4gICAgICovXHJcbiAgICBpbml0aWFsaXplTW9kZWxTZXR0aW5nKHNldHRpbmc6IEFic3RyYWN0TW9kZWxTZXR0aW5nczxhbnk+KTogdm9pZCB7XHJcbiAgICAgICAgdGhpcy50cmFjZVN2Yy50cmFjZShgSW5pdGlhbGl6aW5nIG1vZGVsIHNldHRpbmdzIFwiJHtzZXR0aW5nLm5hbWV9XCJgKTtcclxuICAgICAgICB0aGlzLnNldFByb3BlcnR5TWV0YWRhdGEoc2V0dGluZy5wcm9wZXJ0aWVzLCBzZXR0aW5nLm5hbWUpO1xyXG4gICAgfVxyXG5cclxuICAgIC8qKlxyXG4gICAgICogR2V0cyBtb2RlbCBzZXR0aW5ncyB3aXRoIHRoZSBwcm92aWRlZCBuYW1lXHJcbiAgICAgKiBAcGFyYW0gbmFtZSBOYW1lIG9mIG1vZGVsIHNldHRpbmdcclxuICAgICAqIEByZXR1cm5zIE1vZGVsIHNldHRpbmdzIHdpdGggdGhlIHByb3ZpZGVkIG5hbWVcclxuICAgICAqL1xyXG4gICAgZ2V0TW9kZWxTZXR0aW5nczxUPihuYW1lOiBzdHJpbmcpOiBBYnN0cmFjdE1vZGVsU2V0dGluZ3M8VD4ge1xyXG4gICAgICAgIHRoaXMudHJhY2VTdmMudHJhY2UoYFJldHJpZXZpbmcgbW9kZWwgc2V0dGluZ3MgXCIke25hbWV9XCJgKTtcclxuXHJcbiAgICAgICAgY29uc3Qgc2V0dGluZ3MgPSB0aGlzLnJlZ2lzdGVyZWRTZXR0aW5nc1tuYW1lXTtcclxuXHJcbiAgICAgICAgLy8gY3JlYXRlIG5ldyBvYmplY3RcclxuICAgICAgICByZXR1cm4gc2V0dGluZ3NcclxuICAgICAgICAgICAgPyBPYmplY3QuYXNzaWduKHt9LCB0aGlzLnJlZ2lzdGVyZWRTZXR0aW5nc1tuYW1lXSlcclxuICAgICAgICAgICAgOiBudWxsO1xyXG4gICAgfVxyXG5cclxuICAgIC8qKlxyXG4gICAgICogR2V0cyB0aGUgZGVwZW5kZW5jeSBwcm9wZXJ0aWVzIGZvciBhbiBhcnJheSBvZiB0ZXN0c1xyXG4gICAgICogQHBhcmFtIHRlc3RzIFRlc3RzIHRvIGdldCB0aGUgZGVwZW5kZW5jeSBwcm9wZXJ0aWVzIGZvclxyXG4gICAgICogQHJldHVybnMgRGVwZW5kZW5jeSBwcm9wZXJ0aWVzXHJcbiAgICAgKi9cclxuICAgIGdldERlcGVuZGVuY3lQcm9wZXJ0aWVzPFQ+KHRlc3RzOiBUZXN0PFQ+W10pOiBzdHJpbmdbXSB7XHJcbiAgICAgICAgaWYgKCF0ZXN0cykgcmV0dXJuIFtdO1xyXG5cclxuICAgICAgICBjb25zdCBkZXBzID0gdGVzdHNcclxuICAgICAgICAgICAgLm1hcCh0ID0+IHRoaXMuZ2V0RGVwZW5kZW5jeVByb3BlcnRpZXNGcm9tVGVzdCh0KSlcclxuICAgICAgICAgICAgLnJlZHVjZSgocHJldiwgY3VycmVudCkgPT4gcHJldi5jb25jYXQoY3VycmVudCksIFtdKTtcclxuXHJcbiAgICAgICAgcmV0dXJuIHRoaXMuY29tbW9uU3ZjLnVuaXF1ZShkZXBzKTtcclxuICAgIH1cclxuXHJcbiAgICAvKipcclxuICAgICAqIEdldHMgdGVzdHMgZ3JvdXBlZCBieSB0aGVpciBzeW5jIHR5cGUgKGUuZy4gc3luYyB2cy4gYXN5bmMpXHJcbiAgICAgKiBAcGFyYW0gdGVzdHMgVGVzdCB0byBncm91cHNcclxuICAgICAqIEByZXR1cm5zIFRlc3RzIGdyb3VwZWQgYnkgc3luYyB0eXBlXHJcbiAgICAgKi9cclxuICAgIGdyb3VwVGVzdHNCeVN5bmNUeXBlPFQ+KHRlc3RzOiBUZXN0PFQ+W10pOiBUZXN0U3luY0dyb3VwczxUPiB7XHJcbiAgICAgICAgY29uc3QgdGVzdEdyb3VwcyA9IHtcclxuICAgICAgICAgICAgc3luYzogW10sXHJcbiAgICAgICAgICAgIGFzeW5jOiBbXVxyXG4gICAgICAgIH0gYXMgVGVzdFN5bmNHcm91cHM8VD47XHJcblxyXG4gICAgICAgIGlmICghdGVzdHMpIHJldHVybiB0ZXN0R3JvdXBzO1xyXG5cclxuICAgICAgICB0ZXN0cy5mb3JFYWNoKHRlc3QgPT4ge1xyXG4gICAgICAgICAgICBjb25zdCB0ZXN0RnVuY1R5cGVzID0ge1xyXG4gICAgICAgICAgICAgICAgc3luYzogZmFsc2UsXHJcbiAgICAgICAgICAgICAgICBhc3luYzogZmFsc2VcclxuICAgICAgICAgICAgfSBhcyBDb25maWd1cmVkRnVuY1R5cGVzO1xyXG5cclxuICAgICAgICAgICAgY29uc3QgY29uZGl0aW9uUmVzdWx0cyA9IHRoaXMuZ2V0Q29uZmlndXJlZEZ1bmNUeXBlcyh0ZXN0LmNvbmRpdGlvbik7XHJcbiAgICAgICAgICAgIGNvbnN0IGNoZWNrUmVzdWx0cyA9IHRoaXMuZ2V0Q29uZmlndXJlZEZ1bmNUeXBlcyh0ZXN0LmNoZWNrKTtcclxuXHJcbiAgICAgICAgICAgIHRlc3RGdW5jVHlwZXMuc3luYyA9IGNvbmRpdGlvblJlc3VsdHMuc3luYyB8fCBjaGVja1Jlc3VsdHMuc3luYztcclxuICAgICAgICAgICAgdGVzdEZ1bmNUeXBlcy5hc3luYyA9IGNvbmRpdGlvblJlc3VsdHMuYXN5bmMgfHwgY2hlY2tSZXN1bHRzLmFzeW5jO1xyXG5cclxuICAgICAgICAgICAgLy8gaWYgdGhlcmUgaXMgYW4gYXN5bmMgZnVuYyBhbnl3aGVyZSBpbiB0aGUgdGVzdCdzIHJ1bGUgc2V0cywgdGhlbiBpdCBpcyBjb25zaWRlcmVkIGFuIGFzeW5jIHRlc3RcclxuICAgICAgICAgICAgaWYgKHRlc3RGdW5jVHlwZXMuc3luYyAmJiAhdGVzdEZ1bmNUeXBlcy5hc3luYykgdGVzdEdyb3Vwcy5zeW5jLnB1c2godGVzdCk7XHJcbiAgICAgICAgICAgIGlmICh0ZXN0RnVuY1R5cGVzLmFzeW5jKSB0ZXN0R3JvdXBzLmFzeW5jLnB1c2godGVzdCk7XHJcbiAgICAgICAgfSk7XHJcblxyXG4gICAgICAgIHJldHVybiB0ZXN0R3JvdXBzO1xyXG4gICAgfVxyXG5cclxuICAgIC8qKlxyXG4gICAgICogUnVucyB2YWxpZGF0aW9uIHRlc3RzXHJcbiAgICAgKiBAcGFyYW0gZGF0YSBEYXRhIHRvIHJ1biB2YWxpZGF0aW9uIHRlc3RzIGFnYWluc3RcclxuICAgICAqIEBwYXJhbSBwcm9wZXJ0eSBQcm9wZXJ0eSB0byBydW4gdmFsaWRhdGlvbiB0ZXN0cyBmb3JcclxuICAgICAqIEByZXR1cm5zIFJlc3VsdHMgb2YgdmFsaWRhdGlvbiB0ZXN0c1xyXG4gICAgICovXHJcbiAgICB2YWxpZGF0ZTxUPihkYXRhOiBULCBwcm9wZXJ0eTogUHJvcGVydHk8VD4sIHN0YXRlPzogVGVzdFJ1blN0YXRlKTogT2JzZXJ2YWJsZTxQcm9wZXJ0eVRlc3RSZXN1bHRzPFQ+PiB7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMucnVuQWxsVGVzdHMoZGF0YSwgcHJvcGVydHkudmFsaWQsIHN0YXRlKVxyXG4gICAgICAgICAgICAucGlwZShcclxuICAgICAgICAgICAgICAgIG1hcCgocmVzdWx0czogUHJvcGVydHlUZXN0UmVzdWx0czxUPikgPT4ge1xyXG4gICAgICAgICAgICAgICAgICAgIHJlc3VsdHMucHJvcGVydHlOYW1lID0gcHJvcGVydHkuYWJzb2x1dGVQYXRoO1xyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiByZXN1bHRzIGFzIFByb3BlcnR5VGVzdFJlc3VsdHM8VD47XHJcbiAgICAgICAgICAgICAgICB9KVxyXG4gICAgICAgICAgICApO1xyXG4gICAgfVxyXG5cclxuICAgIC8qKlxyXG4gICAgICogUnVucyBlZGl0YWJpbGl0eSB0ZXN0c1xyXG4gICAgICogQHBhcmFtIGRhdGEgRGF0YSB0byBydW4gZWRpdGFiaWxpdHkgdGVzdHMgYWdhaW5zdFxyXG4gICAgICogQHBhcmFtIHByb3BlcnR5IFByb3BlcnR5IHRvIHJ1biBlZGl0YWJpbGl0eSB0ZXN0cyBmb3JcclxuICAgICAqICogQHJldHVybnMgUmVzdWx0cyBvZiBlZGl0YWJpbGl0eSB0ZXN0c1xyXG4gICAgICovXHJcbiAgICBlZGl0YWJsZTxUPihkYXRhOiBULCBwcm9wZXJ0eTogUHJvcGVydHlCYXNlPFQ+LCBzdGF0ZT86IFRlc3RSdW5TdGF0ZSk6IE9ic2VydmFibGU8UHJvcGVydHlUZXN0UmVzdWx0czxUPj4ge1xyXG4gICAgICAgIHJldHVybiB0aGlzLnJ1bkFsbFRlc3RzKGRhdGEsIHByb3BlcnR5LmVkaXQsIHN0YXRlKVxyXG4gICAgICAgICAgICAucGlwZShcclxuICAgICAgICAgICAgICAgIG1hcCgocmVzdWx0czogUHJvcGVydHlUZXN0UmVzdWx0czxUPikgPT4ge1xyXG4gICAgICAgICAgICAgICAgICAgIHJlc3VsdHMucHJvcGVydHlOYW1lID0gcHJvcGVydHkuYWJzb2x1dGVQYXRoO1xyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiByZXN1bHRzIGFzIFByb3BlcnR5VGVzdFJlc3VsdHM8VD47XHJcbiAgICAgICAgICAgICAgICB9KVxyXG4gICAgICAgICAgICApO1xyXG4gICAgfVxyXG5cclxuICAgIC8qKlxyXG4gICAgICogUnVucyB2aXNpYmlsaXR5IHRlc3RzXHJcbiAgICAgKiBAcGFyYW0gZGF0YSBEYXRhIHRvIHJ1biB2aXNpYmlsaXR5IHRlc3RzIGFnYWluc3RcclxuICAgICAqIEBwYXJhbSBwcm9wZXJ0eSBQcm9wZXJ0eSB0byBydW4gdmlzaWJpbGl0eSB0ZXN0cyBmb3JcclxuICAgICAqICogQHJldHVybnMgUmVzdWx0cyBvZiB2aXNpYmlsaXR5IHRlc3RzXHJcbiAgICAgKi9cclxuICAgIC8vIHZpc2libGU8VD4oZGF0YTogVCwgcHJvcGVydHk6IFByb3BlcnR5PFQ+LCBzdGF0ZT86IFRlc3RSdW5TdGF0ZSk6IE9ic2VydmFibGU8UHJvcGVydHlUZXN0UmVzdWx0czxUPj4ge1xyXG4gICAgLy8gICAgIHJldHVybiB0aGlzLnJ1bkFsbFRlc3RzKGRhdGEsIHByb3BlcnR5LnZpZXcsIHN0YXRlKVxyXG4gICAgLy8gICAgICAgICAucGlwZShcclxuICAgIC8vICAgICAgICAgICAgIG1hcCgocmVzdWx0czogUHJvcGVydHlUZXN0UmVzdWx0czxUPikgPT4ge1xyXG4gICAgLy8gICAgICAgICAgICAgICAgIHJlc3VsdHMucHJvcGVydHlOYW1lID0gcHJvcGVydHkuYWJzb2x1dGVQYXRoO1xyXG4gICAgLy8gICAgICAgICAgICAgICAgIHJldHVybiByZXN1bHRzIGFzIFByb3BlcnR5VGVzdFJlc3VsdHM8VD47XHJcbiAgICAvLyAgICAgICAgICAgICB9KVxyXG4gICAgLy8gICAgICAgICApO1xyXG4gICAgLy8gfVxyXG5cclxuICAgIC8qKlxyXG4gICAgICogUnVucyBhbiBhcnJheSBvZiBzeW5jIHRlc3RzXHJcbiAgICAgKiBAcGFyYW0gZGF0YSBEYXRhIHRvIHBlcmZvcm0gdGVzdHMgYWdhaW5zdFxyXG4gICAgICogQHBhcmFtIHRlc3RzIFRlc3RzIHRvIHJ1blxyXG4gICAgICogQHJldHVybnMgUmVzdWx0IG9mIHRlc3RzXHJcbiAgICAgKi9cclxuICAgIHJ1blRlc3RzPFQ+KGRhdGE6IFQsIHRlc3RzOiBUZXN0PFQ+W10sIHN0YXRlPzogVGVzdFJ1blN0YXRlKTogVGVzdFJlc3VsdHNCYXNlPFQ+IHtcclxuICAgICAgICBpZiAoIXRlc3RzIHx8ICF0ZXN0cy5sZW5ndGgpIHJldHVybiBuZXcgVGVzdFJlc3VsdHNCYXNlKFtdKTtcclxuXHJcbiAgICAgICAgY29uc3QgdGVzdFJlc3VsdHMgPSB0ZXN0c1xyXG4gICAgICAgICAgICAubWFwKHQgPT4gdGhpcy5ydW5UZXN0KGRhdGEsIHQsIHN0YXRlKSlcclxuICAgICAgICAgICAgLmZpbHRlcih4ID0+ICEheCk7XHJcblxyXG4gICAgICAgIHJldHVybiBuZXcgVGVzdFJlc3VsdHNCYXNlKHRlc3RSZXN1bHRzKTtcclxuICAgIH1cclxuXHJcbiAgICAvKipcclxuICAgICAqIFJ1bnMgYW4gYXJyYXkgb2YgYXN5bmMgdGVzdHNcclxuICAgICAqIEBwYXJhbSBkYXRhIERhdGEgdG8gcGVyZm9ybSB0ZXN0cyBhZ2FpbnN0XHJcbiAgICAgKiBAcGFyYW0gdGVzdHMgVGVzdHMgdG8gcnVuXHJcbiAgICAgKiBAcmV0dXJucyBSZXN1bHQgb2YgdGVzdHNcclxuICAgICAqL1xyXG4gICAgcnVuVGVzdHNBc3luYzxUPihkYXRhOiBULCB0ZXN0czogVGVzdDxUPltdLCBzdGF0ZT86IFRlc3RSdW5TdGF0ZSk6IE9ic2VydmFibGU8VGVzdFJlc3VsdHNCYXNlPFQ+PiB7XHJcbiAgICAgICAgaWYgKCF0ZXN0cyB8fCAhdGVzdHMubGVuZ3RoKSByZXR1cm4gb2YobmV3IFRlc3RSZXN1bHRzQmFzZShbXSkpO1xyXG5cclxuICAgICAgICBjb25zdCBydW5UZXN0JCA9IHRlc3RzXHJcbiAgICAgICAgICAgIC5tYXAodGVzdCA9PiB0aGlzLnJ1blRlc3RBc3luYyhkYXRhLCB0ZXN0LCBzdGF0ZSkpO1xyXG5cclxuICAgICAgICByZXR1cm4gZm9ya0pvaW4ocnVuVGVzdCQpXHJcbiAgICAgICAgICAgIC5waXBlKFxyXG4gICAgICAgICAgICAgICAgbWFwKHRlc3RSZXN1bHRzID0+IG5ldyBUZXN0UmVzdWx0c0Jhc2UodGVzdFJlc3VsdHMuZmlsdGVyKHggPT4gISF4KSkpXHJcbiAgICAgICAgICAgICk7XHJcbiAgICB9XHJcblxyXG4gICAgLyoqXHJcbiAgICAgKiBSdW5zIGFuIGFycmF5IG9mIHN5bmMgYW5kIGFzeW5jIHRlc3RzXHJcbiAgICAgKiBAcGFyYW0gZGF0YSBEYXRhIHRvIHBlcmZvcm0gdGVzdHMgYWdhaW5zdFxyXG4gICAgICogQHBhcmFtIHRlc3RzIFRlc3RzIHRvIHJ1blxyXG4gICAgICogQHJldHVybnMgUmVzdWx0IG9mIHRlc3RzXHJcbiAgICAgKi9cclxuICAgIHJ1bkFsbFRlc3RzPFQ+KGRhdGE6IFQsIHRlc3RzOiBUZXN0PFQ+W10sIHN0YXRlPzogVGVzdFJ1blN0YXRlKTogT2JzZXJ2YWJsZTxUZXN0UmVzdWx0c0Jhc2U8VD4+IHtcclxuICAgICAgICBpZiAoIXRlc3RzIHx8ICF0ZXN0cy5sZW5ndGgpIHJldHVybiBvZihuZXcgVGVzdFJlc3VsdHNCYXNlKFtdKSk7XHJcblxyXG4gICAgICAgIGNvbnN0IHN5bmNHcm91cHMgPSB0aGlzLmdyb3VwVGVzdHNCeVN5bmNUeXBlKHRlc3RzKTtcclxuICAgICAgICBjb25zdCBzeW5jVGVzdFJlc3VsdHMgPSBvZih0aGlzLnJ1blRlc3RzKGRhdGEsIHN5bmNHcm91cHMuc3luYywgc3RhdGUpKTtcclxuXHJcbiAgICAgICAgcmV0dXJuIHN5bmNUZXN0UmVzdWx0cy5waXBlKFxyXG4gICAgICAgICAgICBtZXJnZU1hcChyZXN1bHQgPT4ge1xyXG4gICAgICAgICAgICAgICAgaWYgKCFyZXN1bHQucGFzc2VkKSByZXR1cm4gb2YocmVzdWx0KTtcclxuXHJcbiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5ydW5UZXN0c0FzeW5jKGRhdGEsIHN5bmNHcm91cHMuYXN5bmMsIHN0YXRlKTtcclxuICAgICAgICAgICAgfSksXHJcbiAgICAgICAgICAgIHRha2UoMSlcclxuICAgICAgICApO1xyXG4gICAgfVxyXG5cclxuICAgIC8qKlxyXG4gICAgICogUGVyZm9ybXMgc3luYyB0ZXN0IG9uIGEgc2V0IG9mIGRhdGFcclxuICAgICAqIEBwYXJhbSBkYXRhIERhdGEgdG8gcGVyZm9ybSB0ZXN0IGFnYWluc3RcclxuICAgICAqIEBwYXJhbSB0ZXN0IFRlc3QgdG8gcnVuXHJcbiAgICAgKiBAcmV0dXJucyBSZXN1bHQgb2YgdGVzdFxyXG4gICAgICovXHJcbiAgICBydW5UZXN0PFQ+KGRhdGE6IFQsIHRlc3Q6IFRlc3Q8VD4sIHN0YXRlPzogVGVzdFJ1blN0YXRlKTogVGVzdFJlc3VsdDxUPiB7XHJcbiAgICAgICAgaWYgKCF0ZXN0KSByZXR1cm4gbnVsbDtcclxuXHJcbiAgICAgICAgY29uc3QgcGFzc2VkVGVzdFJlc3VsdDogVGVzdFJlc3VsdDxUPiA9IHsgcGFzc2VkOiB0cnVlLCBuYW1lOiB0ZXN0Lm5hbWUsIG1lc3NhZ2U6IG51bGwgfTtcclxuICAgICAgICBjb25zdCBmYWlsZWRUZXN0UmVzdWx0OiBUZXN0UmVzdWx0PFQ+ID0geyBwYXNzZWQ6IGZhbHNlLCBuYW1lOiB0ZXN0Lm5hbWUsIG1lc3NhZ2U6IHRlc3QubWVzc2FnZSB9O1xyXG4gICAgICAgIGNvbnN0IHNraXBwZWRUZXN0UmVzdWx0OiBUZXN0UmVzdWx0PFQ+ID0geyBwYXNzZWQ6IHRydWUsIHNraXBwZWQ6IHRydWUsIG5hbWU6IHRlc3QubmFtZSwgbWVzc2FnZTogbnVsbCB9O1xyXG5cclxuICAgICAgICBjb25zdCBjb25kaXRpb25zUnVsZVNldFJlc3VsdCA9IHRoaXMucHJvY2Vzc1J1bGVTZXQoZGF0YSwgdGVzdC5jb25kaXRpb24sIHN0YXRlKTtcclxuICAgICAgICBpZiAoY29uZGl0aW9uc1J1bGVTZXRSZXN1bHQgPT09IFByb2Nlc3NSZXN1bHRUeXBlLkZhaWxlZCkgcmV0dXJuIHNraXBwZWRUZXN0UmVzdWx0O1xyXG5cclxuICAgICAgICBjb25zdCBjaGVja1J1bGVTZXRSZXN1bHQgPSB0aGlzLnByb2Nlc3NSdWxlU2V0KGRhdGEsIHRlc3QuY2hlY2ssIHN0YXRlKTtcclxuICAgICAgICBzd2l0Y2ggKGNoZWNrUnVsZVNldFJlc3VsdCkge1xyXG4gICAgICAgICAgICBjYXNlIFByb2Nlc3NSZXN1bHRUeXBlLlBhc3NlZDpcclxuICAgICAgICAgICAgICAgIHJldHVybiBwYXNzZWRUZXN0UmVzdWx0O1xyXG4gICAgICAgICAgICBjYXNlIFByb2Nlc3NSZXN1bHRUeXBlLkZhaWxlZDpcclxuICAgICAgICAgICAgICAgIHJldHVybiBmYWlsZWRUZXN0UmVzdWx0O1xyXG4gICAgICAgICAgICBjYXNlIFByb2Nlc3NSZXN1bHRUeXBlLlNraXBwZWQ6XHJcbiAgICAgICAgICAgIGRlZmF1bHQ6XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gc2tpcHBlZFRlc3RSZXN1bHQ7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIC8qKlxyXG4gICAgICogUGVyZm9ybXMgYXN5bmMgdGVzdCBvbiBhIHNldCBvZiBkYXRhXHJcbiAgICAgKiBAcGFyYW0gZGF0YSBEYXRhIHRvIHBlcmZvcm0gdGVzdCBhZ2FpbnN0XHJcbiAgICAgKiBAcGFyYW0gdGVzdCBUZXN0IHRvIHJ1blxyXG4gICAgICogQHJldHVybnMgUmVzdWx0IG9mIHRlc3RcclxuICAgICAqL1xyXG4gICAgcnVuVGVzdEFzeW5jPFQ+KGRhdGE6IFQsIHRlc3Q6IFRlc3Q8VD4sIHN0YXRlPzogVGVzdFJ1blN0YXRlKTogT2JzZXJ2YWJsZTxUZXN0UmVzdWx0PFQ+PiB7XHJcbiAgICAgICAgaWYgKCF0ZXN0KSByZXR1cm4gb2YobnVsbCk7XHJcblxyXG4gICAgICAgIGNvbnN0IHBhc3NlZFRlc3RSZXN1bHQ6IFRlc3RSZXN1bHQ8VD4gPSB7IHBhc3NlZDogdHJ1ZSwgbmFtZTogdGVzdC5uYW1lLCBtZXNzYWdlOiBudWxsIH07XHJcbiAgICAgICAgY29uc3QgZmFpbGVkVGVzdFJlc3VsdDogVGVzdFJlc3VsdDxUPiA9IHsgcGFzc2VkOiBmYWxzZSwgbmFtZTogdGVzdC5uYW1lLCBtZXNzYWdlOiB0ZXN0Lm1lc3NhZ2UgfTtcclxuICAgICAgICBjb25zdCBza2lwcGVkVGVzdFJlc3VsdDogVGVzdFJlc3VsdDxUPiA9IHsgcGFzc2VkOiB0cnVlLCBza2lwcGVkOiB0cnVlLCBuYW1lOiB0ZXN0Lm5hbWUsIG1lc3NhZ2U6IG51bGwgfTtcclxuXHJcbiAgICAgICAgY29uc3QgY29uZGl0aW9uc1J1bGVTZXRSZXN1bHQkID0gdGhpcy5wcm9jZXNzUnVsZVNldEFzeW5jKGRhdGEsIHRlc3QuY29uZGl0aW9uLCBzdGF0ZSk7XHJcbiAgICAgICAgY29uc3QgY2hlY2tSdWxlU2V0UmVzdWx0JCA9IHRoaXMucHJvY2Vzc1J1bGVTZXRBc3luYyhkYXRhLCB0ZXN0LmNoZWNrLCBzdGF0ZSk7XHJcblxyXG4gICAgICAgIHJldHVybiBjb25kaXRpb25zUnVsZVNldFJlc3VsdCRcclxuICAgICAgICAgICAgLnBpcGUoXHJcbiAgICAgICAgICAgICAgICBmbGF0TWFwKGNvbmRpdGlvbnNSdWxlU2V0UmVzdWx0ID0+IHtcclxuICAgICAgICAgICAgICAgICAgICBpZiAoY29uZGl0aW9uc1J1bGVTZXRSZXN1bHQgPT09IFByb2Nlc3NSZXN1bHRUeXBlLkZhaWxlZCkgcmV0dXJuIG9mKHNraXBwZWRUZXN0UmVzdWx0KTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGNoZWNrUnVsZVNldFJlc3VsdCRcclxuICAgICAgICAgICAgICAgICAgICAgICAgLnBpcGUoXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBtYXAoY2hlY2tSdWxlU2V0UmVzdWx0ID0+IHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzd2l0Y2ggKGNoZWNrUnVsZVNldFJlc3VsdCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYXNlIFByb2Nlc3NSZXN1bHRUeXBlLlBhc3NlZDpcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBwYXNzZWRUZXN0UmVzdWx0O1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYXNlIFByb2Nlc3NSZXN1bHRUeXBlLkZhaWxlZDpcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBmYWlsZWRUZXN0UmVzdWx0O1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYXNlIFByb2Nlc3NSZXN1bHRUeXBlLlNraXBwZWQ6XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRlZmF1bHQ6XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gc2tpcHBlZFRlc3RSZXN1bHQ7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfSlcclxuICAgICAgICAgICAgICAgICAgICAgICAgKTtcclxuICAgICAgICAgICAgICAgIH0pXHJcbiAgICAgICAgICAgICk7XHJcbiAgICB9XHJcblxyXG4gICAgLyoqXHJcbiAgICAgKiBQcm9jZXNzZXMgYSBzeW5jIHJ1bGUgc2V0XHJcbiAgICAgKiBAcGFyYW0gZGF0YSBEYXRhIHRvIHByb2Nlc3MgcnVsZSBzZXQgYWdhaW5zdFxyXG4gICAgICogQHBhcmFtIHJ1bGVTZXQgUnVsZSBzZXQgdG8gcHJvY2Vzc1xyXG4gICAgICogQHJldHVybnMgUmVzdWx0IG9mIHJ1bGUgc2V0IHByb2Nlc3NpbmdcclxuICAgICAqL1xyXG4gICAgcHJvY2Vzc1J1bGVTZXQ8VD4oZGF0YTogVCwgcnVsZVNldDogUnVsZVNldDxUPiwgc3RhdGU/OiBUZXN0UnVuU3RhdGUpOiBQcm9jZXNzUmVzdWx0VHlwZSB7XHJcbiAgICAgICAgaWYgKCFydWxlU2V0KSByZXR1cm4gUHJvY2Vzc1Jlc3VsdFR5cGUuU2tpcHBlZDtcclxuXHJcbiAgICAgICAgY29uc3QgaXNSdWxlR3JvdXAgPSB0aGlzLmlzUnVsZUdyb3VwKHJ1bGVTZXQpO1xyXG4gICAgICAgIHJldHVybiBpc1J1bGVHcm91cFxyXG4gICAgICAgICAgICA/IHRoaXMucHJvY2Vzc1J1bGVHcm91cChkYXRhLCBydWxlU2V0IGFzIFJ1bGVHcm91cDxUPiwgc3RhdGUpXHJcbiAgICAgICAgICAgIDogdGhpcy5wcm9jZXNzUnVsZShkYXRhLCBydWxlU2V0IGFzIFJ1bGU8VD4sIHN0YXRlKTtcclxuICAgIH1cclxuXHJcbiAgICAvKipcclxuICAgICAqIFByb2Nlc3NlcyBhbiBhc3luYyBydWxlIHNldFxyXG4gICAgICogQHBhcmFtIGRhdGEgRGF0YSB0byBwcm9jZXNzIHJ1bGUgc2V0IGFnYWluc3RcclxuICAgICAqIEBwYXJhbSBydWxlU2V0IFJ1bGUgc2V0IHRvIHByb2Nlc3NcclxuICAgICAqIEByZXR1cm5zIFJlc3VsdCBvZiBydWxlIHNldCBwcm9jZXNzaW5nXHJcbiAgICAgKi9cclxuICAgIHByb2Nlc3NSdWxlU2V0QXN5bmM8VD4oZGF0YTogVCwgcnVsZVNldDogUnVsZVNldDxUPiwgc3RhdGU/OiBUZXN0UnVuU3RhdGUpOiBPYnNlcnZhYmxlPFByb2Nlc3NSZXN1bHRUeXBlPiB7XHJcbiAgICAgICAgaWYgKCFydWxlU2V0KSByZXR1cm4gb2YoUHJvY2Vzc1Jlc3VsdFR5cGUuU2tpcHBlZCk7XHJcblxyXG4gICAgICAgIGNvbnN0IGlzUnVsZUdyb3VwID0gdGhpcy5pc1J1bGVHcm91cChydWxlU2V0KTtcclxuICAgICAgICByZXR1cm4gaXNSdWxlR3JvdXBcclxuICAgICAgICAgICAgPyB0aGlzLnByb2Nlc3NSdWxlR3JvdXBBc3luYyhkYXRhLCBydWxlU2V0IGFzIFJ1bGVHcm91cDxUPiwgc3RhdGUpXHJcbiAgICAgICAgICAgIDogdGhpcy5wcm9jZXNzUnVsZUFzeW5jKGRhdGEsIHJ1bGVTZXQgYXMgUnVsZTxUPiwgc3RhdGUpO1xyXG4gICAgfVxyXG5cclxuICAgIHByaXZhdGUgcHJvY2Vzc1J1bGVHcm91cDxUPihkYXRhOiBULCBydWxlR3JvdXA6IFJ1bGVHcm91cDxUPiwgc3RhdGU/OiBUZXN0UnVuU3RhdGUpOiBQcm9jZXNzUmVzdWx0VHlwZSB7XHJcbiAgICAgICAgaWYgKCFydWxlR3JvdXAucnVsZXMpIHJldHVybiBQcm9jZXNzUmVzdWx0VHlwZS5Ta2lwcGVkO1xyXG5cclxuICAgICAgICBsZXQgcGFzc2VkQ291bnQgPSAwO1xyXG4gICAgICAgIGxldCBza2lwcGVkQ291bnQgPSAwO1xyXG5cclxuICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IHJ1bGVHcm91cC5ydWxlcy5sZW5ndGg7IGkrKykge1xyXG4gICAgICAgICAgICBjb25zdCBydWxlID0gcnVsZUdyb3VwLnJ1bGVzW2ldO1xyXG4gICAgICAgICAgICBjb25zdCBydWxlU2V0UmVzdWx0ID0gdGhpcy5wcm9jZXNzUnVsZVNldChkYXRhLCBydWxlLCBzdGF0ZSk7XHJcblxyXG4gICAgICAgICAgICBpZiAodGhpcy5jYW5TaG9ydENpcmN1aXRSdWxlR3JvdXAocnVsZVNldFJlc3VsdCwgcnVsZUdyb3VwKSkgcmV0dXJuIHJ1bGVTZXRSZXN1bHQ7XHJcblxyXG4gICAgICAgICAgICBpZiAocnVsZVNldFJlc3VsdCA9PSBQcm9jZXNzUmVzdWx0VHlwZS5QYXNzZWQpIHBhc3NlZENvdW50Kys7XHJcbiAgICAgICAgICAgIGVsc2UgaWYgKHJ1bGVTZXRSZXN1bHQgPT0gUHJvY2Vzc1Jlc3VsdFR5cGUuU2tpcHBlZCkgc2tpcHBlZENvdW50Kys7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICAvLyBpZiB3ZSBza2lwcGVkIHRoZW0gYWxsLCB0aGVuIHJldHVybiBza2lwcGVkXHJcbiAgICAgICAgaWYgKHNraXBwZWRDb3VudCA9PT0gcnVsZUdyb3VwLnJ1bGVzLmxlbmd0aCkgcmV0dXJuIFByb2Nlc3NSZXN1bHRUeXBlLlNraXBwZWQ7XHJcblxyXG4gICAgICAgIC8vIGlmIHdlIGdvdCB0aGlzIGZhciwgbWFrZSBzdXJlIGFsbCB0ZXN0cyB3ZXJlIHBhc3NlZFxyXG4gICAgICAgIHJldHVybiBwYXNzZWRDb3VudCA9PT0gcnVsZUdyb3VwLnJ1bGVzLmxlbmd0aCA/IFByb2Nlc3NSZXN1bHRUeXBlLlBhc3NlZCA6IFByb2Nlc3NSZXN1bHRUeXBlLkZhaWxlZDtcclxuICAgIH1cclxuXHJcbiAgICBwcml2YXRlIHByb2Nlc3NSdWxlR3JvdXBBc3luYzxUPihkYXRhOiBULCBydWxlR3JvdXA6IFJ1bGVHcm91cDxUPiwgc3RhdGU/OiBUZXN0UnVuU3RhdGUpOiBPYnNlcnZhYmxlPFByb2Nlc3NSZXN1bHRUeXBlPiB7XHJcbiAgICAgICAgaWYgKCFydWxlR3JvdXAucnVsZXMpIHJldHVybiBvZihQcm9jZXNzUmVzdWx0VHlwZS5Ta2lwcGVkKTtcclxuICAgICAgICBjb25zdCBhc3luY1J1bGVTZXRSZXN1bHRzJCA9IHJ1bGVHcm91cC5ydWxlcy5tYXAoeCA9PiB0aGlzLnByb2Nlc3NSdWxlU2V0QXN5bmMoZGF0YSwgeCwgc3RhdGUpKTtcclxuXHJcbiAgICAgICAgcmV0dXJuIGZvcmtKb2luKGFzeW5jUnVsZVNldFJlc3VsdHMkKS5waXBlKFxyXG4gICAgICAgICAgICBtYXAocnVsZVNldFJlc3VsdHMgPT4ge1xyXG4gICAgICAgICAgICAgICAgY29uc3QgY291bnRzID0ge1xyXG4gICAgICAgICAgICAgICAgICAgIHBhc3NlZDogcnVsZVNldFJlc3VsdHMuZmlsdGVyKHggPT4geCA9PT0gUHJvY2Vzc1Jlc3VsdFR5cGUuUGFzc2VkKS5sZW5ndGgsXHJcbiAgICAgICAgICAgICAgICAgICAgZmFpbGVkOiBydWxlU2V0UmVzdWx0cy5maWx0ZXIoeCA9PiB4ID09PSBQcm9jZXNzUmVzdWx0VHlwZS5GYWlsZWQpLmxlbmd0aCxcclxuICAgICAgICAgICAgICAgICAgICBza2lwcGVkOiBydWxlU2V0UmVzdWx0cy5maWx0ZXIoeCA9PiB4ID09PSBQcm9jZXNzUmVzdWx0VHlwZS5Ta2lwcGVkKS5sZW5ndGgsXHJcbiAgICAgICAgICAgICAgICB9O1xyXG5cclxuICAgICAgICAgICAgICAgIGNvbnN0IHJ1bGVHcm91cE9wdGlvbnMgPSBydWxlR3JvdXAub3B0aW9ucyB8fCB7IHJlc3VsdFJlcXVpcmVtZW50czogUmVzdWx0c1Bhc3NSZXF1aXJlbWVudC5BbGxQYXNzIH07XHJcblxyXG4gICAgICAgICAgICAgICAgaWYgKHJ1bGVHcm91cE9wdGlvbnMucmVzdWx0UmVxdWlyZW1lbnRzID09IFJlc3VsdHNQYXNzUmVxdWlyZW1lbnQuQW55UGFzcyAmJiBjb3VudHMucGFzc2VkID4gMClcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gUHJvY2Vzc1Jlc3VsdFR5cGUuUGFzc2VkO1xyXG4gICAgICAgICAgICAgICAgaWYgKHJ1bGVHcm91cE9wdGlvbnMucmVzdWx0UmVxdWlyZW1lbnRzID09IFJlc3VsdHNQYXNzUmVxdWlyZW1lbnQuQWxsUGFzcyAmJiBjb3VudHMucGFzc2VkID09PSBydWxlU2V0UmVzdWx0cy5sZW5ndGgpXHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIFByb2Nlc3NSZXN1bHRUeXBlLlBhc3NlZDtcclxuICAgICAgICAgICAgICAgIGlmIChjb3VudHMuc2tpcHBlZCA9PT0gcnVsZVNldFJlc3VsdHMubGVuZ3RoKSByZXR1cm4gUHJvY2Vzc1Jlc3VsdFR5cGUuU2tpcHBlZDtcclxuXHJcbiAgICAgICAgICAgICAgICByZXR1cm4gUHJvY2Vzc1Jlc3VsdFR5cGUuRmFpbGVkO1xyXG4gICAgICAgICAgICB9KVxyXG4gICAgICAgICk7XHJcbiAgICB9XHJcblxyXG4gICAgcHJpdmF0ZSBwcm9jZXNzUnVsZTxUPihkYXRhOiBULCBydWxlOiBSdWxlPFQ+LCBzdGF0ZT86IFRlc3RSdW5TdGF0ZSk6IFByb2Nlc3NSZXN1bHRUeXBlIHtcclxuICAgICAgICBpZiAoIXJ1bGUuZnVuYykgcmV0dXJuIFByb2Nlc3NSZXN1bHRUeXBlLlNraXBwZWQ7XHJcblxyXG4gICAgICAgIGNvbnN0IHJvb3REYXRhID0gc3RhdGUgPyBzdGF0ZS5yb290RGF0YSA6IG51bGw7XHJcbiAgICAgICAgcmV0dXJuIHJ1bGUuZnVuYyhkYXRhLCByb290RGF0YSkgPyBQcm9jZXNzUmVzdWx0VHlwZS5QYXNzZWQgOiBQcm9jZXNzUmVzdWx0VHlwZS5GYWlsZWQ7XHJcbiAgICB9XHJcblxyXG4gICAgcHJpdmF0ZSBwcm9jZXNzUnVsZUFzeW5jPFQ+KGRhdGE6IFQsIHJ1bGU6IFJ1bGU8VD4sIHN0YXRlPzogVGVzdFJ1blN0YXRlKTogT2JzZXJ2YWJsZTxQcm9jZXNzUmVzdWx0VHlwZT4ge1xyXG4gICAgICAgIGlmICghcnVsZS5mdW5jICYmICFydWxlLmFzeW5jRnVuYykgcmV0dXJuIG9mKFByb2Nlc3NSZXN1bHRUeXBlLlNraXBwZWQpO1xyXG5cclxuICAgICAgICBjb25zdCByb290RGF0YSA9IHN0YXRlID8gc3RhdGUucm9vdERhdGEgOiBudWxsO1xyXG4gICAgICAgIGNvbnN0IGZ1bmNSZXN1bHQgPSBydWxlLmZ1bmNcclxuICAgICAgICAgICAgPyBvZihydWxlLmZ1bmMoZGF0YSwgcm9vdERhdGEpKVxyXG4gICAgICAgICAgICA6IHJ1bGUuYXN5bmNGdW5jKGRhdGEsIHJvb3REYXRhKTtcclxuXHJcbiAgICAgICAgcmV0dXJuIGZ1bmNSZXN1bHRcclxuICAgICAgICAgICAgLnBpcGUoXHJcbiAgICAgICAgICAgICAgICBtYXAocGFzc2VkID0+IHBhc3NlZCA/IFByb2Nlc3NSZXN1bHRUeXBlLlBhc3NlZCA6IFByb2Nlc3NSZXN1bHRUeXBlLkZhaWxlZClcclxuICAgICAgICAgICAgKTtcclxuICAgIH1cclxuXHJcbiAgICAvLyBwcml2YXRlIGRvUHJvY2Vzc1J1bGU8VD4ocnVsZTogUnVsZTxUPiwgc3RhdGU6IFRlc3RSdW5TdGF0ZSwgaXNBc3luYzogYm9vbGVhbik6IGJvb2xlYW4ge1xyXG4gICAgLy8gICAgIC8vIG1ha2Ugc3VyZSB3ZSBoYXZlIHRoZSBhcHByb3ByaWF0ZSBmdW5jIHRvIGNhbGxcclxuICAgIC8vICAgICBpZiAoKGlzQXN5bmMgJiYgIXJ1bGUuYXN5bmNGdW5jKSB8fCAoIWlzQXN5bmMgJiYgIXJ1bGUuZnVuYykpIHJldHVybiBmYWxzZTtcclxuXHJcbiAgICAvLyAgICAgLy8gLy8gaWYgdGhlcmUgaXMgbWlzc2luZyBkYXRhLCB0aGVuIGFzc3VtZSB3ZSBzaG91bGQgcHJvY2VzcyB0aGUgcnVsZVxyXG4gICAgLy8gICAgIC8vIGlmICghcnVsZS5vcHRpb25zIHx8ICFydWxlLm9wdGlvbnMuY29udHJvbFN0YXRlT3B0aW9ucyB8fCAhc3RhdGUgfHwgIXN0YXRlLmNvbnRyb2xTdGF0ZSkgcmV0dXJuIHRydWU7XHJcblxyXG4gICAgLy8gICAgIC8vIGlmIChydWxlLm9wdGlvbnMuY29udHJvbFN0YXRlT3B0aW9ucy5za2lwUHJpc3RpbmUgJiYgc3RhdGUuY29udHJvbFN0YXRlLnByaXN0aW5lKSByZXR1cm4gZmFsc2U7XHJcbiAgICAvLyAgICAgLy8gaWYgKHJ1bGUub3B0aW9ucy5jb250cm9sU3RhdGVPcHRpb25zLnNraXBVbnRvdWNoZWQgJiYgc3RhdGUuY29udHJvbFN0YXRlLnVudG91Y2hlZCkgcmV0dXJuIGZhbHNlO1xyXG5cclxuICAgIC8vICAgICByZXR1cm4gdHJ1ZTtcclxuICAgIC8vIH1cclxuXHJcbiAgICBwcml2YXRlIGNhblNob3J0Q2lyY3VpdFJ1bGVHcm91cDxUPihydWxlU2V0UmVzdWx0OiBQcm9jZXNzUmVzdWx0VHlwZSwgcnVsZUdyb3VwOiBSdWxlR3JvdXA8VD4pOiBib29sZWFuIHtcclxuICAgICAgICBjb25zdCBydWxlR3JvdXBPcHRpb25zID0gcnVsZUdyb3VwLm9wdGlvbnMgfHwgeyByZXN1bHRSZXF1aXJlbWVudHM6IFJlc3VsdHNQYXNzUmVxdWlyZW1lbnQuQWxsUGFzcyB9O1xyXG5cclxuICAgICAgICByZXR1cm4gKFxyXG4gICAgICAgICAgICAvLyBpdCBwYXNzZWQsIGFuZCB3ZSBvbmx5IG5lZWQgb25lIHRvIHBhc3NcclxuICAgICAgICAgICAgKHJ1bGVTZXRSZXN1bHQgPT0gUHJvY2Vzc1Jlc3VsdFR5cGUuUGFzc2VkICYmIHJ1bGVHcm91cE9wdGlvbnMucmVzdWx0UmVxdWlyZW1lbnRzID09IFJlc3VsdHNQYXNzUmVxdWlyZW1lbnQuQW55UGFzcylcclxuICAgICAgICAgICAgfHxcclxuICAgICAgICAgICAgLy8gaWYgZmFpbGVkLCBhbmQgd2UgbmVlZCBhbGwgdG8gcGFzc1xyXG4gICAgICAgICAgICAocnVsZVNldFJlc3VsdCA9PSBQcm9jZXNzUmVzdWx0VHlwZS5GYWlsZWQgJiYgcnVsZUdyb3VwT3B0aW9ucy5yZXN1bHRSZXF1aXJlbWVudHMgPT0gUmVzdWx0c1Bhc3NSZXF1aXJlbWVudC5BbGxQYXNzKVxyXG4gICAgICAgICk7XHJcbiAgICB9XHJcblxyXG4gICAgcHJpdmF0ZSBpc1J1bGVHcm91cDxUPihydWxlU2V0OiBSdWxlU2V0PFQ+KTogYm9vbGVhbiB7XHJcbiAgICAgICAgY29uc3QgcnVsZSA9IHJ1bGVTZXQgYXMgUnVsZTxUPjtcclxuICAgICAgICByZXR1cm4gIXJ1bGUuZnVuYyAmJiAhcnVsZS5hc3luY0Z1bmM7XHJcbiAgICB9XHJcblxyXG4gICAgcHJpdmF0ZSBnZXREZXBlbmRlbmN5UHJvcGVydGllc0Zyb21UZXN0PFQ+KHRlc3Q6IFRlc3Q8VD4pOiBzdHJpbmdbXSB7XHJcbiAgICAgICAgY29uc3QgY2hlY2tEZXBzID0gdGhpcy5nZXREZXBlbmRlbmN5UHJvcGVydGllc0Zyb21SdWxlU2V0PFQ+KHRlc3QuY2hlY2spO1xyXG4gICAgICAgIGNvbnN0IGNvbmRpdGlvbkRlcHMgPSB0aGlzLmdldERlcGVuZGVuY3lQcm9wZXJ0aWVzRnJvbVJ1bGVTZXQ8VD4odGVzdC5jb25kaXRpb24pO1xyXG4gICAgICAgIHJldHVybiB0aGlzLmNvbW1vblN2Yy51bmlxdWUoY2hlY2tEZXBzLmNvbmNhdChjb25kaXRpb25EZXBzKSk7XHJcbiAgICB9XHJcblxyXG4gICAgcHJpdmF0ZSBnZXREZXBlbmRlbmN5UHJvcGVydGllc0Zyb21SdWxlU2V0PFQ+KHJ1bGVTZXQ6IFJ1bGVTZXQ8VD4pOiBzdHJpbmdbXSB7XHJcbiAgICAgICAgaWYgKCFydWxlU2V0KSByZXR1cm4gW107XHJcblxyXG4gICAgICAgIGNvbnN0IHJlc3VsdDogc3RyaW5nW10gPSBbXTtcclxuXHJcbiAgICAgICAgaWYgKHRoaXMuaXNSdWxlR3JvdXAocnVsZVNldCkpIHtcclxuICAgICAgICAgICAgY29uc3QgcnVsZUdyb3VwID0gcnVsZVNldCBhcyBSdWxlR3JvdXA8VD47XHJcbiAgICAgICAgICAgIHJ1bGVHcm91cC5ydWxlcy5mb3JFYWNoKHggPT4ge1xyXG4gICAgICAgICAgICAgICAgcmVzdWx0LnB1c2goLi4udGhpcy5jb21tb25TdmMudW5pcXVlKHRoaXMuZ2V0RGVwZW5kZW5jeVByb3BlcnRpZXNGcm9tUnVsZVNldCh4KSkpO1xyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGNvbnN0IHJ1bGUgPSBydWxlU2V0IGFzIFJ1bGU8VD47XHJcbiAgICAgICAgaWYgKHJ1bGUub3B0aW9ucyAmJiBBcnJheS5pc0FycmF5KHJ1bGUub3B0aW9ucy5kZXBlbmRlbmN5UHJvcGVydGllcykpIHtcclxuICAgICAgICAgICAgcmVzdWx0LnB1c2goLi4udGhpcy5jb21tb25TdmMudW5pcXVlKHJ1bGUub3B0aW9ucy5kZXBlbmRlbmN5UHJvcGVydGllcykpO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgcmV0dXJuIHRoaXMuY29tbW9uU3ZjLnVuaXF1ZShyZXN1bHQpO1xyXG4gICAgfVxyXG5cclxuICAgIHByaXZhdGUgc2V0UHJvcGVydHlNZXRhZGF0YShwcm9wZXJ0aWVzOiBQcm9wZXJ0eUJhc2U8YW55PltdLCBtb2RlbFNldHRpbmdzTmFtZTogc3RyaW5nLCBjdXJyZW50QWJzb2x1dGVQYXRoOiBzdHJpbmcgPSAnJyk6IHZvaWQge1xyXG4gICAgICAgIGlmICghcHJvcGVydGllcykgcmV0dXJuO1xyXG5cclxuICAgICAgICBwcm9wZXJ0aWVzLmZvckVhY2gocHJvcCA9PiB7XHJcbiAgICAgICAgICAgIGNvbnN0IG5ld0Fic29sdXRlUGF0aCA9IHRoaXMuc2V0UHJvcGVydHlBYnNvbHV0ZVBhdGgocHJvcCwgY3VycmVudEFic29sdXRlUGF0aCk7XHJcbiAgICAgICAgICAgIHRoaXMuZmlsbEluRW1wdHlUZXN0TmFtZXMocHJvcCk7XHJcbiAgICAgICAgICAgIHByb3Auc2V0T3duZXJNb2RlbFNldHRpbmdzTmFtZShtb2RlbFNldHRpbmdzTmFtZSk7XHJcblxyXG4gICAgICAgICAgICBpZiAocHJvcC5wcm9wZXJ0aWVzKSB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLnNldFByb3BlcnR5TWV0YWRhdGEocHJvcC5wcm9wZXJ0aWVzLCBtb2RlbFNldHRpbmdzTmFtZSwgbmV3QWJzb2x1dGVQYXRoKTtcclxuICAgICAgICAgICAgfSBlbHNlIGlmIChwcm9wLmFycmF5SXRlbVByb3BlcnR5KSB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLnNldFByb3BlcnR5TWV0YWRhdGEoW3Byb3AuYXJyYXlJdGVtUHJvcGVydHldLCBtb2RlbFNldHRpbmdzTmFtZSwgbmV3QWJzb2x1dGVQYXRoKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH0pO1xyXG4gICAgfVxyXG5cclxuICAgIHByaXZhdGUgc2V0UHJvcGVydHlBYnNvbHV0ZVBhdGgocHJvcGVydHk6IFByb3BlcnR5QmFzZTxhbnk+LCBjdXJyZW50QWJzb2x1dGVQYXRoOiBzdHJpbmcgPSAnJyk6IHN0cmluZyB7XHJcbiAgICAgICAgY29uc3QgaXNBcnJheUl0ZW1Qcm9wZXJ0eSA9IFByb3BlcnR5QmFzZS5pc0FycmF5SXRlbVByb3BlcnR5KHByb3BlcnR5KTtcclxuICAgICAgICBjb25zdCBuZXdBYnNvbHV0ZVBhdGhTZWdtZW50ID0gaXNBcnJheUl0ZW1Qcm9wZXJ0eSA/ICdbXScgOiAocHJvcGVydHkgYXMgUHJvcGVydHk8YW55PikubmFtZTtcclxuICAgICAgICBjb25zdCBpc0F0Um9vdCA9ICFjdXJyZW50QWJzb2x1dGVQYXRoO1xyXG4gICAgICAgIGNvbnN0IG5ld0Fic29sdXRlUGF0aCA9IGAke2N1cnJlbnRBYnNvbHV0ZVBhdGh9JHtpc0F0Um9vdCA/ICcnIDogJy4nfSR7bmV3QWJzb2x1dGVQYXRoU2VnbWVudH1gO1xyXG5cclxuICAgICAgICAvLyBzZXQgYWJzb2x1dGUgcGF0aCBmb3IgcHJvcGVydHlcclxuICAgICAgICBwcm9wZXJ0eS5zZXRBYnNvbHV0ZVBhdGgobmV3QWJzb2x1dGVQYXRoKTtcclxuXHJcbiAgICAgICAgcmV0dXJuIG5ld0Fic29sdXRlUGF0aDtcclxuICAgIH1cclxuXHJcbiAgICBwcml2YXRlIGZpbGxJbkVtcHR5VGVzdE5hbWVzKHByb3BlcnR5OiBQcm9wZXJ0eUJhc2U8YW55Pikge1xyXG4gICAgICAgIHByb3BlcnR5LnZhbGlkXHJcbiAgICAgICAgICAgIC5maWx0ZXIodGVzdCA9PiAhdGVzdC5uYW1lKVxyXG4gICAgICAgICAgICAuZm9yRWFjaCgodGVzdCwgaSkgPT4gdGVzdC5uYW1lID0gYHZhbGlkVGVzdCR7aX1gKTtcclxuXHJcbiAgICAgICAgcHJvcGVydHkuZWRpdFxyXG4gICAgICAgICAgICAuZmlsdGVyKHRlc3QgPT4gIXRlc3QubmFtZSlcclxuICAgICAgICAgICAgLmZvckVhY2goKHRlc3QsIGkpID0+IHRlc3QubmFtZSA9IGBlZGl0VGVzdCR7aX1gKTtcclxuICAgIH1cclxuXHJcbiAgICBwcml2YXRlIGdldENvbmZpZ3VyZWRGdW5jVHlwZXM8VD4ocnVsZVNldDogUnVsZVNldDxUPik6IENvbmZpZ3VyZWRGdW5jVHlwZXMge1xyXG4gICAgICAgIGlmICghcnVsZVNldCkgcmV0dXJuIHsgc3luYzogZmFsc2UsIGFzeW5jOiBmYWxzZSB9O1xyXG5cclxuICAgICAgICBjb25zdCBpc1J1bGVHcm91cCA9IHRoaXMuaXNSdWxlR3JvdXAocnVsZVNldCk7XHJcblxyXG4gICAgICAgIGlmIChpc1J1bGVHcm91cCkge1xyXG4gICAgICAgICAgICBjb25zdCBydWxlR3JvdXAgPSBydWxlU2V0IGFzIFJ1bGVHcm91cDxUPjtcclxuICAgICAgICAgICAgY29uc3QgcmVzdWx0cyA9IHJ1bGVHcm91cC5ydWxlc1xyXG4gICAgICAgICAgICAgICAgLm1hcChycyA9PiB7XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuZ2V0Q29uZmlndXJlZEZ1bmNUeXBlcyhycyk7XHJcbiAgICAgICAgICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgICAgIHJldHVybiB7XHJcbiAgICAgICAgICAgICAgICBzeW5jOiByZXN1bHRzLmZpbmRJbmRleCh4ID0+ICEheC5zeW5jKSA+PSAwLFxyXG4gICAgICAgICAgICAgICAgYXN5bmM6IHJlc3VsdHMuZmluZEluZGV4KHggPT4gISF4LmFzeW5jKSA+PSAwLFxyXG4gICAgICAgICAgICB9O1xyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgIGNvbnN0IHJ1bGUgPSBydWxlU2V0IGFzIFJ1bGU8VD47XHJcbiAgICAgICAgICAgIHJldHVybiB7XHJcbiAgICAgICAgICAgICAgICBzeW5jOiAhIXJ1bGUuZnVuYyxcclxuICAgICAgICAgICAgICAgIGFzeW5jOiAhIXJ1bGUuYXN5bmNGdW5jXHJcbiAgICAgICAgICAgIH07XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG59XHJcblxyXG5pbnRlcmZhY2UgQ29uZmlndXJlZEZ1bmNUeXBlcyB7XHJcbiAgICBzeW5jOiBib29sZWFuO1xyXG4gICAgYXN5bmM6IGJvb2xlYW47XHJcbn1cclxuIiwiaW1wb3J0IHsgQWJzdHJhY3RDb250cm9sIH0gZnJvbSBcIkBhbmd1bGFyL2Zvcm1zXCI7XHJcblxyXG4vKipcclxuICogU3RhdGUgb2YgYW4gQW5ndWxhciBBYnN0cmFjdENvbnRyb2wgYXQgdGhlIHRpbWUgb2YgcnVubmluZyBhIHRlc3RcclxuICovXHJcbmV4cG9ydCBjbGFzcyBDb250cm9sU3RhdGUge1xyXG4gICAgcHJpdmF0ZSByZWFkb25seSBfcHJpc3RpbmU6IGJvb2xlYW47XHJcbiAgICBwcml2YXRlIHJlYWRvbmx5IF91bnRvdWNoZWQ6IGJvb2xlYW47XHJcblxyXG4gICAgLy8gZ2V0IHByaXN0aW5lKCk6IGJvb2xlYW4geyByZXR1cm4gdGhpcy5fcHJpc3RpbmU7IH1cclxuICAgIC8vIGdldCB1bnRvdWNoZWQoKTogYm9vbGVhbiB7IHJldHVybiB0aGlzLl91bnRvdWNoZWQ7IH1cclxuXHJcbiAgICBwcml2YXRlIGNvbnN0cnVjdG9yKGNvbnRyb2w6IEFic3RyYWN0Q29udHJvbCkge1xyXG4gICAgICAgIHRoaXMuX3ByaXN0aW5lID0gY29udHJvbC5wcmlzdGluZTtcclxuICAgICAgICB0aGlzLl91bnRvdWNoZWQgPSBjb250cm9sLnVudG91Y2hlZDtcclxuICAgIH1cclxuXHJcbiAgICAvKipcclxuICAgICAqIENyZWF0ZXMgYSBDb250cm9sU3RhdGUgb2JqZWN0IGJhc2VkIG9uIGFuIEFuZ3VsYXIgY29udHJvbFxyXG4gICAgICogQHBhcmFtIGNvbnRyb2wgQW5ndWxhciBjb250cm9sIHRvIGdlbmVyYXRlIHN0YXRlIGZyb21cclxuICAgICAqIEByZXR1cm5zIENvbnRyb2wgc3RhdGUgYmFzZSBvbiBBbmd1bGFyIGNvbnRyb2xcclxuICAgICAqL1xyXG4gICAgc3RhdGljIGNyZWF0ZShjb250cm9sOiBBYnN0cmFjdENvbnRyb2wpOiBDb250cm9sU3RhdGUge1xyXG4gICAgICAgIHJldHVybiBuZXcgQ29udHJvbFN0YXRlKGNvbnRyb2wpO1xyXG4gICAgfVxyXG59IiwiLy8gdHNsaW50OmRpc2FibGU6bWF4LWxpbmUtbGVuZ3RoXHJcbmltcG9ydCB7IEluamVjdGFibGUgfSBmcm9tIFwiQGFuZ3VsYXIvY29yZVwiO1xyXG5pbXBvcnQgeyBGb3JtR3JvdXAsIEFic3RyYWN0Q29udHJvbCwgVmFsaWRhdG9yRm4sIEZvcm1CdWlsZGVyLCBGb3JtQ29udHJvbCwgRm9ybUFycmF5LCBWYWxpZGF0aW9uRXJyb3JzLCBBc3luY1ZhbGlkYXRvckZuIH0gZnJvbSAnQGFuZ3VsYXIvZm9ybXMnO1xyXG5pbXBvcnQgeyBSdWxlc0VuZ2luZVNlcnZpY2UgfSBmcm9tIFwiLi4vcnVsZXMtZW5naW5lL3J1bGVzLWVuZ2luZS5zZXJ2aWNlXCI7XHJcbmltcG9ydCB7IFByb3BlcnR5IH0gZnJvbSBcIi4uLy4uLy4uL2Zvcm0tcnVsZXMvbW9kZWxzL3Byb3BlcnR5XCI7XHJcbmltcG9ydCB7IEFycmF5SXRlbVByb3BlcnR5IH0gZnJvbSBcIi4uLy4uLy4uL2Zvcm0tcnVsZXMvbW9kZWxzL2FycmF5LWl0ZW0tcHJvcGVydHlcIjtcclxuaW1wb3J0IHsgUHJvcGVydHlCYXNlIH0gZnJvbSBcIi4uLy4uLy4uL2Zvcm0tcnVsZXMvbW9kZWxzL3Byb3BlcnR5LWJhc2VcIjtcclxuaW1wb3J0IHsgVHJhY2VTZXJ2aWNlIH0gZnJvbSBcIi4uLy4uLy4uL3V0aWxzL3RyYWNlL3RyYWNlLnNlcnZpY2VcIjtcclxuaW1wb3J0IHsgT2JzZXJ2YWJsZSwgQmVoYXZpb3JTdWJqZWN0LCBvZiwgT3BlcmF0b3JGdW5jdGlvbiwgdGltZXIsIGVtcHR5LCBFTVBUWSB9IGZyb20gXCJyeGpzXCI7XHJcbmltcG9ydCB7IG1hcCwgdGFwLCBzd2l0Y2hNYXAsIHRha2UsIGRpc3RpbmN0VW50aWxDaGFuZ2VkLCBkZWJvdW5jZSB9IGZyb20gXCJyeGpzL29wZXJhdG9yc1wiO1xyXG5pbXBvcnQgeyBUZXN0UmVzdWx0c0Jhc2UgfSBmcm9tIFwiLi4vLi4vLi4vZm9ybS1ydWxlcy9tb2RlbHMvdGVzdC1yZXN1bHRzLWJhc2VcIjtcclxuaW1wb3J0IHsgUmVhY3RpdmVGb3Jtc1ZhbGlkYXRpb25FcnJvcnMgfSBmcm9tIFwiLi4vLi4vLi4vZm9ybS1ydWxlcy9tb2RlbHMvcmVhY3RpdmUtZm9ybXMtdmFsaWRhdGlvbi1lcnJvcnNcIjtcclxuaW1wb3J0IHsgUmVhY3RpdmVGb3Jtc0ZhaWxlZFZhbGRhdGlvbiB9IGZyb20gXCIuLi8uLi8uLi9mb3JtLXJ1bGVzL21vZGVscy9yZWFjdGl2ZS1mb3Jtcy1mYWlsZWQtdmFsaWRhdGlvblwiO1xyXG5pbXBvcnQgeyBSZWFjdGl2ZUZvcm1zVmFsaWRhdGlvbkVycm9yc0RhdGEgfSBmcm9tIFwiLi4vLi4vLi4vZm9ybS1ydWxlcy9tb2RlbHMvcmVhY3RpdmUtZm9ybXMtdmFsaWRhdGlvbi1lcnJvcnMtZGF0YVwiO1xyXG5pbXBvcnQgeyBDb250cm9sU3RhdGUgfSBmcm9tIFwiLi4vLi4vLi4vZm9ybS1ydWxlcy9tb2RlbHMvY29udHJvbC1zdGF0ZVwiO1xyXG5pbXBvcnQgeyBDb21tb25TZXJ2aWNlIH0gZnJvbSBcIi4uLy4uLy4uL3V0aWxzL2NvbW1vbi9jb21tb24uc2VydmljZVwiO1xyXG5pbXBvcnQgeyBBYnN0cmFjdE1vZGVsU2V0dGluZ3MgfSBmcm9tIFwiLi4vLi4vLi4vZm9ybS1ydWxlcy9tb2RlbHMvYWJzdHJhY3QtbW9kZWwtc2V0dGluZ3NcIjtcclxuaW1wb3J0IHsgVmFsdWVDaGFuZ2VPcHRpb25zIH0gZnJvbSBcIi4uLy4uLy4uL2Zvcm0tcnVsZXMvbW9kZWxzL3ZhbHVlLWNoYW5nZS1vcHRpb25zXCI7XHJcbmltcG9ydCB7IEFkZEFycmF5SXRlbVByb3BlcnR5T3B0aW9ucyB9IGZyb20gXCIuLi8uLi8uLi9mb3JtLXJ1bGVzL21vZGVscy9hZGQtYXJyYXktaXRlbS1wcm9wZXJ0eS1vcHRpb25zXCI7XHJcbmltcG9ydCB7IFVwZGF0ZU9uIH0gZnJvbSBcIi4uLy4uLy4uL2Zvcm0tcnVsZXMvbW9kZWxzL3VwZGF0ZS1vblwiO1xyXG4vLyB0c2xpbnQ6ZW5hYmxlOm1heC1saW5lLWxlbmd0aFxyXG5cclxuLyoqXHJcbiAqIEJ1aWxkcyByZWFjdGl2ZSBmb3JtcyB1c2luZyBjb25maWd1cmVkIG1vZGVsIHNldHRpbmdzXHJcbiAqL1xyXG5ASW5qZWN0YWJsZSgpXHJcbmV4cG9ydCBjbGFzcyBSZWFjdGl2ZUZvcm1zUnVsZVNlcnZpY2Uge1xyXG4gICAgcHJpdmF0ZSBzdGF0aWMgcmVhZG9ubHkgRk9STV9NT0RFTF9TRVRUSU5HU19QUk9QRVJUWV9OQU1FID0gJ25nRm9ybVJ1bGVzTW9kZWxTZXR0aW5nJztcclxuICAgIHByaXZhdGUgc3RhdGljIHJlYWRvbmx5IEZPUkNFX0FTWU5DX1ZBTElEX1RFU1RfUlVOX1BST1BFUlRZX05BTUUgPSAnbmdGb3JtUnVsZXNGb3JjZUFzeW5jVmFsaWRUZXN0UnVuJztcclxuICAgIHByaXZhdGUgc3RhdGljIHJlYWRvbmx5IENPTlRST0xfTEFTVF9FUlJPUiA9ICduZ0Zvcm1SdWxlc0NvbnRyb2xMYXN0RXJyb3InO1xyXG5cclxuICAgIGNvbnN0cnVjdG9yKFxyXG4gICAgICAgIHByaXZhdGUgcnVsZXNFbmdpbmVTdmM6IFJ1bGVzRW5naW5lU2VydmljZSxcclxuICAgICAgICBwcml2YXRlIGZvcm1CdWlsZGVyOiBGb3JtQnVpbGRlcixcclxuICAgICAgICBwcml2YXRlIHRyYWNlU3ZjOiBUcmFjZVNlcnZpY2UsXHJcbiAgICAgICAgcHJpdmF0ZSBjb21tb25TdmM6IENvbW1vblNlcnZpY2VcclxuICAgICkge1xyXG4gICAgfVxyXG5cclxuICAgIC8qKlxyXG4gICAgICogR2V0cyBtb2RlbCBzZXR0aW5ncyB3aXRoIHRoZSBwcm92aWRlZCBuYW1lXHJcbiAgICAgKiBAcGFyYW0gbmFtZSBOYW1lIG9mIG1vZGVsIHNldHRpbmdcclxuICAgICAqIEByZXR1cm5zIE1vZGVsIHNldHRpbmdzIHdpdGggdGhlIHByb3ZpZGVkIG5hbWVcclxuICAgICAqL1xyXG4gICAgZ2V0TW9kZWxTZXR0aW5nczxUPihuYW1lOiBzdHJpbmcpOiBBYnN0cmFjdE1vZGVsU2V0dGluZ3M8VD4ge1xyXG4gICAgICAgIHJldHVybiB0aGlzLnJ1bGVzRW5naW5lU3ZjLmdldE1vZGVsU2V0dGluZ3MobmFtZSk7XHJcbiAgICB9XHJcblxyXG4gICAgLyoqXHJcbiAgICAgKiBDcmVhdGVzIGEgZm9ybSBncm91cCB1c2luZyBhbiBpbnN0YW5jZSBvZiBtb2RlbCBzZXR0aW5nc1xyXG4gICAgICogQHBhcmFtIG1vZGVsU2V0dGluZ3MgTmFtZSBvZiB0aGUgbW9kZWwgc2V0dGluZyBvciBhbiBpbnN0YW5jZSBvZiBtb2RlbCBzZXR0aW5ncyB0byB1c2VcclxuICAgICAqIEBwYXJhbSBpbml0aWFsVmFsdWUgSW5pdGlhbCBkYXRhIHRvIHNldCB0aGUgZm9ybSB2YWx1ZXMgdG9cclxuICAgICAqIEByZXR1cm5zIEZvcm0gZ3JvdXAgY3JlYXRlZCBhY2NvcmRpbmcgdG8gZGVmaW5lZCBtb2RlbCBzZXR0aW5nc1xyXG4gICAgICovXHJcbiAgICBjcmVhdGVGb3JtR3JvdXA8VD4oXHJcbiAgICAgICAgbW9kZWxTZXR0aW5nczogc3RyaW5nIHwgQWJzdHJhY3RNb2RlbFNldHRpbmdzPFQ+LFxyXG4gICAgICAgIGluaXRpYWxWYWx1ZT86IGFueVxyXG4gICAgKTogRm9ybUdyb3VwIHtcclxuICAgICAgICBsZXQgc2V0dGluZ3M6IEFic3RyYWN0TW9kZWxTZXR0aW5nczxUPjtcclxuXHJcbiAgICAgICAgaWYgKHR5cGVvZiBtb2RlbFNldHRpbmdzID09PSBcInN0cmluZ1wiKSB7XHJcbiAgICAgICAgICAgIHNldHRpbmdzID0gdGhpcy5ydWxlc0VuZ2luZVN2Yy5nZXRNb2RlbFNldHRpbmdzKG1vZGVsU2V0dGluZ3MgYXMgc3RyaW5nKTtcclxuICAgICAgICAgICAgaWYgKCFzZXR0aW5ncykgdGhyb3cgbmV3IEVycm9yKGBObyBtb2RlbCBzZXR0aW5nIGZvdW5kIHdpdGggdGhlIG5hbWUgXCIke21vZGVsU2V0dGluZ3N9XCJgKTtcclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICBpZiAoIW1vZGVsU2V0dGluZ3MpIHRocm93IG5ldyBFcnJvcihgQWRob2MgbW9kZWwgc2V0dGluZyBwcm92aWRlZCBpcyBpbnZhbGlkYCk7XHJcbiAgICAgICAgICAgIHNldHRpbmdzID0gbW9kZWxTZXR0aW5ncyBhcyBBYnN0cmFjdE1vZGVsU2V0dGluZ3M8VD47XHJcbiAgICAgICAgICAgIHRoaXMucnVsZXNFbmdpbmVTdmMuaW5pdGlhbGl6ZU1vZGVsU2V0dGluZyhzZXR0aW5ncyk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICB0aGlzLnRyYWNlU3ZjLnRyYWNlKGBDcmVhdGluZyBmb3JtIGdyb3VwIHVzaW5nIG1vZGVsIHNldHRpbmdzIFwiJHtzZXR0aW5ncy5uYW1lfVwiYCk7XHJcbiAgICAgICAgY29uc3QgZm9ybUdyb3VwID0gdGhpcy5idWlsZEdyb3VwKHNldHRpbmdzLnByb3BlcnRpZXMsIGluaXRpYWxWYWx1ZSk7XHJcblxyXG4gICAgICAgIHRoaXMudHJhY2VTdmMudHJhY2UoYFNldHRpbmcgdXAgZGVwZW5kZW5jeSBzdWJzY3JpcHRpb25zYCk7XHJcbiAgICAgICAgdGhpcy5yZXNldERlcGVuZGVuY3lTdWJzY3JpcHRpb25zKGZvcm1Hcm91cCwgc2V0dGluZ3MucHJvcGVydGllcyk7XHJcblxyXG4gICAgICAgIHRoaXMudHJhY2VTdmMudHJhY2UoYFBhdGNoaW5nIGZvcm0gZ3JvdXAgd2l0aCBpbml0aWFsIHZhbHVlYCk7XHJcbiAgICAgICAgdGhpcy50cmlnZ2VyVmFsdWVDaGFuZ2UoZm9ybUdyb3VwKTtcclxuXHJcbiAgICAgICAgdGhpcy50cmFjZVN2Yy50cmFjZShgQXR0YWNoaW5nIG1vZGVsIHNldHRpbmdzIHRvIGZvcm1gKTtcclxuICAgICAgICB0aGlzLmF0dGFjaE1vZGVsU2V0dGluZ3NUb0Zvcm0oZm9ybUdyb3VwLCBzZXR0aW5ncyk7XHJcblxyXG4gICAgICAgIHJldHVybiBmb3JtR3JvdXA7XHJcbiAgICB9XHJcblxyXG4gICAgLyoqXHJcbiAgICAgKiBBZGRzIGFuIGFycmF5IGl0ZW0gcHJvcGVydHkgdG8gYW4gZXhpc3RpbmcgZm9ybSBhcnJheVxyXG4gICAgICogQHBhcmFtIHByb3BlcnR5IEFycmF5SXRlbVByb3BlcnR5IHRvIGZvciB0aGUgYXJyYXkgaXRlbSB0byBiZSBhZGRlZFxyXG4gICAgICogQHBhcmFtIHBhcmVudEZvcm1BcnJheSBUaGUgcGFyZW50IEZvcm1BcnJheVxyXG4gICAgICogQHBhcmFtIGluaXRpYWxWYWx1ZSBJbml0aWFsIHZhbHVlIG9mIHRoZSBmb3JtIGFycmF5IGl0ZW1cclxuICAgICAqIEBwYXJhbSBvcHRpb25zIE9wdGlvbnMgZm9yIGFkZGluZyBuZXcgYXJyYXkgaXRlbSBwcm9wZXJ0eVxyXG4gICAgICovXHJcbiAgICBhZGRBcnJheUl0ZW1Qcm9wZXJ0eUNvbnRyb2w8VD4oXHJcbiAgICAgICAgcHJvcGVydHk6IEFycmF5SXRlbVByb3BlcnR5PFQ+LFxyXG4gICAgICAgIHBhcmVudEZvcm1BcnJheTogRm9ybUFycmF5LFxyXG4gICAgICAgIGluaXRpYWxWYWx1ZT86IGFueSxcclxuICAgICAgICBvcHRpb25zPzogQWRkQXJyYXlJdGVtUHJvcGVydHlPcHRpb25zXHJcbiAgICApOiB2b2lkIHtcclxuICAgICAgICBjb25zdCBjb250cm9sID0gdGhpcy5idWlsZEFic3RyYWN0Q29udHJvbChwcm9wZXJ0eSwgaW5pdGlhbFZhbHVlKTtcclxuICAgICAgICBjb25zdCB3aWxsQmVMYXN0SXRlbSA9ICFvcHRpb25zIHx8ICF0aGlzLmNvbW1vblN2Yy5pc1plcm9PckdyZWF0ZXIob3B0aW9ucy5pbmRleCkgfHwgb3B0aW9ucy5pbmRleCA+PSBwYXJlbnRGb3JtQXJyYXkubGVuZ3RoO1xyXG5cclxuICAgICAgICBpZiAod2lsbEJlTGFzdEl0ZW0pXHJcbiAgICAgICAgICAgIHBhcmVudEZvcm1BcnJheS5wdXNoKGNvbnRyb2wpO1xyXG4gICAgICAgIGVsc2VcclxuICAgICAgICAgICAgcGFyZW50Rm9ybUFycmF5Lmluc2VydChvcHRpb25zLmluZGV4LCBjb250cm9sKTtcclxuXHJcbiAgICAgICAgY29uc3QgbW9kZWxTZXR0aW5ncyA9IHRoaXMuZ2V0TW9kZWxTZXR0aW5nc0Zyb21Gb3JtKHBhcmVudEZvcm1BcnJheS5yb290IGFzIEZvcm1Hcm91cCk7XHJcbiAgICAgICAgdGhpcy5yZXNldERlcGVuZGVuY3lTdWJzY3JpcHRpb25zKHBhcmVudEZvcm1BcnJheS5yb290LCBtb2RlbFNldHRpbmdzLnByb3BlcnRpZXMpO1xyXG5cclxuICAgICAgICAvLyB3ZSBuZWVkIHRvIGRvIHRoaXMgYmVjYXVzZSB0aGUgaXRlbSBjb3VsZCBoYXZlIGJlZW4gYWRkZWQgYXQgYW55IGluZGV4IGluIHRoZSBhcnJheSwgYW5kIHdlIG5lZWRcclxuICAgICAgICAvLyB0cmlnZ2VyIGEgdmFsdWUgY2hhbmdlIHRvIHRyaWdnZXIgYW55IGRlcGVuZGVuY3kgcHJvcGVydGl5IHZhbGRpZGF0aW9uc1xyXG4gICAgICAgIHRoaXMudHJpZ2dlclZhbHVlQ2hhbmdlKHBhcmVudEZvcm1BcnJheSk7XHJcbiAgICB9XHJcblxyXG4gICAgLyoqXHJcbiAgICAgKiBFeHRlbmRzIHZhbGlkYXRvcnMgZ2VuZXJhdGVkIGJ5IG5nLWZvcm0tcnVsZXMgd2l0aCB5b3VyIG93biB2YWxpZGF0b3JzXHJcbiAgICAgKiBAcGFyYW0gY29udHJvbCBDb250cm9sIHRvIGV4dGVuZHMgdGhlIHZhbGlkYXRvcnMgZm9yXHJcbiAgICAgKiBAcGFyYW0gdmFsaWRhdG9yIFZhbGlkYXRvciB0byBhZGRcclxuICAgICAqL1xyXG4gICAgZXh0ZW5kVmFsaWRhdG9yKGNvbnRyb2w6IEFic3RyYWN0Q29udHJvbCwgdmFsaWRhdG9yOiBWYWxpZGF0b3JGbiB8IFZhbGlkYXRvckZuW10pOiB2b2lkIHtcclxuICAgICAgICBpZiAoIXZhbGlkYXRvcikgcmV0dXJuO1xyXG5cclxuICAgICAgICBjb25zdCB2YWxpZGF0b3JBcnJheSA9IEFycmF5LmlzQXJyYXkodmFsaWRhdG9yKSA/IHZhbGlkYXRvciA6IFt2YWxpZGF0b3JdO1xyXG4gICAgICAgIGNvbnRyb2wuc2V0VmFsaWRhdG9ycyhbY29udHJvbC52YWxpZGF0b3IsIC4uLnZhbGlkYXRvckFycmF5XVxyXG4gICAgICAgICAgICAuZmlsdGVyKHZhbGlkYXRvckZuID0+ICEhdmFsaWRhdG9yRm4pKTtcclxuICAgIH1cclxuXHJcbiAgICAvKipcclxuICAgICAqIEV4dGVuZHMgYXN5bmMgdmFsaWRhdG9ycyBnZW5lcmF0ZWQgYnkgbmctZm9ybS1ydWxlcyB3aXRoIHlvdXIgb3duIGFzeW5jIHZhbGlkYXRvcnNcclxuICAgICAqIEBwYXJhbSBjb250cm9sIENvbnRyb2wgdG8gZXh0ZW5kcyB0aGUgYXN5bmMgdmFsaWRhdG9ycyBmb3JcclxuICAgICAqIEBwYXJhbSBhc3luY1ZhbGlkYXRvciBBc3luYyB2YWxpZGF0b3IgdG8gYWRkXHJcbiAgICAgKi9cclxuICAgIGV4dGVuZEFzeW5jVmFsaWRhdG9yKGNvbnRyb2w6IEFic3RyYWN0Q29udHJvbCwgYXN5bmNWYWxpZGF0b3I6IEFzeW5jVmFsaWRhdG9yRm4gfCBBc3luY1ZhbGlkYXRvckZuW10pOiB2b2lkIHtcclxuICAgICAgICBpZiAoIWFzeW5jVmFsaWRhdG9yKSByZXR1cm47XHJcblxyXG4gICAgICAgIGNvbnN0IGFzeW5jVmFsaWRhdG9yQXJyYXkgPSBBcnJheS5pc0FycmF5KGFzeW5jVmFsaWRhdG9yKSA/IGFzeW5jVmFsaWRhdG9yIDogW2FzeW5jVmFsaWRhdG9yXTtcclxuICAgICAgICBjb250cm9sLnNldEFzeW5jVmFsaWRhdG9ycyhbY29udHJvbC5hc3luY1ZhbGlkYXRvciwgLi4uYXN5bmNWYWxpZGF0b3JBcnJheV1cclxuICAgICAgICAgICAgLmZpbHRlcihhc3luY1ZhbGlkYXRvckZuID0+ICEhYXN5bmNWYWxpZGF0b3JGbikpO1xyXG4gICAgfVxyXG5cclxuICAgIHByaXZhdGUgYnVpbGRBYnN0cmFjdENvbnRyb2w8VD4ocHJvcGVydHk6IFByb3BlcnR5QmFzZTxUPiwgaW5pdGlhbFZhbHVlPzogYW55KTogQWJzdHJhY3RDb250cm9sIHtcclxuICAgICAgICBsZXQgY29udHJvbDogQWJzdHJhY3RDb250cm9sO1xyXG5cclxuICAgICAgICBpZiAocHJvcGVydHkuYXJyYXlJdGVtUHJvcGVydHkpIGNvbnRyb2wgPSB0aGlzLmJ1aWxkQXJyYXkocHJvcGVydHkuYXJyYXlJdGVtUHJvcGVydHksIGluaXRpYWxWYWx1ZSwgcHJvcGVydHkudXBkYXRlT24pO1xyXG4gICAgICAgIGVsc2UgaWYgKHByb3BlcnR5LnByb3BlcnRpZXMpIGNvbnRyb2wgPSB0aGlzLmJ1aWxkR3JvdXAocHJvcGVydHkucHJvcGVydGllcywgaW5pdGlhbFZhbHVlLCBwcm9wZXJ0eS51cGRhdGVPbik7XHJcbiAgICAgICAgZWxzZSBjb250cm9sID0gdGhpcy5idWlsZENvbnRyb2woaW5pdGlhbFZhbHVlLCBwcm9wZXJ0eS51cGRhdGVPbik7XHJcblxyXG4gICAgICAgIC8vIHNldHVwIHZhbGlkYXRpb24gdGVzdHMgb24gdmFsdWUgY2hhbmdlXHJcbiAgICAgICAgY29udHJvbC5zZXRWYWxpZGF0b3JzKHRoaXMuYnVpbGRWYWxpZGF0b3JGdW5jdGlvbihwcm9wZXJ0eSkpO1xyXG4gICAgICAgIGNvbnRyb2wuc2V0QXN5bmNWYWxpZGF0b3JzKHRoaXMuYnVpbGRBc3luY1ZhbGlkYXRvckZ1bmN0aW9uKHByb3BlcnR5KSk7XHJcblxyXG4gICAgICAgIC8vIHNldHVwIGVkaXQgdGVzdHMgb24gdmFsdWUgY2hhbmdlXHJcbiAgICAgICAgY29udHJvbC52YWx1ZUNoYW5nZXNcclxuICAgICAgICAgICAgLnBpcGUoXHJcbiAgICAgICAgICAgICAgICB0aGlzLmFwcGx5VmFsdWVDaGFuZ2VPcHRpb25zKHByb3BlcnR5LnZhbHVlQ2hhbmdlT3B0aW9ucy5zZWxmLmVkaXQpXHJcbiAgICAgICAgICAgIClcclxuICAgICAgICAgICAgLnN1YnNjcmliZSh2YWx1ZSA9PiB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLnBlcnNpc3RFZGl0VGVzdHMoY29udHJvbCwgcHJvcGVydHkpO1xyXG4gICAgICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgcmV0dXJuIGNvbnRyb2w7XHJcbiAgICB9XHJcblxyXG4gICAgcHJpdmF0ZSBidWlsZENvbnRyb2w8VD4oaW5pdGlhbFZhbHVlOiBhbnksIHVwZGF0ZU9uPzogVXBkYXRlT24pOiBGb3JtQ29udHJvbCB7XHJcbiAgICAgICAgcmV0dXJuIG5ldyBGb3JtQ29udHJvbChpbml0aWFsVmFsdWUsIHsgdXBkYXRlT246IHVwZGF0ZU9uIH0pO1xyXG4gICAgfVxyXG5cclxuICAgIHByaXZhdGUgYnVpbGRHcm91cDxUPihwcm9wZXJ0aWVzOiBQcm9wZXJ0eTxUPltdLCBpbml0aWFsVmFsdWU6IGFueSwgdXBkYXRlT24/OiBVcGRhdGVPbik6IEZvcm1Hcm91cCB7XHJcbiAgICAgICAgY29uc3QgZm9ybUdyb3VwID0gbmV3IEZvcm1Hcm91cCh7fSwgeyB1cGRhdGVPbjogdXBkYXRlT24gfSk7XHJcblxyXG4gICAgICAgIChwcm9wZXJ0aWVzIHx8IFtdKS5mb3JFYWNoKHAgPT4ge1xyXG4gICAgICAgICAgICBjb25zdCBwcm9wZXJ0eVZhbHVlID0gaW5pdGlhbFZhbHVlID8gaW5pdGlhbFZhbHVlW3AubmFtZV0gOiBudWxsO1xyXG4gICAgICAgICAgICBjb25zdCBjdHJsID0gdGhpcy5idWlsZEFic3RyYWN0Q29udHJvbChwLCBwcm9wZXJ0eVZhbHVlKTtcclxuICAgICAgICAgICAgZm9ybUdyb3VwLmFkZENvbnRyb2wocC5uYW1lLCBjdHJsKTtcclxuICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgcmV0dXJuIGZvcm1Hcm91cDtcclxuICAgIH1cclxuXHJcbiAgICBwcml2YXRlIGJ1aWxkQXJyYXk8VD4ocHJvcGVydHk6IEFycmF5SXRlbVByb3BlcnR5PFQ+LCBpbml0aWFsVmFsdWU6IGFueVtdLCB1cGRhdGVPbj86IFVwZGF0ZU9uKTogRm9ybUFycmF5IHtcclxuICAgICAgICBpbml0aWFsVmFsdWUgPSBBcnJheS5pc0FycmF5KGluaXRpYWxWYWx1ZSkgPyBpbml0aWFsVmFsdWUgOiBbXTtcclxuXHJcbiAgICAgICAgcmV0dXJuIG5ldyBGb3JtQXJyYXkoXHJcbiAgICAgICAgICAgIGluaXRpYWxWYWx1ZS5tYXAodiA9PiB0aGlzLmJ1aWxkQWJzdHJhY3RDb250cm9sKHByb3BlcnR5LCB2KSksXHJcbiAgICAgICAgICAgIHsgdXBkYXRlT246IHVwZGF0ZU9uIH1cclxuICAgICAgICApO1xyXG4gICAgfVxyXG5cclxuICAgIHByaXZhdGUgYnVpbGRWYWxpZGF0b3JGdW5jdGlvbjxUPihwcm9wZXJ0eTogUHJvcGVydHlCYXNlPFQ+KTogVmFsaWRhdG9yRm4ge1xyXG4gICAgICAgIGNvbnN0IHN5bmNHcm91cHMgPSB0aGlzLnJ1bGVzRW5naW5lU3ZjLmdyb3VwVGVzdHNCeVN5bmNUeXBlKHByb3BlcnR5LnZhbGlkKTtcclxuICAgICAgICBpZiAoIXN5bmNHcm91cHMuc3luYy5sZW5ndGgpIHJldHVybiBudWxsO1xyXG5cclxuICAgICAgICByZXR1cm4gKGNvbnRyb2w6IEFic3RyYWN0Q29udHJvbCk6IFZhbGlkYXRpb25FcnJvcnMgPT4ge1xyXG4gICAgICAgICAgICBjb25zdCBjb250cm9sQ29udGV4dFZhbHVlcyA9IHRoaXMuZ2V0Q29udHJvbENvbnRleHRWYWx1ZXMoY29udHJvbCwgcHJvcGVydHkpO1xyXG5cclxuICAgICAgICAgICAgY29uc3QgdGVzdFJlc3VsdHMgPSB0aGlzLnJ1bGVzRW5naW5lU3ZjXHJcbiAgICAgICAgICAgICAgICAucnVuVGVzdHMoY29udHJvbENvbnRleHRWYWx1ZXMucmVsYXRpdmUsIHN5bmNHcm91cHMuc3luYywge1xyXG4gICAgICAgICAgICAgICAgICAgIHJvb3REYXRhOiBjb250cm9sQ29udGV4dFZhbHVlcy5yb290LFxyXG4gICAgICAgICAgICAgICAgICAgIGNvbnRyb2xTdGF0ZTogQ29udHJvbFN0YXRlLmNyZWF0ZShjb250cm9sKVxyXG4gICAgICAgICAgICAgICAgfSk7XHJcblxyXG4gICAgICAgICAgICBpZiAodGVzdFJlc3VsdHMucmVzdWx0cy5sZW5ndGgpIHtcclxuICAgICAgICAgICAgICAgIHRoaXMudHJhY2VTdmMudHJhY2UoYFZhbGlkYXRlZCBwcm9wZXJ0eSBcIiR7cHJvcGVydHkuYWJzb2x1dGVQYXRofVwiLiBgICtcclxuICAgICAgICAgICAgICAgICAgICB0aGlzLmJ1aWxkVGVzdFJlc3VsdFN0YXRzU3RyaW5nKHRlc3RSZXN1bHRzKSk7XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIHJldHVybiB0aGlzLm1hcFRvUmVhY3RpdmVGb3Jtc1ZhbGlkYXRpb25FcnJvcnModGVzdFJlc3VsdHMpO1xyXG4gICAgICAgIH07XHJcbiAgICB9XHJcblxyXG4gICAgcHJpdmF0ZSBidWlsZEFzeW5jVmFsaWRhdG9yRnVuY3Rpb248VD4ocHJvcGVydHk6IFByb3BlcnR5QmFzZTxUPik6IEFzeW5jVmFsaWRhdG9yRm4ge1xyXG4gICAgICAgIGNvbnN0IHJhd0FzeW5jRnVuYyA9IHRoaXMuYnVpbGRBc3luY1ZhbGlkYXRvckZ1bmN0aW9uUmF3KHByb3BlcnR5KTtcclxuXHJcbiAgICAgICAgaWYgKCFyYXdBc3luY0Z1bmMpIHJldHVybiBudWxsO1xyXG5cclxuICAgICAgICBjb25zdCB2YWx1ZXMgPSBuZXcgQmVoYXZpb3JTdWJqZWN0PEFic3RyYWN0Q29udHJvbD4obnVsbCk7XHJcbiAgICAgICAgY29uc3QgdmFsaWQkID0gdmFsdWVzLnBpcGUoXHJcbiAgICAgICAgICAgIHRoaXMuYXBwbHlBc3luY1ZhbGlkVmFsdWVDaGFuZ2VPcHRpb25zKHByb3BlcnR5LnZhbHVlQ2hhbmdlT3B0aW9ucy5zZWxmLmFzeW5jVmFsaWQpLFxyXG4gICAgICAgICAgICBzd2l0Y2hNYXAoeCA9PiB7XHJcbiAgICAgICAgICAgICAgICAvLyBwYXNzIHRocm91Z2ggbWVhbnMgd2UgZGlkIG5vdCBleGVjdXRlIHRoZSBuZy1mb3JtLXJ1bGVzIGFzeW5jIHRlc3RzXHJcbiAgICAgICAgICAgICAgICBpZiAoeC5wYXNzdGhyb3VnaCkge1xyXG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IGN1cnJlbnRFcnJvcnMgPSB4LmNvbnRyb2wuZXJyb3JzIHx8IHt9O1xyXG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IGxhc3ROZ0Zvcm1SdWxlc0Vycm9ycyA9IHRoaXMuZ2V0TGFzdEVycm9yRm9yQ29udHJvbCh4LmNvbnRyb2wpO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAvLyByZXR1cm4gdGhlIGxhc3QgbmctZm9ybS1ydWxlcyBlcnJvcnMgKGlmIGFueSkgYWxvbmdzaWRlIG5vbiBuZy1mb3JtLXJ1bGVzIGVycm9ycy5cclxuICAgICAgICAgICAgICAgICAgICAvLyB0aGlzIGhhbmRsZXMgc2NlbmFyaW8gd2hlcmUgZGVib3VuY2UgYW5kIGRpc3RpbmN0IGFyZSB1c2VkIGFuZCBzdGF0ZSBnb2VzIGZyb206XHJcbiAgICAgICAgICAgICAgICAgICAgLy8gICAgaW52YWxpZCAtPiBtYWtlIGNoYW5nZXMgYW5kIGJhY2sgdGhlbSBvdXQgLT4gdmFsaWRcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gb2YoT2JqZWN0LmFzc2lnbihjdXJyZW50RXJyb3JzLCB7IG5nRm9ybVJ1bGVzOiBsYXN0TmdGb3JtUnVsZXNFcnJvcnMgfSBhcyBSZWFjdGl2ZUZvcm1zVmFsaWRhdGlvbkVycm9ycykpO1xyXG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gcmF3QXN5bmNGdW5jKHguY29udHJvbCk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH0pLFxyXG4gICAgICAgICAgICB0YWtlKDEpXHJcbiAgICAgICAgKTtcclxuXHJcbiAgICAgICAgcmV0dXJuIChjb250cm9sOiBBYnN0cmFjdENvbnRyb2wpOiBQcm9taXNlPFZhbGlkYXRpb25FcnJvcnM+IHwgT2JzZXJ2YWJsZTxWYWxpZGF0aW9uRXJyb3JzPiA9PiB7XHJcbiAgICAgICAgICAgIHZhbHVlcy5uZXh0KGNvbnRyb2wpO1xyXG4gICAgICAgICAgICByZXR1cm4gdmFsaWQkO1xyXG4gICAgICAgIH07XHJcbiAgICB9XHJcblxyXG4gICAgcHJpdmF0ZSBidWlsZEFzeW5jVmFsaWRhdG9yRnVuY3Rpb25SYXc8VD4ocHJvcGVydHk6IFByb3BlcnR5QmFzZTxUPik6IEFzeW5jVmFsaWRhdG9yRm4ge1xyXG4gICAgICAgIGNvbnN0IHN5bmNHcm91cHMgPSB0aGlzLnJ1bGVzRW5naW5lU3ZjLmdyb3VwVGVzdHNCeVN5bmNUeXBlKHByb3BlcnR5LnZhbGlkKTtcclxuICAgICAgICBpZiAoIXN5bmNHcm91cHMuYXN5bmMubGVuZ3RoKSByZXR1cm4gbnVsbDtcclxuXHJcbiAgICAgICAgcmV0dXJuIChjb250cm9sOiBBYnN0cmFjdENvbnRyb2wpID0+IHtcclxuICAgICAgICAgICAgY29uc3QgY29udHJvbENvbnRleHRWYWx1ZXMgPSB0aGlzLmdldENvbnRyb2xDb250ZXh0VmFsdWVzKGNvbnRyb2wsIHByb3BlcnR5KTtcclxuXHJcbiAgICAgICAgICAgIHJldHVybiB0aGlzLnJ1bGVzRW5naW5lU3ZjLnJ1blRlc3RzQXN5bmMoY29udHJvbENvbnRleHRWYWx1ZXMucmVsYXRpdmUsIHN5bmNHcm91cHMuYXN5bmMsIHtcclxuICAgICAgICAgICAgICAgIHJvb3REYXRhOiBjb250cm9sQ29udGV4dFZhbHVlcy5yb290LFxyXG4gICAgICAgICAgICAgICAgY29udHJvbFN0YXRlOiBDb250cm9sU3RhdGUuY3JlYXRlKGNvbnRyb2wpXHJcbiAgICAgICAgICAgIH0pLnBpcGUoXHJcbiAgICAgICAgICAgICAgICB0YXAodGVzdFJlc3VsdHMgPT4ge1xyXG4gICAgICAgICAgICAgICAgICAgIGlmICh0ZXN0UmVzdWx0cy5yZXN1bHRzLmxlbmd0aCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnRyYWNlU3ZjLnRyYWNlKGBWYWxpZGF0ZWQgKGFzeW5jKSBwcm9wZXJ0eSBcIiR7cHJvcGVydHkuYWJzb2x1dGVQYXRofVwiLiBgICtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuYnVpbGRUZXN0UmVzdWx0U3RhdHNTdHJpbmcodGVzdFJlc3VsdHMpKTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9KSxcclxuICAgICAgICAgICAgICAgIG1hcCh0aGlzLm1hcFRvUmVhY3RpdmVGb3Jtc1ZhbGlkYXRpb25FcnJvcnMpLFxyXG4gICAgICAgICAgICAgICAgdGFwKHggPT4gdGhpcy5zZXRMYXN0RXJyb3JGb3JDb250cm9sKGNvbnRyb2wsICh4IHx8IHt9KS5uZ0Zvcm1SdWxlcykpXHJcbiAgICAgICAgICAgICk7XHJcbiAgICAgICAgfTtcclxuICAgIH1cclxuXHJcbiAgICBwcml2YXRlIHJlc2V0RGVwZW5kZW5jeVN1YnNjcmlwdGlvbnM8VD4oXHJcbiAgICAgICAgcGFyZW50Q29udHJvbDogQWJzdHJhY3RDb250cm9sLFxyXG4gICAgICAgIHByb3BlcnRpZXM6IFByb3BlcnR5QmFzZTxUPltdLFxyXG4gICAgKTogdm9pZCB7XHJcbiAgICAgICAgdGhpcy5yZW1vdmVEZXBlbmRlbmN5U3Vic2NyaXB0aW9ucyhwcm9wZXJ0aWVzKTtcclxuICAgICAgICB0aGlzLmFkZERlcGVuZGVuY3lTdWJzY3JpcHRpb25zKHBhcmVudENvbnRyb2wsIHByb3BlcnRpZXMpO1xyXG4gICAgfVxyXG5cclxuICAgIHByaXZhdGUgcmVtb3ZlRGVwZW5kZW5jeVN1YnNjcmlwdGlvbnM8VD4oXHJcbiAgICAgICAgcHJvcGVydGllczogUHJvcGVydHlCYXNlPFQ+W11cclxuICAgICk6IHZvaWQge1xyXG4gICAgICAgIChwcm9wZXJ0aWVzIHx8IFtdKS5mb3JFYWNoKHByb3BlcnR5ID0+IHtcclxuICAgICAgICAgICAgcHJvcGVydHkuY2xlYXJEZXBlbmRlbmN5UHJvcGVydHlTdWJzY3JpcHRpb25zKCk7XHJcblxyXG4gICAgICAgICAgICBpZiAocHJvcGVydHkucHJvcGVydGllcykge1xyXG4gICAgICAgICAgICAgICAgdGhpcy5yZW1vdmVEZXBlbmRlbmN5U3Vic2NyaXB0aW9ucyhwcm9wZXJ0eS5wcm9wZXJ0aWVzKTtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgaWYgKHByb3BlcnR5LmFycmF5SXRlbVByb3BlcnR5KSB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLnJlbW92ZURlcGVuZGVuY3lTdWJzY3JpcHRpb25zKFtwcm9wZXJ0eS5hcnJheUl0ZW1Qcm9wZXJ0eV0pO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfSk7XHJcbiAgICB9XHJcblxyXG4gICAgcHJpdmF0ZSBhZGREZXBlbmRlbmN5U3Vic2NyaXB0aW9uczxUPihcclxuICAgICAgICBwYXJlbnRDb250cm9sOiBBYnN0cmFjdENvbnRyb2wsXHJcbiAgICAgICAgcHJvcGVydGllczogUHJvcGVydHlCYXNlPFQ+W10sXHJcbiAgICAgICAgYXJyYXlJbmRleD86IG51bWJlclxyXG4gICAgKTogdm9pZCB7XHJcbiAgICAgICAgKHByb3BlcnRpZXMgfHwgW10pLmZvckVhY2gocHJvcGVydHkgPT4ge1xyXG4gICAgICAgICAgICBjb25zdCBwcm9wZXJ0eUNvbnRyb2wgPSB0aGlzLmdldFByb3BlcnR5RnJvbVBhcmVudChwYXJlbnRDb250cm9sLCBwcm9wZXJ0eSwgYXJyYXlJbmRleCk7XHJcbiAgICAgICAgICAgIGlmICghcHJvcGVydHlDb250cm9sKSByZXR1cm47XHJcblxyXG4gICAgICAgICAgICB0aGlzLnNldHVwRWRpdGFiaWxpdHlEZXBlbmRlbmN5U3Vic2NyaXB0aW9ucyhwcm9wZXJ0eUNvbnRyb2wsIHBhcmVudENvbnRyb2wsIHByb3BlcnR5KTtcclxuICAgICAgICAgICAgdGhpcy5zZXR1cFZhbGlkYXRpb25EZXBlbmRlbmN5U3Vic2NyaXB0aW9ucyhwcm9wZXJ0eUNvbnRyb2wsIHBhcmVudENvbnRyb2wsIHByb3BlcnR5KTtcclxuXHJcbiAgICAgICAgICAgIGlmIChwcm9wZXJ0eS5wcm9wZXJ0aWVzKSB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLmFkZERlcGVuZGVuY3lTdWJzY3JpcHRpb25zKHByb3BlcnR5Q29udHJvbCwgcHJvcGVydHkucHJvcGVydGllcyk7XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIGlmIChwcm9wZXJ0eS5hcnJheUl0ZW1Qcm9wZXJ0eSkge1xyXG4gICAgICAgICAgICAgICAgLy8gaWYgdGhlcmUgaXMgYW4gYXJyYXlJdGVtUHJvcGVydHkgd2Uga25vdyB0aGF0IHdlIGFyZSB3b3JraW5nIHdpdGggYSBGb3JtQXJyYXkgY29udHJvbFxyXG4gICAgICAgICAgICAgICAgY29uc3QgZm9ybUFycmF5Q29udHJvbCA9IChwcm9wZXJ0eUNvbnRyb2wgYXMgRm9ybUFycmF5KTtcclxuICAgICAgICAgICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgZm9ybUFycmF5Q29udHJvbC5sZW5ndGg7IGkrKykge1xyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMuYWRkRGVwZW5kZW5jeVN1YnNjcmlwdGlvbnMoZm9ybUFycmF5Q29udHJvbCwgW3Byb3BlcnR5LmFycmF5SXRlbVByb3BlcnR5XSwgaSk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9KTtcclxuICAgIH1cclxuXHJcbiAgICBwcml2YXRlIHNldHVwVmFsaWRhdGlvbkRlcGVuZGVuY3lTdWJzY3JpcHRpb25zPFQ+KFxyXG4gICAgICAgIHByb3BlcnR5Q29udHJvbDogQWJzdHJhY3RDb250cm9sLCBwYXJlbnRDb250cm9sOiBBYnN0cmFjdENvbnRyb2wsIHByb3BlcnR5OiBQcm9wZXJ0eUJhc2U8VD5cclxuICAgICk6IHZvaWQge1xyXG4gICAgICAgIGNvbnN0IGRlcGVuZGVuY3lQcm9wTmFtZXMgPSB0aGlzLnJ1bGVzRW5naW5lU3ZjLmdldERlcGVuZGVuY3lQcm9wZXJ0aWVzKHByb3BlcnR5LnZhbGlkKTtcclxuXHJcbiAgICAgICAgZGVwZW5kZW5jeVByb3BOYW1lcy5mb3JFYWNoKGQgPT4ge1xyXG4gICAgICAgICAgICBjb25zdCBkZXBlbmRlbmN5Q29udHJvbCA9IHRoaXMuZmluZENvbnRyb2xSZWxhdGl2ZWx5KHBhcmVudENvbnRyb2wsIGQpO1xyXG5cclxuICAgICAgICAgICAgaWYgKCFkZXBlbmRlbmN5Q29udHJvbCkgcmV0dXJuO1xyXG5cclxuICAgICAgICAgICAgY29uc3Qgc3ViJCA9IGRlcGVuZGVuY3lDb250cm9sLnZhbHVlQ2hhbmdlc1xyXG4gICAgICAgICAgICAgICAgLnBpcGUoXHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5hcHBseVZhbHVlQ2hhbmdlT3B0aW9ucyhwcm9wZXJ0eS52YWx1ZUNoYW5nZU9wdGlvbnMuZGVwZW5kZW5jeVByb3BlcnRpZXMudmFsaWQpXHJcbiAgICAgICAgICAgICAgICApXHJcbiAgICAgICAgICAgICAgICAuc3Vic2NyaWJlKHZhbHVlID0+IHtcclxuICAgICAgICAgICAgICAgICAgICB0aGlzLnNldEZvcmNlQXN5bmNWYWxpZGF0aW9uVGVzdEZvckNvbnRyb2wocHJvcGVydHlDb250cm9sLCB0cnVlKTtcclxuICAgICAgICAgICAgICAgICAgICBwcm9wZXJ0eUNvbnRyb2wudXBkYXRlVmFsdWVBbmRWYWxpZGl0eSh7IG9ubHlTZWxmOiB0cnVlLCBlbWl0RXZlbnQ6IGZhbHNlIH0pO1xyXG4gICAgICAgICAgICAgICAgfSk7XHJcblxyXG4gICAgICAgICAgICBwcm9wZXJ0eS5hZGREZXBlbmRlbmN5UHJvcGVydHlTdWJzY3JpcHRpb24oc3ViJCk7XHJcbiAgICAgICAgfSk7XHJcbiAgICB9XHJcblxyXG4gICAgcHJpdmF0ZSBzZXR1cEVkaXRhYmlsaXR5RGVwZW5kZW5jeVN1YnNjcmlwdGlvbnM8VD4oXHJcbiAgICAgICAgcHJvcGVydHlDb250cm9sOiBBYnN0cmFjdENvbnRyb2wsXHJcbiAgICAgICAgcGFyZW50Q29udHJvbDogQWJzdHJhY3RDb250cm9sLFxyXG4gICAgICAgIHByb3BlcnR5OiBQcm9wZXJ0eUJhc2U8VD5cclxuICAgICk6IHZvaWQge1xyXG4gICAgICAgIGNvbnN0IGRlcGVuZGVuY3lQcm9wTmFtZXMgPSB0aGlzLnJ1bGVzRW5naW5lU3ZjLmdldERlcGVuZGVuY3lQcm9wZXJ0aWVzKHByb3BlcnR5LmVkaXQpO1xyXG5cclxuICAgICAgICBkZXBlbmRlbmN5UHJvcE5hbWVzLmZvckVhY2goZHBuID0+IHtcclxuICAgICAgICAgICAgY29uc3QgZGVwZW5kZW5jeUNvbnRyb2wgPSB0aGlzLmZpbmRDb250cm9sUmVsYXRpdmVseShwYXJlbnRDb250cm9sLCBkcG4pO1xyXG5cclxuICAgICAgICAgICAgaWYgKCFkZXBlbmRlbmN5Q29udHJvbCkgcmV0dXJuO1xyXG5cclxuICAgICAgICAgICAgLy8gc2V0dXAgY29udHJvbCB0byBwZXJmb3JtIGVkaXQgdGVzdHMgd2hlbiBkZXBlbmRlbmN5IHByb3BlcnR5IGNoYW5nZXNcclxuICAgICAgICAgICAgY29uc3Qgc3ViJCA9IGRlcGVuZGVuY3lDb250cm9sLnZhbHVlQ2hhbmdlc1xyXG4gICAgICAgICAgICAgICAgLnBpcGUoXHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5hcHBseVZhbHVlQ2hhbmdlT3B0aW9ucyhwcm9wZXJ0eS52YWx1ZUNoYW5nZU9wdGlvbnMuZGVwZW5kZW5jeVByb3BlcnRpZXMuZWRpdClcclxuICAgICAgICAgICAgICAgIClcclxuICAgICAgICAgICAgICAgIC5zdWJzY3JpYmUodmFsdWUgPT4ge1xyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMucGVyc2lzdEVkaXRUZXN0cyhwcm9wZXJ0eUNvbnRyb2wsIHByb3BlcnR5KTtcclxuICAgICAgICAgICAgICAgIH0pO1xyXG5cclxuICAgICAgICAgICAgcHJvcGVydHkuYWRkRGVwZW5kZW5jeVByb3BlcnR5U3Vic2NyaXB0aW9uKHN1YiQpO1xyXG4gICAgICAgIH0pO1xyXG4gICAgfVxyXG5cclxuICAgIHByaXZhdGUgcGVyc2lzdEVkaXRUZXN0czxUPihwcm9wZXJ0eUNvbnRyb2w6IEFic3RyYWN0Q29udHJvbCwgcHJvcGVydHk6IFByb3BlcnR5QmFzZTxUPik6IHZvaWQge1xyXG4gICAgICAgIGNvbnN0IGNvbnRyb2xDb250ZXh0VmFsdWVzID0gdGhpcy5nZXRDb250cm9sQ29udGV4dFZhbHVlcyhwcm9wZXJ0eUNvbnRyb2wsIHByb3BlcnR5KTtcclxuXHJcbiAgICAgICAgdGhpcy5ydWxlc0VuZ2luZVN2Yy5lZGl0YWJsZShjb250cm9sQ29udGV4dFZhbHVlcy5yZWxhdGl2ZSwgcHJvcGVydHksIHtcclxuICAgICAgICAgICAgcm9vdERhdGE6IGNvbnRyb2xDb250ZXh0VmFsdWVzLnJvb3QsXHJcbiAgICAgICAgICAgIGNvbnRyb2xTdGF0ZTogQ29udHJvbFN0YXRlLmNyZWF0ZShwcm9wZXJ0eUNvbnRyb2wpXHJcbiAgICAgICAgfSkuc3Vic2NyaWJlKHRlc3RSZXN1bHRzID0+IHtcclxuICAgICAgICAgICAgaWYgKHRlc3RSZXN1bHRzLnJlc3VsdHMubGVuZ3RoKSB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLnRyYWNlU3ZjLnRyYWNlKGBFZGl0YWJsZSBwcm9wZXJ0eSBcIiR7cHJvcGVydHkuYWJzb2x1dGVQYXRofVwiLiBgICtcclxuICAgICAgICAgICAgICAgICAgICB0aGlzLmJ1aWxkVGVzdFJlc3VsdFN0YXRzU3RyaW5nKHRlc3RSZXN1bHRzKSk7XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIGlmICh0ZXN0UmVzdWx0cy5wYXNzZWQgJiYgcHJvcGVydHlDb250cm9sLmRpc2FibGVkKVxyXG4gICAgICAgICAgICAgICAgcHJvcGVydHlDb250cm9sLmVuYWJsZSh7IGVtaXRFdmVudDogZmFsc2UgfSk7XHJcbiAgICAgICAgICAgIGVsc2UgaWYgKCF0ZXN0UmVzdWx0cy5wYXNzZWQgJiYgcHJvcGVydHlDb250cm9sLmVuYWJsZWQpXHJcbiAgICAgICAgICAgICAgICBwcm9wZXJ0eUNvbnRyb2wuZGlzYWJsZSh7IGVtaXRFdmVudDogZmFsc2UgfSk7XHJcbiAgICAgICAgfSk7XHJcbiAgICB9XHJcblxyXG4gICAgcHJpdmF0ZSBhcHBseUFzeW5jVmFsaWRWYWx1ZUNoYW5nZU9wdGlvbnMoXHJcbiAgICAgICAgdmFsdWVDaGFuZ2VPcHRpb25zOiBWYWx1ZUNoYW5nZU9wdGlvbnNcclxuICAgICk6IE9wZXJhdG9yRnVuY3Rpb248QWJzdHJhY3RDb250cm9sLCBBc3luY1ZhbGlkYXRpb25QYXNzdGhyb3VnaGFibGU+IHtcclxuICAgICAgICByZXR1cm4gKHNvdXJjZSQ6IE9ic2VydmFibGU8QWJzdHJhY3RDb250cm9sPik6IE9ic2VydmFibGU8QXN5bmNWYWxpZGF0aW9uUGFzc3Rocm91Z2hhYmxlPiA9PiB7XHJcbiAgICAgICAgICAgIGxldCBsYXN0VmFsdWU6IGFueTtcclxuICAgICAgICAgICAgbGV0IGlzRm9yY2U6IGJvb2xlYW47XHJcblxyXG4gICAgICAgICAgICByZXR1cm4gc291cmNlJC5waXBlKFxyXG4gICAgICAgICAgICAgICAgdGFwKGNvbnRyb2wgPT4ge1xyXG4gICAgICAgICAgICAgICAgICAgIGlzRm9yY2UgPSB0aGlzLmRvZXNDb250cm9sSGF2ZUZvcmNlZEFzeW5jVmFsaWRhdGlvbihjb250cm9sKTtcclxuICAgICAgICAgICAgICAgICAgICB0aGlzLnNldEZvcmNlQXN5bmNWYWxpZGF0aW9uVGVzdEZvckNvbnRyb2woY29udHJvbCwgZmFsc2UpO1xyXG4gICAgICAgICAgICAgICAgfSksXHJcbiAgICAgICAgICAgICAgICBkZWJvdW5jZSh4ID0+IHtcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gaXNGb3JjZSB8fCB2YWx1ZUNoYW5nZU9wdGlvbnMuZGVib3VuY2VNaWxsaXNlY29uZHMgPiAwXHJcbiAgICAgICAgICAgICAgICAgICAgICAgID8gdGltZXIodmFsdWVDaGFuZ2VPcHRpb25zLmRlYm91bmNlTWlsbGlzZWNvbmRzKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICA6IEVNUFRZO1xyXG4gICAgICAgICAgICAgICAgfSksXHJcbiAgICAgICAgICAgICAgICBtYXAoY29udHJvbCA9PiB7XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgY29udHJvbDogY29udHJvbCxcclxuICAgICAgICAgICAgICAgICAgICAgICAgcGFzc3Rocm91Z2g6ICEoY29udHJvbC52YWx1ZSAhPT0gbGFzdFZhbHVlIHx8ICF2YWx1ZUNoYW5nZU9wdGlvbnMuZGlzdGluY3RVbnRpbENoYW5nZWQgfHwgaXNGb3JjZSlcclxuICAgICAgICAgICAgICAgICAgICB9IGFzIEFzeW5jVmFsaWRhdGlvblBhc3N0aHJvdWdoYWJsZTtcclxuICAgICAgICAgICAgICAgIH0pLFxyXG4gICAgICAgICAgICAgICAgdGFwKHggPT4ge1xyXG4gICAgICAgICAgICAgICAgICAgIGlmICgheC5wYXNzdGhyb3VnaCkgbGFzdFZhbHVlID0geC5jb250cm9sLnZhbHVlO1xyXG4gICAgICAgICAgICAgICAgfSlcclxuICAgICAgICAgICAgKTtcclxuICAgICAgICB9O1xyXG4gICAgfVxyXG5cclxuICAgIHByaXZhdGUgYXBwbHlWYWx1ZUNoYW5nZU9wdGlvbnModmFsdWVDaGFuZ2VPcHRpb25zOiBWYWx1ZUNoYW5nZU9wdGlvbnMpOiBPcGVyYXRvckZ1bmN0aW9uPGFueSwgYW55PiB7XHJcbiAgICAgICAgcmV0dXJuIChzb3VyY2UkOiBPYnNlcnZhYmxlPGFueT4pOiBPYnNlcnZhYmxlPGFueT4gPT4ge1xyXG4gICAgICAgICAgICByZXR1cm4gc291cmNlJC5waXBlKFxyXG4gICAgICAgICAgICAgICAgZGVib3VuY2UoeCA9PiB7XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHZhbHVlQ2hhbmdlT3B0aW9ucy5kZWJvdW5jZU1pbGxpc2Vjb25kcyA+IDBcclxuICAgICAgICAgICAgICAgICAgICAgICAgPyB0aW1lcih2YWx1ZUNoYW5nZU9wdGlvbnMuZGVib3VuY2VNaWxsaXNlY29uZHMpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIDogRU1QVFk7XHJcbiAgICAgICAgICAgICAgICB9KSxcclxuICAgICAgICAgICAgICAgIHZhbHVlQ2hhbmdlT3B0aW9ucy5kaXN0aW5jdFVudGlsQ2hhbmdlZCA/IGRpc3RpbmN0VW50aWxDaGFuZ2VkKCkgOiB0YXAoKVxyXG4gICAgICAgICAgICApO1xyXG4gICAgICAgIH07XHJcbiAgICB9XHJcblxyXG4gICAgcHJpdmF0ZSBnZXRDb250cm9sQ29udGV4dFZhbHVlczxUPihjb250cm9sOiBBYnN0cmFjdENvbnRyb2wsIHByb3BlcnR5OiBQcm9wZXJ0eTxUPiB8IEFycmF5SXRlbVByb3BlcnR5PFQ+KTogQ29udHJvbENvbnRleHRWYWx1ZXMge1xyXG4gICAgICAgIGNvbnN0IHJvb3RWYWx1ZSA9IChjb250cm9sLnJvb3QgYXMgRm9ybUdyb3VwKS5nZXRSYXdWYWx1ZSgpO1xyXG5cclxuICAgICAgICAvLyB1c2UgdGhlIGNvbnRyb2wgdmFsdWUgaWYgYW4gYXJyYXkgaXRlbSwgb3RoZXJ3aXNlIHVzZSB0aGUgcGFyZW50IGNvbnRyb2xcclxuICAgICAgICBjb25zdCByZWxhdGl2ZVZhbHVlID0gUHJvcGVydHlCYXNlLmlzQXJyYXlJdGVtUHJvcGVydHkocHJvcGVydHkpXHJcbiAgICAgICAgICAgID8gY29udHJvbC52YWx1ZVxyXG4gICAgICAgICAgICA6IGNvbnRyb2wucGFyZW50LmdldFJhd1ZhbHVlKCk7XHJcblxyXG4gICAgICAgIHJldHVybiB7XHJcbiAgICAgICAgICAgIHJvb3Q6IHJvb3RWYWx1ZSxcclxuICAgICAgICAgICAgcmVsYXRpdmU6IHJlbGF0aXZlVmFsdWVcclxuICAgICAgICB9O1xyXG4gICAgfVxyXG5cclxuICAgIHByaXZhdGUgZ2V0UHJvcGVydHlGcm9tUGFyZW50PFQ+KFxyXG4gICAgICAgIHBhcmVudENvbnRyb2w6IEFic3RyYWN0Q29udHJvbCxcclxuICAgICAgICBwcm9wZXJ0eTogUHJvcGVydHlCYXNlPFQ+LFxyXG4gICAgICAgIGFycmF5SW5kZXg/OiBudW1iZXJcclxuICAgICkge1xyXG4gICAgICAgIHJldHVybiBQcm9wZXJ0eUJhc2UuaXNBcnJheUl0ZW1Qcm9wZXJ0eShwcm9wZXJ0eSlcclxuICAgICAgICAgICAgPyAocGFyZW50Q29udHJvbCBhcyBGb3JtQXJyYXkpLmF0KGFycmF5SW5kZXgpXHJcbiAgICAgICAgICAgIDogcGFyZW50Q29udHJvbC5nZXQoKHByb3BlcnR5IGFzIFByb3BlcnR5PFQ+KS5uYW1lKTtcclxuICAgIH1cclxuXHJcbiAgICBwcml2YXRlIG1hcFRvUmVhY3RpdmVGb3Jtc1ZhbGlkYXRpb25FcnJvcnM8VD4odGVzdFJlc3VsdHM6IFRlc3RSZXN1bHRzQmFzZTxUPik6IFJlYWN0aXZlRm9ybXNWYWxpZGF0aW9uRXJyb3JzIHtcclxuICAgICAgICAvLyBpZiBwYXNzZWQsIEFuZ3VsYXIgcmVhY3RpdmUgZm9ybXMgd2FudHMgdXMgdG8gcmV0dXJuIG51bGwsIG90aGVyd2lzZSByZXR1cm4gYW4gb2JqZWN0IHdpdGggdGhlIHZhbGlkYXRpb24gaW5mb1xyXG4gICAgICAgIGlmICghdGVzdFJlc3VsdHMgfHwgdGVzdFJlc3VsdHMucGFzc2VkKSByZXR1cm4gbnVsbDtcclxuXHJcbiAgICAgICAgY29uc3QgZmFpbGVkOiB7IFtrZXk6IHN0cmluZ106IFJlYWN0aXZlRm9ybXNGYWlsZWRWYWxkYXRpb24gfSA9IHt9O1xyXG5cclxuICAgICAgICB0ZXN0UmVzdWx0cy5mYWlsZWRSZXN1bHRzLmZvckVhY2godGVzdCA9PiB7XHJcbiAgICAgICAgICAgIGZhaWxlZFt0ZXN0Lm5hbWVdID0geyBtZXNzYWdlOiB0ZXN0Lm1lc3NhZ2UgfTtcclxuICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgcmV0dXJuIHtcclxuICAgICAgICAgICAgbmdGb3JtUnVsZXM6IHtcclxuICAgICAgICAgICAgICAgIG1lc3NhZ2U6IHRlc3RSZXN1bHRzLm1lc3NhZ2UsXHJcbiAgICAgICAgICAgICAgICBmYWlsZWQ6IGZhaWxlZFxyXG4gICAgICAgICAgICB9IGFzIFJlYWN0aXZlRm9ybXNWYWxpZGF0aW9uRXJyb3JzRGF0YVxyXG4gICAgICAgIH07XHJcbiAgICB9XHJcblxyXG4gICAgcHJpdmF0ZSBmaW5kQ29udHJvbFJlbGF0aXZlbHkoY29udHJvbDogQWJzdHJhY3RDb250cm9sLCBwYXRoOiBzdHJpbmcpIHtcclxuICAgICAgICBjb25zdCByZWxhdGl2ZVBhdGhzID0gdGhpcy5idWlsZENvbnRyb2xSZWxhdGl2ZVBhdGhBcnJheShwYXRoKTtcclxuXHJcbiAgICAgICAgaWYgKCFyZWxhdGl2ZVBhdGhzLmxlbmd0aCkgcmV0dXJuIG51bGw7XHJcblxyXG4gICAgICAgIGxldCByZXN1bHQ6IEFic3RyYWN0Q29udHJvbDtcclxuICAgICAgICByZWxhdGl2ZVBhdGhzLmZvckVhY2gocGF0aFNlZ21lbnQgPT4ge1xyXG4gICAgICAgICAgICByZXN1bHQgPSB0aGlzLmdldENvbnRyb2xCeVBhdGhTZWdtZW50KHJlc3VsdCB8fCBjb250cm9sLCBwYXRoU2VnbWVudCk7XHJcbiAgICAgICAgICAgIGlmICghcmVzdWx0KSByZXR1cm47XHJcbiAgICAgICAgfSk7XHJcblxyXG4gICAgICAgIHJldHVybiByZXN1bHQ7XHJcbiAgICB9XHJcblxyXG4gICAgcHJpdmF0ZSBidWlsZENvbnRyb2xSZWxhdGl2ZVBhdGhBcnJheShyZWxhdGl2ZVBhdGg6IHN0cmluZyk6IHN0cmluZ1tdIHtcclxuICAgICAgICBjb25zdCByZXN1bHQ6IHN0cmluZ1tdID0gW107XHJcblxyXG4gICAgICAgIGlmICghcmVsYXRpdmVQYXRoIHx8IHR5cGVvZiByZWxhdGl2ZVBhdGggIT09IFwic3RyaW5nXCIpIHJldHVybiByZXN1bHQ7XHJcblxyXG4gICAgICAgIC8vIHRha2VzIGNhcmUgb2YgJy4vJywgJy4uLycsIGFuZCAnLydcclxuICAgICAgICBjb25zdCBzbGFzaFNlcGFyYXRlZCA9IHJlbGF0aXZlUGF0aC5zcGxpdChcIi9cIik7XHJcblxyXG4gICAgICAgIHNsYXNoU2VwYXJhdGVkLmZvckVhY2goc2xhc2hJdGVtID0+IHtcclxuICAgICAgICAgICAgY29uc3QgZG90U2VwYXJhdGVkID0gc2xhc2hJdGVtLnNwbGl0KFwiLlwiKVxyXG4gICAgICAgICAgICAgICAgLmZpbHRlcihkb3RJdGVtID0+ICEhZG90SXRlbSk7XHJcblxyXG4gICAgICAgICAgICBpZiAoZG90U2VwYXJhdGVkLmxlbmd0aClcclxuICAgICAgICAgICAgICAgIHJlc3VsdC5wdXNoKC4uLmRvdFNlcGFyYXRlZCk7XHJcbiAgICAgICAgICAgIGVsc2VcclxuICAgICAgICAgICAgICAgIHJlc3VsdC5wdXNoKHNsYXNoSXRlbSk7XHJcbiAgICAgICAgfSk7XHJcblxyXG4gICAgICAgIHJldHVybiByZXN1bHQ7XHJcbiAgICB9XHJcblxyXG4gICAgcHJpdmF0ZSBnZXRDb250cm9sQnlQYXRoU2VnbWVudChjb250cm9sOiBBYnN0cmFjdENvbnRyb2wsIHBhdGhTZWdtZW50OiBzdHJpbmcpOiBBYnN0cmFjdENvbnRyb2wge1xyXG4gICAgICAgIHN3aXRjaCAocGF0aFNlZ21lbnQpIHtcclxuICAgICAgICAgICAgY2FzZSBcIlwiOlxyXG4gICAgICAgICAgICAgICAgcmV0dXJuIGNvbnRyb2wucm9vdDtcclxuICAgICAgICAgICAgY2FzZSBcIi4uXCI6XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gY29udHJvbC5wYXJlbnQ7XHJcbiAgICAgICAgICAgIGNhc2UgXCIuXCI6XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gY29udHJvbDtcclxuICAgICAgICAgICAgZGVmYXVsdDpcclxuICAgICAgICAgICAgICAgIHJldHVybiBjb250cm9sLmdldChwYXRoU2VnbWVudCk7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIHByaXZhdGUgYnVpbGRUZXN0UmVzdWx0U3RhdHNTdHJpbmc8VD4odGVzdFJlc3VsdHM6IFRlc3RSZXN1bHRzQmFzZTxUPikge1xyXG4gICAgICAgIHJldHVybiBgRXhlY3V0ZWQgJHt0ZXN0UmVzdWx0cy5yZXN1bHRzLmxlbmd0aH0gdGVzdHMgYCArXHJcbiAgICAgICAgICAgIGAoJHt0ZXN0UmVzdWx0cy5wYXNzZWRSZXN1bHRzLmxlbmd0aH0gUEFTUyB8IGAgK1xyXG4gICAgICAgICAgICBgJHt0ZXN0UmVzdWx0cy5mYWlsZWRSZXN1bHRzLmxlbmd0aH0gRkFJTCB8IGBcclxuICAgICAgICAgICAgKyBgJHt0ZXN0UmVzdWx0cy5za2lwcGVkUmVzdWx0cy5sZW5ndGh9IFNLSVApYDtcclxuICAgIH1cclxuXHJcbiAgICBwcml2YXRlIGF0dGFjaE1vZGVsU2V0dGluZ3NUb0Zvcm08VD4oZm9ybUdyb3VwOiBGb3JtR3JvdXAsIG1vZGVsU2V0dGluZ3M6IEFic3RyYWN0TW9kZWxTZXR0aW5nczxUPik6IHZvaWQge1xyXG4gICAgICAgIGZvcm1Hcm91cFtSZWFjdGl2ZUZvcm1zUnVsZVNlcnZpY2UuRk9STV9NT0RFTF9TRVRUSU5HU19QUk9QRVJUWV9OQU1FXSA9IG1vZGVsU2V0dGluZ3M7XHJcbiAgICB9XHJcblxyXG4gICAgcHJpdmF0ZSBnZXRNb2RlbFNldHRpbmdzRnJvbUZvcm08VD4oZm9ybUdyb3VwOiBGb3JtR3JvdXApOiBBYnN0cmFjdE1vZGVsU2V0dGluZ3M8VD4ge1xyXG4gICAgICAgIHJldHVybiBmb3JtR3JvdXBbUmVhY3RpdmVGb3Jtc1J1bGVTZXJ2aWNlLkZPUk1fTU9ERUxfU0VUVElOR1NfUFJPUEVSVFlfTkFNRV0gYXMgQWJzdHJhY3RNb2RlbFNldHRpbmdzPFQ+O1xyXG4gICAgfVxyXG5cclxuICAgIHByaXZhdGUgc2V0Rm9yY2VBc3luY1ZhbGlkYXRpb25UZXN0Rm9yQ29udHJvbChjb250cm9sOiBBYnN0cmFjdENvbnRyb2wsIGZvcmNlOiBib29sZWFuKTogdm9pZCB7XHJcbiAgICAgICAgY29udHJvbFtSZWFjdGl2ZUZvcm1zUnVsZVNlcnZpY2UuRk9SQ0VfQVNZTkNfVkFMSURfVEVTVF9SVU5fUFJPUEVSVFlfTkFNRV0gPSBmb3JjZTtcclxuICAgIH1cclxuXHJcbiAgICBwcml2YXRlIHNldExhc3RFcnJvckZvckNvbnRyb2woY29udHJvbDogQWJzdHJhY3RDb250cm9sLCBlcnJvcnM6IFJlYWN0aXZlRm9ybXNWYWxpZGF0aW9uRXJyb3JzRGF0YSk6IHZvaWQge1xyXG4gICAgICAgIGNvbnRyb2xbUmVhY3RpdmVGb3Jtc1J1bGVTZXJ2aWNlLkNPTlRST0xfTEFTVF9FUlJPUl0gPSBlcnJvcnM7XHJcbiAgICB9XHJcblxyXG4gICAgcHJpdmF0ZSBnZXRMYXN0RXJyb3JGb3JDb250cm9sKGNvbnRyb2w6IEFic3RyYWN0Q29udHJvbCk6IFJlYWN0aXZlRm9ybXNWYWxpZGF0aW9uRXJyb3JzRGF0YSB7XHJcbiAgICAgICAgcmV0dXJuIGNvbnRyb2xbUmVhY3RpdmVGb3Jtc1J1bGVTZXJ2aWNlLkNPTlRST0xfTEFTVF9FUlJPUl07XHJcbiAgICB9XHJcblxyXG4gICAgcHJpdmF0ZSBkb2VzQ29udHJvbEhhdmVGb3JjZWRBc3luY1ZhbGlkYXRpb24oY29udHJvbDogQWJzdHJhY3RDb250cm9sKTogYm9vbGVhbiB7XHJcbiAgICAgICAgcmV0dXJuICEhKGNvbnRyb2xbUmVhY3RpdmVGb3Jtc1J1bGVTZXJ2aWNlLkZPUkNFX0FTWU5DX1ZBTElEX1RFU1RfUlVOX1BST1BFUlRZX05BTUVdKTtcclxuICAgIH1cclxuXHJcbiAgICBwcml2YXRlIHRyaWdnZXJWYWx1ZUNoYW5nZShjb250cm9sOiBBYnN0cmFjdENvbnRyb2wpOiB2b2lkIHtcclxuICAgICAgICBjb250cm9sLnBhdGNoVmFsdWUoY29udHJvbC52YWx1ZSk7XHJcbiAgICB9XHJcbn1cclxuXHJcbmludGVyZmFjZSBDb250cm9sQ29udGV4dFZhbHVlcyB7XHJcbiAgICByb290OiBhbnk7XHJcbiAgICByZWxhdGl2ZTogYW55O1xyXG59XHJcblxyXG5pbnRlcmZhY2UgQXN5bmNWYWxpZGF0aW9uUGFzc3Rocm91Z2hhYmxlIHtcclxuICAgIGNvbnRyb2w6IEFic3RyYWN0Q29udHJvbDtcclxuICAgIHBhc3N0aHJvdWdoOiBib29sZWFuO1xyXG59XHJcbiIsImltcG9ydCB7IE5nTW9kdWxlIH0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XHJcbmltcG9ydCB7IFRyYWNlU2VydmljZSB9IGZyb20gJy4vdHJhY2UvdHJhY2Uuc2VydmljZSc7XHJcbmltcG9ydCB7IENvbW1vblNlcnZpY2UgfSBmcm9tICcuL2NvbW1vbi9jb21tb24uc2VydmljZSc7XHJcblxyXG5ATmdNb2R1bGUoe1xyXG4gIGltcG9ydHM6IFtdLFxyXG4gIGRlY2xhcmF0aW9uczogW10sXHJcbiAgcHJvdmlkZXJzOiBbXHJcbiAgICAgIFRyYWNlU2VydmljZSxcclxuICAgICAgQ29tbW9uU2VydmljZVxyXG4gIF1cclxufSlcclxuZXhwb3J0IGNsYXNzIFV0aWxzTW9kdWxlIHsgfVxyXG4iLCJpbXBvcnQgeyBOZ01vZHVsZSB9IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xyXG5pbXBvcnQgeyBDb21tb25Nb2R1bGUgfSBmcm9tICdAYW5ndWxhci9jb21tb24nO1xyXG5pbXBvcnQgeyBSdWxlc0VuZ2luZVNlcnZpY2UgfSBmcm9tICcuL3NlcnZpY2VzL3J1bGVzLWVuZ2luZS9ydWxlcy1lbmdpbmUuc2VydmljZSc7XHJcbmltcG9ydCB7IFJlYWN0aXZlRm9ybXNSdWxlU2VydmljZSB9IGZyb20gJy4vc2VydmljZXMvcmVhY3RpdmUtZm9ybXMtcnVsZS9yZWFjdGl2ZS1mb3Jtcy1ydWxlLnNlcnZpY2UnO1xyXG5pbXBvcnQgeyBSZWFjdGl2ZUZvcm1zTW9kdWxlIH0gZnJvbSAnQGFuZ3VsYXIvZm9ybXMnO1xyXG5pbXBvcnQgeyBVdGlsc01vZHVsZSB9IGZyb20gJy4uL3V0aWxzL3V0aWxzLm1vZHVsZSc7XHJcblxyXG5ATmdNb2R1bGUoe1xyXG4gICAgaW1wb3J0czogW1xyXG4gICAgICAgIENvbW1vbk1vZHVsZSxcclxuICAgICAgICBVdGlsc01vZHVsZVxyXG4gICAgXSxcclxuICAgIHByb3ZpZGVyczogW1xyXG4gICAgICAgIFJ1bGVzRW5naW5lU2VydmljZSxcclxuICAgICAgICBSZWFjdGl2ZUZvcm1zUnVsZVNlcnZpY2VcclxuICAgIF0sXHJcbiAgICBkZWNsYXJhdGlvbnM6IFtdXHJcbn0pXHJcbmV4cG9ydCBjbGFzcyBSdWxlc0VuZ2luZU1vZHVsZSB7IH1cclxuIiwiaW1wb3J0IHsgTmdNb2R1bGUgfSBmcm9tICdAYW5ndWxhci9jb3JlJztcclxuaW1wb3J0IHsgQ29tbW9uTW9kdWxlIH0gZnJvbSAnQGFuZ3VsYXIvY29tbW9uJztcclxuaW1wb3J0IHsgUnVsZXNFbmdpbmVNb2R1bGUgfSBmcm9tICcuLi9ydWxlcy1lbmdpbmUvcnVsZXMtZW5naW5lLm1vZHVsZSc7XHJcblxyXG4vKipcclxuICogTWFpbiBtb2R1bGUgZm9yIG5nLWZvcm0tcnVsZXNcclxuICovXHJcbkBOZ01vZHVsZSh7XHJcbiAgaW1wb3J0czogW1xyXG4gICAgQ29tbW9uTW9kdWxlLFxyXG4gICAgUnVsZXNFbmdpbmVNb2R1bGUsXHJcbiAgXSxcclxuICBkZWNsYXJhdGlvbnM6IFtdLFxyXG4gIGV4cG9ydHM6IFtcclxuICAgICAgUnVsZXNFbmdpbmVNb2R1bGUsXHJcbiAgXVxyXG59KVxyXG5leHBvcnQgY2xhc3MgRm9ybVJ1bGVzTW9kdWxlIHsgfVxyXG4iLCJpbXBvcnQgeyBQcm9wZXJ0eUJhc2UgfSBmcm9tIFwiLi9wcm9wZXJ0eS1iYXNlXCI7XHJcblxyXG4vKipcclxuICogTm9uLWFycmF5IGl0ZW0gcHJvcGVydHlcclxuICovXHJcbmV4cG9ydCBjbGFzcyBQcm9wZXJ0eTxUPiBleHRlbmRzIFByb3BlcnR5QmFzZTxUPiB7XHJcbiAgICBwcml2YXRlIF9uYW1lOiBzdHJpbmc7XHJcblxyXG4gICAgLyoqXHJcbiAgICAgKiBOYW1lIG9mIHRoZSBwcm9wZXJ0eVxyXG4gICAgICovXHJcbiAgICBnZXQgbmFtZSgpOiBzdHJpbmcge1xyXG4gICAgICAgIHJldHVybiB0aGlzLl9uYW1lO1xyXG4gICAgfVxyXG5cclxuICAgIGNvbnN0cnVjdG9yKG5hbWU6IHN0cmluZykge1xyXG4gICAgICAgIHN1cGVyKCk7XHJcbiAgICAgICAgdGhpcy5fbmFtZSA9IG5hbWU7XHJcbiAgICB9XHJcbn0iLCJpbXBvcnQgeyBQcm9wZXJ0eUJhc2UgfSBmcm9tIFwiLi9wcm9wZXJ0eS1iYXNlXCI7XHJcblxyXG4vKipcclxuICogQSBwcm9wZXJ0eSByZXByZXNlbnRpbmcgYW4gYXJyYXkgaXRlbSAoZS5nLiBhbiBhcnJheSBvZiBBZGRyZXNzIG9iamVjdHMpXHJcbiAqL1xyXG5leHBvcnQgY2xhc3MgQXJyYXlJdGVtUHJvcGVydHk8VD4gZXh0ZW5kcyBQcm9wZXJ0eUJhc2U8VD4ge30iLCJpbXBvcnQgeyBQcm9wZXJ0eSB9IGZyb20gJy4uL21vZGVscy9wcm9wZXJ0eSc7XHJcbmltcG9ydCB7IFJ1bGVHcm91cCB9IGZyb20gJy4uL21vZGVscy9ydWxlLWdyb3VwJztcclxuaW1wb3J0IHsgUnVsZSB9IGZyb20gJy4uL21vZGVscy9ydWxlJztcclxuaW1wb3J0IHsgVGVzdCB9IGZyb20gJy4uL21vZGVscy90ZXN0JztcclxuaW1wb3J0IHsgQXJyYXlJdGVtUHJvcGVydHkgfSBmcm9tICcuLi9tb2RlbHMvYXJyYXktaXRlbS1wcm9wZXJ0eSc7XHJcbmltcG9ydCB7IFJ1bGVTZXQgfSBmcm9tICcuLi9tb2RlbHMvcnVsZS1zZXQnO1xyXG5pbXBvcnQgeyBSdWxlRnVuYyB9IGZyb20gJy4uL21vZGVscy9ydWxlLWZ1bmMnO1xyXG5pbXBvcnQgeyBSdWxlT3B0aW9ucyB9IGZyb20gJy4uL21vZGVscy9ydWxlLW9wdGlvbnMnO1xyXG5pbXBvcnQgeyBBc3luY1J1bGVGdW5jIH0gZnJvbSAnLi4vbW9kZWxzL2FzeW5jLXJ1bGUtZnVuYyc7XHJcbmltcG9ydCB7IFJ1bGVHcm91cE9wdGlvbnMgfSBmcm9tICcuLi9tb2RlbHMvcnVsZS1ncm91cC1vcHRpb25zJztcclxuaW1wb3J0IHsgUmVzdWx0c1Bhc3NSZXF1aXJlbWVudCB9IGZyb20gJy4uL21vZGVscy9yZXN1bHRzLXBhc3MtcmVxdWlyZW1lbnQnO1xyXG5cclxuLyoqXHJcbiAqIFV0aWxpdHkgY2xhc3MgZm9yIGJ1aWxkaW5nIG1vZGVsIHNldHRpbmdzXHJcbiAqL1xyXG5leHBvcnQgY2xhc3MgTW9kZWxTZXR0aW5nc0J1aWxkZXIge1xyXG4gICAgLyoqXHJcbiAgICAgKiBDcmVhdGVzIGEgcHJvcGVydHlcclxuICAgICAqIEBwYXJhbSBwcm9wZXJ0eU5hbWUgUHJvcGVydHkgbmFtZVxyXG4gICAgICogQHBhcmFtIGV4dGVuZCBGdW5jdGlvbiB0byBleHRlbmQgdGhlIHByb3BlcnR5XHJcbiAgICAgKiBAcmV0dXJucyBDcmVhdGVkIHByb3BlcnR5XHJcbiAgICAgKi9cclxuICAgIHByb3BlcnR5PFQ+KHByb3BlcnR5TmFtZToga2V5b2YgVCwgZXh0ZW5kPzogKHByb3A6IFByb3BlcnR5PFQ+KSA9PiB2b2lkKTogUHJvcGVydHk8VD4ge1xyXG4gICAgICAgIGlmICghcHJvcGVydHlOYW1lIHx8IHR5cGVvZiBwcm9wZXJ0eU5hbWUgIT09ICdzdHJpbmcnKSB0aHJvdyBFcnJvcignSW52YWxpZCBwcm9wZXJ0eSBuYW1lJyk7XHJcblxyXG4gICAgICAgIGNvbnN0IHByb3BlcnR5ID0gbmV3IFByb3BlcnR5PFQ+KHByb3BlcnR5TmFtZSk7XHJcblxyXG4gICAgICAgIGlmIChleHRlbmQpIGV4dGVuZChwcm9wZXJ0eSk7XHJcblxyXG4gICAgICAgIHJldHVybiBwcm9wZXJ0eTtcclxuICAgIH1cclxuXHJcbiAgICAvKipcclxuICAgICAqIENyZWF0ZXMgYW4gYXJyYXkgaXRlbSBwcm9wZXJ0eVxyXG4gICAgICogQHBhcmFtIGV4dGVuZCBGdW5jdGlvbiB0byBleHRlbmQgdGhlIGFycmF5IGl0ZW0gcHJvcGVydHlcclxuICAgICAqIEByZXR1cm5zIENyZWF0ZWQgYXJyYXkgaXRlbSBwcm9wZXJ0eVxyXG4gICAgICovXHJcbiAgICBhcnJheUl0ZW1Qcm9wZXJ0eTxUPihleHRlbmQ/OiAocHJvcDogQXJyYXlJdGVtUHJvcGVydHk8VD4pID0+IHZvaWQpOiBBcnJheUl0ZW1Qcm9wZXJ0eTxUPiB7XHJcbiAgICAgICAgY29uc3QgcHJvcGVydHkgPSBuZXcgQXJyYXlJdGVtUHJvcGVydHk8VD4oKTtcclxuXHJcbiAgICAgICAgaWYgKGV4dGVuZCkgZXh0ZW5kKHByb3BlcnR5KTtcclxuXHJcbiAgICAgICAgcmV0dXJuIHByb3BlcnR5O1xyXG4gICAgfVxyXG5cclxuICAgIC8qKlxyXG4gICAgICogQ3JlYXRlcyBhIHZhbGlkYXRpb24gdGVzdFxyXG4gICAgICogQHBhcmFtIG1lc3NhZ2UgTWVzc2FnZSB3aGVuIHRoZSB0ZXN0IGZhaWxzXHJcbiAgICAgKiBAcGFyYW0gY2hlY2sgQ2hlY2sgcnVsZSBzZXQgZm9yIHRoZSB0ZXN0XHJcbiAgICAgKiBAcGFyYW0gY29uZGl0aW9uIENvbmRpdGlvbiBydWxlIHNldCBmb3IgdGhlIHRlc3RcclxuICAgICAqIEByZXR1cm5zIENyZWF0ZWQgdmFsaWRhdGlvbiB0ZXN0XHJcbiAgICAgKi9cclxuICAgIHZhbGlkVGVzdDxUPihtZXNzYWdlOiBzdHJpbmcsIGNoZWNrOiBSdWxlU2V0PFQ+LCBjb25kaXRpb24/OiBSdWxlU2V0PFQ+KTogVGVzdDxUPiB7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMudmFsaWROYW1lZFRlc3QobnVsbCwgbWVzc2FnZSwgY2hlY2ssIGNvbmRpdGlvbik7XHJcbiAgICB9XHJcblxyXG4gICAgLyoqXHJcbiAgICAgKiBDcmVhdGVzIGEgbmFtZWQgdmFsaWRhdGlvbiB0ZXN0XHJcbiAgICAgKiBAcGFyYW0gbmFtZSBOYW1lIG9mIHRoZSB0ZXN0XHJcbiAgICAgKiBAcGFyYW0gbWVzc2FnZSBNZXNzYWdlIHdoZW4gdGhlIHRlc3QgZmFpbHNcclxuICAgICAqIEBwYXJhbSBjaGVjayBDaGVjayBydWxlIHNldCBmb3IgdGhlIHRlc3RcclxuICAgICAqIEBwYXJhbSBjb25kaXRpb24gQ29uZGl0aW9uIHJ1bGUgc2V0IGZvciB0aGUgdGVzdFxyXG4gICAgICogQHJldHVybnMgQ3JlYXRlZCBuYW1lZCB2YWxpZGF0aW9uIHRlc3RcclxuICAgICAqL1xyXG4gICAgdmFsaWROYW1lZFRlc3Q8VD4obmFtZTogc3RyaW5nLCBtZXNzYWdlOiBzdHJpbmcsIGNoZWNrOiBSdWxlU2V0PFQ+LCBjb25kaXRpb24/OiBSdWxlU2V0PFQ+KTogVGVzdDxUPiB7XHJcbiAgICAgICAgcmV0dXJuIHtcclxuICAgICAgICAgICAgbmFtZTogbmFtZSxcclxuICAgICAgICAgICAgbWVzc2FnZTogbWVzc2FnZSxcclxuICAgICAgICAgICAgY2hlY2s6IGNoZWNrLFxyXG4gICAgICAgICAgICBjb25kaXRpb246IGNvbmRpdGlvblxyXG4gICAgICAgIH0gYXMgVGVzdDxUPjtcclxuICAgIH1cclxuXHJcbiAgICAvKipcclxuICAgICAqIENyZWF0ZXMgYW4gZWRpdCB0ZXN0XHJcbiAgICAgKiBAcGFyYW0gY2hlY2sgQ2hlY2sgcnVsZSBzZXQgZm9yIHRoZSB0ZXN0XHJcbiAgICAgKiBAcGFyYW0gY29uZGl0aW9uIENvbmRpdGlvbiBydWxlIHNldCBmb3IgdGhlIHRlc3RcclxuICAgICAqIEByZXR1cm5zIENyZWF0ZWQgZWRpdCB0ZXN0XHJcbiAgICAgKi9cclxuICAgIGVkaXRUZXN0PFQ+KGNoZWNrOiBSdWxlU2V0PFQ+LCBjb25kaXRpb24/OiBSdWxlU2V0PFQ+KTogVGVzdDxUPiB7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMuZWRpdE5hbWVkVGVzdChudWxsLCBjaGVjaywgY29uZGl0aW9uKTtcclxuICAgIH1cclxuXHJcbiAgICAvKipcclxuICAgICAqIENyZWF0ZXMgYSBuYW1lZCBlZGl0IHRlc3RcclxuICAgICAqIEBwYXJhbSBuYW1lIE5hbWUgb2YgdGhlIHRlc3RcclxuICAgICAqIEBwYXJhbSBjaGVjayBDaGVjayBydWxlIHNldCBmb3IgdGhlIHRlc3RcclxuICAgICAqIEBwYXJhbSBjb25kaXRpb24gQ29uZGl0aW9uIHJ1bGUgc2V0IGZvciB0aGUgdGVzdFxyXG4gICAgICogQHJldHVybnMgQ3JlYXRlZCBuYW1lZCBlZGl0IHRlc3RcclxuICAgICAqL1xyXG4gICAgZWRpdE5hbWVkVGVzdDxUPihuYW1lOiBzdHJpbmcsIGNoZWNrOiBSdWxlU2V0PFQ+LCBjb25kaXRpb24/OiBSdWxlU2V0PFQ+KTogVGVzdDxUPiB7XHJcbiAgICAgICAgcmV0dXJuIHtcclxuICAgICAgICAgICAgbmFtZTogbmFtZSxcclxuICAgICAgICAgICAgY2hlY2s6IGNoZWNrLFxyXG4gICAgICAgICAgICBjb25kaXRpb246IGNvbmRpdGlvblxyXG4gICAgICAgIH0gYXMgVGVzdDxUPjtcclxuICAgIH1cclxuXHJcbiAgICAvKipcclxuICAgICAqIENyZWF0ZXMgYSBydWxlXHJcbiAgICAgKiBAcGFyYW0gZnVuYyBGdW5jdGlvbiBmb3IgdGhlIHJ1bGVcclxuICAgICAqIEBwYXJhbSBvcHRpb25zIEFkZGl0aW9uYWwgcnVsZSBvcHRpb25zXHJcbiAgICAgKiBAcmV0dXJucyBDcmVhdGVkIHJ1bGVcclxuICAgICAqL1xyXG4gICAgcnVsZTxULCBSPihmdW5jOiBSdWxlRnVuYzxULCBSPiwgb3B0aW9ucz86IFJ1bGVPcHRpb25zKTogUnVsZTxUPiB7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMucnVsZUNvbWJvKGZ1bmMsIG51bGwsIG9wdGlvbnMpO1xyXG4gICAgfVxyXG5cclxuICAgIC8qKlxyXG4gICAgICogQ3JlYXRlcyBhbiBhc3luYyBydWxlXHJcbiAgICAgKiBAcGFyYW0gYXN5bmNGdW5jIEFzeW5jIGZ1bmN0aW9uIGZvciB0aGUgcnVsZVxyXG4gICAgICogQHBhcmFtIG9wdGlvbnMgQWRkaXRpb25hbCBydWxlIG9wdGlvbnNcclxuICAgICAqIEByZXR1cm5zIENyZWF0ZWQgcnVsZVxyXG4gICAgICovXHJcbiAgICBydWxlQXN5bmM8VCwgUj4oYXN5bmNGdW5jOiBBc3luY1J1bGVGdW5jPFQsIFI+LCBvcHRpb25zPzogUnVsZU9wdGlvbnMpOiBSdWxlPFQ+IHtcclxuICAgICAgICByZXR1cm4gdGhpcy5ydWxlQ29tYm8obnVsbCwgYXN5bmNGdW5jLCBvcHRpb25zKTtcclxuICAgIH1cclxuXHJcbiAgICAvKipcclxuICAgICAqIENyZWF0ZXMgYSBjb21ibyBydWxlIHRoYXQgaGFzIGJvdGggc3luY3Jvbm91cyBhbmQgYXN5bmMgZnVuY3Rpb25zXHJcbiAgICAgKiBAcGFyYW0gZnVuYyBGdW5jdGlvbiBmb3IgdGhlIHJ1bGVcclxuICAgICAqIEBwYXJhbSBhc3luY0Z1bmMgQXN5bmMgZnVuY3Rpb24gZm9yIHRoZSBydWxlXHJcbiAgICAgKiBAcGFyYW0gb3B0aW9ucyBBZGRpdGlvbmFsIHJ1bGUgb3B0aW9uc1xyXG4gICAgICogQHJldHVybnMgQ3JlYXRlZCBydWxlXHJcbiAgICAgKi9cclxuICAgIHJ1bGVDb21ibzxULCBSPihmdW5jOiBSdWxlRnVuYzxULCBSPiwgYXN5bmNGdW5jOiBBc3luY1J1bGVGdW5jPFQsIFI+LCBvcHRpb25zPzogUnVsZU9wdGlvbnMpOiBSdWxlPFQ+IHtcclxuICAgICAgICByZXR1cm4ge1xyXG4gICAgICAgICAgICBmdW5jOiBmdW5jLFxyXG4gICAgICAgICAgICBhc3luY0Z1bmM6IGFzeW5jRnVuYyxcclxuICAgICAgICAgICAgb3B0aW9uczogb3B0aW9uc1xyXG4gICAgICAgIH0gYXMgUnVsZTxUPjtcclxuICAgIH1cclxuXHJcbiAgICAvKipcclxuICAgICAqIENyZWF0ZXMgYSBydWxlIGdyb3VwXHJcbiAgICAgKiBAcGFyYW0gcnVsZVNldHMgUnVsZSBzZXRzIGZvciB0aGUgcnVsZSBncm91cFxyXG4gICAgICogQHBhcmFtIG9wdGlvbnMgQWRkaXRpb25hbCBydWxlIGdyb3VwIG9wdGlvbnNcclxuICAgICAqIEByZXR1cm5zIENyZWF0ZWQgcnVsZSBncm91cFxyXG4gICAgICovXHJcbiAgICBydWxlR3JvdXA8VD4ocnVsZVNldHM6IFJ1bGVTZXQ8VD5bXSwgb3B0aW9ucz86IFJ1bGVHcm91cE9wdGlvbnMpOiBSdWxlR3JvdXA8VD4ge1xyXG4gICAgICAgIHJldHVybiB7XHJcbiAgICAgICAgICAgIHJ1bGVzOiBydWxlU2V0cyxcclxuICAgICAgICAgICAgb3B0aW9uczogb3B0aW9ucyB8fCB7IHJlc3VsdFJlcXVpcmVtZW50czogUmVzdWx0c1Bhc3NSZXF1aXJlbWVudC5BbGxQYXNzIH1cclxuICAgICAgICB9IGFzIFJ1bGVHcm91cDxUPjtcclxuICAgIH1cclxufSIsImltcG9ydCB7IE1vZGVsU2V0dGluZ3NCdWlsZGVyIH0gZnJvbSBcIi4uL2hlbHBlci9tb2RlbC1zZXR0aW5ncy1idWlsZGVyXCI7XHJcbmltcG9ydCB7IFByb3BlcnR5IH0gZnJvbSBcIi4vcHJvcGVydHlcIjtcclxuXHJcbi8qKlxyXG4gKiBCYXNlIGNsYXNzIGZvciBtb2RlbCBzZXR0aW5nc1xyXG4gKi9cclxuZXhwb3J0IGFic3RyYWN0IGNsYXNzIEFic3RyYWN0TW9kZWxTZXR0aW5nczxUPiB7XHJcbiAgICBwcml2YXRlIF9uYW1lOiBzdHJpbmc7XHJcblxyXG4gICAgLyoqXHJcbiAgICAgKiBOYW1lIG9mIHRoZSBtb2RlbCBzZXR0aW5nXHJcbiAgICAgKi9cclxuICAgIGdldCBuYW1lKCk6IHN0cmluZyB7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMuX25hbWU7XHJcbiAgICB9XHJcblxyXG4gICAgLyoqXHJcbiAgICAgKiBIZWxwZXIgZm9yIGJ1aWxkaW5nIHByb3BlcnRpZXMsIHRlc3RzLCBhbmQgcnVsZXNcclxuICAgICAqL1xyXG4gICAgcHJvdGVjdGVkIGJ1aWxkZXI6IE1vZGVsU2V0dGluZ3NCdWlsZGVyO1xyXG5cclxuICAgIC8qKlxyXG4gICAgICogUHJvcGVydGllcyBjb25maWd1cmVkIGZvciB0aGUgbW9kZWwgc2V0dGluZ3NcclxuICAgICAqL1xyXG4gICAgcHJvcGVydGllczogUHJvcGVydHk8VD5bXTtcclxuXHJcbiAgICAvKipcclxuICAgICAqIENyZWF0ZXMgbW9kZWwgc2V0dGluZ3NcclxuICAgICAqIEBwYXJhbSBuYW1lIE5hbWUgb2YgdGhlIG1vZGVsIHNldHRpbmdzXHJcbiAgICAgKi9cclxuICAgIGNvbnN0cnVjdG9yKG5hbWU6IHN0cmluZykge1xyXG4gICAgICAgIHRoaXMuYnVpbGRlciA9IG5ldyBNb2RlbFNldHRpbmdzQnVpbGRlcigpO1xyXG4gICAgICAgIHRoaXMuX25hbWUgPSBuYW1lO1xyXG4gICAgICAgIHRoaXMucHJvcGVydGllcyA9IHRoaXMuYnVpbGRQcm9wZXJ0aWVzKCkgfHwgW107XHJcbiAgICB9XHJcblxyXG4gICAgLyoqXHJcbiAgICAgKiBBYnN0cmFjdCBmdW5jdGlvbiBmb3IgYnVpbGRpbmcgdGhlIHByb3BlcnRpZXNcclxuICAgICAqL1xyXG4gICAgcHJvdGVjdGVkIGFic3RyYWN0IGJ1aWxkUHJvcGVydGllcygpOiBQcm9wZXJ0eTxUPltdO1xyXG59IiwiaW1wb3J0IHsgVGVzdFJlc3VsdHNCYXNlIH0gZnJvbSBcIi4vdGVzdC1yZXN1bHRzLWJhc2VcIjtcclxuaW1wb3J0IHsgVGVzdFJlc3VsdCB9IGZyb20gXCIuL3Rlc3QtcmVzdWx0XCI7XHJcblxyXG5leHBvcnQgY2xhc3MgUHJvcGVydHlUZXN0UmVzdWx0czxUPiBleHRlbmRzIFRlc3RSZXN1bHRzQmFzZTxUPiB7XHJcbiAgICBjb25zdHJ1Y3RvcihwdWJsaWMgcHJvcGVydHlOYW1lOiBzdHJpbmcsIHJlc3VsdHM6IFRlc3RSZXN1bHQ8VD5bXSkge1xyXG4gICAgICAgIHN1cGVyKHJlc3VsdHMpO1xyXG4gICAgfVxyXG59IiwiaW1wb3J0IHsgQWJzdHJhY3RNb2RlbFNldHRpbmdzIH0gZnJvbSBcIi4vYWJzdHJhY3QtbW9kZWwtc2V0dGluZ3NcIjtcclxuaW1wb3J0IHsgTW9kZWxTZXR0aW5nc0J1aWxkZXIgfSBmcm9tIFwiLi4vaGVscGVyL21vZGVsLXNldHRpbmdzLWJ1aWxkZXJcIjtcclxuaW1wb3J0IHsgUHJvcGVydHkgfSBmcm9tIFwiLi9wcm9wZXJ0eVwiO1xyXG5cclxuLyoqXHJcbiAqIENsYXNzIGZvciBjcmVhdGluZyBhZGhvYyAobm9uLXJlZ2lzdGVyZWQpIG1vZGVsIHNldHRpbmdzXHJcbiAqL1xyXG5leHBvcnQgY2xhc3MgQWRob2NNb2RlbFNldHRpbmdzPFQ+IGV4dGVuZHMgQWJzdHJhY3RNb2RlbFNldHRpbmdzPFQ+IHtcclxuICAgIC8qKlxyXG4gICAgICogQ3JlYXRlcyBtb2RlbCBzZXR0aW5nc1xyXG4gICAgICogQHBhcmFtIHByb3BlcnR5QnVpbGRlckZ1bmMgRnVuY3Rpb24gdGhhdCB0YWtlcyBhIE1vZGVsU2V0dGluZ3NCdWlsZGVyIGFuZCB1c2VzIGl0IHRvIHJldHVybiBhbiBhcnJheSBvZiBwcm9wZXJ0aWVzXHJcbiAgICAgKiBAcmV0dXJucyBNb2RlbCBzZXR0aW5ncyBjb25maWd1cmVkIHdpdGggcHJvcGVydGllcyByZXR1cm5lZCBmcm9tIHRoZSAncHJvcGVydHlCdWlsZGVyRnVuYycgZnVuY3Rpb24gcGFyYW1ldGVyXHJcbiAgICAgKi9cclxuICAgIHN0YXRpYyBjcmVhdGU8VD4ocHJvcGVydHlCdWlsZGVyRnVuYzogKGJ1aWxkZXI6IE1vZGVsU2V0dGluZ3NCdWlsZGVyKSA9PiBQcm9wZXJ0eTxUPltdKTogQWJzdHJhY3RNb2RlbFNldHRpbmdzPFQ+IHtcclxuICAgICAgICBjb25zdCBpbnN0YW5jZSA9IG5ldyBBZGhvY01vZGVsU2V0dGluZ3MoKTtcclxuICAgICAgICBpbnN0YW5jZS5wcm9wZXJ0aWVzID0gISFwcm9wZXJ0eUJ1aWxkZXJGdW5jID8gcHJvcGVydHlCdWlsZGVyRnVuYyhpbnN0YW5jZS5idWlsZGVyKSB8fCBbXSA6IFtdO1xyXG5cclxuICAgICAgICByZXR1cm4gaW5zdGFuY2U7XHJcbiAgICB9XHJcblxyXG4gICAgcHJpdmF0ZSBjb25zdHJ1Y3RvcigpIHtcclxuICAgICAgICAvLyBzaW5jZSB0aGVzZSBzZXR0aW5ncyBhcmUgbm90IHJlZ2lzdGVyZWQsIGp1c3QgdXNlIGEgc3RhdGljIG5hbWVcclxuICAgICAgICBzdXBlcignYWRob2MnKTtcclxuICAgIH1cclxuXHJcbiAgICBwcm90ZWN0ZWQgYnVpbGRQcm9wZXJ0aWVzKCk6IFByb3BlcnR5PFQ+W10ge1xyXG4gICAgICAgIC8vIHRoaXMgaXMganVzdCBuZWVkZWQgdG8gc2F0aXNmeSB0aGUgQWJzdHJhY3RNb2RlbFNldHRpbmdzPFQ+IGNvbnRyYWN0XHJcbiAgICAgICAgcmV0dXJuIFtdO1xyXG4gICAgfVxyXG59IiwiLyoqXHJcbiAqIE9wdGlvbnMgZm9yIGhvdyBhbmQgd2hlbiB0byBwcm9jZXNzIHZhbHVlIGNoYW5nZXMgaW4gYSBmb3JtIGNvbnRyb2xcclxuICovXHJcbmV4cG9ydCBjbGFzcyBWYWx1ZUNoYW5nZU9wdGlvbnMge1xyXG4gICAgLyoqXHJcbiAgICAgKiBDb25zaWRlciB2YWx1ZSBjaGFuZ2VkIG9ubHkgaWYgaXQgaXMgZGlmZmVyZW50XHJcbiAgICAgKi9cclxuICAgIGRpc3RpbmN0VW50aWxDaGFuZ2VkPzogYm9vbGVhbjtcclxuXHJcbiAgICAvKipcclxuICAgICAqIE1pbGxpc2Vjb25kcyB0byBkZWJvdW5jZSB2YWx1ZSBjaGFuZ2VzXHJcbiAgICAgKi9cclxuICAgIGRlYm91bmNlTWlsbGlzZWNvbmRzPzogbnVtYmVyO1xyXG59Il0sIm5hbWVzIjpbInRzbGliXzEuX19zcHJlYWQiLCJ0c2xpYl8xLl9fZXh0ZW5kcyJdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7QUFBQTs7O0FBS0EscUJBQVcsb0JBQW9CLEdBQUcsSUFBSSxjQUFjLENBQVMscUJBQXFCLENBQUM7Ozs7OztBQ0xuRjs7O0FBS0EscUJBQVcsb0JBQW9CLEdBQUcsSUFBSSxjQUFjLENBQVMscUJBQXFCLENBQUM7Ozs7OztBQ0xuRjtJQUtJLHNCQUNzRDs7UUFBQSxZQUFPLEdBQVAsT0FBTztLQUU1RDs7Ozs7SUFFRCw0QkFBSzs7OztJQUFMLFVBQU0sR0FBVztRQUNiLElBQUksQ0FB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