/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes} checked by tsc
 */
import * as tslib_1 from "tslib";
import { Injectable } from "@angular/core";
import { FormGroup, FormBuilder, FormControl, FormArray } from '@angular/forms';
import { RulesEngineService } from "../rules-engine/rules-engine.service";
import { PropertyBase } from "../../../form-rules/models/property-base";
import { TraceService } from "../../../utils/trace/trace.service";
import { BehaviorSubject, of, timer, EMPTY } from "rxjs";
import { map, tap, switchMap, take, distinctUntilChanged, debounce } from "rxjs/operators";
import { ControlState } from "../../../form-rules/models/control-state";
import { CommonService } from "../../../utils/common/common.service";
/**
 * Builds reactive forms using configured model settings
 */
var ReactiveFormsRuleService = /** @class */ (function () {
    function ReactiveFormsRuleService(rulesEngineSvc, formBuilder, traceSvc, commonSvc) {
        this.rulesEngineSvc = rulesEngineSvc;
        this.formBuilder = formBuilder;
        this.traceSvc = traceSvc;
        this.commonSvc = commonSvc;
    }
    /**
     * Gets model settings with the provided name
     * @param name Name of model setting
     * @returns Model settings with the provided name
     */
    /**
     * Gets model settings with the provided name
     * @template T
     * @param {?} name Name of model setting
     * @return {?} Model settings with the provided name
     */
    ReactiveFormsRuleService.prototype.getModelSettings = /**
     * Gets model settings with the provided name
     * @template T
     * @param {?} name Name of model setting
     * @return {?} Model settings with the provided name
     */
    function (name) {
        return this.rulesEngineSvc.getModelSettings(name);
    };
    /**
     * Creates a form group using an instance of model settings
     * @param modelSettings Name of the model setting or an instance of model settings to use
     * @param initialValue Initial data to set the form values to
     * @returns Form group created according to defined model settings
     */
    /**
     * Creates a form group using an instance of model settings
     * @template T
     * @param {?} modelSettings Name of the model setting or an instance of model settings to use
     * @param {?=} initialValue Initial data to set the form values to
     * @return {?} Form group created according to defined model settings
     */
    ReactiveFormsRuleService.prototype.createFormGroup = /**
     * Creates a form group using an instance of model settings
     * @template T
     * @param {?} modelSettings Name of the model setting or an instance of model settings to use
     * @param {?=} initialValue Initial data to set the form values to
     * @return {?} Form group created according to defined model settings
     */
    function (modelSettings, initialValue) {
        var /** @type {?} */ settings;
        if (typeof modelSettings === "string") {
            settings = this.rulesEngineSvc.getModelSettings(/** @type {?} */ (modelSettings));
            if (!settings)
                throw new Error("No model setting found with the name \"" + modelSettings + "\"");
        }
        else {
            if (!modelSettings)
                throw new Error("Adhoc model setting provided is invalid");
            settings = /** @type {?} */ (modelSettings);
            this.rulesEngineSvc.initializeModelSetting(settings);
        }
        this.traceSvc.trace("Creating form group using model settings \"" + settings.name + "\"");
        var /** @type {?} */ formGroup = this.buildGroup(settings.properties, initialValue);
        this.traceSvc.trace("Setting up dependency subscriptions");
        this.resetDependencySubscriptions(formGroup, settings.properties);
        this.traceSvc.trace("Patching form group with initial value");
        this.triggerValueChange(formGroup);
        this.traceSvc.trace("Attaching model settings to form");
        this.attachModelSettingsToForm(formGroup, settings);
        return formGroup;
    };
    /**
     * Adds an array item property to an existing form array
     * @param property ArrayItemProperty to for the array item to be added
     * @param parentFormArray The parent FormArray
     * @param initialValue Initial value of the form array item
     * @param options Options for adding new array item property
     */
    /**
     * Adds an array item property to an existing form array
     * @template T
     * @param {?} property ArrayItemProperty to for the array item to be added
     * @param {?} parentFormArray The parent FormArray
     * @param {?=} initialValue Initial value of the form array item
     * @param {?=} options Options for adding new array item property
     * @return {?}
     */
    ReactiveFormsRuleService.prototype.addArrayItemPropertyControl = /**
     * Adds an array item property to an existing form array
     * @template T
     * @param {?} property ArrayItemProperty to for the array item to be added
     * @param {?} parentFormArray The parent FormArray
     * @param {?=} initialValue Initial value of the form array item
     * @param {?=} options Options for adding new array item property
     * @return {?}
     */
    function (property, parentFormArray, initialValue, options) {
        var /** @type {?} */ control = this.buildAbstractControl(property, initialValue);
        var /** @type {?} */ willBeLastItem = !options || !this.commonSvc.isZeroOrGreater(options.index) || options.index >= parentFormArray.length;
        if (willBeLastItem)
            parentFormArray.push(control);
        else
            parentFormArray.insert(options.index, control);
        var /** @type {?} */ modelSettings = this.getModelSettingsFromForm(/** @type {?} */ (parentFormArray.root));
        this.resetDependencySubscriptions(parentFormArray.root, modelSettings.properties);
        // we need to do this because the item could have been added at any index in the array, and we need
        // trigger a value change to trigger any dependency propertiy valdidations
        this.triggerValueChange(parentFormArray);
    };
    /**
     * Extends validators generated by ng-form-rules with your own validators
     * @param control Control to extends the validators for
     * @param validator Validator to add
     */
    /**
     * Extends validators generated by ng-form-rules with your own validators
     * @param {?} control Control to extends the validators for
     * @param {?} validator Validator to add
     * @return {?}
     */
    ReactiveFormsRuleService.prototype.extendValidator = /**
     * Extends validators generated by ng-form-rules with your own validators
     * @param {?} control Control to extends the validators for
     * @param {?} validator Validator to add
     * @return {?}
     */
    function (control, validator) {
        if (!validator)
            return;
        var /** @type {?} */ validatorArray = Array.isArray(validator) ? validator : [validator];
        control.setValidators(tslib_1.__spread([control.validator], validatorArray).filter(function (validatorFn) { return !!validatorFn; }));
    };
    /**
     * Extends async validators generated by ng-form-rules with your own async validators
     * @param control Control to extends the async validators for
     * @param asyncValidator Async validator to add
     */
    /**
     * Extends async validators generated by ng-form-rules with your own async validators
     * @param {?} control Control to extends the async validators for
     * @param {?} asyncValidator Async validator to add
     * @return {?}
     */
    ReactiveFormsRuleService.prototype.extendAsyncValidator = /**
     * Extends async validators generated by ng-form-rules with your own async validators
     * @param {?} control Control to extends the async validators for
     * @param {?} asyncValidator Async validator to add
     * @return {?}
     */
    function (control, asyncValidator) {
        if (!asyncValidator)
            return;
        var /** @type {?} */ asyncValidatorArray = Array.isArray(asyncValidator) ? asyncValidator : [asyncValidator];
        control.setAsyncValidators(tslib_1.__spread([control.asyncValidator], asyncValidatorArray).filter(function (asyncValidatorFn) { return !!asyncValidatorFn; }));
    };
    /**
     * @template T
     * @param {?} property
     * @param {?=} initialValue
     * @return {?}
     */
    ReactiveFormsRuleService.prototype.buildAbstractControl = /**
     * @template T
     * @param {?} property
     * @param {?=} initialValue
     * @return {?}
     */
    function (property, initialValue) {
        var _this = this;
        var /** @type {?} */ control;
        if (property.arrayItemProperty)
            control = this.buildArray(property.arrayItemProperty, initialValue, property.updateOn);
        else if (property.properties)
            control = this.buildGroup(property.properties, initialValue, property.updateOn);
        else
            control = this.buildControl(initialValue, property.updateOn);
        // setup validation tests on value change
        control.setValidators(this.buildValidatorFunction(property));
        control.setAsyncValidators(this.buildAsyncValidatorFunction(property));
        // setup edit tests on value change
        control.valueChanges
            .pipe(this.applyValueChangeOptions(property.valueChangeOptions.self.edit))
            .subscribe(function (value) {
            _this.persistEditTests(control, property);
        });
        return control;
    };
    /**
     * @template T
     * @param {?} initialValue
     * @param {?=} updateOn
     * @return {?}
     */
    ReactiveFormsRuleService.prototype.buildControl = /**
     * @template T
     * @param {?} initialValue
     * @param {?=} updateOn
     * @return {?}
     */
    function (initialValue, updateOn) {
        return new FormControl(initialValue, { updateOn: updateOn });
    };
    /**
     * @template T
     * @param {?} properties
     * @param {?} initialValue
     * @param {?=} updateOn
     * @return {?}
     */
    ReactiveFormsRuleService.prototype.buildGroup = /**
     * @template T
     * @param {?} properties
     * @param {?} initialValue
     * @param {?=} updateOn
     * @return {?}
     */
    function (properties, initialValue, updateOn) {
        var _this = this;
        var /** @type {?} */ formGroup = new FormGroup({}, { updateOn: updateOn });
        (properties || []).forEach(function (p) {
            var /** @type {?} */ propertyValue = initialValue ? initialValue[p.name] : null;
            var /** @type {?} */ ctrl = _this.buildAbstractControl(p, propertyValue);
            formGroup.addControl(p.name, ctrl);
        });
        return formGroup;
    };
    /**
     * @template T
     * @param {?} property
     * @param {?} initialValue
     * @param {?=} updateOn
     * @return {?}
     */
    ReactiveFormsRuleService.prototype.buildArray = /**
     * @template T
     * @param {?} property
     * @param {?} initialValue
     * @param {?=} updateOn
     * @return {?}
     */
    function (property, initialValue, updateOn) {
        var _this = this;
        initialValue = Array.isArray(initialValue) ? initialValue : [];
        return new FormArray(initialValue.map(function (v) { return _this.buildAbstractControl(property, v); }), { updateOn: updateOn });
    };
    /**
     * @template T
     * @param {?} property
     * @return {?}
     */
    ReactiveFormsRuleService.prototype.buildValidatorFunction = /**
     * @template T
     * @param {?} property
     * @return {?}
     */
    function (property) {
        var _this = this;
        var /** @type {?} */ syncGroups = this.rulesEngineSvc.groupTestsBySyncType(property.valid);
        if (!syncGroups.sync.length)
            return null;
        return function (control) {
            var /** @type {?} */ controlContextValues = _this.getControlContextValues(control, property);
            var /** @type {?} */ testResults = _this.rulesEngineSvc
                .runTests(controlContextValues.relative, syncGroups.sync, {
                rootData: controlContextValues.root,
                controlState: ControlState.create(control)
            });
            if (testResults.results.length) {
                _this.traceSvc.trace("Validated property \"" + property.absolutePath + "\". " +
                    _this.buildTestResultStatsString(testResults));
            }
            return _this.mapToReactiveFormsValidationErrors(testResults);
        };
    };
    /**
     * @template T
     * @param {?} property
     * @return {?}
     */
    ReactiveFormsRuleService.prototype.buildAsyncValidatorFunction = /**
     * @template T
     * @param {?} property
     * @return {?}
     */
    function (property) {
        var _this = this;
        var /** @type {?} */ rawAsyncFunc = this.buildAsyncValidatorFunctionRaw(property);
        if (!rawAsyncFunc)
            return null;
        var /** @type {?} */ values = new BehaviorSubject(null);
        var /** @type {?} */ valid$ = values.pipe(this.applyAsyncValidValueChangeOptions(property.valueChangeOptions.self.asyncValid), switchMap(function (x) {
            // pass through means we did not execute the ng-form-rules async tests
            if (x.passthrough) {
                var /** @type {?} */ currentErrors = x.control.errors || {};
                var /** @type {?} */ lastNgFormRulesErrors = _this.getLastErrorForControl(x.control);
                // return the last ng-form-rules errors (if any) alongside non ng-form-rules errors.
                // this handles scenario where debounce and distinct are used and state goes from:
                //    invalid -> make changes and back them out -> valid
                return of(Object.assign(currentErrors, /** @type {?} */ ({ ngFormRules: lastNgFormRulesErrors })));
            }
            else {
                return rawAsyncFunc(x.control);
            }
        }), take(1));
        return function (control) {
            values.next(control);
            return valid$;
        };
    };
    /**
     * @template T
     * @param {?} property
     * @return {?}
     */
    ReactiveFormsRuleService.prototype.buildAsyncValidatorFunctionRaw = /**
     * @template T
     * @param {?} property
     * @return {?}
     */
    function (property) {
        var _this = this;
        var /** @type {?} */ syncGroups = this.rulesEngineSvc.groupTestsBySyncType(property.valid);
        if (!syncGroups.async.length)
            return null;
        return function (control) {
            var /** @type {?} */ controlContextValues = _this.getControlContextValues(control, property);
            return _this.rulesEngineSvc.runTestsAsync(controlContextValues.relative, syncGroups.async, {
                rootData: controlContextValues.root,
                controlState: ControlState.create(control)
            }).pipe(tap(function (testResults) {
                if (testResults.results.length) {
                    _this.traceSvc.trace("Validated (async) property \"" + property.absolutePath + "\". " +
                        _this.buildTestResultStatsString(testResults));
                }
            }), map(_this.mapToReactiveFormsValidationErrors), tap(function (x) { return _this.setLastErrorForControl(control, (x || {})["ngFormRules"]); }));
        };
    };
    /**
     * @template T
     * @param {?} parentControl
     * @param {?} properties
     * @return {?}
     */
    ReactiveFormsRuleService.prototype.resetDependencySubscriptions = /**
     * @template T
     * @param {?} parentControl
     * @param {?} properties
     * @return {?}
     */
    function (parentControl, properties) {
        this.removeDependencySubscriptions(properties);
        this.addDependencySubscriptions(parentControl, properties);
    };
    /**
     * @template T
     * @param {?} properties
     * @return {?}
     */
    ReactiveFormsRuleService.prototype.removeDependencySubscriptions = /**
     * @template T
     * @param {?} properties
     * @return {?}
     */
    function (properties) {
        var _this = this;
        (properties || []).forEach(function (property) {
            property.clearDependencyPropertySubscriptions();
            if (property.properties) {
                _this.removeDependencySubscriptions(property.properties);
            }
            if (property.arrayItemProperty) {
                _this.removeDependencySubscriptions([property.arrayItemProperty]);
            }
        });
    };
    /**
     * @template T
     * @param {?} parentControl
     * @param {?} properties
     * @param {?=} arrayIndex
     * @return {?}
     */
    ReactiveFormsRuleService.prototype.addDependencySubscriptions = /**
     * @template T
     * @param {?} parentControl
     * @param {?} properties
     * @param {?=} arrayIndex
     * @return {?}
     */
    function (parentControl, properties, arrayIndex) {
        var _this = this;
        (properties || []).forEach(function (property) {
            var /** @type {?} */ propertyControl = _this.getPropertyFromParent(parentControl, property, arrayIndex);
            if (!propertyControl)
                return;
            _this.setupEditabilityDependencySubscriptions(propertyControl, parentControl, property);
            _this.setupValidationDependencySubscriptions(propertyControl, parentControl, property);
            if (property.properties) {
                _this.addDependencySubscriptions(propertyControl, property.properties);
            }
            if (property.arrayItemProperty) {
                // if there is an arrayItemProperty we know that we are working with a FormArray control
                var /** @type {?} */ formArrayControl = (/** @type {?} */ (propertyControl));
                for (var /** @type {?} */ i = 0; i < formArrayControl.length; i++) {
                    _this.addDependencySubscriptions(formArrayControl, [property.arrayItemProperty], i);
                }
            }
        });
    };
    /**
     * @template T
     * @param {?} propertyControl
     * @param {?} parentControl
     * @param {?} property
     * @return {?}
     */
    ReactiveFormsRuleService.prototype.setupValidationDependencySubscriptions = /**
     * @template T
     * @param {?} propertyControl
     * @param {?} parentControl
     * @param {?} property
     * @return {?}
     */
    function (propertyControl, parentControl, property) {
        var _this = this;
        var /** @type {?} */ dependencyPropNames = this.rulesEngineSvc.getDependencyProperties(property.valid);
        dependencyPropNames.forEach(function (d) {
            var /** @type {?} */ dependencyControl = _this.findControlRelatively(parentControl, d);
            if (!dependencyControl)
                return;
            var /** @type {?} */ sub$ = dependencyControl.valueChanges
                .pipe(_this.applyValueChangeOptions(property.valueChangeOptions.dependencyProperties.valid))
                .subscribe(function (value) {
                _this.setForceAsyncValidationTestForControl(propertyControl, true);
                propertyControl.updateValueAndValidity({ onlySelf: true, emitEvent: false });
            });
            property.addDependencyPropertySubscription(sub$);
        });
    };
    /**
     * @template T
     * @param {?} propertyControl
     * @param {?} parentControl
     * @param {?} property
     * @return {?}
     */
    ReactiveFormsRuleService.prototype.setupEditabilityDependencySubscriptions = /**
     * @template T
     * @param {?} propertyControl
     * @param {?} parentControl
     * @param {?} property
     * @return {?}
     */
    function (propertyControl, parentControl, property) {
        var _this = this;
        var /** @type {?} */ dependencyPropNames = this.rulesEngineSvc.getDependencyProperties(property.edit);
        dependencyPropNames.forEach(function (dpn) {
            var /** @type {?} */ dependencyControl = _this.findControlRelatively(parentControl, dpn);
            if (!dependencyControl)
                return;
            // setup control to perform edit tests when dependency property changes
            var /** @type {?} */ sub$ = dependencyControl.valueChanges
                .pipe(_this.applyValueChangeOptions(property.valueChangeOptions.dependencyProperties.edit))
                .subscribe(function (value) {
                _this.persistEditTests(propertyControl, property);
            });
            property.addDependencyPropertySubscription(sub$);
        });
    };
    /**
     * @template T
     * @param {?} propertyControl
     * @param {?} property
     * @return {?}
     */
    ReactiveFormsRuleService.prototype.persistEditTests = /**
     * @template T
     * @param {?} propertyControl
     * @param {?} property
     * @return {?}
     */
    function (propertyControl, property) {
        var _this = this;
        var /** @type {?} */ controlContextValues = this.getControlContextValues(propertyControl, property);
        this.rulesEngineSvc.editable(controlContextValues.relative, property, {
            rootData: controlContextValues.root,
            controlState: ControlState.create(propertyControl)
        }).subscribe(function (testResults) {
            if (testResults.results.length) {
                _this.traceSvc.trace("Editable property \"" + property.absolutePath + "\". " +
                    _this.buildTestResultStatsString(testResults));
            }
            if (testResults.passed && propertyControl.disabled)
                propertyControl.enable({ emitEvent: false });
            else if (!testResults.passed && propertyControl.enabled)
                propertyControl.disable({ emitEvent: false });
        });
    };
    /**
     * @param {?} valueChangeOptions
     * @return {?}
     */
    ReactiveFormsRuleService.prototype.applyAsyncValidValueChangeOptions = /**
     * @param {?} valueChangeOptions
     * @return {?}
     */
    function (valueChangeOptions) {
        var _this = this;
        return function (source$) {
            var /** @type {?} */ lastValue;
            var /** @type {?} */ isForce;
            return source$.pipe(tap(function (control) {
                isForce = _this.doesControlHaveForcedAsyncValidation(control);
                _this.setForceAsyncValidationTestForControl(control, false);
            }), debounce(function (x) {
                return isForce || valueChangeOptions.debounceMilliseconds > 0
                    ? timer(valueChangeOptions.debounceMilliseconds)
                    : EMPTY;
            }), map(function (control) {
                return /** @type {?} */ ({
                    control: control,
                    passthrough: !(control.value !== lastValue || !valueChangeOptions.distinctUntilChanged || isForce)
                });
            }), tap(function (x) {
                if (!x.passthrough)
                    lastValue = x.control.value;
            }));
        };
    };
    /**
     * @param {?} valueChangeOptions
     * @return {?}
     */
    ReactiveFormsRuleService.prototype.applyValueChangeOptions = /**
     * @param {?} valueChangeOptions
     * @return {?}
     */
    function (valueChangeOptions) {
        return function (source$) {
            return source$.pipe(debounce(function (x) {
                return valueChangeOptions.debounceMilliseconds > 0
                    ? timer(valueChangeOptions.debounceMilliseconds)
                    : EMPTY;
            }), valueChangeOptions.distinctUntilChanged ? distinctUntilChanged() : tap());
        };
    };
    /**
     * @template T
     * @param {?} control
     * @param {?} property
     * @return {?}
     */
    ReactiveFormsRuleService.prototype.getControlContextValues = /**
     * @template T
     * @param {?} control
     * @param {?} property
     * @return {?}
     */
    function (control, property) {
        var /** @type {?} */ rootValue = (/** @type {?} */ (control.root)).getRawValue();
        // use the control value if an array item, otherwise use the parent control
        var /** @type {?} */ relativeValue = PropertyBase.isArrayItemProperty(property)
            ? control.value
            : control.parent.getRawValue();
        return {
            root: rootValue,
            relative: relativeValue
        };
    };
    /**
     * @template T
     * @param {?} parentControl
     * @param {?} property
     * @param {?=} arrayIndex
     * @return {?}
     */
    ReactiveFormsRuleService.prototype.getPropertyFromParent = /**
     * @template T
     * @param {?} parentControl
     * @param {?} property
     * @param {?=} arrayIndex
     * @return {?}
     */
    function (parentControl, property, arrayIndex) {
        return PropertyBase.isArrayItemProperty(property)
            ? (/** @type {?} */ (parentControl)).at(arrayIndex)
            : parentControl.get((/** @type {?} */ (property)).name);
    };
    /**
     * @template T
     * @param {?} testResults
     * @return {?}
     */
    ReactiveFormsRuleService.prototype.mapToReactiveFormsValidationErrors = /**
     * @template T
     * @param {?} testResults
     * @return {?}
     */
    function (testResults) {
        // if passed, Angular reactive forms wants us to return null, otherwise return an object with the validation info
        if (!testResults || testResults.passed)
            return null;
        var /** @type {?} */ failed = {};
        testResults.failedResults.forEach(function (test) {
            failed[test.name] = { message: test.message };
        });
        return {
            ngFormRules: /** @type {?} */ ({
                message: testResults.message,
                failed: failed
            })
        };
    };
    /**
     * @param {?} control
     * @param {?} path
     * @return {?}
     */
    ReactiveFormsRuleService.prototype.findControlRelatively = /**
     * @param {?} control
     * @param {?} path
     * @return {?}
     */
    function (control, path) {
        var _this = this;
        var /** @type {?} */ relativePaths = this.buildControlRelativePathArray(path);
        if (!relativePaths.length)
            return null;
        var /** @type {?} */ result;
        relativePaths.forEach(function (pathSegment) {
            result = _this.getControlByPathSegment(result || control, pathSegment);
            if (!result)
                return;
        });
        return result;
    };
    /**
     * @param {?} relativePath
     * @return {?}
     */
    ReactiveFormsRuleService.prototype.buildControlRelativePathArray = /**
     * @param {?} relativePath
     * @return {?}
     */
    function (relativePath) {
        var /** @type {?} */ result = [];
        if (!relativePath || typeof relativePath !== "string")
            return result;
        // takes care of './', '../', and '/'
        var /** @type {?} */ slashSeparated = relativePath.split("/");
        slashSeparated.forEach(function (slashItem) {
            var /** @type {?} */ dotSeparated = slashItem.split(".")
                .filter(function (dotItem) { return !!dotItem; });
            if (dotSeparated.length)
                result.push.apply(result, tslib_1.__spread(dotSeparated));
            else
                result.push(slashItem);
        });
        return result;
    };
    /**
     * @param {?} control
     * @param {?} pathSegment
     * @return {?}
     */
    ReactiveFormsRuleService.prototype.getControlByPathSegment = /**
     * @param {?} control
     * @param {?} pathSegment
     * @return {?}
     */
    function (control, pathSegment) {
        switch (pathSegment) {
            case "":
                return control.root;
            case "..":
                return control.parent;
            case ".":
                return control;
            default:
                return control.get(pathSegment);
        }
    };
    /**
     * @template T
     * @param {?} testResults
     * @return {?}
     */
    ReactiveFormsRuleService.prototype.buildTestResultStatsString = /**
     * @template T
     * @param {?} testResults
     * @return {?}
     */
    function (testResults) {
        return "Executed " + testResults.results.length + " tests " +
            ("(" + testResults.passedResults.length + " PASS | ") +
            (testResults.failedResults.length + " FAIL | ")
            + (testResults.skippedResults.length + " SKIP)");
    };
    /**
     * @template T
     * @param {?} formGroup
     * @param {?} modelSettings
     * @return {?}
     */
    ReactiveFormsRuleService.prototype.attachModelSettingsToForm = /**
     * @template T
     * @param {?} formGroup
     * @param {?} modelSettings
     * @return {?}
     */
    function (formGroup, modelSettings) {
        formGroup[ReactiveFormsRuleService.FORM_MODEL_SETTINGS_PROPERTY_NAME] = modelSettings;
    };
    /**
     * @template T
     * @param {?} formGroup
     * @return {?}
     */
    ReactiveFormsRuleService.prototype.getModelSettingsFromForm = /**
     * @template T
     * @param {?} formGroup
     * @return {?}
     */
    function (formGroup) {
        return /** @type {?} */ (formGroup[ReactiveFormsRuleService.FORM_MODEL_SETTINGS_PROPERTY_NAME]);
    };
    /**
     * @param {?} control
     * @param {?} force
     * @return {?}
     */
    ReactiveFormsRuleService.prototype.setForceAsyncValidationTestForControl = /**
     * @param {?} control
     * @param {?} force
     * @return {?}
     */
    function (control, force) {
        control[ReactiveFormsRuleService.FORCE_ASYNC_VALID_TEST_RUN_PROPERTY_NAME] = force;
    };
    /**
     * @param {?} control
     * @param {?} errors
     * @return {?}
     */
    ReactiveFormsRuleService.prototype.setLastErrorForControl = /**
     * @param {?} control
     * @param {?} errors
     * @return {?}
     */
    function (control, errors) {
        control[ReactiveFormsRuleService.CONTROL_LAST_ERROR] = errors;
    };
    /**
     * @param {?} control
     * @return {?}
     */
    ReactiveFormsRuleService.prototype.getLastErrorForControl = /**
     * @param {?} control
     * @return {?}
     */
    function (control) {
        return control[ReactiveFormsRuleService.CONTROL_LAST_ERROR];
    };
    /**
     * @param {?} control
     * @return {?}
     */
    ReactiveFormsRuleService.prototype.doesControlHaveForcedAsyncValidation = /**
     * @param {?} control
     * @return {?}
     */
    function (control) {
        return !!(control[ReactiveFormsRuleService.FORCE_ASYNC_VALID_TEST_RUN_PROPERTY_NAME]);
    };
    /**
     * @param {?} control
     * @return {?}
     */
    ReactiveFormsRuleService.prototype.triggerValueChange = /**
     * @param {?} control
     * @return {?}
     */
    function (control) {
        control.patchValue(control.value);
    };
    ReactiveFormsRuleService.FORM_MODEL_SETTINGS_PROPERTY_NAME = 'ngFormRulesModelSetting';
    ReactiveFormsRuleService.FORCE_ASYNC_VALID_TEST_RUN_PROPERTY_NAME = 'ngFormRulesForceAsyncValidTestRun';
    ReactiveFormsRuleService.CONTROL_LAST_ERROR = 'ngFormRulesControlLastError';
    ReactiveFormsRuleService.decorators = [
        { type: Injectable },
    ];
    /** @nocollapse */
    ReactiveFormsRuleService.ctorParameters = function () { return [
        { type: RulesEngineService, },
        { type: FormBuilder, },
        { type: TraceService, },
        { type: CommonService, },
    ]; };
    return ReactiveFormsRuleService;
}());
export { ReactiveFormsRuleService };
function ReactiveFormsRuleService_tsickle_Closure_declarations() {
    /** @type {!Array<{type: !Function, args: (undefined|!Array<?>)}>} */
    ReactiveFormsRuleService.decorators;
    /**
     * @nocollapse
     * @type {function(): !Array<(null|{type: ?, decorators: (undefined|!Array<{type: !Function, args: (undefined|!Array<?>)}>)})>}
     */
    ReactiveFormsRuleService.ctorParameters;
    /** @type {?} */
    ReactiveFormsRuleService.FORM_MODEL_SETTINGS_PROPERTY_NAME;
    /** @type {?} */
    ReactiveFormsRuleService.FORCE_ASYNC_VALID_TEST_RUN_PROPERTY_NAME;
    /** @type {?} */
    ReactiveFormsRuleService.CONTROL_LAST_ERROR;
    /** @type {?} */
    ReactiveFormsRuleService.prototype.rulesEngineSvc;
    /** @type {?} */
    ReactiveFormsRuleService.prototype.formBuilder;
    /** @type {?} */
    ReactiveFormsRuleService.prototype.traceSvc;
    /** @type {?} */
    ReactiveFormsRuleService.prototype.commonSvc;
}
/**
 * @record
 */
function ControlContextValues() { }
function ControlContextValues_tsickle_Closure_declarations() {
    /** @type {?} */
    ControlContextValues.prototype.root;
    /** @type {?} */
    ControlContextValues.prototype.relative;
}
/**
 * @record
 */
function AsyncValidationPassthroughable() { }
function AsyncValidationPassthroughable_tsickle_Closure_declarations() {
    /** @type {?} */
    AsyncValidationPassthroughable.prototype.control;
    /** @type {?} */
    AsyncValidationPassthroughable.prototype.passthrough;
}

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoicmVhY3RpdmUtZm9ybXMtcnVsZS5zZXJ2aWNlLmpzIiwic291cmNlUm9vdCI6Im5nOi8vbmctZm9ybS1ydWxlcy8iLCJzb3VyY2VzIjpbImxpYi9ydWxlcy1lbmdpbmUvc2VydmljZXMvcmVhY3RpdmUtZm9ybXMtcnVsZS9yZWFjdGl2ZS1mb3Jtcy1ydWxlLnNlcnZpY2UudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7Ozs7QUFDQSxPQUFPLEVBQUUsVUFBVSxFQUFFLE1BQU0sZUFBZSxDQUFDO0FBQzNDLE9BQU8sRUFBRSxTQUFTLEVBQWdDLFdBQVcsRUFBRSxXQUFXLEVBQUUsU0FBUyxFQUFzQyxNQUFNLGdCQUFnQixDQUFDO0FBQ2xKLE9BQU8sRUFBRSxrQkFBa0IsRUFBRSxNQUFNLHNDQUFzQyxDQUFDO0FBRzFFLE9BQU8sRUFBRSxZQUFZLEVBQUUsTUFBTSwwQ0FBMEMsQ0FBQztBQUN4RSxPQUFPLEVBQUUsWUFBWSxFQUFFLE1BQU0sb0NBQW9DLENBQUM7QUFDbEUsT0FBTyxFQUFjLGVBQWUsRUFBRSxFQUFFLEVBQW9CLEtBQUssRUFBUyxLQUFLLEVBQUUsTUFBTSxNQUFNLENBQUM7QUFDOUYsT0FBTyxFQUFFLEdBQUcsRUFBRSxHQUFHLEVBQUUsU0FBUyxFQUFFLElBQUksRUFBRSxvQkFBb0IsRUFBRSxRQUFRLEVBQUUsTUFBTSxnQkFBZ0IsQ0FBQztBQUszRixPQUFPLEVBQUUsWUFBWSxFQUFFLE1BQU0sMENBQTBDLENBQUM7QUFDeEUsT0FBTyxFQUFFLGFBQWEsRUFBRSxNQUFNLHNDQUFzQyxDQUFDOzs7OztJQWdCakUsa0NBQ1ksZ0JBQ0EsYUFDQSxVQUNBO1FBSEEsbUJBQWMsR0FBZCxjQUFjO1FBQ2QsZ0JBQVcsR0FBWCxXQUFXO1FBQ1gsYUFBUSxHQUFSLFFBQVE7UUFDUixjQUFTLEdBQVQsU0FBUztLQUVwQjtJQUVEOzs7O09BSUc7Ozs7Ozs7SUFDSCxtREFBZ0I7Ozs7OztJQUFoQixVQUFvQixJQUFZO1FBQzVCLE1BQU0sQ0FBQyxJQUFJLENBQUMsY0FBYyxDQUFDLGdCQUFnQixDQUFDLElBQUksQ0FBQyxDQUFDO0tBQ3JEO0lBRUQ7Ozs7O09BS0c7Ozs7Ozs7O0lBQ0gsa0RBQWU7Ozs7Ozs7SUFBZixVQUNJLGFBQWdELEVBQ2hELFlBQWtCO1FBRWxCLHFCQUFJLFFBQWtDLENBQUM7UUFFdkMsRUFBRSxDQUFDLENBQUMsT0FBTyxhQUFhLEtBQUssUUFBUSxDQUFDLENBQUMsQ0FBQztZQUNwQyxRQUFRLEdBQUcsSUFBSSxDQUFDLGNBQWMsQ0FBQyxnQkFBZ0IsbUJBQUMsYUFBdUIsRUFBQyxDQUFDO1lBQ3pFLEVBQUUsQ0FBQyxDQUFDLENBQUMsUUFBUSxDQUFDO2dCQUFDLE1BQU0sSUFBSSxLQUFLLENBQUMsNENBQXlDLGFBQWEsT0FBRyxDQUFDLENBQUM7U0FDN0Y7UUFBQyxJQUFJLENBQUMsQ0FBQztZQUNKLEVBQUUsQ0FBQyxDQUFDLENBQUMsYUFBYSxDQUFDO2dCQUFDLE1BQU0sSUFBSSxLQUFLLENBQUMseUNBQXlDLENBQUMsQ0FBQztZQUMvRSxRQUFRLHFCQUFHLGFBQXlDLENBQUEsQ0FBQztZQUNyRCxJQUFJLENBQUMsY0FBYyxDQUFDLHNCQUFzQixDQUFDLFFBQVEsQ0FBQyxDQUFDO1NBQ3hEO1FBRUQsSUFBSSxDQUFDLFFBQVEsQ0FBQyxLQUFLLENBQUMsZ0RBQTZDLFFBQVEsQ0FBQyxJQUFJLE9BQUcsQ0FBQyxDQUFDO1FBQ25GLHFCQUFNLFNBQVMsR0FBRyxJQUFJLENBQUMsVUFBVSxDQUFDLFFBQVEsQ0FBQyxVQUFVLEVBQUUsWUFBWSxDQUFDLENBQUM7UUFFckUsSUFBSSxDQUFDLFFBQVEsQ0FBQyxLQUFLLENBQUMscUNBQXFDLENBQUMsQ0FBQztRQUMzRCxJQUFJLENBQUMsNEJBQTRCLENBQUMsU0FBUyxFQUFFLFFBQVEsQ0FBQyxVQUFVLENBQUMsQ0FBQztRQUVsRSxJQUFJLENBQUMsUUFBUSxDQUFDLEtBQUssQ0FBQyx3Q0FBd0MsQ0FBQyxDQUFDO1FBQzlELElBQUksQ0FBQyxrQkFBa0IsQ0FBQyxTQUFTLENBQUMsQ0FBQztRQUVuQyxJQUFJLENBQUMsUUFBUSxDQUFDLEtBQUssQ0FBQyxrQ0FBa0MsQ0FBQyxDQUFDO1FBQ3hELElBQUksQ0FBQyx5QkFBeUIsQ0FBQyxTQUFTLEVBQUUsUUFBUSxDQUFDLENBQUM7UUFFcEQsTUFBTSxDQUFDLFNBQVMsQ0FBQztLQUNwQjtJQUVEOzs7Ozs7T0FNRzs7Ozs7Ozs7OztJQUNILDhEQUEyQjs7Ozs7Ozs7O0lBQTNCLFVBQ0ksUUFBOEIsRUFDOUIsZUFBMEIsRUFDMUIsWUFBa0IsRUFDbEIsT0FBcUM7UUFFckMscUJBQU0sT0FBTyxHQUFHLElBQUksQ0FBQyxvQkFBb0IsQ0FBQyxRQUFRLEVBQUUsWUFBWSxDQUFDLENBQUM7UUFDbEUscUJBQU0sY0FBYyxHQUFHLENBQUMsT0FBTyxJQUFJLENBQUMsSUFBSSxDQUFDLFNBQVMsQ0FBQyxlQUFlLENBQUMsT0FBTyxDQUFDLEtBQUssQ0FBQyxJQUFJLE9BQU8sQ0FBQyxLQUFLLElBQUksZUFBZSxDQUFDLE1BQU0sQ0FBQztRQUU3SCxFQUFFLENBQUMsQ0FBQyxjQUFjLENBQUM7WUFDZixlQUFlLENBQUMsSUFBSSxDQUFDLE9BQU8sQ0FBQyxDQUFDO1FBQ2xDLElBQUk7WUFDQSxlQUFlLENBQUMsTUFBTSxDQUFDLE9BQU8sQ0FBQyxLQUFLLEVBQUUsT0FBTyxDQUFDLENBQUM7UUFFbkQscUJBQU0sYUFBYSxHQUFHLElBQUksQ0FBQyx3QkFBd0IsbUJBQUMsZUFBZSxDQUFDLElBQWlCLEVBQUMsQ0FBQztRQUN2RixJQUFJLENBQUMsNEJBQTRCLENBQUMsZUFBZSxDQUFDLElBQUksRUFBRSxhQUFhLENBQUMsVUFBVSxDQUFDLENBQUM7OztRQUlsRixJQUFJLENBQUMsa0JBQWtCLENBQUMsZUFBZSxDQUFDLENBQUM7S0FDNUM7SUFFRDs7OztPQUlHOzs7Ozs7O0lBQ0gsa0RBQWU7Ozs7OztJQUFmLFVBQWdCLE9BQXdCLEVBQUUsU0FBc0M7UUFDNUUsRUFBRSxDQUFDLENBQUMsQ0FBQyxTQUFTLENBQUM7WUFBQyxNQUFNLENBQUM7UUFFdkIscUJBQU0sY0FBYyxHQUFHLEtBQUssQ0FBQyxPQUFPLENBQUMsU0FBUyxDQUFDLENBQUMsQ0FBQyxDQUFDLFNBQVMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxTQUFTLENBQUMsQ0FBQztRQUMxRSxPQUFPLENBQUMsYUFBYSxDQUFDLGtCQUFDLE9BQU8sQ0FBQyxTQUFTLEdBQUssY0FBYyxFQUN0RCxNQUFNLENBQUMsVUFBQSxXQUFXLElBQUksT0FBQSxDQUFDLENBQUMsV0FBVyxFQUFiLENBQWEsQ0FBQyxDQUFDLENBQUM7S0FDOUM7SUFFRDs7OztPQUlHOzs7Ozs7O0lBQ0gsdURBQW9COzs7Ozs7SUFBcEIsVUFBcUIsT0FBd0IsRUFBRSxjQUFxRDtRQUNoRyxFQUFFLENBQUMsQ0FBQyxDQUFDLGNBQWMsQ0FBQztZQUFDLE1BQU0sQ0FBQztRQUU1QixxQkFBTSxtQkFBbUIsR0FBRyxLQUFLLENBQUMsT0FBTyxDQUFDLGNBQWMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxjQUFjLENBQUMsQ0FBQyxDQUFDLENBQUMsY0FBYyxDQUFDLENBQUM7UUFDOUYsT0FBTyxDQUFDLGtCQUFrQixDQUFDLGtCQUFDLE9BQU8sQ0FBQyxjQUFjLEdBQUssbUJBQW1CLEVBQ3JFLE1BQU0sQ0FBQyxVQUFBLGdCQUFnQixJQUFJLE9BQUEsQ0FBQyxDQUFDLGdCQUFnQixFQUFsQixDQUFrQixDQUFDLENBQUMsQ0FBQztLQUN4RDs7Ozs7OztJQUVPLHVEQUFvQjs7Ozs7O2NBQUksUUFBeUIsRUFBRSxZQUFrQjs7UUFDekUscUJBQUksT0FBd0IsQ0FBQztRQUU3QixFQUFFLENBQUMsQ0FBQyxRQUFRLENBQUMsaUJBQWlCLENBQUM7WUFBQyxPQUFPLEdBQUcsSUFBSSxDQUFDLFVBQVUsQ0FBQyxRQUFRLENBQUMsaUJBQWlCLEVBQUUsWUFBWSxFQUFFLFFBQVEsQ0FBQyxRQUFRLENBQUMsQ0FBQztRQUN2SCxJQUFJLENBQUMsRUFBRSxDQUFDLENBQUMsUUFBUSxDQUFDLFVBQVUsQ0FBQztZQUFDLE9BQU8sR0FBRyxJQUFJLENBQUMsVUFBVSxDQUFDLFFBQVEsQ0FBQyxVQUFVLEVBQUUsWUFBWSxFQUFFLFFBQVEsQ0FBQyxRQUFRLENBQUMsQ0FBQztRQUM5RyxJQUFJO1lBQUMsT0FBTyxHQUFHLElBQUksQ0FBQyxZQUFZLENBQUMsWUFBWSxFQUFFLFFBQVEsQ0FBQyxRQUFRLENBQUMsQ0FBQzs7UUFHbEUsT0FBTyxDQUFDLGFBQWEsQ0FBQyxJQUFJLENBQUMsc0JBQXNCLENBQUMsUUFBUSxDQUFDLENBQUMsQ0FBQztRQUM3RCxPQUFPLENBQUMsa0JBQWtCLENBQUMsSUFBSSxDQUFDLDJCQUEyQixDQUFDLFFBQVEsQ0FBQyxDQUFDLENBQUM7O1FBR3ZFLE9BQU8sQ0FBQyxZQUFZO2FBQ2YsSUFBSSxDQUNELElBQUksQ0FBQyx1QkFBdUIsQ0FBQyxRQUFRLENBQUMsa0JBQWtCLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxDQUN0RTthQUNBLFNBQVMsQ0FBQyxVQUFBLEtBQUs7WUFDWixLQUFJLENBQUMsZ0JBQWdCLENBQUMsT0FBTyxFQUFFLFFBQVEsQ0FBQyxDQUFDO1NBQzVDLENBQUMsQ0FBQztRQUVQLE1BQU0sQ0FBQyxPQUFPLENBQUM7Ozs7Ozs7O0lBR1gsK0NBQVk7Ozs7OztjQUFJLFlBQWlCLEVBQUUsUUFBbUI7UUFDMUQsTUFBTSxDQUFDLElBQUksV0FBVyxDQUFDLFlBQVksRUFBRSxFQUFFLFFBQVEsRUFBRSxRQUFRLEVBQUUsQ0FBQyxDQUFDOzs7Ozs7Ozs7SUFHekQsNkNBQVU7Ozs7Ozs7Y0FBSSxVQUF5QixFQUFFLFlBQWlCLEVBQUUsUUFBbUI7O1FBQ25GLHFCQUFNLFNBQVMsR0FBRyxJQUFJLFNBQVMsQ0FBQyxFQUFFLEVBQUUsRUFBRSxRQUFRLEVBQUUsUUFBUSxFQUFFLENBQUMsQ0FBQztRQUU1RCxDQUFDLFVBQVUsSUFBSSxFQUFFLENBQUMsQ0FBQyxPQUFPLENBQUMsVUFBQSxDQUFDO1lBQ3hCLHFCQUFNLGFBQWEsR0FBRyxZQUFZLENBQUMsQ0FBQyxDQUFDLFlBQVksQ0FBQyxDQUFDLENBQUMsSUFBSSxDQUFDLENBQUMsQ0FBQyxDQUFDLElBQUksQ0FBQztZQUNqRSxxQkFBTSxJQUFJLEdBQUcsS0FBSSxDQUFDLG9CQUFvQixDQUFDLENBQUMsRUFBRSxhQUFhLENBQUMsQ0FBQztZQUN6RCxTQUFTLENBQUMsVUFBVSxDQUFDLENBQUMsQ0FBQyxJQUFJLEVBQUUsSUFBSSxDQUFDLENBQUM7U0FDdEMsQ0FBQyxDQUFDO1FBRUgsTUFBTSxDQUFDLFNBQVMsQ0FBQzs7Ozs7Ozs7O0lBR2IsNkNBQVU7Ozs7Ozs7Y0FBSSxRQUE4QixFQUFFLFlBQW1CLEVBQUUsUUFBbUI7O1FBQzFGLFlBQVksR0FBRyxLQUFLLENBQUMsT0FBTyxDQUFDLFlBQVksQ0FBQyxDQUFDLENBQUMsQ0FBQyxZQUFZLENBQUMsQ0FBQyxDQUFDLEVBQUUsQ0FBQztRQUUvRCxNQUFNLENBQUMsSUFBSSxTQUFTLENBQ2hCLFlBQVksQ0FBQyxHQUFHLENBQUMsVUFBQSxDQUFDLElBQUksT0FBQSxLQUFJLENBQUMsb0JBQW9CLENBQUMsUUFBUSxFQUFFLENBQUMsQ0FBQyxFQUF0QyxDQUFzQyxDQUFDLEVBQzdELEVBQUUsUUFBUSxFQUFFLFFBQVEsRUFBRSxDQUN6QixDQUFDOzs7Ozs7O0lBR0UseURBQXNCOzs7OztjQUFJLFFBQXlCOztRQUN2RCxxQkFBTSxVQUFVLEdBQUcsSUFBSSxDQUFDLGNBQWMsQ0FBQyxvQkFBb0IsQ0FBQyxRQUFRLENBQUMsS0FBSyxDQUFDLENBQUM7UUFDNUUsRUFBRSxDQUFDLENBQUMsQ0FBQyxVQUFVLENBQUMsSUFBSSxDQUFDLE1BQU0sQ0FBQztZQUFDLE1BQU0sQ0FBQyxJQUFJLENBQUM7UUFFekMsTUFBTSxDQUFDLFVBQUMsT0FBd0I7WUFDNUIscUJBQU0sb0JBQW9CLEdBQUcsS0FBSSxDQUFDLHVCQUF1QixDQUFDLE9BQU8sRUFBRSxRQUFRLENBQUMsQ0FBQztZQUU3RSxxQkFBTSxXQUFXLEdBQUcsS0FBSSxDQUFDLGNBQWM7aUJBQ2xDLFFBQVEsQ0FBQyxvQkFBb0IsQ0FBQyxRQUFRLEVBQUUsVUFBVSxDQUFDLElBQUksRUFBRTtnQkFDdEQsUUFBUSxFQUFFLG9CQUFvQixDQUFDLElBQUk7Z0JBQ25DLFlBQVksRUFBRSxZQUFZLENBQUMsTUFBTSxDQUFDLE9BQU8sQ0FBQzthQUM3QyxDQUFDLENBQUM7WUFFUCxFQUFFLENBQUMsQ0FBQyxXQUFXLENBQUMsT0FBTyxDQUFDLE1BQU0sQ0FBQyxDQUFDLENBQUM7Z0JBQzdCLEtBQUksQ0FBQyxRQUFRLENBQUMsS0FBSyxDQUFDLDBCQUF1QixRQUFRLENBQUMsWUFBWSxTQUFLO29CQUNqRSxLQUFJLENBQUMsMEJBQTBCLENBQUMsV0FBVyxDQUFDLENBQUMsQ0FBQzthQUNyRDtZQUVELE1BQU0sQ0FBQyxLQUFJLENBQUMsa0NBQWtDLENBQUMsV0FBVyxDQUFDLENBQUM7U0FDL0QsQ0FBQzs7Ozs7OztJQUdFLDhEQUEyQjs7Ozs7Y0FBSSxRQUF5Qjs7UUFDNUQscUJBQU0sWUFBWSxHQUFHLElBQUksQ0FBQyw4QkFBOEIsQ0FBQyxRQUFRLENBQUMsQ0FBQztRQUVuRSxFQUFFLENBQUMsQ0FBQyxDQUFDLFlBQVksQ0FBQztZQUFDLE1BQU0sQ0FBQyxJQUFJLENBQUM7UUFFL0IscUJBQU0sTUFBTSxHQUFHLElBQUksZUFBZSxDQUFrQixJQUFJLENBQUMsQ0FBQztRQUMxRCxxQkFBTSxNQUFNLEdBQUcsTUFBTSxDQUFDLElBQUksQ0FDdEIsSUFBSSxDQUFDLGlDQUFpQyxDQUFDLFFBQVEsQ0FBQyxrQkFBa0IsQ0FBQyxJQUFJLENBQUMsVUFBVSxDQUFDLEVBQ25GLFNBQVMsQ0FBQyxVQUFBLENBQUM7O1lBRVAsRUFBRSxDQUFDLENBQUMsQ0FBQyxDQUFDLFdBQVcsQ0FBQyxDQUFDLENBQUM7Z0JBQ2hCLHFCQUFNLGFBQWEsR0FBRyxDQUFDLENBQUMsT0FBTyxDQUFDLE1BQU0sSUFBSSxFQUFFLENBQUM7Z0JBQzdDLHFCQUFNLHFCQUFxQixHQUFHLEtBQUksQ0FBQyxzQkFBc0IsQ0FBQyxDQUFDLENBQUMsT0FBTyxDQUFDLENBQUM7Ozs7Z0JBS3JFLE1BQU0sQ0FBQyxFQUFFLENBQUMsTUFBTSxDQUFDLE1BQU0sQ0FBQyxhQUFhLG9CQUFFLEVBQUUsV0FBVyxFQUFFLHFCQUFxQixFQUFtQyxFQUFDLENBQUMsQ0FBQzthQUNwSDtZQUFDLElBQUksQ0FBQyxDQUFDO2dCQUNKLE1BQU0sQ0FBQyxZQUFZLENBQUMsQ0FBQyxDQUFDLE9BQU8sQ0FBQyxDQUFDO2FBQ2xDO1NBQ0osQ0FBQyxFQUNGLElBQUksQ0FBQyxDQUFDLENBQUMsQ0FDVixDQUFDO1FBRUYsTUFBTSxDQUFDLFVBQUMsT0FBd0I7WUFDNUIsTUFBTSxDQUFDLElBQUksQ0FBQyxPQUFPLENBQUMsQ0FBQztZQUNyQixNQUFNLENBQUMsTUFBTSxDQUFDO1NBQ2pCLENBQUM7Ozs7Ozs7SUFHRSxpRUFBOEI7Ozs7O2NBQUksUUFBeUI7O1FBQy9ELHFCQUFNLFVBQVUsR0FBRyxJQUFJLENBQUMsY0FBYyxDQUFDLG9CQUFvQixDQUFDLFFBQVEsQ0FBQyxLQUFLLENBQUMsQ0FBQztRQUM1RSxFQUFFLENBQUMsQ0FBQyxDQUFDLFVBQVUsQ0FBQyxLQUFLLENBQUMsTUFBTSxDQUFDO1lBQUMsTUFBTSxDQUFDLElBQUksQ0FBQztRQUUxQyxNQUFNLENBQUMsVUFBQyxPQUF3QjtZQUM1QixxQkFBTSxvQkFBb0IsR0FBRyxLQUFJLENBQUMsdUJBQXVCLENBQUMsT0FBTyxFQUFFLFFBQVEsQ0FBQyxDQUFDO1lBRTdFLE1BQU0sQ0FBQyxLQUFJLENBQUMsY0FBYyxDQUFDLGFBQWEsQ0FBQyxvQkFBb0IsQ0FBQyxRQUFRLEVBQUUsVUFBVSxDQUFDLEtBQUssRUFBRTtnQkFDdEYsUUFBUSxFQUFFLG9CQUFvQixDQUFDLElBQUk7Z0JBQ25DLFlBQVksRUFBRSxZQUFZLENBQUMsTUFBTSxDQUFDLE9BQU8sQ0FBQzthQUM3QyxDQUFDLENBQUMsSUFBSSxDQUNILEdBQUcsQ0FBQyxVQUFBLFdBQVc7Z0JBQ1gsRUFBRSxDQUFDLENBQUMsV0FBVyxDQUFDLE9BQU8sQ0FBQyxNQUFNLENBQUMsQ0FBQyxDQUFDO29CQUM3QixLQUFJLENBQUMsUUFBUSxDQUFDLEtBQUssQ0FBQyxrQ0FBK0IsUUFBUSxDQUFDLFlBQVksU0FBSzt3QkFDekUsS0FBSSxDQUFDLDBCQUEwQixDQUFDLFdBQVcsQ0FBQyxDQUFDLENBQUM7aUJBQ3JEO2FBQ0osQ0FBQyxFQUNGLEdBQUcsQ0FBQyxLQUFJLENBQUMsa0NBQWtDLENBQUMsRUFDNUMsR0FBRyxDQUFDLFVBQUEsQ0FBQyxJQUFJLE9BQUEsS0FBSSxDQUFDLHNCQUFzQixDQUFDLE9BQU8sRUFBRSxDQUFDLENBQUMsSUFBSSxFQUFFLENBQUMsZ0JBQWEsRUFBM0QsQ0FBMkQsQ0FBQyxDQUN4RSxDQUFDO1NBQ0wsQ0FBQzs7Ozs7Ozs7SUFHRSwrREFBNEI7Ozs7OztjQUNoQyxhQUE4QixFQUM5QixVQUE2QjtRQUU3QixJQUFJLENBQUMsNkJBQTZCLENBQUMsVUFBVSxDQUFDLENBQUM7UUFDL0MsSUFBSSxDQUFDLDBCQUEwQixDQUFDLGFBQWEsRUFBRSxVQUFVLENBQUMsQ0FBQzs7Ozs7OztJQUd2RCxnRUFBNkI7Ozs7O2NBQ2pDLFVBQTZCOztRQUU3QixDQUFDLFVBQVUsSUFBSSxFQUFFLENBQUMsQ0FBQyxPQUFPLENBQUMsVUFBQSxRQUFRO1lBQy9CLFFBQVEsQ0FBQyxvQ0FBb0MsRUFBRSxDQUFDO1lBRWhELEVBQUUsQ0FBQyxDQUFDLFFBQVEsQ0FBQyxVQUFVLENBQUMsQ0FBQyxDQUFDO2dCQUN0QixLQUFJLENBQUMsNkJBQTZCLENBQUMsUUFBUSxDQUFDLFVBQVUsQ0FBQyxDQUFDO2FBQzNEO1lBRUQsRUFBRSxDQUFDLENBQUMsUUFBUSxDQUFDLGlCQUFpQixDQUFDLENBQUMsQ0FBQztnQkFDN0IsS0FBSSxDQUFDLDZCQUE2QixDQUFDLENBQUMsUUFBUSxDQUFDLGlCQUFpQixDQUFDLENBQUMsQ0FBQzthQUNwRTtTQUNKLENBQUMsQ0FBQzs7Ozs7Ozs7O0lBR0MsNkRBQTBCOzs7Ozs7O2NBQzlCLGFBQThCLEVBQzlCLFVBQTZCLEVBQzdCLFVBQW1COztRQUVuQixDQUFDLFVBQVUsSUFBSSxFQUFFLENBQUMsQ0FBQyxPQUFPLENBQUMsVUFBQSxRQUFRO1lBQy9CLHFCQUFNLGVBQWUsR0FBRyxLQUFJLENBQUMscUJBQXFCLENBQUMsYUFBYSxFQUFFLFFBQVEsRUFBRSxVQUFVLENBQUMsQ0FBQztZQUN4RixFQUFFLENBQUMsQ0FBQyxDQUFDLGVBQWUsQ0FBQztnQkFBQyxNQUFNLENBQUM7WUFFN0IsS0FBSSxDQUFDLHVDQUF1QyxDQUFDLGVBQWUsRUFBRSxhQUFhLEVBQUUsUUFBUSxDQUFDLENBQUM7WUFDdkYsS0FBSSxDQUFDLHNDQUFzQyxDQUFDLGVBQWUsRUFBRSxhQUFhLEVBQUUsUUFBUSxDQUFDLENBQUM7WUFFdEYsRUFBRSxDQUFDLENBQUMsUUFBUSxDQUFDLFVBQVUsQ0FBQyxDQUFDLENBQUM7Z0JBQ3RCLEtBQUksQ0FBQywwQkFBMEIsQ0FBQyxlQUFlLEVBQUUsUUFBUSxDQUFDLFVBQVUsQ0FBQyxDQUFDO2FBQ3pFO1lBRUQsRUFBRSxDQUFDLENBQUMsUUFBUSxDQUFDLGlCQUFpQixDQUFDLENBQUMsQ0FBQzs7Z0JBRTdCLHFCQUFNLGdCQUFnQixHQUFHLG1CQUFDLGVBQTRCLEVBQUMsQ0FBQztnQkFDeEQsR0FBRyxDQUFDLENBQUMscUJBQUksQ0FBQyxHQUFHLENBQUMsRUFBRSxDQUFDLEdBQUcsZ0JBQWdCLENBQUMsTUFBTSxFQUFFLENBQUMsRUFBRSxFQUFFLENBQUM7b0JBQy9DLEtBQUksQ0FBQywwQkFBMEIsQ0FBQyxnQkFBZ0IsRUFBRSxDQUFDLFFBQVEsQ0FBQyxpQkFBaUIsQ0FBQyxFQUFFLENBQUMsQ0FBQyxDQUFDO2lCQUN0RjthQUNKO1NBQ0osQ0FBQyxDQUFDOzs7Ozs7Ozs7SUFHQyx5RUFBc0M7Ozs7Ozs7Y0FDMUMsZUFBZ0MsRUFBRSxhQUE4QixFQUFFLFFBQXlCOztRQUUzRixxQkFBTSxtQkFBbUIsR0FBRyxJQUFJLENBQUMsY0FBYyxDQUFDLHVCQUF1QixDQUFDLFFBQVEsQ0FBQyxLQUFLLENBQUMsQ0FBQztRQUV4RixtQkFBbUIsQ0FBQyxPQUFPLENBQUMsVUFBQSxDQUFDO1lBQ3pCLHFCQUFNLGlCQUFpQixHQUFHLEtBQUksQ0FBQyxxQkFBcUIsQ0FBQyxhQUFhLEVBQUUsQ0FBQyxDQUFDLENBQUM7WUFFdkUsRUFBRSxDQUFDLENBQUMsQ0FBQyxpQkFBaUIsQ0FBQztnQkFBQyxNQUFNLENBQUM7WUFFL0IscUJBQU0sSUFBSSxHQUFHLGlCQUFpQixDQUFDLFlBQVk7aUJBQ3RDLElBQUksQ0FDRCxLQUFJLENBQUMsdUJBQXVCLENBQUMsUUFBUSxDQUFDLGtCQUFrQixDQUFDLG9CQUFvQixDQUFDLEtBQUssQ0FBQyxDQUN2RjtpQkFDQSxTQUFTLENBQUMsVUFBQSxLQUFLO2dCQUNaLEtBQUksQ0FBQyxxQ0FBcUMsQ0FBQyxlQUFlLEVBQUUsSUFBSSxDQUFDLENBQUM7Z0JBQ2xFLGVBQWUsQ0FBQyxzQkFBc0IsQ0FBQyxFQUFFLFFBQVEsRUFBRSxJQUFJLEVBQUUsU0FBUyxFQUFFLEtBQUssRUFBRSxDQUFDLENBQUM7YUFDaEYsQ0FBQyxDQUFDO1lBRVAsUUFBUSxDQUFDLGlDQUFpQyxDQUFDLElBQUksQ0FBQyxDQUFDO1NBQ3BELENBQUMsQ0FBQzs7Ozs7Ozs7O0lBR0MsMEVBQXVDOzs7Ozs7O2NBQzNDLGVBQWdDLEVBQ2hDLGFBQThCLEVBQzlCLFFBQXlCOztRQUV6QixxQkFBTSxtQkFBbUIsR0FBRyxJQUFJLENBQUMsY0FBYyxDQUFDLHVCQUF1QixDQUFDLFFBQVEsQ0FBQyxJQUFJLENBQUMsQ0FBQztRQUV2RixtQkFBbUIsQ0FBQyxPQUFPLENBQUMsVUFBQSxHQUFHO1lBQzNCLHFCQUFNLGlCQUFpQixHQUFHLEtBQUksQ0FBQyxxQkFBcUIsQ0FBQyxhQUFhLEVBQUUsR0FBRyxDQUFDLENBQUM7WUFFekUsRUFBRSxDQUFDLENBQUMsQ0FBQyxpQkFBaUIsQ0FBQztnQkFBQyxNQUFNLENBQUM7O1lBRy9CLHFCQUFNLElBQUksR0FBRyxpQkFBaUIsQ0FBQyxZQUFZO2lCQUN0QyxJQUFJLENBQ0QsS0FBSSxDQUFDLHVCQUF1QixDQUFDLFFBQVEsQ0FBQyxrQkFBa0IsQ0FBQyxvQkFBb0IsQ0FBQyxJQUFJLENBQUMsQ0FDdEY7aUJBQ0EsU0FBUyxDQUFDLFVBQUEsS0FBSztnQkFDWixLQUFJLENBQUMsZ0JBQWdCLENBQUMsZUFBZSxFQUFFLFFBQVEsQ0FBQyxDQUFDO2FBQ3BELENBQUMsQ0FBQztZQUVQLFFBQVEsQ0FBQyxpQ0FBaUMsQ0FBQyxJQUFJLENBQUMsQ0FBQztTQUNwRCxDQUFDLENBQUM7Ozs7Ozs7O0lBR0MsbURBQWdCOzs7Ozs7Y0FBSSxlQUFnQyxFQUFFLFFBQXlCOztRQUNuRixxQkFBTSxvQkFBb0IsR0FBRyxJQUFJLENBQUMsdUJBQXVCLENBQUMsZUFBZSxFQUFFLFFBQVEsQ0FBQyxDQUFDO1FBRXJGLElBQUksQ0FBQyxjQUFjLENBQUMsUUFBUSxDQUFDLG9CQUFvQixDQUFDLFFBQVEsRUFBRSxRQUFRLEVBQUU7WUFDbEUsUUFBUSxFQUFFLG9CQUFvQixDQUFDLElBQUk7WUFDbkMsWUFBWSxFQUFFLFlBQVksQ0FBQyxNQUFNLENBQUMsZUFBZSxDQUFDO1NBQ3JELENBQUMsQ0FBQyxTQUFTLENBQUMsVUFBQSxXQUFXO1lBQ3BCLEVBQUUsQ0FBQyxDQUFDLFdBQVcsQ0FBQyxPQUFPLENBQUMsTUFBTSxDQUFDLENBQUMsQ0FBQztnQkFDN0IsS0FBSSxDQUFDLFFBQVEsQ0FBQyxLQUFLLENBQUMseUJBQXNCLFFBQVEsQ0FBQyxZQUFZLFNBQUs7b0JBQ2hFLEtBQUksQ0FBQywwQkFBMEIsQ0FBQyxXQUFXLENBQUMsQ0FBQyxDQUFDO2FBQ3JEO1lBRUQsRUFBRSxDQUFDLENBQUMsV0FBVyxDQUFDLE1BQU0sSUFBSSxlQUFlLENBQUMsUUFBUSxDQUFDO2dCQUMvQyxlQUFlLENBQUMsTUFBTSxDQUFDLEVBQUUsU0FBUyxFQUFFLEtBQUssRUFBRSxDQUFDLENBQUM7WUFDakQsSUFBSSxDQUFDLEVBQUUsQ0FBQyxDQUFDLENBQUMsV0FBVyxDQUFDLE1BQU0sSUFBSSxlQUFlLENBQUMsT0FBTyxDQUFDO2dCQUNwRCxlQUFlLENBQUMsT0FBTyxDQUFDLEVBQUUsU0FBUyxFQUFFLEtBQUssRUFBRSxDQUFDLENBQUM7U0FDckQsQ0FBQyxDQUFDOzs7Ozs7SUFHQyxvRUFBaUM7Ozs7Y0FDckMsa0JBQXNDOztRQUV0QyxNQUFNLENBQUMsVUFBQyxPQUFvQztZQUN4QyxxQkFBSSxTQUFjLENBQUM7WUFDbkIscUJBQUksT0FBZ0IsQ0FBQztZQUVyQixNQUFNLENBQUMsT0FBTyxDQUFDLElBQUksQ0FDZixHQUFHLENBQUMsVUFBQSxPQUFPO2dCQUNQLE9BQU8sR0FBRyxLQUFJLENBQUMsb0NBQW9DLENBQUMsT0FBTyxDQUFDLENBQUM7Z0JBQzdELEtBQUksQ0FBQyxxQ0FBcUMsQ0FBQyxPQUFPLEVBQUUsS0FBSyxDQUFDLENBQUM7YUFDOUQsQ0FBQyxFQUNGLFFBQVEsQ0FBQyxVQUFBLENBQUM7Z0JBQ04sTUFBTSxDQUFDLE9BQU8sSUFBSSxrQkFBa0IsQ0FBQyxvQkFBb0IsR0FBRyxDQUFDO29CQUN6RCxDQUFDLENBQUMsS0FBSyxDQUFDLGtCQUFrQixDQUFDLG9CQUFvQixDQUFDO29CQUNoRCxDQUFDLENBQUMsS0FBSyxDQUFDO2FBQ2YsQ0FBQyxFQUNGLEdBQUcsQ0FBQyxVQUFBLE9BQU87Z0JBQ1AsTUFBTSxtQkFBQztvQkFDSCxPQUFPLEVBQUUsT0FBTztvQkFDaEIsV0FBVyxFQUFFLENBQUMsQ0FBQyxPQUFPLENBQUMsS0FBSyxLQUFLLFNBQVMsSUFBSSxDQUFDLGtCQUFrQixDQUFDLG9CQUFvQixJQUFJLE9BQU8sQ0FBQztpQkFDbkUsRUFBQzthQUN2QyxDQUFDLEVBQ0YsR0FBRyxDQUFDLFVBQUEsQ0FBQztnQkFDRCxFQUFFLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxXQUFXLENBQUM7b0JBQUMsU0FBUyxHQUFHLENBQUMsQ0FBQyxPQUFPLENBQUMsS0FBSyxDQUFDO2FBQ25ELENBQUMsQ0FDTCxDQUFDO1NBQ0wsQ0FBQzs7Ozs7O0lBR0UsMERBQXVCOzs7O2NBQUMsa0JBQXNDO1FBQ2xFLE1BQU0sQ0FBQyxVQUFDLE9BQXdCO1lBQzVCLE1BQU0sQ0FBQyxPQUFPLENBQUMsSUFBSSxDQUNmLFFBQVEsQ0FBQyxVQUFBLENBQUM7Z0JBQ04sTUFBTSxDQUFDLGtCQUFrQixDQUFDLG9CQUFvQixHQUFHLENBQUM7b0JBQzlDLENBQUMsQ0FBQyxLQUFLLENBQUMsa0JBQWtCLENBQUMsb0JBQW9CLENBQUM7b0JBQ2hELENBQUMsQ0FBQyxLQUFLLENBQUM7YUFDZixDQUFDLEVBQ0Ysa0JBQWtCLENBQUMsb0JBQW9CLENBQUMsQ0FBQyxDQUFDLG9CQUFvQixFQUFFLENBQUMsQ0FBQyxDQUFDLEdBQUcsRUFBRSxDQUMzRSxDQUFDO1NBQ0wsQ0FBQzs7Ozs7Ozs7SUFHRSwwREFBdUI7Ozs7OztjQUFJLE9BQXdCLEVBQUUsUUFBNEM7UUFDckcscUJBQU0sU0FBUyxHQUFHLG1CQUFDLE9BQU8sQ0FBQyxJQUFpQixFQUFDLENBQUMsV0FBVyxFQUFFLENBQUM7O1FBRzVELHFCQUFNLGFBQWEsR0FBRyxZQUFZLENBQUMsbUJBQW1CLENBQUMsUUFBUSxDQUFDO1lBQzVELENBQUMsQ0FBQyxPQUFPLENBQUMsS0FBSztZQUNmLENBQUMsQ0FBQyxPQUFPLENBQUMsTUFBTSxDQUFDLFdBQVcsRUFBRSxDQUFDO1FBRW5DLE1BQU0sQ0FBQztZQUNILElBQUksRUFBRSxTQUFTO1lBQ2YsUUFBUSxFQUFFLGFBQWE7U0FDMUIsQ0FBQzs7Ozs7Ozs7O0lBR0Usd0RBQXFCOzs7Ozs7O2NBQ3pCLGFBQThCLEVBQzlCLFFBQXlCLEVBQ3pCLFVBQW1CO1FBRW5CLE1BQU0sQ0FBQyxZQUFZLENBQUMsbUJBQW1CLENBQUMsUUFBUSxDQUFDO1lBQzdDLENBQUMsQ0FBQyxtQkFBQyxhQUEwQixFQUFDLENBQUMsRUFBRSxDQUFDLFVBQVUsQ0FBQztZQUM3QyxDQUFDLENBQUMsYUFBYSxDQUFDLEdBQUcsQ0FBQyxtQkFBQyxRQUF1QixFQUFDLENBQUMsSUFBSSxDQUFDLENBQUM7Ozs7Ozs7SUFHcEQscUVBQWtDOzs7OztjQUFJLFdBQStCOztRQUV6RSxFQUFFLENBQUMsQ0FBQyxDQUFDLFdBQVcsSUFBSSxXQUFXLENBQUMsTUFBTSxDQUFDO1lBQUMsTUFBTSxDQUFDLElBQUksQ0FBQztRQUVwRCxxQkFBTSxNQUFNLEdBQW9ELEVBQUUsQ0FBQztRQUVuRSxXQUFXLENBQUMsYUFBYSxDQUFDLE9BQU8sQ0FBQyxVQUFBLElBQUk7WUFDbEMsTUFBTSxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsR0FBRyxFQUFFLE9BQU8sRUFBRSxJQUFJLENBQUMsT0FBTyxFQUFFLENBQUM7U0FDakQsQ0FBQyxDQUFDO1FBRUgsTUFBTSxDQUFDO1lBQ0gsV0FBVyxvQkFBRTtnQkFDVCxPQUFPLEVBQUUsV0FBVyxDQUFDLE9BQU87Z0JBQzVCLE1BQU0sRUFBRSxNQUFNO2FBQ29CLENBQUE7U0FDekMsQ0FBQzs7Ozs7OztJQUdFLHdEQUFxQjs7Ozs7Y0FBQyxPQUF3QixFQUFFLElBQVk7O1FBQ2hFLHFCQUFNLGFBQWEsR0FBRyxJQUFJLENBQUMsNkJBQTZCLENBQUMsSUFBSSxDQUFDLENBQUM7UUFFL0QsRUFBRSxDQUFDLENBQUMsQ0FBQyxhQUFhLENBQUMsTUFBTSxDQUFDO1lBQUMsTUFBTSxDQUFDLElBQUksQ0FBQztRQUV2QyxxQkFBSSxNQUF1QixDQUFDO1FBQzVCLGFBQWEsQ0FBQyxPQUFPLENBQUMsVUFBQSxXQUFXO1lBQzdCLE1BQU0sR0FBRyxLQUFJLENBQUMsdUJBQXVCLENBQUMsTUFBTSxJQUFJLE9BQU8sRUFBRSxXQUFXLENBQUMsQ0FBQztZQUN0RSxFQUFFLENBQUMsQ0FBQyxDQUFDLE1BQU0sQ0FBQztnQkFBQyxNQUFNLENBQUM7U0FDdkIsQ0FBQyxDQUFDO1FBRUgsTUFBTSxDQUFDLE1BQU0sQ0FBQzs7Ozs7O0lBR1YsZ0VBQTZCOzs7O2NBQUMsWUFBb0I7UUFDdEQscUJBQU0sTUFBTSxHQUFhLEVBQUUsQ0FBQztRQUU1QixFQUFFLENBQUMsQ0FBQyxDQUFDLFlBQVksSUFBSSxPQUFPLFlBQVksS0FBSyxRQUFRLENBQUM7WUFBQyxNQUFNLENBQUMsTUFBTSxDQUFDOztRQUdyRSxxQkFBTSxjQUFjLEdBQUcsWUFBWSxDQUFDLEtBQUssQ0FBQyxHQUFHLENBQUMsQ0FBQztRQUUvQyxjQUFjLENBQUMsT0FBTyxDQUFDLFVBQUEsU0FBUztZQUM1QixxQkFBTSxZQUFZLEdBQUcsU0FBUyxDQUFDLEtBQUssQ0FBQyxHQUFHLENBQUM7aUJBQ3BDLE1BQU0sQ0FBQyxVQUFBLE9BQU8sSUFBSSxPQUFBLENBQUMsQ0FBQyxPQUFPLEVBQVQsQ0FBUyxDQUFDLENBQUM7WUFFbEMsRUFBRSxDQUFDLENBQUMsWUFBWSxDQUFDLE1BQU0sQ0FBQztnQkFDcEIsTUFBTSxDQUFDLElBQUksT0FBWCxNQUFNLG1CQUFTLFlBQVksR0FBRTtZQUNqQyxJQUFJO2dCQUNBLE1BQU0sQ0FBQyxJQUFJLENBQUMsU0FBUyxDQUFDLENBQUM7U0FDOUIsQ0FBQyxDQUFDO1FBRUgsTUFBTSxDQUFDLE1BQU0sQ0FBQzs7Ozs7OztJQUdWLDBEQUF1Qjs7Ozs7Y0FBQyxPQUF3QixFQUFFLFdBQW1CO1FBQ3pFLE1BQU0sQ0FBQyxDQUFDLFdBQVcsQ0FBQyxDQUFDLENBQUM7WUFDbEIsS0FBSyxFQUFFO2dCQUNILE1BQU0sQ0FBQyxPQUFPLENBQUMsSUFBSSxDQUFDO1lBQ3hCLEtBQUssSUFBSTtnQkFDTCxNQUFNLENBQUMsT0FBTyxDQUFDLE1BQU0sQ0FBQztZQUMxQixLQUFLLEdBQUc7Z0JBQ0osTUFBTSxDQUFDLE9BQU8sQ0FBQztZQUNuQjtnQkFDSSxNQUFNLENBQUMsT0FBTyxDQUFDLEdBQUcsQ0FBQyxXQUFXLENBQUMsQ0FBQztTQUN2Qzs7Ozs7OztJQUdHLDZEQUEwQjs7Ozs7Y0FBSSxXQUErQjtRQUNqRSxNQUFNLENBQUMsY0FBWSxXQUFXLENBQUMsT0FBTyxDQUFDLE1BQU0sWUFBUzthQUNsRCxNQUFJLFdBQVcsQ0FBQyxhQUFhLENBQUMsTUFBTSxhQUFVLENBQUE7YUFDM0MsV0FBVyxDQUFDLGFBQWEsQ0FBQyxNQUFNLGFBQVUsQ0FBQTtlQUN4QyxXQUFXLENBQUMsY0FBYyxDQUFDLE1BQU0sV0FBUSxDQUFBLENBQUM7Ozs7Ozs7O0lBRy9DLDREQUF5Qjs7Ozs7O2NBQUksU0FBb0IsRUFBRSxhQUF1QztRQUM5RixTQUFTLENBQUMsd0JBQXdCLENBQUMsaUNBQWlDLENBQUMsR0FBRyxhQUFhLENBQUM7Ozs7Ozs7SUFHbEYsMkRBQXdCOzs7OztjQUFJLFNBQW9CO1FBQ3BELE1BQU0sbUJBQUMsU0FBUyxDQUFDLHdCQUF3QixDQUFDLGlDQUFpQyxDQUE2QixFQUFDOzs7Ozs7O0lBR3JHLHdFQUFxQzs7Ozs7Y0FBQyxPQUF3QixFQUFFLEtBQWM7UUFDbEYsT0FBTyxDQUFDLHdCQUF3QixDQUFDLHdDQUF3QyxDQUFDLEdBQUcsS0FBSyxDQUFDOzs7Ozs7O0lBRy9FLHlEQUFzQjs7Ozs7Y0FBQyxPQUF3QixFQUFFLE1BQXlDO1FBQzlGLE9BQU8sQ0FBQyx3QkFBd0IsQ0FBQyxrQkFBa0IsQ0FBQyxHQUFHLE1BQU0sQ0FBQzs7Ozs7O0lBRzFELHlEQUFzQjs7OztjQUFDLE9BQXdCO1FBQ25ELE1BQU0sQ0FBQyxPQUFPLENBQUMsd0JBQXdCLENBQUMsa0JBQWtCLENBQUMsQ0FBQzs7Ozs7O0lBR3hELHVFQUFvQzs7OztjQUFDLE9BQXdCO1FBQ2pFLE1BQU0sQ0FBQyxDQUFDLENBQUMsQ0FBQyxPQUFPLENBQUMsd0JBQXdCLENBQUMsd0NBQXdDLENBQUMsQ0FBQyxDQUFDOzs7Ozs7SUFHbEYscURBQWtCOzs7O2NBQUMsT0FBd0I7UUFDL0MsT0FBTyxDQUFDLFVBQVUsQ0FBQyxPQUFPLENBQUMsS0FBSyxDQUFDLENBQUM7O2lFQXRnQnNCLHlCQUF5Qjt3RUFDbEIsbUNBQW1DO2tEQUN6RCw2QkFBNkI7O2dCQUo3RSxVQUFVOzs7O2dCQXRCRixrQkFBa0I7Z0JBRHVCLFdBQVc7Z0JBS3BELFlBQVk7Z0JBUVosYUFBYTs7bUNBZnRCOztTQTBCYSx3QkFBd0IiLCJzb3VyY2VzQ29udGVudCI6WyIvLyB0c2xpbnQ6ZGlzYWJsZTptYXgtbGluZS1sZW5ndGhcclxuaW1wb3J0IHsgSW5qZWN0YWJsZSB9IGZyb20gXCJAYW5ndWxhci9jb3JlXCI7XHJcbmltcG9ydCB7IEZvcm1Hcm91cCwgQWJzdHJhY3RDb250cm9sLCBWYWxpZGF0b3JGbiwgRm9ybUJ1aWxkZXIsIEZvcm1Db250cm9sLCBGb3JtQXJyYXksIFZhbGlkYXRpb25FcnJvcnMsIEFzeW5jVmFsaWRhdG9yRm4gfSBmcm9tICdAYW5ndWxhci9mb3Jtcyc7XHJcbmltcG9ydCB7IFJ1bGVzRW5naW5lU2VydmljZSB9IGZyb20gXCIuLi9ydWxlcy1lbmdpbmUvcnVsZXMtZW5naW5lLnNlcnZpY2VcIjtcclxuaW1wb3J0IHsgUHJvcGVydHkgfSBmcm9tIFwiLi4vLi4vLi4vZm9ybS1ydWxlcy9tb2RlbHMvcHJvcGVydHlcIjtcclxuaW1wb3J0IHsgQXJyYXlJdGVtUHJvcGVydHkgfSBmcm9tIFwiLi4vLi4vLi4vZm9ybS1ydWxlcy9tb2RlbHMvYXJyYXktaXRlbS1wcm9wZXJ0eVwiO1xyXG5pbXBvcnQgeyBQcm9wZXJ0eUJhc2UgfSBmcm9tIFwiLi4vLi4vLi4vZm9ybS1ydWxlcy9tb2RlbHMvcHJvcGVydHktYmFzZVwiO1xyXG5pbXBvcnQgeyBUcmFjZVNlcnZpY2UgfSBmcm9tIFwiLi4vLi4vLi4vdXRpbHMvdHJhY2UvdHJhY2Uuc2VydmljZVwiO1xyXG5pbXBvcnQgeyBPYnNlcnZhYmxlLCBCZWhhdmlvclN1YmplY3QsIG9mLCBPcGVyYXRvckZ1bmN0aW9uLCB0aW1lciwgZW1wdHksIEVNUFRZIH0gZnJvbSBcInJ4anNcIjtcclxuaW1wb3J0IHsgbWFwLCB0YXAsIHN3aXRjaE1hcCwgdGFrZSwgZGlzdGluY3RVbnRpbENoYW5nZWQsIGRlYm91bmNlIH0gZnJvbSBcInJ4anMvb3BlcmF0b3JzXCI7XHJcbmltcG9ydCB7IFRlc3RSZXN1bHRzQmFzZSB9IGZyb20gXCIuLi8uLi8uLi9mb3JtLXJ1bGVzL21vZGVscy90ZXN0LXJlc3VsdHMtYmFzZVwiO1xyXG5pbXBvcnQgeyBSZWFjdGl2ZUZvcm1zVmFsaWRhdGlvbkVycm9ycyB9IGZyb20gXCIuLi8uLi8uLi9mb3JtLXJ1bGVzL21vZGVscy9yZWFjdGl2ZS1mb3Jtcy12YWxpZGF0aW9uLWVycm9yc1wiO1xyXG5pbXBvcnQgeyBSZWFjdGl2ZUZvcm1zRmFpbGVkVmFsZGF0aW9uIH0gZnJvbSBcIi4uLy4uLy4uL2Zvcm0tcnVsZXMvbW9kZWxzL3JlYWN0aXZlLWZvcm1zLWZhaWxlZC12YWxpZGF0aW9uXCI7XHJcbmltcG9ydCB7IFJlYWN0aXZlRm9ybXNWYWxpZGF0aW9uRXJyb3JzRGF0YSB9IGZyb20gXCIuLi8uLi8uLi9mb3JtLXJ1bGVzL21vZGVscy9yZWFjdGl2ZS1mb3Jtcy12YWxpZGF0aW9uLWVycm9ycy1kYXRhXCI7XHJcbmltcG9ydCB7IENvbnRyb2xTdGF0ZSB9IGZyb20gXCIuLi8uLi8uLi9mb3JtLXJ1bGVzL21vZGVscy9jb250cm9sLXN0YXRlXCI7XHJcbmltcG9ydCB7IENvbW1vblNlcnZpY2UgfSBmcm9tIFwiLi4vLi4vLi4vdXRpbHMvY29tbW9uL2NvbW1vbi5zZXJ2aWNlXCI7XHJcbmltcG9ydCB7IEFic3RyYWN0TW9kZWxTZXR0aW5ncyB9IGZyb20gXCIuLi8uLi8uLi9mb3JtLXJ1bGVzL21vZGVscy9hYnN0cmFjdC1tb2RlbC1zZXR0aW5nc1wiO1xyXG5pbXBvcnQgeyBWYWx1ZUNoYW5nZU9wdGlvbnMgfSBmcm9tIFwiLi4vLi4vLi4vZm9ybS1ydWxlcy9tb2RlbHMvdmFsdWUtY2hhbmdlLW9wdGlvbnNcIjtcclxuaW1wb3J0IHsgQWRkQXJyYXlJdGVtUHJvcGVydHlPcHRpb25zIH0gZnJvbSBcIi4uLy4uLy4uL2Zvcm0tcnVsZXMvbW9kZWxzL2FkZC1hcnJheS1pdGVtLXByb3BlcnR5LW9wdGlvbnNcIjtcclxuaW1wb3J0IHsgVXBkYXRlT24gfSBmcm9tIFwiLi4vLi4vLi4vZm9ybS1ydWxlcy9tb2RlbHMvdXBkYXRlLW9uXCI7XHJcbi8vIHRzbGludDplbmFibGU6bWF4LWxpbmUtbGVuZ3RoXHJcblxyXG4vKipcclxuICogQnVpbGRzIHJlYWN0aXZlIGZvcm1zIHVzaW5nIGNvbmZpZ3VyZWQgbW9kZWwgc2V0dGluZ3NcclxuICovXHJcbkBJbmplY3RhYmxlKClcclxuZXhwb3J0IGNsYXNzIFJlYWN0aXZlRm9ybXNSdWxlU2VydmljZSB7XHJcbiAgICBwcml2YXRlIHN0YXRpYyByZWFkb25seSBGT1JNX01PREVMX1NFVFRJTkdTX1BST1BFUlRZX05BTUUgPSAnbmdGb3JtUnVsZXNNb2RlbFNldHRpbmcnO1xyXG4gICAgcHJpdmF0ZSBzdGF0aWMgcmVhZG9ubHkgRk9SQ0VfQVNZTkNfVkFMSURfVEVTVF9SVU5fUFJPUEVSVFlfTkFNRSA9ICduZ0Zvcm1SdWxlc0ZvcmNlQXN5bmNWYWxpZFRlc3RSdW4nO1xyXG4gICAgcHJpdmF0ZSBzdGF0aWMgcmVhZG9ubHkgQ09OVFJPTF9MQVNUX0VSUk9SID0gJ25nRm9ybVJ1bGVzQ29udHJvbExhc3RFcnJvcic7XHJcblxyXG4gICAgY29uc3RydWN0b3IoXHJcbiAgICAgICAgcHJpdmF0ZSBydWxlc0VuZ2luZVN2YzogUnVsZXNFbmdpbmVTZXJ2aWNlLFxyXG4gICAgICAgIHByaXZhdGUgZm9ybUJ1aWxkZXI6IEZvcm1CdWlsZGVyLFxyXG4gICAgICAgIHByaXZhdGUgdHJhY2VTdmM6IFRyYWNlU2VydmljZSxcclxuICAgICAgICBwcml2YXRlIGNvbW1vblN2YzogQ29tbW9uU2VydmljZVxyXG4gICAgKSB7XHJcbiAgICB9XHJcblxyXG4gICAgLyoqXHJcbiAgICAgKiBHZXRzIG1vZGVsIHNldHRpbmdzIHdpdGggdGhlIHByb3ZpZGVkIG5hbWVcclxuICAgICAqIEBwYXJhbSBuYW1lIE5hbWUgb2YgbW9kZWwgc2V0dGluZ1xyXG4gICAgICogQHJldHVybnMgTW9kZWwgc2V0dGluZ3Mgd2l0aCB0aGUgcHJvdmlkZWQgbmFtZVxyXG4gICAgICovXHJcbiAgICBnZXRNb2RlbFNldHRpbmdzPFQ+KG5hbWU6IHN0cmluZyk6IEFic3RyYWN0TW9kZWxTZXR0aW5nczxUPiB7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMucnVsZXNFbmdpbmVTdmMuZ2V0TW9kZWxTZXR0aW5ncyhuYW1lKTtcclxuICAgIH1cclxuXHJcbiAgICAvKipcclxuICAgICAqIENyZWF0ZXMgYSBmb3JtIGdyb3VwIHVzaW5nIGFuIGluc3RhbmNlIG9mIG1vZGVsIHNldHRpbmdzXHJcbiAgICAgKiBAcGFyYW0gbW9kZWxTZXR0aW5ncyBOYW1lIG9mIHRoZSBtb2RlbCBzZXR0aW5nIG9yIGFuIGluc3RhbmNlIG9mIG1vZGVsIHNldHRpbmdzIHRvIHVzZVxyXG4gICAgICogQHBhcmFtIGluaXRpYWxWYWx1ZSBJbml0aWFsIGRhdGEgdG8gc2V0IHRoZSBmb3JtIHZhbHVlcyB0b1xyXG4gICAgICogQHJldHVybnMgRm9ybSBncm91cCBjcmVhdGVkIGFjY29yZGluZyB0byBkZWZpbmVkIG1vZGVsIHNldHRpbmdzXHJcbiAgICAgKi9cclxuICAgIGNyZWF0ZUZvcm1Hcm91cDxUPihcclxuICAgICAgICBtb2RlbFNldHRpbmdzOiBzdHJpbmcgfCBBYnN0cmFjdE1vZGVsU2V0dGluZ3M8VD4sXHJcbiAgICAgICAgaW5pdGlhbFZhbHVlPzogYW55XHJcbiAgICApOiBGb3JtR3JvdXAge1xyXG4gICAgICAgIGxldCBzZXR0aW5nczogQWJzdHJhY3RNb2RlbFNldHRpbmdzPFQ+O1xyXG5cclxuICAgICAgICBpZiAodHlwZW9mIG1vZGVsU2V0dGluZ3MgPT09IFwic3RyaW5nXCIpIHtcclxuICAgICAgICAgICAgc2V0dGluZ3MgPSB0aGlzLnJ1bGVzRW5naW5lU3ZjLmdldE1vZGVsU2V0dGluZ3MobW9kZWxTZXR0aW5ncyBhcyBzdHJpbmcpO1xyXG4gICAgICAgICAgICBpZiAoIXNldHRpbmdzKSB0aHJvdyBuZXcgRXJyb3IoYE5vIG1vZGVsIHNldHRpbmcgZm91bmQgd2l0aCB0aGUgbmFtZSBcIiR7bW9kZWxTZXR0aW5nc31cImApO1xyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgIGlmICghbW9kZWxTZXR0aW5ncykgdGhyb3cgbmV3IEVycm9yKGBBZGhvYyBtb2RlbCBzZXR0aW5nIHByb3ZpZGVkIGlzIGludmFsaWRgKTtcclxuICAgICAgICAgICAgc2V0dGluZ3MgPSBtb2RlbFNldHRpbmdzIGFzIEFic3RyYWN0TW9kZWxTZXR0aW5nczxUPjtcclxuICAgICAgICAgICAgdGhpcy5ydWxlc0VuZ2luZVN2Yy5pbml0aWFsaXplTW9kZWxTZXR0aW5nKHNldHRpbmdzKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHRoaXMudHJhY2VTdmMudHJhY2UoYENyZWF0aW5nIGZvcm0gZ3JvdXAgdXNpbmcgbW9kZWwgc2V0dGluZ3MgXCIke3NldHRpbmdzLm5hbWV9XCJgKTtcclxuICAgICAgICBjb25zdCBmb3JtR3JvdXAgPSB0aGlzLmJ1aWxkR3JvdXAoc2V0dGluZ3MucHJvcGVydGllcywgaW5pdGlhbFZhbHVlKTtcclxuXHJcbiAgICAgICAgdGhpcy50cmFjZVN2Yy50cmFjZShgU2V0dGluZyB1cCBkZXBlbmRlbmN5IHN1YnNjcmlwdGlvbnNgKTtcclxuICAgICAgICB0aGlzLnJlc2V0RGVwZW5kZW5jeVN1YnNjcmlwdGlvbnMoZm9ybUdyb3VwLCBzZXR0aW5ncy5wcm9wZXJ0aWVzKTtcclxuXHJcbiAgICAgICAgdGhpcy50cmFjZVN2Yy50cmFjZShgUGF0Y2hpbmcgZm9ybSBncm91cCB3aXRoIGluaXRpYWwgdmFsdWVgKTtcclxuICAgICAgICB0aGlzLnRyaWdnZXJWYWx1ZUNoYW5nZShmb3JtR3JvdXApO1xyXG5cclxuICAgICAgICB0aGlzLnRyYWNlU3ZjLnRyYWNlKGBBdHRhY2hpbmcgbW9kZWwgc2V0dGluZ3MgdG8gZm9ybWApO1xyXG4gICAgICAgIHRoaXMuYXR0YWNoTW9kZWxTZXR0aW5nc1RvRm9ybShmb3JtR3JvdXAsIHNldHRpbmdzKTtcclxuXHJcbiAgICAgICAgcmV0dXJuIGZvcm1Hcm91cDtcclxuICAgIH1cclxuXHJcbiAgICAvKipcclxuICAgICAqIEFkZHMgYW4gYXJyYXkgaXRlbSBwcm9wZXJ0eSB0byBhbiBleGlzdGluZyBmb3JtIGFycmF5XHJcbiAgICAgKiBAcGFyYW0gcHJvcGVydHkgQXJyYXlJdGVtUHJvcGVydHkgdG8gZm9yIHRoZSBhcnJheSBpdGVtIHRvIGJlIGFkZGVkXHJcbiAgICAgKiBAcGFyYW0gcGFyZW50Rm9ybUFycmF5IFRoZSBwYXJlbnQgRm9ybUFycmF5XHJcbiAgICAgKiBAcGFyYW0gaW5pdGlhbFZhbHVlIEluaXRpYWwgdmFsdWUgb2YgdGhlIGZvcm0gYXJyYXkgaXRlbVxyXG4gICAgICogQHBhcmFtIG9wdGlvbnMgT3B0aW9ucyBmb3IgYWRkaW5nIG5ldyBhcnJheSBpdGVtIHByb3BlcnR5XHJcbiAgICAgKi9cclxuICAgIGFkZEFycmF5SXRlbVByb3BlcnR5Q29udHJvbDxUPihcclxuICAgICAgICBwcm9wZXJ0eTogQXJyYXlJdGVtUHJvcGVydHk8VD4sXHJcbiAgICAgICAgcGFyZW50Rm9ybUFycmF5OiBGb3JtQXJyYXksXHJcbiAgICAgICAgaW5pdGlhbFZhbHVlPzogYW55LFxyXG4gICAgICAgIG9wdGlvbnM/OiBBZGRBcnJheUl0ZW1Qcm9wZXJ0eU9wdGlvbnNcclxuICAgICk6IHZvaWQge1xyXG4gICAgICAgIGNvbnN0IGNvbnRyb2wgPSB0aGlzLmJ1aWxkQWJzdHJhY3RDb250cm9sKHByb3BlcnR5LCBpbml0aWFsVmFsdWUpO1xyXG4gICAgICAgIGNvbnN0IHdpbGxCZUxhc3RJdGVtID0gIW9wdGlvbnMgfHwgIXRoaXMuY29tbW9uU3ZjLmlzWmVyb09yR3JlYXRlcihvcHRpb25zLmluZGV4KSB8fCBvcHRpb25zLmluZGV4ID49IHBhcmVudEZvcm1BcnJheS5sZW5ndGg7XHJcblxyXG4gICAgICAgIGlmICh3aWxsQmVMYXN0SXRlbSlcclxuICAgICAgICAgICAgcGFyZW50Rm9ybUFycmF5LnB1c2goY29udHJvbCk7XHJcbiAgICAgICAgZWxzZVxyXG4gICAgICAgICAgICBwYXJlbnRGb3JtQXJyYXkuaW5zZXJ0KG9wdGlvbnMuaW5kZXgsIGNvbnRyb2wpO1xyXG5cclxuICAgICAgICBjb25zdCBtb2RlbFNldHRpbmdzID0gdGhpcy5nZXRNb2RlbFNldHRpbmdzRnJvbUZvcm0ocGFyZW50Rm9ybUFycmF5LnJvb3QgYXMgRm9ybUdyb3VwKTtcclxuICAgICAgICB0aGlzLnJlc2V0RGVwZW5kZW5jeVN1YnNjcmlwdGlvbnMocGFyZW50Rm9ybUFycmF5LnJvb3QsIG1vZGVsU2V0dGluZ3MucHJvcGVydGllcyk7XHJcblxyXG4gICAgICAgIC8vIHdlIG5lZWQgdG8gZG8gdGhpcyBiZWNhdXNlIHRoZSBpdGVtIGNvdWxkIGhhdmUgYmVlbiBhZGRlZCBhdCBhbnkgaW5kZXggaW4gdGhlIGFycmF5LCBhbmQgd2UgbmVlZFxyXG4gICAgICAgIC8vIHRyaWdnZXIgYSB2YWx1ZSBjaGFuZ2UgdG8gdHJpZ2dlciBhbnkgZGVwZW5kZW5jeSBwcm9wZXJ0aXkgdmFsZGlkYXRpb25zXHJcbiAgICAgICAgdGhpcy50cmlnZ2VyVmFsdWVDaGFuZ2UocGFyZW50Rm9ybUFycmF5KTtcclxuICAgIH1cclxuXHJcbiAgICAvKipcclxuICAgICAqIEV4dGVuZHMgdmFsaWRhdG9ycyBnZW5lcmF0ZWQgYnkgbmctZm9ybS1ydWxlcyB3aXRoIHlvdXIgb3duIHZhbGlkYXRvcnNcclxuICAgICAqIEBwYXJhbSBjb250cm9sIENvbnRyb2wgdG8gZXh0ZW5kcyB0aGUgdmFsaWRhdG9ycyBmb3JcclxuICAgICAqIEBwYXJhbSB2YWxpZGF0b3IgVmFsaWRhdG9yIHRvIGFkZFxyXG4gICAgICovXHJcbiAgICBleHRlbmRWYWxpZGF0b3IoY29udHJvbDogQWJzdHJhY3RDb250cm9sLCB2YWxpZGF0b3I6IFZhbGlkYXRvckZuIHwgVmFsaWRhdG9yRm5bXSk6IHZvaWQge1xyXG4gICAgICAgIGlmICghdmFsaWRhdG9yKSByZXR1cm47XHJcblxyXG4gICAgICAgIGNvbnN0IHZhbGlkYXRvckFycmF5ID0gQXJyYXkuaXNBcnJheSh2YWxpZGF0b3IpID8gdmFsaWRhdG9yIDogW3ZhbGlkYXRvcl07XHJcbiAgICAgICAgY29udHJvbC5zZXRWYWxpZGF0b3JzKFtjb250cm9sLnZhbGlkYXRvciwgLi4udmFsaWRhdG9yQXJyYXldXHJcbiAgICAgICAgICAgIC5maWx0ZXIodmFsaWRhdG9yRm4gPT4gISF2YWxpZGF0b3JGbikpO1xyXG4gICAgfVxyXG5cclxuICAgIC8qKlxyXG4gICAgICogRXh0ZW5kcyBhc3luYyB2YWxpZGF0b3JzIGdlbmVyYXRlZCBieSBuZy1mb3JtLXJ1bGVzIHdpdGggeW91ciBvd24gYXN5bmMgdmFsaWRhdG9yc1xyXG4gICAgICogQHBhcmFtIGNvbnRyb2wgQ29udHJvbCB0byBleHRlbmRzIHRoZSBhc3luYyB2YWxpZGF0b3JzIGZvclxyXG4gICAgICogQHBhcmFtIGFzeW5jVmFsaWRhdG9yIEFzeW5jIHZhbGlkYXRvciB0byBhZGRcclxuICAgICAqL1xyXG4gICAgZXh0ZW5kQXN5bmNWYWxpZGF0b3IoY29udHJvbDogQWJzdHJhY3RDb250cm9sLCBhc3luY1ZhbGlkYXRvcjogQXN5bmNWYWxpZGF0b3JGbiB8IEFzeW5jVmFsaWRhdG9yRm5bXSk6IHZvaWQge1xyXG4gICAgICAgIGlmICghYXN5bmNWYWxpZGF0b3IpIHJldHVybjtcclxuXHJcbiAgICAgICAgY29uc3QgYXN5bmNWYWxpZGF0b3JBcnJheSA9IEFycmF5LmlzQXJyYXkoYXN5bmNWYWxpZGF0b3IpID8gYXN5bmNWYWxpZGF0b3IgOiBbYXN5bmNWYWxpZGF0b3JdO1xyXG4gICAgICAgIGNvbnRyb2wuc2V0QXN5bmNWYWxpZGF0b3JzKFtjb250cm9sLmFzeW5jVmFsaWRhdG9yLCAuLi5hc3luY1ZhbGlkYXRvckFycmF5XVxyXG4gICAgICAgICAgICAuZmlsdGVyKGFzeW5jVmFsaWRhdG9yRm4gPT4gISFhc3luY1ZhbGlkYXRvckZuKSk7XHJcbiAgICB9XHJcblxyXG4gICAgcHJpdmF0ZSBidWlsZEFic3RyYWN0Q29udHJvbDxUPihwcm9wZXJ0eTogUHJvcGVydHlCYXNlPFQ+LCBpbml0aWFsVmFsdWU/OiBhbnkpOiBBYnN0cmFjdENvbnRyb2wge1xyXG4gICAgICAgIGxldCBjb250cm9sOiBBYnN0cmFjdENvbnRyb2w7XHJcblxyXG4gICAgICAgIGlmIChwcm9wZXJ0eS5hcnJheUl0ZW1Qcm9wZXJ0eSkgY29udHJvbCA9IHRoaXMuYnVpbGRBcnJheShwcm9wZXJ0eS5hcnJheUl0ZW1Qcm9wZXJ0eSwgaW5pdGlhbFZhbHVlLCBwcm9wZXJ0eS51cGRhdGVPbik7XHJcbiAgICAgICAgZWxzZSBpZiAocHJvcGVydHkucHJvcGVydGllcykgY29udHJvbCA9IHRoaXMuYnVpbGRHcm91cChwcm9wZXJ0eS5wcm9wZXJ0aWVzLCBpbml0aWFsVmFsdWUsIHByb3BlcnR5LnVwZGF0ZU9uKTtcclxuICAgICAgICBlbHNlIGNvbnRyb2wgPSB0aGlzLmJ1aWxkQ29udHJvbChpbml0aWFsVmFsdWUsIHByb3BlcnR5LnVwZGF0ZU9uKTtcclxuXHJcbiAgICAgICAgLy8gc2V0dXAgdmFsaWRhdGlvbiB0ZXN0cyBvbiB2YWx1ZSBjaGFuZ2VcclxuICAgICAgICBjb250cm9sLnNldFZhbGlkYXRvcnModGhpcy5idWlsZFZhbGlkYXRvckZ1bmN0aW9uKHByb3BlcnR5KSk7XHJcbiAgICAgICAgY29udHJvbC5zZXRBc3luY1ZhbGlkYXRvcnModGhpcy5idWlsZEFzeW5jVmFsaWRhdG9yRnVuY3Rpb24ocHJvcGVydHkpKTtcclxuXHJcbiAgICAgICAgLy8gc2V0dXAgZWRpdCB0ZXN0cyBvbiB2YWx1ZSBjaGFuZ2VcclxuICAgICAgICBjb250cm9sLnZhbHVlQ2hhbmdlc1xyXG4gICAgICAgICAgICAucGlwZShcclxuICAgICAgICAgICAgICAgIHRoaXMuYXBwbHlWYWx1ZUNoYW5nZU9wdGlvbnMocHJvcGVydHkudmFsdWVDaGFuZ2VPcHRpb25zLnNlbGYuZWRpdClcclxuICAgICAgICAgICAgKVxyXG4gICAgICAgICAgICAuc3Vic2NyaWJlKHZhbHVlID0+IHtcclxuICAgICAgICAgICAgICAgIHRoaXMucGVyc2lzdEVkaXRUZXN0cyhjb250cm9sLCBwcm9wZXJ0eSk7XHJcbiAgICAgICAgICAgIH0pO1xyXG5cclxuICAgICAgICByZXR1cm4gY29udHJvbDtcclxuICAgIH1cclxuXHJcbiAgICBwcml2YXRlIGJ1aWxkQ29udHJvbDxUPihpbml0aWFsVmFsdWU6IGFueSwgdXBkYXRlT24/OiBVcGRhdGVPbik6IEZvcm1Db250cm9sIHtcclxuICAgICAgICByZXR1cm4gbmV3IEZvcm1Db250cm9sKGluaXRpYWxWYWx1ZSwgeyB1cGRhdGVPbjogdXBkYXRlT24gfSk7XHJcbiAgICB9XHJcblxyXG4gICAgcHJpdmF0ZSBidWlsZEdyb3VwPFQ+KHByb3BlcnRpZXM6IFByb3BlcnR5PFQ+W10sIGluaXRpYWxWYWx1ZTogYW55LCB1cGRhdGVPbj86IFVwZGF0ZU9uKTogRm9ybUdyb3VwIHtcclxuICAgICAgICBjb25zdCBmb3JtR3JvdXAgPSBuZXcgRm9ybUdyb3VwKHt9LCB7IHVwZGF0ZU9uOiB1cGRhdGVPbiB9KTtcclxuXHJcbiAgICAgICAgKHByb3BlcnRpZXMgfHwgW10pLmZvckVhY2gocCA9PiB7XHJcbiAgICAgICAgICAgIGNvbnN0IHByb3BlcnR5VmFsdWUgPSBpbml0aWFsVmFsdWUgPyBpbml0aWFsVmFsdWVbcC5uYW1lXSA6IG51bGw7XHJcbiAgICAgICAgICAgIGNvbnN0IGN0cmwgPSB0aGlzLmJ1aWxkQWJzdHJhY3RDb250cm9sKHAsIHByb3BlcnR5VmFsdWUpO1xyXG4gICAgICAgICAgICBmb3JtR3JvdXAuYWRkQ29udHJvbChwLm5hbWUsIGN0cmwpO1xyXG4gICAgICAgIH0pO1xyXG5cclxuICAgICAgICByZXR1cm4gZm9ybUdyb3VwO1xyXG4gICAgfVxyXG5cclxuICAgIHByaXZhdGUgYnVpbGRBcnJheTxUPihwcm9wZXJ0eTogQXJyYXlJdGVtUHJvcGVydHk8VD4sIGluaXRpYWxWYWx1ZTogYW55W10sIHVwZGF0ZU9uPzogVXBkYXRlT24pOiBGb3JtQXJyYXkge1xyXG4gICAgICAgIGluaXRpYWxWYWx1ZSA9IEFycmF5LmlzQXJyYXkoaW5pdGlhbFZhbHVlKSA/IGluaXRpYWxWYWx1ZSA6IFtdO1xyXG5cclxuICAgICAgICByZXR1cm4gbmV3IEZvcm1BcnJheShcclxuICAgICAgICAgICAgaW5pdGlhbFZhbHVlLm1hcCh2ID0+IHRoaXMuYnVpbGRBYnN0cmFjdENvbnRyb2wocHJvcGVydHksIHYpKSxcclxuICAgICAgICAgICAgeyB1cGRhdGVPbjogdXBkYXRlT24gfVxyXG4gICAgICAgICk7XHJcbiAgICB9XHJcblxyXG4gICAgcHJpdmF0ZSBidWlsZFZhbGlkYXRvckZ1bmN0aW9uPFQ+KHByb3BlcnR5OiBQcm9wZXJ0eUJhc2U8VD4pOiBWYWxpZGF0b3JGbiB7XHJcbiAgICAgICAgY29uc3Qgc3luY0dyb3VwcyA9IHRoaXMucnVsZXNFbmdpbmVTdmMuZ3JvdXBUZXN0c0J5U3luY1R5cGUocHJvcGVydHkudmFsaWQpO1xyXG4gICAgICAgIGlmICghc3luY0dyb3Vwcy5zeW5jLmxlbmd0aCkgcmV0dXJuIG51bGw7XHJcblxyXG4gICAgICAgIHJldHVybiAoY29udHJvbDogQWJzdHJhY3RDb250cm9sKTogVmFsaWRhdGlvbkVycm9ycyA9PiB7XHJcbiAgICAgICAgICAgIGNvbnN0IGNvbnRyb2xDb250ZXh0VmFsdWVzID0gdGhpcy5nZXRDb250cm9sQ29udGV4dFZhbHVlcyhjb250cm9sLCBwcm9wZXJ0eSk7XHJcblxyXG4gICAgICAgICAgICBjb25zdCB0ZXN0UmVzdWx0cyA9IHRoaXMucnVsZXNFbmdpbmVTdmNcclxuICAgICAgICAgICAgICAgIC5ydW5UZXN0cyhjb250cm9sQ29udGV4dFZhbHVlcy5yZWxhdGl2ZSwgc3luY0dyb3Vwcy5zeW5jLCB7XHJcbiAgICAgICAgICAgICAgICAgICAgcm9vdERhdGE6IGNvbnRyb2xDb250ZXh0VmFsdWVzLnJvb3QsXHJcbiAgICAgICAgICAgICAgICAgICAgY29udHJvbFN0YXRlOiBDb250cm9sU3RhdGUuY3JlYXRlKGNvbnRyb2wpXHJcbiAgICAgICAgICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgICAgIGlmICh0ZXN0UmVzdWx0cy5yZXN1bHRzLmxlbmd0aCkge1xyXG4gICAgICAgICAgICAgICAgdGhpcy50cmFjZVN2Yy50cmFjZShgVmFsaWRhdGVkIHByb3BlcnR5IFwiJHtwcm9wZXJ0eS5hYnNvbHV0ZVBhdGh9XCIuIGAgK1xyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMuYnVpbGRUZXN0UmVzdWx0U3RhdHNTdHJpbmcodGVzdFJlc3VsdHMpKTtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgcmV0dXJuIHRoaXMubWFwVG9SZWFjdGl2ZUZvcm1zVmFsaWRhdGlvbkVycm9ycyh0ZXN0UmVzdWx0cyk7XHJcbiAgICAgICAgfTtcclxuICAgIH1cclxuXHJcbiAgICBwcml2YXRlIGJ1aWxkQXN5bmNWYWxpZGF0b3JGdW5jdGlvbjxUPihwcm9wZXJ0eTogUHJvcGVydHlCYXNlPFQ+KTogQXN5bmNWYWxpZGF0b3JGbiB7XHJcbiAgICAgICAgY29uc3QgcmF3QXN5bmNGdW5jID0gdGhpcy5idWlsZEFzeW5jVmFsaWRhdG9yRnVuY3Rpb25SYXcocHJvcGVydHkpO1xyXG5cclxuICAgICAgICBpZiAoIXJhd0FzeW5jRnVuYykgcmV0dXJuIG51bGw7XHJcblxyXG4gICAgICAgIGNvbnN0IHZhbHVlcyA9IG5ldyBCZWhhdmlvclN1YmplY3Q8QWJzdHJhY3RDb250cm9sPihudWxsKTtcclxuICAgICAgICBjb25zdCB2YWxpZCQgPSB2YWx1ZXMucGlwZShcclxuICAgICAgICAgICAgdGhpcy5hcHBseUFzeW5jVmFsaWRWYWx1ZUNoYW5nZU9wdGlvbnMocHJvcGVydHkudmFsdWVDaGFuZ2VPcHRpb25zLnNlbGYuYXN5bmNWYWxpZCksXHJcbiAgICAgICAgICAgIHN3aXRjaE1hcCh4ID0+IHtcclxuICAgICAgICAgICAgICAgIC8vIHBhc3MgdGhyb3VnaCBtZWFucyB3ZSBkaWQgbm90IGV4ZWN1dGUgdGhlIG5nLWZvcm0tcnVsZXMgYXN5bmMgdGVzdHNcclxuICAgICAgICAgICAgICAgIGlmICh4LnBhc3N0aHJvdWdoKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgY29uc3QgY3VycmVudEVycm9ycyA9IHguY29udHJvbC5lcnJvcnMgfHwge307XHJcbiAgICAgICAgICAgICAgICAgICAgY29uc3QgbGFzdE5nRm9ybVJ1bGVzRXJyb3JzID0gdGhpcy5nZXRMYXN0RXJyb3JGb3JDb250cm9sKHguY29udHJvbCk7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIC8vIHJldHVybiB0aGUgbGFzdCBuZy1mb3JtLXJ1bGVzIGVycm9ycyAoaWYgYW55KSBhbG9uZ3NpZGUgbm9uIG5nLWZvcm0tcnVsZXMgZXJyb3JzLlxyXG4gICAgICAgICAgICAgICAgICAgIC8vIHRoaXMgaGFuZGxlcyBzY2VuYXJpbyB3aGVyZSBkZWJvdW5jZSBhbmQgZGlzdGluY3QgYXJlIHVzZWQgYW5kIHN0YXRlIGdvZXMgZnJvbTpcclxuICAgICAgICAgICAgICAgICAgICAvLyAgICBpbnZhbGlkIC0+IG1ha2UgY2hhbmdlcyBhbmQgYmFjayB0aGVtIG91dCAtPiB2YWxpZFxyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBvZihPYmplY3QuYXNzaWduKGN1cnJlbnRFcnJvcnMsIHsgbmdGb3JtUnVsZXM6IGxhc3ROZ0Zvcm1SdWxlc0Vycm9ycyB9IGFzIFJlYWN0aXZlRm9ybXNWYWxpZGF0aW9uRXJyb3JzKSk7XHJcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiByYXdBc3luY0Z1bmMoeC5jb250cm9sKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfSksXHJcbiAgICAgICAgICAgIHRha2UoMSlcclxuICAgICAgICApO1xyXG5cclxuICAgICAgICByZXR1cm4gKGNvbnRyb2w6IEFic3RyYWN0Q29udHJvbCk6IFByb21pc2U8VmFsaWRhdGlvbkVycm9ycz4gfCBPYnNlcnZhYmxlPFZhbGlkYXRpb25FcnJvcnM+ID0+IHtcclxuICAgICAgICAgICAgdmFsdWVzLm5leHQoY29udHJvbCk7XHJcbiAgICAgICAgICAgIHJldHVybiB2YWxpZCQ7XHJcbiAgICAgICAgfTtcclxuICAgIH1cclxuXHJcbiAgICBwcml2YXRlIGJ1aWxkQXN5bmNWYWxpZGF0b3JGdW5jdGlvblJhdzxUPihwcm9wZXJ0eTogUHJvcGVydHlCYXNlPFQ+KTogQXN5bmNWYWxpZGF0b3JGbiB7XHJcbiAgICAgICAgY29uc3Qgc3luY0dyb3VwcyA9IHRoaXMucnVsZXNFbmdpbmVTdmMuZ3JvdXBUZXN0c0J5U3luY1R5cGUocHJvcGVydHkudmFsaWQpO1xyXG4gICAgICAgIGlmICghc3luY0dyb3Vwcy5hc3luYy5sZW5ndGgpIHJldHVybiBudWxsO1xyXG5cclxuICAgICAgICByZXR1cm4gKGNvbnRyb2w6IEFic3RyYWN0Q29udHJvbCkgPT4ge1xyXG4gICAgICAgICAgICBjb25zdCBjb250cm9sQ29udGV4dFZhbHVlcyA9IHRoaXMuZ2V0Q29udHJvbENvbnRleHRWYWx1ZXMoY29udHJvbCwgcHJvcGVydHkpO1xyXG5cclxuICAgICAgICAgICAgcmV0dXJuIHRoaXMucnVsZXNFbmdpbmVTdmMucnVuVGVzdHNBc3luYyhjb250cm9sQ29udGV4dFZhbHVlcy5yZWxhdGl2ZSwgc3luY0dyb3Vwcy5hc3luYywge1xyXG4gICAgICAgICAgICAgICAgcm9vdERhdGE6IGNvbnRyb2xDb250ZXh0VmFsdWVzLnJvb3QsXHJcbiAgICAgICAgICAgICAgICBjb250cm9sU3RhdGU6IENvbnRyb2xTdGF0ZS5jcmVhdGUoY29udHJvbClcclxuICAgICAgICAgICAgfSkucGlwZShcclxuICAgICAgICAgICAgICAgIHRhcCh0ZXN0UmVzdWx0cyA9PiB7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKHRlc3RSZXN1bHRzLnJlc3VsdHMubGVuZ3RoKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMudHJhY2VTdmMudHJhY2UoYFZhbGlkYXRlZCAoYXN5bmMpIHByb3BlcnR5IFwiJHtwcm9wZXJ0eS5hYnNvbHV0ZVBhdGh9XCIuIGAgK1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5idWlsZFRlc3RSZXN1bHRTdGF0c1N0cmluZyh0ZXN0UmVzdWx0cykpO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH0pLFxyXG4gICAgICAgICAgICAgICAgbWFwKHRoaXMubWFwVG9SZWFjdGl2ZUZvcm1zVmFsaWRhdGlvbkVycm9ycyksXHJcbiAgICAgICAgICAgICAgICB0YXAoeCA9PiB0aGlzLnNldExhc3RFcnJvckZvckNvbnRyb2woY29udHJvbCwgKHggfHwge30pLm5nRm9ybVJ1bGVzKSlcclxuICAgICAgICAgICAgKTtcclxuICAgICAgICB9O1xyXG4gICAgfVxyXG5cclxuICAgIHByaXZhdGUgcmVzZXREZXBlbmRlbmN5U3Vic2NyaXB0aW9uczxUPihcclxuICAgICAgICBwYXJlbnRDb250cm9sOiBBYnN0cmFjdENvbnRyb2wsXHJcbiAgICAgICAgcHJvcGVydGllczogUHJvcGVydHlCYXNlPFQ+W10sXHJcbiAgICApOiB2b2lkIHtcclxuICAgICAgICB0aGlzLnJlbW92ZURlcGVuZGVuY3lTdWJzY3JpcHRpb25zKHByb3BlcnRpZXMpO1xyXG4gICAgICAgIHRoaXMuYWRkRGVwZW5kZW5jeVN1YnNjcmlwdGlvbnMocGFyZW50Q29udHJvbCwgcHJvcGVydGllcyk7XHJcbiAgICB9XHJcblxyXG4gICAgcHJpdmF0ZSByZW1vdmVEZXBlbmRlbmN5U3Vic2NyaXB0aW9uczxUPihcclxuICAgICAgICBwcm9wZXJ0aWVzOiBQcm9wZXJ0eUJhc2U8VD5bXVxyXG4gICAgKTogdm9pZCB7XHJcbiAgICAgICAgKHByb3BlcnRpZXMgfHwgW10pLmZvckVhY2gocHJvcGVydHkgPT4ge1xyXG4gICAgICAgICAgICBwcm9wZXJ0eS5jbGVhckRlcGVuZGVuY3lQcm9wZXJ0eVN1YnNjcmlwdGlvbnMoKTtcclxuXHJcbiAgICAgICAgICAgIGlmIChwcm9wZXJ0eS5wcm9wZXJ0aWVzKSB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLnJlbW92ZURlcGVuZGVuY3lTdWJzY3JpcHRpb25zKHByb3BlcnR5LnByb3BlcnRpZXMpO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICBpZiAocHJvcGVydHkuYXJyYXlJdGVtUHJvcGVydHkpIHtcclxuICAgICAgICAgICAgICAgIHRoaXMucmVtb3ZlRGVwZW5kZW5jeVN1YnNjcmlwdGlvbnMoW3Byb3BlcnR5LmFycmF5SXRlbVByb3BlcnR5XSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9KTtcclxuICAgIH1cclxuXHJcbiAgICBwcml2YXRlIGFkZERlcGVuZGVuY3lTdWJzY3JpcHRpb25zPFQ+KFxyXG4gICAgICAgIHBhcmVudENvbnRyb2w6IEFic3RyYWN0Q29udHJvbCxcclxuICAgICAgICBwcm9wZXJ0aWVzOiBQcm9wZXJ0eUJhc2U8VD5bXSxcclxuICAgICAgICBhcnJheUluZGV4PzogbnVtYmVyXHJcbiAgICApOiB2b2lkIHtcclxuICAgICAgICAocHJvcGVydGllcyB8fCBbXSkuZm9yRWFjaChwcm9wZXJ0eSA9PiB7XHJcbiAgICAgICAgICAgIGNvbnN0IHByb3BlcnR5Q29udHJvbCA9IHRoaXMuZ2V0UHJvcGVydHlGcm9tUGFyZW50KHBhcmVudENvbnRyb2wsIHByb3BlcnR5LCBhcnJheUluZGV4KTtcclxuICAgICAgICAgICAgaWYgKCFwcm9wZXJ0eUNvbnRyb2wpIHJldHVybjtcclxuXHJcbiAgICAgICAgICAgIHRoaXMuc2V0dXBFZGl0YWJpbGl0eURlcGVuZGVuY3lTdWJzY3JpcHRpb25zKHByb3BlcnR5Q29udHJvbCwgcGFyZW50Q29udHJvbCwgcHJvcGVydHkpO1xyXG4gICAgICAgICAgICB0aGlzLnNldHVwVmFsaWRhdGlvbkRlcGVuZGVuY3lTdWJzY3JpcHRpb25zKHByb3BlcnR5Q29udHJvbCwgcGFyZW50Q29udHJvbCwgcHJvcGVydHkpO1xyXG5cclxuICAgICAgICAgICAgaWYgKHByb3BlcnR5LnByb3BlcnRpZXMpIHtcclxuICAgICAgICAgICAgICAgIHRoaXMuYWRkRGVwZW5kZW5jeVN1YnNjcmlwdGlvbnMocHJvcGVydHlDb250cm9sLCBwcm9wZXJ0eS5wcm9wZXJ0aWVzKTtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgaWYgKHByb3BlcnR5LmFycmF5SXRlbVByb3BlcnR5KSB7XHJcbiAgICAgICAgICAgICAgICAvLyBpZiB0aGVyZSBpcyBhbiBhcnJheUl0ZW1Qcm9wZXJ0eSB3ZSBrbm93IHRoYXQgd2UgYXJlIHdvcmtpbmcgd2l0aCBhIEZvcm1BcnJheSBjb250cm9sXHJcbiAgICAgICAgICAgICAgICBjb25zdCBmb3JtQXJyYXlDb250cm9sID0gKHByb3BlcnR5Q29udHJvbCBhcyBGb3JtQXJyYXkpO1xyXG4gICAgICAgICAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBmb3JtQXJyYXlDb250cm9sLmxlbmd0aDsgaSsrKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5hZGREZXBlbmRlbmN5U3Vic2NyaXB0aW9ucyhmb3JtQXJyYXlDb250cm9sLCBbcHJvcGVydHkuYXJyYXlJdGVtUHJvcGVydHldLCBpKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH0pO1xyXG4gICAgfVxyXG5cclxuICAgIHByaXZhdGUgc2V0dXBWYWxpZGF0aW9uRGVwZW5kZW5jeVN1YnNjcmlwdGlvbnM8VD4oXHJcbiAgICAgICAgcHJvcGVydHlDb250cm9sOiBBYnN0cmFjdENvbnRyb2wsIHBhcmVudENvbnRyb2w6IEFic3RyYWN0Q29udHJvbCwgcHJvcGVydHk6IFByb3BlcnR5QmFzZTxUPlxyXG4gICAgKTogdm9pZCB7XHJcbiAgICAgICAgY29uc3QgZGVwZW5kZW5jeVByb3BOYW1lcyA9IHRoaXMucnVsZXNFbmdpbmVTdmMuZ2V0RGVwZW5kZW5jeVByb3BlcnRpZXMocHJvcGVydHkudmFsaWQpO1xyXG5cclxuICAgICAgICBkZXBlbmRlbmN5UHJvcE5hbWVzLmZvckVhY2goZCA9PiB7XHJcbiAgICAgICAgICAgIGNvbnN0IGRlcGVuZGVuY3lDb250cm9sID0gdGhpcy5maW5kQ29udHJvbFJlbGF0aXZlbHkocGFyZW50Q29udHJvbCwgZCk7XHJcblxyXG4gICAgICAgICAgICBpZiAoIWRlcGVuZGVuY3lDb250cm9sKSByZXR1cm47XHJcblxyXG4gICAgICAgICAgICBjb25zdCBzdWIkID0gZGVwZW5kZW5jeUNvbnRyb2wudmFsdWVDaGFuZ2VzXHJcbiAgICAgICAgICAgICAgICAucGlwZShcclxuICAgICAgICAgICAgICAgICAgICB0aGlzLmFwcGx5VmFsdWVDaGFuZ2VPcHRpb25zKHByb3BlcnR5LnZhbHVlQ2hhbmdlT3B0aW9ucy5kZXBlbmRlbmN5UHJvcGVydGllcy52YWxpZClcclxuICAgICAgICAgICAgICAgIClcclxuICAgICAgICAgICAgICAgIC5zdWJzY3JpYmUodmFsdWUgPT4ge1xyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMuc2V0Rm9yY2VBc3luY1ZhbGlkYXRpb25UZXN0Rm9yQ29udHJvbChwcm9wZXJ0eUNvbnRyb2wsIHRydWUpO1xyXG4gICAgICAgICAgICAgICAgICAgIHByb3BlcnR5Q29udHJvbC51cGRhdGVWYWx1ZUFuZFZhbGlkaXR5KHsgb25seVNlbGY6IHRydWUsIGVtaXRFdmVudDogZmFsc2UgfSk7XHJcbiAgICAgICAgICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgICAgIHByb3BlcnR5LmFkZERlcGVuZGVuY3lQcm9wZXJ0eVN1YnNjcmlwdGlvbihzdWIkKTtcclxuICAgICAgICB9KTtcclxuICAgIH1cclxuXHJcbiAgICBwcml2YXRlIHNldHVwRWRpdGFiaWxpdHlEZXBlbmRlbmN5U3Vic2NyaXB0aW9uczxUPihcclxuICAgICAgICBwcm9wZXJ0eUNvbnRyb2w6IEFic3RyYWN0Q29udHJvbCxcclxuICAgICAgICBwYXJlbnRDb250cm9sOiBBYnN0cmFjdENvbnRyb2wsXHJcbiAgICAgICAgcHJvcGVydHk6IFByb3BlcnR5QmFzZTxUPlxyXG4gICAgKTogdm9pZCB7XHJcbiAgICAgICAgY29uc3QgZGVwZW5kZW5jeVByb3BOYW1lcyA9IHRoaXMucnVsZXNFbmdpbmVTdmMuZ2V0RGVwZW5kZW5jeVByb3BlcnRpZXMocHJvcGVydHkuZWRpdCk7XHJcblxyXG4gICAgICAgIGRlcGVuZGVuY3lQcm9wTmFtZXMuZm9yRWFjaChkcG4gPT4ge1xyXG4gICAgICAgICAgICBjb25zdCBkZXBlbmRlbmN5Q29udHJvbCA9IHRoaXMuZmluZENvbnRyb2xSZWxhdGl2ZWx5KHBhcmVudENvbnRyb2wsIGRwbik7XHJcblxyXG4gICAgICAgICAgICBpZiAoIWRlcGVuZGVuY3lDb250cm9sKSByZXR1cm47XHJcblxyXG4gICAgICAgICAgICAvLyBzZXR1cCBjb250cm9sIHRvIHBlcmZvcm0gZWRpdCB0ZXN0cyB3aGVuIGRlcGVuZGVuY3kgcHJvcGVydHkgY2hhbmdlc1xyXG4gICAgICAgICAgICBjb25zdCBzdWIkID0gZGVwZW5kZW5jeUNvbnRyb2wudmFsdWVDaGFuZ2VzXHJcbiAgICAgICAgICAgICAgICAucGlwZShcclxuICAgICAgICAgICAgICAgICAgICB0aGlzLmFwcGx5VmFsdWVDaGFuZ2VPcHRpb25zKHByb3BlcnR5LnZhbHVlQ2hhbmdlT3B0aW9ucy5kZXBlbmRlbmN5UHJvcGVydGllcy5lZGl0KVxyXG4gICAgICAgICAgICAgICAgKVxyXG4gICAgICAgICAgICAgICAgLnN1YnNjcmliZSh2YWx1ZSA9PiB7XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5wZXJzaXN0RWRpdFRlc3RzKHByb3BlcnR5Q29udHJvbCwgcHJvcGVydHkpO1xyXG4gICAgICAgICAgICAgICAgfSk7XHJcblxyXG4gICAgICAgICAgICBwcm9wZXJ0eS5hZGREZXBlbmRlbmN5UHJvcGVydHlTdWJzY3JpcHRpb24oc3ViJCk7XHJcbiAgICAgICAgfSk7XHJcbiAgICB9XHJcblxyXG4gICAgcHJpdmF0ZSBwZXJzaXN0RWRpdFRlc3RzPFQ+KHByb3BlcnR5Q29udHJvbDogQWJzdHJhY3RDb250cm9sLCBwcm9wZXJ0eTogUHJvcGVydHlCYXNlPFQ+KTogdm9pZCB7XHJcbiAgICAgICAgY29uc3QgY29udHJvbENvbnRleHRWYWx1ZXMgPSB0aGlzLmdldENvbnRyb2xDb250ZXh0VmFsdWVzKHByb3BlcnR5Q29udHJvbCwgcHJvcGVydHkpO1xyXG5cclxuICAgICAgICB0aGlzLnJ1bGVzRW5naW5lU3ZjLmVkaXRhYmxlKGNvbnRyb2xDb250ZXh0VmFsdWVzLnJlbGF0aXZlLCBwcm9wZXJ0eSwge1xyXG4gICAgICAgICAgICByb290RGF0YTogY29udHJvbENvbnRleHRWYWx1ZXMucm9vdCxcclxuICAgICAgICAgICAgY29udHJvbFN0YXRlOiBDb250cm9sU3RhdGUuY3JlYXRlKHByb3BlcnR5Q29udHJvbClcclxuICAgICAgICB9KS5zdWJzY3JpYmUodGVzdFJlc3VsdHMgPT4ge1xyXG4gICAgICAgICAgICBpZiAodGVzdFJlc3VsdHMucmVzdWx0cy5sZW5ndGgpIHtcclxuICAgICAgICAgICAgICAgIHRoaXMudHJhY2VTdmMudHJhY2UoYEVkaXRhYmxlIHByb3BlcnR5IFwiJHtwcm9wZXJ0eS5hYnNvbHV0ZVBhdGh9XCIuIGAgK1xyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMuYnVpbGRUZXN0UmVzdWx0U3RhdHNTdHJpbmcodGVzdFJlc3VsdHMpKTtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgaWYgKHRlc3RSZXN1bHRzLnBhc3NlZCAmJiBwcm9wZXJ0eUNvbnRyb2wuZGlzYWJsZWQpXHJcbiAgICAgICAgICAgICAgICBwcm9wZXJ0eUNvbnRyb2wuZW5hYmxlKHsgZW1pdEV2ZW50OiBmYWxzZSB9KTtcclxuICAgICAgICAgICAgZWxzZSBpZiAoIXRlc3RSZXN1bHRzLnBhc3NlZCAmJiBwcm9wZXJ0eUNvbnRyb2wuZW5hYmxlZClcclxuICAgICAgICAgICAgICAgIHByb3BlcnR5Q29udHJvbC5kaXNhYmxlKHsgZW1pdEV2ZW50OiBmYWxzZSB9KTtcclxuICAgICAgICB9KTtcclxuICAgIH1cclxuXHJcbiAgICBwcml2YXRlIGFwcGx5QXN5bmNWYWxpZFZhbHVlQ2hhbmdlT3B0aW9ucyhcclxuICAgICAgICB2YWx1ZUNoYW5nZU9wdGlvbnM6IFZhbHVlQ2hhbmdlT3B0aW9uc1xyXG4gICAgKTogT3BlcmF0b3JGdW5jdGlvbjxBYnN0cmFjdENvbnRyb2wsIEFzeW5jVmFsaWRhdGlvblBhc3N0aHJvdWdoYWJsZT4ge1xyXG4gICAgICAgIHJldHVybiAoc291cmNlJDogT2JzZXJ2YWJsZTxBYnN0cmFjdENvbnRyb2w+KTogT2JzZXJ2YWJsZTxBc3luY1ZhbGlkYXRpb25QYXNzdGhyb3VnaGFibGU+ID0+IHtcclxuICAgICAgICAgICAgbGV0IGxhc3RWYWx1ZTogYW55O1xyXG4gICAgICAgICAgICBsZXQgaXNGb3JjZTogYm9vbGVhbjtcclxuXHJcbiAgICAgICAgICAgIHJldHVybiBzb3VyY2UkLnBpcGUoXHJcbiAgICAgICAgICAgICAgICB0YXAoY29udHJvbCA9PiB7XHJcbiAgICAgICAgICAgICAgICAgICAgaXNGb3JjZSA9IHRoaXMuZG9lc0NvbnRyb2xIYXZlRm9yY2VkQXN5bmNWYWxpZGF0aW9uKGNvbnRyb2wpO1xyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMuc2V0Rm9yY2VBc3luY1ZhbGlkYXRpb25UZXN0Rm9yQ29udHJvbChjb250cm9sLCBmYWxzZSk7XHJcbiAgICAgICAgICAgICAgICB9KSxcclxuICAgICAgICAgICAgICAgIGRlYm91bmNlKHggPT4ge1xyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBpc0ZvcmNlIHx8IHZhbHVlQ2hhbmdlT3B0aW9ucy5kZWJvdW5jZU1pbGxpc2Vjb25kcyA+IDBcclxuICAgICAgICAgICAgICAgICAgICAgICAgPyB0aW1lcih2YWx1ZUNoYW5nZU9wdGlvbnMuZGVib3VuY2VNaWxsaXNlY29uZHMpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIDogRU1QVFk7XHJcbiAgICAgICAgICAgICAgICB9KSxcclxuICAgICAgICAgICAgICAgIG1hcChjb250cm9sID0+IHtcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm4ge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBjb250cm9sOiBjb250cm9sLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBwYXNzdGhyb3VnaDogIShjb250cm9sLnZhbHVlICE9PSBsYXN0VmFsdWUgfHwgIXZhbHVlQ2hhbmdlT3B0aW9ucy5kaXN0aW5jdFVudGlsQ2hhbmdlZCB8fCBpc0ZvcmNlKVxyXG4gICAgICAgICAgICAgICAgICAgIH0gYXMgQXN5bmNWYWxpZGF0aW9uUGFzc3Rocm91Z2hhYmxlO1xyXG4gICAgICAgICAgICAgICAgfSksXHJcbiAgICAgICAgICAgICAgICB0YXAoeCA9PiB7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKCF4LnBhc3N0aHJvdWdoKSBsYXN0VmFsdWUgPSB4LmNvbnRyb2wudmFsdWU7XHJcbiAgICAgICAgICAgICAgICB9KVxyXG4gICAgICAgICAgICApO1xyXG4gICAgICAgIH07XHJcbiAgICB9XHJcblxyXG4gICAgcHJpdmF0ZSBhcHBseVZhbHVlQ2hhbmdlT3B0aW9ucyh2YWx1ZUNoYW5nZU9wdGlvbnM6IFZhbHVlQ2hhbmdlT3B0aW9ucyk6IE9wZXJhdG9yRnVuY3Rpb248YW55LCBhbnk+IHtcclxuICAgICAgICByZXR1cm4gKHNvdXJjZSQ6IE9ic2VydmFibGU8YW55Pik6IE9ic2VydmFibGU8YW55PiA9PiB7XHJcbiAgICAgICAgICAgIHJldHVybiBzb3VyY2UkLnBpcGUoXHJcbiAgICAgICAgICAgICAgICBkZWJvdW5jZSh4ID0+IHtcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gdmFsdWVDaGFuZ2VPcHRpb25zLmRlYm91bmNlTWlsbGlzZWNvbmRzID4gMFxyXG4gICAgICAgICAgICAgICAgICAgICAgICA/IHRpbWVyKHZhbHVlQ2hhbmdlT3B0aW9ucy5kZWJvdW5jZU1pbGxpc2Vjb25kcylcclxuICAgICAgICAgICAgICAgICAgICAgICAgOiBFTVBUWTtcclxuICAgICAgICAgICAgICAgIH0pLFxyXG4gICAgICAgICAgICAgICAgdmFsdWVDaGFuZ2VPcHRpb25zLmRpc3RpbmN0VW50aWxDaGFuZ2VkID8gZGlzdGluY3RVbnRpbENoYW5nZWQoKSA6IHRhcCgpXHJcbiAgICAgICAgICAgICk7XHJcbiAgICAgICAgfTtcclxuICAgIH1cclxuXHJcbiAgICBwcml2YXRlIGdldENvbnRyb2xDb250ZXh0VmFsdWVzPFQ+KGNvbnRyb2w6IEFic3RyYWN0Q29udHJvbCwgcHJvcGVydHk6IFByb3BlcnR5PFQ+IHwgQXJyYXlJdGVtUHJvcGVydHk8VD4pOiBDb250cm9sQ29udGV4dFZhbHVlcyB7XHJcbiAgICAgICAgY29uc3Qgcm9vdFZhbHVlID0gKGNvbnRyb2wucm9vdCBhcyBGb3JtR3JvdXApLmdldFJhd1ZhbHVlKCk7XHJcblxyXG4gICAgICAgIC8vIHVzZSB0aGUgY29udHJvbCB2YWx1ZSBpZiBhbiBhcnJheSBpdGVtLCBvdGhlcndpc2UgdXNlIHRoZSBwYXJlbnQgY29udHJvbFxyXG4gICAgICAgIGNvbnN0IHJlbGF0aXZlVmFsdWUgPSBQcm9wZXJ0eUJhc2UuaXNBcnJheUl0ZW1Qcm9wZXJ0eShwcm9wZXJ0eSlcclxuICAgICAgICAgICAgPyBjb250cm9sLnZhbHVlXHJcbiAgICAgICAgICAgIDogY29udHJvbC5wYXJlbnQuZ2V0UmF3VmFsdWUoKTtcclxuXHJcbiAgICAgICAgcmV0dXJuIHtcclxuICAgICAgICAgICAgcm9vdDogcm9vdFZhbHVlLFxyXG4gICAgICAgICAgICByZWxhdGl2ZTogcmVsYXRpdmVWYWx1ZVxyXG4gICAgICAgIH07XHJcbiAgICB9XHJcblxyXG4gICAgcHJpdmF0ZSBnZXRQcm9wZXJ0eUZyb21QYXJlbnQ8VD4oXHJcbiAgICAgICAgcGFyZW50Q29udHJvbDogQWJzdHJhY3RDb250cm9sLFxyXG4gICAgICAgIHByb3BlcnR5OiBQcm9wZXJ0eUJhc2U8VD4sXHJcbiAgICAgICAgYXJyYXlJbmRleD86IG51bWJlclxyXG4gICAgKSB7XHJcbiAgICAgICAgcmV0dXJuIFByb3BlcnR5QmFzZS5pc0FycmF5SXRlbVByb3BlcnR5KHByb3BlcnR5KVxyXG4gICAgICAgICAgICA/IChwYXJlbnRDb250cm9sIGFzIEZvcm1BcnJheSkuYXQoYXJyYXlJbmRleClcclxuICAgICAgICAgICAgOiBwYXJlbnRDb250cm9sLmdldCgocHJvcGVydHkgYXMgUHJvcGVydHk8VD4pLm5hbWUpO1xyXG4gICAgfVxyXG5cclxuICAgIHByaXZhdGUgbWFwVG9SZWFjdGl2ZUZvcm1zVmFsaWRhdGlvbkVycm9yczxUPih0ZXN0UmVzdWx0czogVGVzdFJlc3VsdHNCYXNlPFQ+KTogUmVhY3RpdmVGb3Jtc1ZhbGlkYXRpb25FcnJvcnMge1xyXG4gICAgICAgIC8vIGlmIHBhc3NlZCwgQW5ndWxhciByZWFjdGl2ZSBmb3JtcyB3YW50cyB1cyB0byByZXR1cm4gbnVsbCwgb3RoZXJ3aXNlIHJldHVybiBhbiBvYmplY3Qgd2l0aCB0aGUgdmFsaWRhdGlvbiBpbmZvXHJcbiAgICAgICAgaWYgKCF0ZXN0UmVzdWx0cyB8fCB0ZXN0UmVzdWx0cy5wYXNzZWQpIHJldHVybiBudWxsO1xyXG5cclxuICAgICAgICBjb25zdCBmYWlsZWQ6IHsgW2tleTogc3RyaW5nXTogUmVhY3RpdmVGb3Jtc0ZhaWxlZFZhbGRhdGlvbiB9ID0ge307XHJcblxyXG4gICAgICAgIHRlc3RSZXN1bHRzLmZhaWxlZFJlc3VsdHMuZm9yRWFjaCh0ZXN0ID0+IHtcclxuICAgICAgICAgICAgZmFpbGVkW3Rlc3QubmFtZV0gPSB7IG1lc3NhZ2U6IHRlc3QubWVzc2FnZSB9O1xyXG4gICAgICAgIH0pO1xyXG5cclxuICAgICAgICByZXR1cm4ge1xyXG4gICAgICAgICAgICBuZ0Zvcm1SdWxlczoge1xyXG4gICAgICAgICAgICAgICAgbWVzc2FnZTogdGVzdFJlc3VsdHMubWVzc2FnZSxcclxuICAgICAgICAgICAgICAgIGZhaWxlZDogZmFpbGVkXHJcbiAgICAgICAgICAgIH0gYXMgUmVhY3RpdmVGb3Jtc1ZhbGlkYXRpb25FcnJvcnNEYXRhXHJcbiAgICAgICAgfTtcclxuICAgIH1cclxuXHJcbiAgICBwcml2YXRlIGZpbmRDb250cm9sUmVsYXRpdmVseShjb250cm9sOiBBYnN0cmFjdENvbnRyb2wsIHBhdGg6IHN0cmluZykge1xyXG4gICAgICAgIGNvbnN0IHJlbGF0aXZlUGF0aHMgPSB0aGlzLmJ1aWxkQ29udHJvbFJlbGF0aXZlUGF0aEFycmF5KHBhdGgpO1xyXG5cclxuICAgICAgICBpZiAoIXJlbGF0aXZlUGF0aHMubGVuZ3RoKSByZXR1cm4gbnVsbDtcclxuXHJcbiAgICAgICAgbGV0IHJlc3VsdDogQWJzdHJhY3RDb250cm9sO1xyXG4gICAgICAgIHJlbGF0aXZlUGF0aHMuZm9yRWFjaChwYXRoU2VnbWVudCA9PiB7XHJcbiAgICAgICAgICAgIHJlc3VsdCA9IHRoaXMuZ2V0Q29udHJvbEJ5UGF0aFNlZ21lbnQocmVzdWx0IHx8IGNvbnRyb2wsIHBhdGhTZWdtZW50KTtcclxuICAgICAgICAgICAgaWYgKCFyZXN1bHQpIHJldHVybjtcclxuICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgcmV0dXJuIHJlc3VsdDtcclxuICAgIH1cclxuXHJcbiAgICBwcml2YXRlIGJ1aWxkQ29udHJvbFJlbGF0aXZlUGF0aEFycmF5KHJlbGF0aXZlUGF0aDogc3RyaW5nKTogc3RyaW5nW10ge1xyXG4gICAgICAgIGNvbnN0IHJlc3VsdDogc3RyaW5nW10gPSBbXTtcclxuXHJcbiAgICAgICAgaWYgKCFyZWxhdGl2ZVBhdGggfHwgdHlwZW9mIHJlbGF0aXZlUGF0aCAhPT0gXCJzdHJpbmdcIikgcmV0dXJuIHJlc3VsdDtcclxuXHJcbiAgICAgICAgLy8gdGFrZXMgY2FyZSBvZiAnLi8nLCAnLi4vJywgYW5kICcvJ1xyXG4gICAgICAgIGNvbnN0IHNsYXNoU2VwYXJhdGVkID0gcmVsYXRpdmVQYXRoLnNwbGl0KFwiL1wiKTtcclxuXHJcbiAgICAgICAgc2xhc2hTZXBhcmF0ZWQuZm9yRWFjaChzbGFzaEl0ZW0gPT4ge1xyXG4gICAgICAgICAgICBjb25zdCBkb3RTZXBhcmF0ZWQgPSBzbGFzaEl0ZW0uc3BsaXQoXCIuXCIpXHJcbiAgICAgICAgICAgICAgICAuZmlsdGVyKGRvdEl0ZW0gPT4gISFkb3RJdGVtKTtcclxuXHJcbiAgICAgICAgICAgIGlmIChkb3RTZXBhcmF0ZWQubGVuZ3RoKVxyXG4gICAgICAgICAgICAgICAgcmVzdWx0LnB1c2goLi4uZG90U2VwYXJhdGVkKTtcclxuICAgICAgICAgICAgZWxzZVxyXG4gICAgICAgICAgICAgICAgcmVzdWx0LnB1c2goc2xhc2hJdGVtKTtcclxuICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgcmV0dXJuIHJlc3VsdDtcclxuICAgIH1cclxuXHJcbiAgICBwcml2YXRlIGdldENvbnRyb2xCeVBhdGhTZWdtZW50KGNvbnRyb2w6IEFic3RyYWN0Q29udHJvbCwgcGF0aFNlZ21lbnQ6IHN0cmluZyk6IEFic3RyYWN0Q29udHJvbCB7XHJcbiAgICAgICAgc3dpdGNoIChwYXRoU2VnbWVudCkge1xyXG4gICAgICAgICAgICBjYXNlIFwiXCI6XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gY29udHJvbC5yb290O1xyXG4gICAgICAgICAgICBjYXNlIFwiLi5cIjpcclxuICAgICAgICAgICAgICAgIHJldHVybiBjb250cm9sLnBhcmVudDtcclxuICAgICAgICAgICAgY2FzZSBcIi5cIjpcclxuICAgICAgICAgICAgICAgIHJldHVybiBjb250cm9sO1xyXG4gICAgICAgICAgICBkZWZhdWx0OlxyXG4gICAgICAgICAgICAgICAgcmV0dXJuIGNvbnRyb2wuZ2V0KHBhdGhTZWdtZW50KTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgcHJpdmF0ZSBidWlsZFRlc3RSZXN1bHRTdGF0c1N0cmluZzxUPih0ZXN0UmVzdWx0czogVGVzdFJlc3VsdHNCYXNlPFQ+KSB7XHJcbiAgICAgICAgcmV0dXJuIGBFeGVjdXRlZCAke3Rlc3RSZXN1bHRzLnJlc3VsdHMubGVuZ3RofSB0ZXN0cyBgICtcclxuICAgICAgICAgICAgYCgke3Rlc3RSZXN1bHRzLnBhc3NlZFJlc3VsdHMubGVuZ3RofSBQQVNTIHwgYCArXHJcbiAgICAgICAgICAgIGAke3Rlc3RSZXN1bHRzLmZhaWxlZFJlc3VsdHMubGVuZ3RofSBGQUlMIHwgYFxyXG4gICAgICAgICAgICArIGAke3Rlc3RSZXN1bHRzLnNraXBwZWRSZXN1bHRzLmxlbmd0aH0gU0tJUClgO1xyXG4gICAgfVxyXG5cclxuICAgIHByaXZhdGUgYXR0YWNoTW9kZWxTZXR0aW5nc1RvRm9ybTxUPihmb3JtR3JvdXA6IEZvcm1Hcm91cCwgbW9kZWxTZXR0aW5nczogQWJzdHJhY3RNb2RlbFNldHRpbmdzPFQ+KTogdm9pZCB7XHJcbiAgICAgICAgZm9ybUdyb3VwW1JlYWN0aXZlRm9ybXNSdWxlU2VydmljZS5GT1JNX01PREVMX1NFVFRJTkdTX1BST1BFUlRZX05BTUVdID0gbW9kZWxTZXR0aW5ncztcclxuICAgIH1cclxuXHJcbiAgICBwcml2YXRlIGdldE1vZGVsU2V0dGluZ3NGcm9tRm9ybTxUPihmb3JtR3JvdXA6IEZvcm1Hcm91cCk6IEFic3RyYWN0TW9kZWxTZXR0aW5nczxUPiB7XHJcbiAgICAgICAgcmV0dXJuIGZvcm1Hcm91cFtSZWFjdGl2ZUZvcm1zUnVsZVNlcnZpY2UuRk9STV9NT0RFTF9TRVRUSU5HU19QUk9QRVJUWV9OQU1FXSBhcyBBYnN0cmFjdE1vZGVsU2V0dGluZ3M8VD47XHJcbiAgICB9XHJcblxyXG4gICAgcHJpdmF0ZSBzZXRGb3JjZUFzeW5jVmFsaWRhdGlvblRlc3RGb3JDb250cm9sKGNvbnRyb2w6IEFic3RyYWN0Q29udHJvbCwgZm9yY2U6IGJvb2xlYW4pOiB2b2lkIHtcclxuICAgICAgICBjb250cm9sW1JlYWN0aXZlRm9ybXNSdWxlU2VydmljZS5GT1JDRV9BU1lOQ19WQUxJRF9URVNUX1JVTl9QUk9QRVJUWV9OQU1FXSA9IGZvcmNlO1xyXG4gICAgfVxyXG5cclxuICAgIHByaXZhdGUgc2V0TGFzdEVycm9yRm9yQ29udHJvbChjb250cm9sOiBBYnN0cmFjdENvbnRyb2wsIGVycm9yczogUmVhY3RpdmVGb3Jtc1ZhbGlkYXRpb25FcnJvcnNEYXRhKTogdm9pZCB7XHJcbiAgICAgICAgY29udHJvbFtSZWFjdGl2ZUZvcm1zUnVsZVNlcnZpY2UuQ09OVFJPTF9MQVNUX0VSUk9SXSA9IGVycm9ycztcclxuICAgIH1cclxuXHJcbiAgICBwcml2YXRlIGdldExhc3RFcnJvckZvckNvbnRyb2woY29udHJvbDogQWJzdHJhY3RDb250cm9sKTogUmVhY3RpdmVGb3Jtc1ZhbGlkYXRpb25FcnJvcnNEYXRhIHtcclxuICAgICAgICByZXR1cm4gY29udHJvbFtSZWFjdGl2ZUZvcm1zUnVsZVNlcnZpY2UuQ09OVFJPTF9MQVNUX0VSUk9SXTtcclxuICAgIH1cclxuXHJcbiAgICBwcml2YXRlIGRvZXNDb250cm9sSGF2ZUZvcmNlZEFzeW5jVmFsaWRhdGlvbihjb250cm9sOiBBYnN0cmFjdENvbnRyb2wpOiBib29sZWFuIHtcclxuICAgICAgICByZXR1cm4gISEoY29udHJvbFtSZWFjdGl2ZUZvcm1zUnVsZVNlcnZpY2UuRk9SQ0VfQVNZTkNfVkFMSURfVEVTVF9SVU5fUFJPUEVSVFlfTkFNRV0pO1xyXG4gICAgfVxyXG5cclxuICAgIHByaXZhdGUgdHJpZ2dlclZhbHVlQ2hhbmdlKGNvbnRyb2w6IEFic3RyYWN0Q29udHJvbCk6IHZvaWQge1xyXG4gICAgICAgIGNvbnRyb2wucGF0Y2hWYWx1ZShjb250cm9sLnZhbHVlKTtcclxuICAgIH1cclxufVxyXG5cclxuaW50ZXJmYWNlIENvbnRyb2xDb250ZXh0VmFsdWVzIHtcclxuICAgIHJvb3Q6IGFueTtcclxuICAgIHJlbGF0aXZlOiBhbnk7XHJcbn1cclxuXHJcbmludGVyZmFjZSBBc3luY1ZhbGlkYXRpb25QYXNzdGhyb3VnaGFibGUge1xyXG4gICAgY29udHJvbDogQWJzdHJhY3RDb250cm9sO1xyXG4gICAgcGFzc3Rocm91Z2g6IGJvb2xlYW47XHJcbn1cclxuIl19