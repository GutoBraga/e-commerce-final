/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes} checked by tsc
 */
import { Injectable } from "@angular/core";
import { FormGroup, FormBuilder, FormControl, FormArray } from '@angular/forms';
import { RulesEngineService } from "../rules-engine/rules-engine.service";
import { PropertyBase } from "../../../form-rules/models/property-base";
import { TraceService } from "../../../utils/trace/trace.service";
import { BehaviorSubject, of, timer, EMPTY } from "rxjs";
import { map, tap, switchMap, take, distinctUntilChanged, debounce } from "rxjs/operators";
import { ControlState } from "../../../form-rules/models/control-state";
import { CommonService } from "../../../utils/common/common.service";
/**
 * Builds reactive forms using configured model settings
 */
export class ReactiveFormsRuleService {
    /**
     * @param {?} rulesEngineSvc
     * @param {?} formBuilder
     * @param {?} traceSvc
     * @param {?} commonSvc
     */
    constructor(rulesEngineSvc, formBuilder, traceSvc, commonSvc) {
        this.rulesEngineSvc = rulesEngineSvc;
        this.formBuilder = formBuilder;
        this.traceSvc = traceSvc;
        this.commonSvc = commonSvc;
    }
    /**
     * Gets model settings with the provided name
     * @template T
     * @param {?} name Name of model setting
     * @return {?} Model settings with the provided name
     */
    getModelSettings(name) {
        return this.rulesEngineSvc.getModelSettings(name);
    }
    /**
     * Creates a form group using an instance of model settings
     * @template T
     * @param {?} modelSettings Name of the model setting or an instance of model settings to use
     * @param {?=} initialValue Initial data to set the form values to
     * @return {?} Form group created according to defined model settings
     */
    createFormGroup(modelSettings, initialValue) {
        let /** @type {?} */ settings;
        if (typeof modelSettings === "string") {
            settings = this.rulesEngineSvc.getModelSettings(/** @type {?} */ (modelSettings));
            if (!settings)
                throw new Error(`No model setting found with the name "${modelSettings}"`);
        }
        else {
            if (!modelSettings)
                throw new Error(`Adhoc model setting provided is invalid`);
            settings = /** @type {?} */ (modelSettings);
            this.rulesEngineSvc.initializeModelSetting(settings);
        }
        this.traceSvc.trace(`Creating form group using model settings "${settings.name}"`);
        const /** @type {?} */ formGroup = this.buildGroup(settings.properties, initialValue);
        this.traceSvc.trace(`Setting up dependency subscriptions`);
        this.resetDependencySubscriptions(formGroup, settings.properties);
        this.traceSvc.trace(`Patching form group with initial value`);
        this.triggerValueChange(formGroup);
        this.traceSvc.trace(`Attaching model settings to form`);
        this.attachModelSettingsToForm(formGroup, settings);
        return formGroup;
    }
    /**
     * Adds an array item property to an existing form array
     * @template T
     * @param {?} property ArrayItemProperty to for the array item to be added
     * @param {?} parentFormArray The parent FormArray
     * @param {?=} initialValue Initial value of the form array item
     * @param {?=} options Options for adding new array item property
     * @return {?}
     */
    addArrayItemPropertyControl(property, parentFormArray, initialValue, options) {
        const /** @type {?} */ control = this.buildAbstractControl(property, initialValue);
        const /** @type {?} */ willBeLastItem = !options || !this.commonSvc.isZeroOrGreater(options.index) || options.index >= parentFormArray.length;
        if (willBeLastItem)
            parentFormArray.push(control);
        else
            parentFormArray.insert(options.index, control);
        const /** @type {?} */ modelSettings = this.getModelSettingsFromForm(/** @type {?} */ (parentFormArray.root));
        this.resetDependencySubscriptions(parentFormArray.root, modelSettings.properties);
        // we need to do this because the item could have been added at any index in the array, and we need
        // trigger a value change to trigger any dependency propertiy valdidations
        this.triggerValueChange(parentFormArray);
    }
    /**
     * Extends validators generated by ng-form-rules with your own validators
     * @param {?} control Control to extends the validators for
     * @param {?} validator Validator to add
     * @return {?}
     */
    extendValidator(control, validator) {
        if (!validator)
            return;
        const /** @type {?} */ validatorArray = Array.isArray(validator) ? validator : [validator];
        control.setValidators([control.validator, ...validatorArray]
            .filter(validatorFn => !!validatorFn));
    }
    /**
     * Extends async validators generated by ng-form-rules with your own async validators
     * @param {?} control Control to extends the async validators for
     * @param {?} asyncValidator Async validator to add
     * @return {?}
     */
    extendAsyncValidator(control, asyncValidator) {
        if (!asyncValidator)
            return;
        const /** @type {?} */ asyncValidatorArray = Array.isArray(asyncValidator) ? asyncValidator : [asyncValidator];
        control.setAsyncValidators([control.asyncValidator, ...asyncValidatorArray]
            .filter(asyncValidatorFn => !!asyncValidatorFn));
    }
    /**
     * @template T
     * @param {?} property
     * @param {?=} initialValue
     * @return {?}
     */
    buildAbstractControl(property, initialValue) {
        let /** @type {?} */ control;
        if (property.arrayItemProperty)
            control = this.buildArray(property.arrayItemProperty, initialValue, property.updateOn);
        else if (property.properties)
            control = this.buildGroup(property.properties, initialValue, property.updateOn);
        else
            control = this.buildControl(initialValue, property.updateOn);
        // setup validation tests on value change
        control.setValidators(this.buildValidatorFunction(property));
        control.setAsyncValidators(this.buildAsyncValidatorFunction(property));
        // setup edit tests on value change
        control.valueChanges
            .pipe(this.applyValueChangeOptions(property.valueChangeOptions.self.edit))
            .subscribe(value => {
            this.persistEditTests(control, property);
        });
        return control;
    }
    /**
     * @template T
     * @param {?} initialValue
     * @param {?=} updateOn
     * @return {?}
     */
    buildControl(initialValue, updateOn) {
        return new FormControl(initialValue, { updateOn: updateOn });
    }
    /**
     * @template T
     * @param {?} properties
     * @param {?} initialValue
     * @param {?=} updateOn
     * @return {?}
     */
    buildGroup(properties, initialValue, updateOn) {
        const /** @type {?} */ formGroup = new FormGroup({}, { updateOn: updateOn });
        (properties || []).forEach(p => {
            const /** @type {?} */ propertyValue = initialValue ? initialValue[p.name] : null;
            const /** @type {?} */ ctrl = this.buildAbstractControl(p, propertyValue);
            formGroup.addControl(p.name, ctrl);
        });
        return formGroup;
    }
    /**
     * @template T
     * @param {?} property
     * @param {?} initialValue
     * @param {?=} updateOn
     * @return {?}
     */
    buildArray(property, initialValue, updateOn) {
        initialValue = Array.isArray(initialValue) ? initialValue : [];
        return new FormArray(initialValue.map(v => this.buildAbstractControl(property, v)), { updateOn: updateOn });
    }
    /**
     * @template T
     * @param {?} property
     * @return {?}
     */
    buildValidatorFunction(property) {
        const /** @type {?} */ syncGroups = this.rulesEngineSvc.groupTestsBySyncType(property.valid);
        if (!syncGroups.sync.length)
            return null;
        return (control) => {
            const /** @type {?} */ controlContextValues = this.getControlContextValues(control, property);
            const /** @type {?} */ testResults = this.rulesEngineSvc
                .runTests(controlContextValues.relative, syncGroups.sync, {
                rootData: controlContextValues.root,
                controlState: ControlState.create(control)
            });
            if (testResults.results.length) {
                this.traceSvc.trace(`Validated property "${property.absolutePath}". ` +
                    this.buildTestResultStatsString(testResults));
            }
            return this.mapToReactiveFormsValidationErrors(testResults);
        };
    }
    /**
     * @template T
     * @param {?} property
     * @return {?}
     */
    buildAsyncValidatorFunction(property) {
        const /** @type {?} */ rawAsyncFunc = this.buildAsyncValidatorFunctionRaw(property);
        if (!rawAsyncFunc)
            return null;
        const /** @type {?} */ values = new BehaviorSubject(null);
        const /** @type {?} */ valid$ = values.pipe(this.applyAsyncValidValueChangeOptions(property.valueChangeOptions.self.asyncValid), switchMap(x => {
            // pass through means we did not execute the ng-form-rules async tests
            if (x.passthrough) {
                const /** @type {?} */ currentErrors = x.control.errors || {};
                const /** @type {?} */ lastNgFormRulesErrors = this.getLastErrorForControl(x.control);
                // return the last ng-form-rules errors (if any) alongside non ng-form-rules errors.
                // this handles scenario where debounce and distinct are used and state goes from:
                //    invalid -> make changes and back them out -> valid
                return of(Object.assign(currentErrors, /** @type {?} */ ({ ngFormRules: lastNgFormRulesErrors })));
            }
            else {
                return rawAsyncFunc(x.control);
            }
        }), take(1));
        return (control) => {
            values.next(control);
            return valid$;
        };
    }
    /**
     * @template T
     * @param {?} property
     * @return {?}
     */
    buildAsyncValidatorFunctionRaw(property) {
        const /** @type {?} */ syncGroups = this.rulesEngineSvc.groupTestsBySyncType(property.valid);
        if (!syncGroups.async.length)
            return null;
        return (control) => {
            const /** @type {?} */ controlContextValues = this.getControlContextValues(control, property);
            return this.rulesEngineSvc.runTestsAsync(controlContextValues.relative, syncGroups.async, {
                rootData: controlContextValues.root,
                controlState: ControlState.create(control)
            }).pipe(tap(testResults => {
                if (testResults.results.length) {
                    this.traceSvc.trace(`Validated (async) property "${property.absolutePath}". ` +
                        this.buildTestResultStatsString(testResults));
                }
            }), map(this.mapToReactiveFormsValidationErrors), tap(x => this.setLastErrorForControl(control, (x || {})["ngFormRules"])));
        };
    }
    /**
     * @template T
     * @param {?} parentControl
     * @param {?} properties
     * @return {?}
     */
    resetDependencySubscriptions(parentControl, properties) {
        this.removeDependencySubscriptions(properties);
        this.addDependencySubscriptions(parentControl, properties);
    }
    /**
     * @template T
     * @param {?} properties
     * @return {?}
     */
    removeDependencySubscriptions(properties) {
        (properties || []).forEach(property => {
            property.clearDependencyPropertySubscriptions();
            if (property.properties) {
                this.removeDependencySubscriptions(property.properties);
            }
            if (property.arrayItemProperty) {
                this.removeDependencySubscriptions([property.arrayItemProperty]);
            }
        });
    }
    /**
     * @template T
     * @param {?} parentControl
     * @param {?} properties
     * @param {?=} arrayIndex
     * @return {?}
     */
    addDependencySubscriptions(parentControl, properties, arrayIndex) {
        (properties || []).forEach(property => {
            const /** @type {?} */ propertyControl = this.getPropertyFromParent(parentControl, property, arrayIndex);
            if (!propertyControl)
                return;
            this.setupEditabilityDependencySubscriptions(propertyControl, parentControl, property);
            this.setupValidationDependencySubscriptions(propertyControl, parentControl, property);
            if (property.properties) {
                this.addDependencySubscriptions(propertyControl, property.properties);
            }
            if (property.arrayItemProperty) {
                // if there is an arrayItemProperty we know that we are working with a FormArray control
                const /** @type {?} */ formArrayControl = (/** @type {?} */ (propertyControl));
                for (let /** @type {?} */ i = 0; i < formArrayControl.length; i++) {
                    this.addDependencySubscriptions(formArrayControl, [property.arrayItemProperty], i);
                }
            }
        });
    }
    /**
     * @template T
     * @param {?} propertyControl
     * @param {?} parentControl
     * @param {?} property
     * @return {?}
     */
    setupValidationDependencySubscriptions(propertyControl, parentControl, property) {
        const /** @type {?} */ dependencyPropNames = this.rulesEngineSvc.getDependencyProperties(property.valid);
        dependencyPropNames.forEach(d => {
            const /** @type {?} */ dependencyControl = this.findControlRelatively(parentControl, d);
            if (!dependencyControl)
                return;
            const /** @type {?} */ sub$ = dependencyControl.valueChanges
                .pipe(this.applyValueChangeOptions(property.valueChangeOptions.dependencyProperties.valid))
                .subscribe(value => {
                this.setForceAsyncValidationTestForControl(propertyControl, true);
                propertyControl.updateValueAndValidity({ onlySelf: true, emitEvent: false });
            });
            property.addDependencyPropertySubscription(sub$);
        });
    }
    /**
     * @template T
     * @param {?} propertyControl
     * @param {?} parentControl
     * @param {?} property
     * @return {?}
     */
    setupEditabilityDependencySubscriptions(propertyControl, parentControl, property) {
        const /** @type {?} */ dependencyPropNames = this.rulesEngineSvc.getDependencyProperties(property.edit);
        dependencyPropNames.forEach(dpn => {
            const /** @type {?} */ dependencyControl = this.findControlRelatively(parentControl, dpn);
            if (!dependencyControl)
                return;
            // setup control to perform edit tests when dependency property changes
            const /** @type {?} */ sub$ = dependencyControl.valueChanges
                .pipe(this.applyValueChangeOptions(property.valueChangeOptions.dependencyProperties.edit))
                .subscribe(value => {
                this.persistEditTests(propertyControl, property);
            });
            property.addDependencyPropertySubscription(sub$);
        });
    }
    /**
     * @template T
     * @param {?} propertyControl
     * @param {?} property
     * @return {?}
     */
    persistEditTests(propertyControl, property) {
        const /** @type {?} */ controlContextValues = this.getControlContextValues(propertyControl, property);
        this.rulesEngineSvc.editable(controlContextValues.relative, property, {
            rootData: controlContextValues.root,
            controlState: ControlState.create(propertyControl)
        }).subscribe(testResults => {
            if (testResults.results.length) {
                this.traceSvc.trace(`Editable property "${property.absolutePath}". ` +
                    this.buildTestResultStatsString(testResults));
            }
            if (testResults.passed && propertyControl.disabled)
                propertyControl.enable({ emitEvent: false });
            else if (!testResults.passed && propertyControl.enabled)
                propertyControl.disable({ emitEvent: false });
        });
    }
    /**
     * @param {?} valueChangeOptions
     * @return {?}
     */
    applyAsyncValidValueChangeOptions(valueChangeOptions) {
        return (source$) => {
            let /** @type {?} */ lastValue;
            let /** @type {?} */ isForce;
            return source$.pipe(tap(control => {
                isForce = this.doesControlHaveForcedAsyncValidation(control);
                this.setForceAsyncValidationTestForControl(control, false);
            }), debounce(x => {
                return isForce || valueChangeOptions.debounceMilliseconds > 0
                    ? timer(valueChangeOptions.debounceMilliseconds)
                    : EMPTY;
            }), map(control => {
                return /** @type {?} */ ({
                    control: control,
                    passthrough: !(control.value !== lastValue || !valueChangeOptions.distinctUntilChanged || isForce)
                });
            }), tap(x => {
                if (!x.passthrough)
                    lastValue = x.control.value;
            }));
        };
    }
    /**
     * @param {?} valueChangeOptions
     * @return {?}
     */
    applyValueChangeOptions(valueChangeOptions) {
        return (source$) => {
            return source$.pipe(debounce(x => {
                return valueChangeOptions.debounceMilliseconds > 0
                    ? timer(valueChangeOptions.debounceMilliseconds)
                    : EMPTY;
            }), valueChangeOptions.distinctUntilChanged ? distinctUntilChanged() : tap());
        };
    }
    /**
     * @template T
     * @param {?} control
     * @param {?} property
     * @return {?}
     */
    getControlContextValues(control, property) {
        const /** @type {?} */ rootValue = (/** @type {?} */ (control.root)).getRawValue();
        // use the control value if an array item, otherwise use the parent control
        const /** @type {?} */ relativeValue = PropertyBase.isArrayItemProperty(property)
            ? control.value
            : control.parent.getRawValue();
        return {
            root: rootValue,
            relative: relativeValue
        };
    }
    /**
     * @template T
     * @param {?} parentControl
     * @param {?} property
     * @param {?=} arrayIndex
     * @return {?}
     */
    getPropertyFromParent(parentControl, property, arrayIndex) {
        return PropertyBase.isArrayItemProperty(property)
            ? (/** @type {?} */ (parentControl)).at(arrayIndex)
            : parentControl.get((/** @type {?} */ (property)).name);
    }
    /**
     * @template T
     * @param {?} testResults
     * @return {?}
     */
    mapToReactiveFormsValidationErrors(testResults) {
        // if passed, Angular reactive forms wants us to return null, otherwise return an object with the validation info
        if (!testResults || testResults.passed)
            return null;
        const /** @type {?} */ failed = {};
        testResults.failedResults.forEach(test => {
            failed[test.name] = { message: test.message };
        });
        return {
            ngFormRules: /** @type {?} */ ({
                message: testResults.message,
                failed: failed
            })
        };
    }
    /**
     * @param {?} control
     * @param {?} path
     * @return {?}
     */
    findControlRelatively(control, path) {
        const /** @type {?} */ relativePaths = this.buildControlRelativePathArray(path);
        if (!relativePaths.length)
            return null;
        let /** @type {?} */ result;
        relativePaths.forEach(pathSegment => {
            result = this.getControlByPathSegment(result || control, pathSegment);
            if (!result)
                return;
        });
        return result;
    }
    /**
     * @param {?} relativePath
     * @return {?}
     */
    buildControlRelativePathArray(relativePath) {
        const /** @type {?} */ result = [];
        if (!relativePath || typeof relativePath !== "string")
            return result;
        // takes care of './', '../', and '/'
        const /** @type {?} */ slashSeparated = relativePath.split("/");
        slashSeparated.forEach(slashItem => {
            const /** @type {?} */ dotSeparated = slashItem.split(".")
                .filter(dotItem => !!dotItem);
            if (dotSeparated.length)
                result.push(...dotSeparated);
            else
                result.push(slashItem);
        });
        return result;
    }
    /**
     * @param {?} control
     * @param {?} pathSegment
     * @return {?}
     */
    getControlByPathSegment(control, pathSegment) {
        switch (pathSegment) {
            case "":
                return control.root;
            case "..":
                return control.parent;
            case ".":
                return control;
            default:
                return control.get(pathSegment);
        }
    }
    /**
     * @template T
     * @param {?} testResults
     * @return {?}
     */
    buildTestResultStatsString(testResults) {
        return `Executed ${testResults.results.length} tests ` +
            `(${testResults.passedResults.length} PASS | ` +
            `${testResults.failedResults.length} FAIL | `
            + `${testResults.skippedResults.length} SKIP)`;
    }
    /**
     * @template T
     * @param {?} formGroup
     * @param {?} modelSettings
     * @return {?}
     */
    attachModelSettingsToForm(formGroup, modelSettings) {
        formGroup[ReactiveFormsRuleService.FORM_MODEL_SETTINGS_PROPERTY_NAME] = modelSettings;
    }
    /**
     * @template T
     * @param {?} formGroup
     * @return {?}
     */
    getModelSettingsFromForm(formGroup) {
        return /** @type {?} */ (formGroup[ReactiveFormsRuleService.FORM_MODEL_SETTINGS_PROPERTY_NAME]);
    }
    /**
     * @param {?} control
     * @param {?} force
     * @return {?}
     */
    setForceAsyncValidationTestForControl(control, force) {
        control[ReactiveFormsRuleService.FORCE_ASYNC_VALID_TEST_RUN_PROPERTY_NAME] = force;
    }
    /**
     * @param {?} control
     * @param {?} errors
     * @return {?}
     */
    setLastErrorForControl(control, errors) {
        control[ReactiveFormsRuleService.CONTROL_LAST_ERROR] = errors;
    }
    /**
     * @param {?} control
     * @return {?}
     */
    getLastErrorForControl(control) {
        return control[ReactiveFormsRuleService.CONTROL_LAST_ERROR];
    }
    /**
     * @param {?} control
     * @return {?}
     */
    doesControlHaveForcedAsyncValidation(control) {
        return !!(control[ReactiveFormsRuleService.FORCE_ASYNC_VALID_TEST_RUN_PROPERTY_NAME]);
    }
    /**
     * @param {?} control
     * @return {?}
     */
    triggerValueChange(control) {
        control.patchValue(control.value);
    }
}
ReactiveFormsRuleService.FORM_MODEL_SETTINGS_PROPERTY_NAME = 'ngFormRulesModelSetting';
ReactiveFormsRuleService.FORCE_ASYNC_VALID_TEST_RUN_PROPERTY_NAME = 'ngFormRulesForceAsyncValidTestRun';
ReactiveFormsRuleService.CONTROL_LAST_ERROR = 'ngFormRulesControlLastError';
ReactiveFormsRuleService.decorators = [
    { type: Injectable },
];
/** @nocollapse */
ReactiveFormsRuleService.ctorParameters = () => [
    { type: RulesEngineService, },
    { type: FormBuilder, },
    { type: TraceService, },
    { type: CommonService, },
];
function ReactiveFormsRuleService_tsickle_Closure_declarations() {
    /** @type {!Array<{type: !Function, args: (undefined|!Array<?>)}>} */
    ReactiveFormsRuleService.decorators;
    /**
     * @nocollapse
     * @type {function(): !Array<(null|{type: ?, decorators: (undefined|!Array<{type: !Function, args: (undefined|!Array<?>)}>)})>}
     */
    ReactiveFormsRuleService.ctorParameters;
    /** @type {?} */
    ReactiveFormsRuleService.FORM_MODEL_SETTINGS_PROPERTY_NAME;
    /** @type {?} */
    ReactiveFormsRuleService.FORCE_ASYNC_VALID_TEST_RUN_PROPERTY_NAME;
    /** @type {?} */
    ReactiveFormsRuleService.CONTROL_LAST_ERROR;
    /** @type {?} */
    ReactiveFormsRuleService.prototype.rulesEngineSvc;
    /** @type {?} */
    ReactiveFormsRuleService.prototype.formBuilder;
    /** @type {?} */
    ReactiveFormsRuleService.prototype.traceSvc;
    /** @type {?} */
    ReactiveFormsRuleService.prototype.commonSvc;
}
/**
 * @record
 */
function ControlContextValues() { }
function ControlContextValues_tsickle_Closure_declarations() {
    /** @type {?} */
    ControlContextValues.prototype.root;
    /** @type {?} */
    ControlContextValues.prototype.relative;
}
/**
 * @record
 */
function AsyncValidationPassthroughable() { }
function AsyncValidationPassthroughable_tsickle_Closure_declarations() {
    /** @type {?} */
    AsyncValidationPassthroughable.prototype.control;
    /** @type {?} */
    AsyncValidationPassthroughable.prototype.passthrough;
}

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoicmVhY3RpdmUtZm9ybXMtcnVsZS5zZXJ2aWNlLmpzIiwic291cmNlUm9vdCI6Im5nOi8vbmctZm9ybS1ydWxlcy8iLCJzb3VyY2VzIjpbImxpYi9ydWxlcy1lbmdpbmUvc2VydmljZXMvcmVhY3RpdmUtZm9ybXMtcnVsZS9yZWFjdGl2ZS1mb3Jtcy1ydWxlLnNlcnZpY2UudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7OztBQUNBLE9BQU8sRUFBRSxVQUFVLEVBQUUsTUFBTSxlQUFlLENBQUM7QUFDM0MsT0FBTyxFQUFFLFNBQVMsRUFBZ0MsV0FBVyxFQUFFLFdBQVcsRUFBRSxTQUFTLEVBQXNDLE1BQU0sZ0JBQWdCLENBQUM7QUFDbEosT0FBTyxFQUFFLGtCQUFrQixFQUFFLE1BQU0sc0NBQXNDLENBQUM7QUFHMUUsT0FBTyxFQUFFLFlBQVksRUFBRSxNQUFNLDBDQUEwQyxDQUFDO0FBQ3hFLE9BQU8sRUFBRSxZQUFZLEVBQUUsTUFBTSxvQ0FBb0MsQ0FBQztBQUNsRSxPQUFPLEVBQWMsZUFBZSxFQUFFLEVBQUUsRUFBb0IsS0FBSyxFQUFTLEtBQUssRUFBRSxNQUFNLE1BQU0sQ0FBQztBQUM5RixPQUFPLEVBQUUsR0FBRyxFQUFFLEdBQUcsRUFBRSxTQUFTLEVBQUUsSUFBSSxFQUFFLG9CQUFvQixFQUFFLFFBQVEsRUFBRSxNQUFNLGdCQUFnQixDQUFDO0FBSzNGLE9BQU8sRUFBRSxZQUFZLEVBQUUsTUFBTSwwQ0FBMEMsQ0FBQztBQUN4RSxPQUFPLEVBQUUsYUFBYSxFQUFFLE1BQU0sc0NBQXNDLENBQUM7Ozs7QUFXckUsTUFBTTs7Ozs7OztJQUtGLFlBQ1ksZ0JBQ0EsYUFDQSxVQUNBO1FBSEEsbUJBQWMsR0FBZCxjQUFjO1FBQ2QsZ0JBQVcsR0FBWCxXQUFXO1FBQ1gsYUFBUSxHQUFSLFFBQVE7UUFDUixjQUFTLEdBQVQsU0FBUztLQUVwQjs7Ozs7OztJQU9ELGdCQUFnQixDQUFJLElBQVk7UUFDNUIsTUFBTSxDQUFDLElBQUksQ0FBQyxjQUFjLENB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aUNBQWlDLENBQTZCLEVBQUM7Ozs7Ozs7SUFHckcscUNBQXFDLENBQUMsT0FBd0IsRUFBRSxLQUFjO1FBQ2xGLE9BQU8sQ0FBQyx3QkFBd0IsQ0FBQyx3Q0FBd0MsQ0FBQyxHQUFHLEtBQUssQ0FBQzs7Ozs7OztJQUcvRSxzQkFBc0IsQ0FBQyxPQUF3QixFQUFFLE1BQXlDO1FBQzlGLE9BQU8sQ0FBQyx3QkFBd0IsQ0FBQyxrQkFBa0IsQ0FBQyxHQUFHLE1BQU0sQ0FBQzs7Ozs7O0lBRzFELHNCQUFzQixDQUFDLE9BQXdCO1FBQ25ELE1BQU0sQ0FBQyxPQUFPLENBQUMsd0JBQXdCLENBQUMsa0JBQWtCLENBQUMsQ0FBQzs7Ozs7O0lBR3hELG9DQUFvQyxDQUFDLE9BQXdCO1FBQ2pFLE1BQU0sQ0FBQyxDQUFDLENBQUMsQ0FBQyxPQUFPLENBQUMsd0JBQXdCLENBQUMsd0NBQXdDLENBQUMsQ0FBQyxDQUFDOzs7Ozs7SUFHbEYsa0JBQWtCLENBQUMsT0FBd0I7UUFDL0MsT0FBTyxDQUFDLFVBQVUsQ0FBQyxPQUFPLENBQUMsS0FBSyxDQUFDLENBQUM7Ozs2REF0Z0JzQix5QkFBeUI7b0VBQ2xCLG1DQUFtQzs4Q0FDekQsNkJBQTZCOztZQUo3RSxVQUFVOzs7O1lBdEJGLGtCQUFrQjtZQUR1QixXQUFXO1lBS3BELFlBQVk7WUFRWixhQUFhIiwic291cmNlc0NvbnRlbnQiOlsiLy8gdHNsaW50OmRpc2FibGU6bWF4LWxpbmUtbGVuZ3RoXHJcbmltcG9ydCB7IEluamVjdGFibGUgfSBmcm9tIFwiQGFuZ3VsYXIvY29yZVwiO1xyXG5pbXBvcnQgeyBGb3JtR3JvdXAsIEFic3RyYWN0Q29udHJvbCwgVmFsaWRhdG9yRm4sIEZvcm1CdWlsZGVyLCBGb3JtQ29udHJvbCwgRm9ybUFycmF5LCBWYWxpZGF0aW9uRXJyb3JzLCBBc3luY1ZhbGlkYXRvckZuIH0gZnJvbSAnQGFuZ3VsYXIvZm9ybXMnO1xyXG5pbXBvcnQgeyBSdWxlc0VuZ2luZVNlcnZpY2UgfSBmcm9tIFwiLi4vcnVsZXMtZW5naW5lL3J1bGVzLWVuZ2luZS5zZXJ2aWNlXCI7XHJcbmltcG9ydCB7IFByb3BlcnR5IH0gZnJvbSBcIi4uLy4uLy4uL2Zvcm0tcnVsZXMvbW9kZWxzL3Byb3BlcnR5XCI7XHJcbmltcG9ydCB7IEFycmF5SXRlbVByb3BlcnR5IH0gZnJvbSBcIi4uLy4uLy4uL2Zvcm0tcnVsZXMvbW9kZWxzL2FycmF5LWl0ZW0tcHJvcGVydHlcIjtcclxuaW1wb3J0IHsgUHJvcGVydHlCYXNlIH0gZnJvbSBcIi4uLy4uLy4uL2Zvcm0tcnVsZXMvbW9kZWxzL3Byb3BlcnR5LWJhc2VcIjtcclxuaW1wb3J0IHsgVHJhY2VTZXJ2aWNlIH0gZnJvbSBcIi4uLy4uLy4uL3V0aWxzL3RyYWNlL3RyYWNlLnNlcnZpY2VcIjtcclxuaW1wb3J0IHsgT2JzZXJ2YWJsZSwgQmVoYXZpb3JTdWJqZWN0LCBvZiwgT3BlcmF0b3JGdW5jdGlvbiwgdGltZXIsIGVtcHR5LCBFTVBUWSB9IGZyb20gXCJyeGpzXCI7XHJcbmltcG9ydCB7IG1hcCwgdGFwLCBzd2l0Y2hNYXAsIHRha2UsIGRpc3RpbmN0VW50aWxDaGFuZ2VkLCBkZWJvdW5jZSB9IGZyb20gXCJyeGpzL29wZXJhdG9yc1wiO1xyXG5pbXBvcnQgeyBUZXN0UmVzdWx0c0Jhc2UgfSBmcm9tIFwiLi4vLi4vLi4vZm9ybS1ydWxlcy9tb2RlbHMvdGVzdC1yZXN1bHRzLWJhc2VcIjtcclxuaW1wb3J0IHsgUmVhY3RpdmVGb3Jtc1ZhbGlkYXRpb25FcnJvcnMgfSBmcm9tIFwiLi4vLi4vLi4vZm9ybS1ydWxlcy9tb2RlbHMvcmVhY3RpdmUtZm9ybXMtdmFsaWRhdGlvbi1lcnJvcnNcIjtcclxuaW1wb3J0IHsgUmVhY3RpdmVGb3Jtc0ZhaWxlZFZhbGRhdGlvbiB9IGZyb20gXCIuLi8uLi8uLi9mb3JtLXJ1bGVzL21vZGVscy9yZWFjdGl2ZS1mb3Jtcy1mYWlsZWQtdmFsaWRhdGlvblwiO1xyXG5pbXBvcnQgeyBSZWFjdGl2ZUZvcm1zVmFsaWRhdGlvbkVycm9yc0RhdGEgfSBmcm9tIFwiLi4vLi4vLi4vZm9ybS1ydWxlcy9tb2RlbHMvcmVhY3RpdmUtZm9ybXMtdmFsaWRhdGlvbi1lcnJvcnMtZGF0YVwiO1xyXG5pbXBvcnQgeyBDb250cm9sU3RhdGUgfSBmcm9tIFwiLi4vLi4vLi4vZm9ybS1ydWxlcy9tb2RlbHMvY29udHJvbC1zdGF0ZVwiO1xyXG5pbXBvcnQgeyBDb21tb25TZXJ2aWNlIH0gZnJvbSBcIi4uLy4uLy4uL3V0aWxzL2NvbW1vbi9jb21tb24uc2VydmljZVwiO1xyXG5pbXBvcnQgeyBBYnN0cmFjdE1vZGVsU2V0dGluZ3MgfSBmcm9tIFwiLi4vLi4vLi4vZm9ybS1ydWxlcy9tb2RlbHMvYWJzdHJhY3QtbW9kZWwtc2V0dGluZ3NcIjtcclxuaW1wb3J0IHsgVmFsdWVDaGFuZ2VPcHRpb25zIH0gZnJvbSBcIi4uLy4uLy4uL2Zvcm0tcnVsZXMvbW9kZWxzL3ZhbHVlLWNoYW5nZS1vcHRpb25zXCI7XHJcbmltcG9ydCB7IEFkZEFycmF5SXRlbVByb3BlcnR5T3B0aW9ucyB9IGZyb20gXCIuLi8uLi8uLi9mb3JtLXJ1bGVzL21vZGVscy9hZGQtYXJyYXktaXRlbS1wcm9wZXJ0eS1vcHRpb25zXCI7XHJcbmltcG9ydCB7IFVwZGF0ZU9uIH0gZnJvbSBcIi4uLy4uLy4uL2Zvcm0tcnVsZXMvbW9kZWxzL3VwZGF0ZS1vblwiO1xyXG4vLyB0c2xpbnQ6ZW5hYmxlOm1heC1saW5lLWxlbmd0aFxyXG5cclxuLyoqXHJcbiAqIEJ1aWxkcyByZWFjdGl2ZSBmb3JtcyB1c2luZyBjb25maWd1cmVkIG1vZGVsIHNldHRpbmdzXHJcbiAqL1xyXG5ASW5qZWN0YWJsZSgpXHJcbmV4cG9ydCBjbGFzcyBSZWFjdGl2ZUZvcm1zUnVsZVNlcnZpY2Uge1xyXG4gICAgcHJpdmF0ZSBzdGF0aWMgcmVhZG9ubHkgRk9STV9NT0RFTF9TRVRUSU5HU19QUk9QRVJUWV9OQU1FID0gJ25nRm9ybVJ1bGVzTW9kZWxTZXR0aW5nJztcclxuICAgIHByaXZhdGUgc3RhdGljIHJlYWRvbmx5IEZPUkNFX0FTWU5DX1ZBTElEX1RFU1RfUlVOX1BST1BFUlRZX05BTUUgPSAnbmdGb3JtUnVsZXNGb3JjZUFzeW5jVmFsaWRUZXN0UnVuJztcclxuICAgIHByaXZhdGUgc3RhdGljIHJlYWRvbmx5IENPTlRST0xfTEFTVF9FUlJPUiA9ICduZ0Zvcm1SdWxlc0NvbnRyb2xMYXN0RXJyb3InO1xyXG5cclxuICAgIGNvbnN0cnVjdG9yKFxyXG4gICAgICAgIHByaXZhdGUgcnVsZXNFbmdpbmVTdmM6IFJ1bGVzRW5naW5lU2VydmljZSxcclxuICAgICAgICBwcml2YXRlIGZvcm1CdWlsZGVyOiBGb3JtQnVpbGRlcixcclxuICAgICAgICBwcml2YXRlIHRyYWNlU3ZjOiBUcmFjZVNlcnZpY2UsXHJcbiAgICAgICAgcHJpdmF0ZSBjb21tb25TdmM6IENvbW1vblNlcnZpY2VcclxuICAgICkge1xyXG4gICAgfVxyXG5cclxuICAgIC8qKlxyXG4gICAgICogR2V0cyBtb2RlbCBzZXR0aW5ncyB3aXRoIHRoZSBwcm92aWRlZCBuYW1lXHJcbiAgICAgKiBAcGFyYW0gbmFtZSBOYW1lIG9mIG1vZGVsIHNldHRpbmdcclxuICAgICAqIEByZXR1cm5zIE1vZGVsIHNldHRpbmdzIHdpdGggdGhlIHByb3ZpZGVkIG5hbWVcclxuICAgICAqL1xyXG4gICAgZ2V0TW9kZWxTZXR0aW5nczxUPihuYW1lOiBzdHJpbmcpOiBBYnN0cmFjdE1vZGVsU2V0dGluZ3M8VD4ge1xyXG4gICAgICAgIHJldHVybiB0aGlzLnJ1bGVzRW5naW5lU3ZjLmdldE1vZGVsU2V0dGluZ3MobmFtZSk7XHJcbiAgICB9XHJcblxyXG4gICAgLyoqXHJcbiAgICAgKiBDcmVhdGVzIGEgZm9ybSBncm91cCB1c2luZyBhbiBpbnN0YW5jZSBvZiBtb2RlbCBzZXR0aW5nc1xyXG4gICAgICogQHBhcmFtIG1vZGVsU2V0dGluZ3MgTmFtZSBvZiB0aGUgbW9kZWwgc2V0dGluZyBvciBhbiBpbnN0YW5jZSBvZiBtb2RlbCBzZXR0aW5ncyB0byB1c2VcclxuICAgICAqIEBwYXJhbSBpbml0aWFsVmFsdWUgSW5pdGlhbCBkYXRhIHRvIHNldCB0aGUgZm9ybSB2YWx1ZXMgdG9cclxuICAgICAqIEByZXR1cm5zIEZvcm0gZ3JvdXAgY3JlYXRlZCBhY2NvcmRpbmcgdG8gZGVmaW5lZCBtb2RlbCBzZXR0aW5nc1xyXG4gICAgICovXHJcbiAgICBjcmVhdGVGb3JtR3JvdXA8VD4oXHJcbiAgICAgICAgbW9kZWxTZXR0aW5nczogc3RyaW5nIHwgQWJzdHJhY3RNb2RlbFNldHRpbmdzPFQ+LFxyXG4gICAgICAgIGluaXRpYWxWYWx1ZT86IGFueVxyXG4gICAgKTogRm9ybUdyb3VwIHtcclxuICAgICAgICBsZXQgc2V0dGluZ3M6IEFic3RyYWN0TW9kZWxTZXR0aW5nczxUPjtcclxuXHJcbiAgICAgICAgaWYgKHR5cGVvZiBtb2RlbFNldHRpbmdzID09PSBcInN0cmluZ1wiKSB7XHJcbiAgICAgICAgICAgIHNldHRpbmdzID0gdGhpcy5ydWxlc0VuZ2luZVN2Yy5nZXRNb2RlbFNldHRpbmdzKG1vZGVsU2V0dGluZ3MgYXMgc3RyaW5nKTtcclxuICAgICAgICAgICAgaWYgKCFzZXR0aW5ncykgdGhyb3cgbmV3IEVycm9yKGBObyBtb2RlbCBzZXR0aW5nIGZvdW5kIHdpdGggdGhlIG5hbWUgXCIke21vZGVsU2V0dGluZ3N9XCJgKTtcclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICBpZiAoIW1vZGVsU2V0dGluZ3MpIHRocm93IG5ldyBFcnJvcihgQWRob2MgbW9kZWwgc2V0dGluZyBwcm92aWRlZCBpcyBpbnZhbGlkYCk7XHJcbiAgICAgICAgICAgIHNldHRpbmdzID0gbW9kZWxTZXR0aW5ncyBhcyBBYnN0cmFjdE1vZGVsU2V0dGluZ3M8VD47XHJcbiAgICAgICAgICAgIHRoaXMucnVsZXNFbmdpbmVTdmMuaW5pdGlhbGl6ZU1vZGVsU2V0dGluZyhzZXR0aW5ncyk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICB0aGlzLnRyYWNlU3ZjLnRyYWNlKGBDcmVhdGluZyBmb3JtIGdyb3VwIHVzaW5nIG1vZGVsIHNldHRpbmdzIFwiJHtzZXR0aW5ncy5uYW1lfVwiYCk7XHJcbiAgICAgICAgY29uc3QgZm9ybUdyb3VwID0gdGhpcy5idWlsZEdyb3VwKHNldHRpbmdzLnByb3BlcnRpZXMsIGluaXRpYWxWYWx1ZSk7XHJcblxyXG4gICAgICAgIHRoaXMudHJhY2VTdmMudHJhY2UoYFNldHRpbmcgdXAgZGVwZW5kZW5jeSBzdWJzY3JpcHRpb25zYCk7XHJcbiAgICAgICAgdGhpcy5yZXNldERlcGVuZGVuY3lTdWJzY3JpcHRpb25zKGZvcm1Hcm91cCwgc2V0dGluZ3MucHJvcGVydGllcyk7XHJcblxyXG4gICAgICAgIHRoaXMudHJhY2VTdmMudHJhY2UoYFBhdGNoaW5nIGZvcm0gZ3JvdXAgd2l0aCBpbml0aWFsIHZhbHVlYCk7XHJcbiAgICAgICAgdGhpcy50cmlnZ2VyVmFsdWVDaGFuZ2UoZm9ybUdyb3VwKTtcclxuXHJcbiAgICAgICAgdGhpcy50cmFjZVN2Yy50cmFjZShgQXR0YWNoaW5nIG1vZGVsIHNldHRpbmdzIHRvIGZvcm1gKTtcclxuICAgICAgICB0aGlzLmF0dGFjaE1vZGVsU2V0dGluZ3NUb0Zvcm0oZm9ybUdyb3VwLCBzZXR0aW5ncyk7XHJcblxyXG4gICAgICAgIHJldHVybiBmb3JtR3JvdXA7XHJcbiAgICB9XHJcblxyXG4gICAgLyoqXHJcbiAgICAgKiBBZGRzIGFuIGFycmF5IGl0ZW0gcHJvcGVydHkgdG8gYW4gZXhpc3RpbmcgZm9ybSBhcnJheVxyXG4gICAgICogQHBhcmFtIHByb3BlcnR5IEFycmF5SXRlbVByb3BlcnR5IHRvIGZvciB0aGUgYXJyYXkgaXRlbSB0byBiZSBhZGRlZFxyXG4gICAgICogQHBhcmFtIHBhcmVudEZvcm1BcnJheSBUaGUgcGFyZW50IEZvcm1BcnJheVxyXG4gICAgICogQHBhcmFtIGluaXRpYWxWYWx1ZSBJbml0aWFsIHZhbHVlIG9mIHRoZSBmb3JtIGFycmF5IGl0ZW1cclxuICAgICAqIEBwYXJhbSBvcHRpb25zIE9wdGlvbnMgZm9yIGFkZGluZyBuZXcgYXJyYXkgaXRlbSBwcm9wZXJ0eVxyXG4gICAgICovXHJcbiAgICBhZGRBcnJheUl0ZW1Qcm9wZXJ0eUNvbnRyb2w8VD4oXHJcbiAgICAgICAgcHJvcGVydHk6IEFycmF5SXRlbVByb3BlcnR5PFQ+LFxyXG4gICAgICAgIHBhcmVudEZvcm1BcnJheTogRm9ybUFycmF5LFxyXG4gICAgICAgIGluaXRpYWxWYWx1ZT86IGFueSxcclxuICAgICAgICBvcHRpb25zPzogQWRkQXJyYXlJdGVtUHJvcGVydHlPcHRpb25zXHJcbiAgICApOiB2b2lkIHtcclxuICAgICAgICBjb25zdCBjb250cm9sID0gdGhpcy5idWlsZEFic3RyYWN0Q29udHJvbChwcm9wZXJ0eSwgaW5pdGlhbFZhbHVlKTtcclxuICAgICAgICBjb25zdCB3aWxsQmVMYXN0SXRlbSA9ICFvcHRpb25zIHx8ICF0aGlzLmNvbW1vblN2Yy5pc1plcm9PckdyZWF0ZXIob3B0aW9ucy5pbmRleCkgfHwgb3B0aW9ucy5pbmRleCA+PSBwYXJlbnRGb3JtQXJyYXkubGVuZ3RoO1xyXG5cclxuICAgICAgICBpZiAod2lsbEJlTGFzdEl0ZW0pXHJcbiAgICAgICAgICAgIHBhcmVudEZvcm1BcnJheS5wdXNoKGNvbnRyb2wpO1xyXG4gICAgICAgIGVsc2VcclxuICAgICAgICAgICAgcGFyZW50Rm9ybUFycmF5Lmluc2VydChvcHRpb25zLmluZGV4LCBjb250cm9sKTtcclxuXHJcbiAgICAgICAgY29uc3QgbW9kZWxTZXR0aW5ncyA9IHRoaXMuZ2V0TW9kZWxTZXR0aW5nc0Zyb21Gb3JtKHBhcmVudEZvcm1BcnJheS5yb290IGFzIEZvcm1Hcm91cCk7XHJcbiAgICAgICAgdGhpcy5yZXNldERlcGVuZGVuY3lTdWJzY3JpcHRpb25zKHBhcmVudEZvcm1BcnJheS5yb290LCBtb2RlbFNldHRpbmdzLnByb3BlcnRpZXMpO1xyXG5cclxuICAgICAgICAvLyB3ZSBuZWVkIHRvIGRvIHRoaXMgYmVjYXVzZSB0aGUgaXRlbSBjb3VsZCBoYXZlIGJlZW4gYWRkZWQgYXQgYW55IGluZGV4IGluIHRoZSBhcnJheSwgYW5kIHdlIG5lZWRcclxuICAgICAgICAvLyB0cmlnZ2VyIGEgdmFsdWUgY2hhbmdlIHRvIHRyaWdnZXIgYW55IGRlcGVuZGVuY3kgcHJvcGVydGl5IHZhbGRpZGF0aW9uc1xyXG4gICAgICAgIHRoaXMudHJpZ2dlclZhbHVlQ2hhbmdlKHBhcmVudEZvcm1BcnJheSk7XHJcbiAgICB9XHJcblxyXG4gICAgLyoqXHJcbiAgICAgKiBFeHRlbmRzIHZhbGlkYXRvcnMgZ2VuZXJhdGVkIGJ5IG5nLWZvcm0tcnVsZXMgd2l0aCB5b3VyIG93biB2YWxpZGF0b3JzXHJcbiAgICAgKiBAcGFyYW0gY29udHJvbCBDb250cm9sIHRvIGV4dGVuZHMgdGhlIHZhbGlkYXRvcnMgZm9yXHJcbiAgICAgKiBAcGFyYW0gdmFsaWRhdG9yIFZhbGlkYXRvciB0byBhZGRcclxuICAgICAqL1xyXG4gICAgZXh0ZW5kVmFsaWRhdG9yKGNvbnRyb2w6IEFic3RyYWN0Q29udHJvbCwgdmFsaWRhdG9yOiBWYWxpZGF0b3JGbiB8IFZhbGlkYXRvckZuW10pOiB2b2lkIHtcclxuICAgICAgICBpZiAoIXZhbGlkYXRvcikgcmV0dXJuO1xyXG5cclxuICAgICAgICBjb25zdCB2YWxpZGF0b3JBcnJheSA9IEFycmF5LmlzQXJyYXkodmFsaWRhdG9yKSA/IHZhbGlkYXRvciA6IFt2YWxpZGF0b3JdO1xyXG4gICAgICAgIGNvbnRyb2wuc2V0VmFsaWRhdG9ycyhbY29udHJvbC52YWxpZGF0b3IsIC4uLnZhbGlkYXRvckFycmF5XVxyXG4gICAgICAgICAgICAuZmlsdGVyKHZhbGlkYXRvckZuID0+ICEhdmFsaWRhdG9yRm4pKTtcclxuICAgIH1cclxuXHJcbiAgICAvKipcclxuICAgICAqIEV4dGVuZHMgYXN5bmMgdmFsaWRhdG9ycyBnZW5lcmF0ZWQgYnkgbmctZm9ybS1ydWxlcyB3aXRoIHlvdXIgb3duIGFzeW5jIHZhbGlkYXRvcnNcclxuICAgICAqIEBwYXJhbSBjb250cm9sIENvbnRyb2wgdG8gZXh0ZW5kcyB0aGUgYXN5bmMgdmFsaWRhdG9ycyBmb3JcclxuICAgICAqIEBwYXJhbSBhc3luY1ZhbGlkYXRvciBBc3luYyB2YWxpZGF0b3IgdG8gYWRkXHJcbiAgICAgKi9cclxuICAgIGV4dGVuZEFzeW5jVmFsaWRhdG9yKGNvbnRyb2w6IEFic3RyYWN0Q29udHJvbCwgYXN5bmNWYWxpZGF0b3I6IEFzeW5jVmFsaWRhdG9yRm4gfCBBc3luY1ZhbGlkYXRvckZuW10pOiB2b2lkIHtcclxuICAgICAgICBpZiAoIWFzeW5jVmFsaWRhdG9yKSByZXR1cm47XHJcblxyXG4gICAgICAgIGNvbnN0IGFzeW5jVmFsaWRhdG9yQXJyYXkgPSBBcnJheS5pc0FycmF5KGFzeW5jVmFsaWRhdG9yKSA/IGFzeW5jVmFsaWRhdG9yIDogW2FzeW5jVmFsaWRhdG9yXTtcclxuICAgICAgICBjb250cm9sLnNldEFzeW5jVmFsaWRhdG9ycyhbY29udHJvbC5hc3luY1ZhbGlkYXRvciwgLi4uYXN5bmNWYWxpZGF0b3JBcnJheV1cclxuICAgICAgICAgICAgLmZpbHRlcihhc3luY1ZhbGlkYXRvckZuID0+ICEhYXN5bmNWYWxpZGF0b3JGbikpO1xyXG4gICAgfVxyXG5cclxuICAgIHByaXZhdGUgYnVpbGRBYnN0cmFjdENvbnRyb2w8VD4ocHJvcGVydHk6IFByb3BlcnR5QmFzZTxUPiwgaW5pdGlhbFZhbHVlPzogYW55KTogQWJzdHJhY3RDb250cm9sIHtcclxuICAgICAgICBsZXQgY29udHJvbDogQWJzdHJhY3RDb250cm9sO1xyXG5cclxuICAgICAgICBpZiAocHJvcGVydHkuYXJyYXlJdGVtUHJvcGVydHkpIGNvbnRyb2wgPSB0aGlzLmJ1aWxkQXJyYXkocHJvcGVydHkuYXJyYXlJdGVtUHJvcGVydHksIGluaXRpYWxWYWx1ZSwgcHJvcGVydHkudXBkYXRlT24pO1xyXG4gICAgICAgIGVsc2UgaWYgKHByb3BlcnR5LnByb3BlcnRpZXMpIGNvbnRyb2wgPSB0aGlzLmJ1aWxkR3JvdXAocHJvcGVydHkucHJvcGVydGllcywgaW5pdGlhbFZhbHVlLCBwcm9wZXJ0eS51cGRhdGVPbik7XHJcbiAgICAgICAgZWxzZSBjb250cm9sID0gdGhpcy5idWlsZENvbnRyb2woaW5pdGlhbFZhbHVlLCBwcm9wZXJ0eS51cGRhdGVPbik7XHJcblxyXG4gICAgICAgIC8vIHNldHVwIHZhbGlkYXRpb24gdGVzdHMgb24gdmFsdWUgY2hhbmdlXHJcbiAgICAgICAgY29udHJvbC5zZXRWYWxpZGF0b3JzKHRoaXMuYnVpbGRWYWxpZGF0b3JGdW5jdGlvbihwcm9wZXJ0eSkpO1xyXG4gICAgICAgIGNvbnRyb2wuc2V0QXN5bmNWYWxpZGF0b3JzKHRoaXMuYnVpbGRBc3luY1ZhbGlkYXRvckZ1bmN0aW9uKHByb3BlcnR5KSk7XHJcblxyXG4gICAgICAgIC8vIHNldHVwIGVkaXQgdGVzdHMgb24gdmFsdWUgY2hhbmdlXHJcbiAgICAgICAgY29udHJvbC52YWx1ZUNoYW5nZXNcclxuICAgICAgICAgICAgLnBpcGUoXHJcbiAgICAgICAgICAgICAgICB0aGlzLmFwcGx5VmFsdWVDaGFuZ2VPcHRpb25zKHByb3BlcnR5LnZhbHVlQ2hhbmdlT3B0aW9ucy5zZWxmLmVkaXQpXHJcbiAgICAgICAgICAgIClcclxuICAgICAgICAgICAgLnN1YnNjcmliZSh2YWx1ZSA9PiB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLnBlcnNpc3RFZGl0VGVzdHMoY29udHJvbCwgcHJvcGVydHkpO1xyXG4gICAgICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgcmV0dXJuIGNvbnRyb2w7XHJcbiAgICB9XHJcblxyXG4gICAgcHJpdmF0ZSBidWlsZENvbnRyb2w8VD4oaW5pdGlhbFZhbHVlOiBhbnksIHVwZGF0ZU9uPzogVXBkYXRlT24pOiBGb3JtQ29udHJvbCB7XHJcbiAgICAgICAgcmV0dXJuIG5ldyBGb3JtQ29udHJvbChpbml0aWFsVmFsdWUsIHsgdXBkYXRlT246IHVwZGF0ZU9uIH0pO1xyXG4gICAgfVxyXG5cclxuICAgIHByaXZhdGUgYnVpbGRHcm91cDxUPihwcm9wZXJ0aWVzOiBQcm9wZXJ0eTxUPltdLCBpbml0aWFsVmFsdWU6IGFueSwgdXBkYXRlT24/OiBVcGRhdGVPbik6IEZvcm1Hcm91cCB7XHJcbiAgICAgICAgY29uc3QgZm9ybUdyb3VwID0gbmV3IEZvcm1Hcm91cCh7fSwgeyB1cGRhdGVPbjogdXBkYXRlT24gfSk7XHJcblxyXG4gICAgICAgIChwcm9wZXJ0aWVzIHx8IFtdKS5mb3JFYWNoKHAgPT4ge1xyXG4gICAgICAgICAgICBjb25zdCBwcm9wZXJ0eVZhbHVlID0gaW5pdGlhbFZhbHVlID8gaW5pdGlhbFZhbHVlW3AubmFtZV0gOiBudWxsO1xyXG4gICAgICAgICAgICBjb25zdCBjdHJsID0gdGhpcy5idWlsZEFic3RyYWN0Q29udHJvbChwLCBwcm9wZXJ0eVZhbHVlKTtcclxuICAgICAgICAgICAgZm9ybUdyb3VwLmFkZENvbnRyb2wocC5uYW1lLCBjdHJsKTtcclxuICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgcmV0dXJuIGZvcm1Hcm91cDtcclxuICAgIH1cclxuXHJcbiAgICBwcml2YXRlIGJ1aWxkQXJyYXk8VD4ocHJvcGVydHk6IEFycmF5SXRlbVByb3BlcnR5PFQ+LCBpbml0aWFsVmFsdWU6IGFueVtdLCB1cGRhdGVPbj86IFVwZGF0ZU9uKTogRm9ybUFycmF5IHtcclxuICAgICAgICBpbml0aWFsVmFsdWUgPSBBcnJheS5pc0FycmF5KGluaXRpYWxWYWx1ZSkgPyBpbml0aWFsVmFsdWUgOiBbXTtcclxuXHJcbiAgICAgICAgcmV0dXJuIG5ldyBGb3JtQXJyYXkoXHJcbiAgICAgICAgICAgIGluaXRpYWxWYWx1ZS5tYXAodiA9PiB0aGlzLmJ1aWxkQWJzdHJhY3RDb250cm9sKHByb3BlcnR5LCB2KSksXHJcbiAgICAgICAgICAgIHsgdXBkYXRlT246IHVwZGF0ZU9uIH1cclxuICAgICAgICApO1xyXG4gICAgfVxyXG5cclxuICAgIHByaXZhdGUgYnVpbGRWYWxpZGF0b3JGdW5jdGlvbjxUPihwcm9wZXJ0eTogUHJvcGVydHlCYXNlPFQ+KTogVmFsaWRhdG9yRm4ge1xyXG4gICAgICAgIGNvbnN0IHN5bmNHcm91cHMgPSB0aGlzLnJ1bGVzRW5naW5lU3ZjLmdyb3VwVGVzdHNCeVN5bmNUeXBlKHByb3BlcnR5LnZhbGlkKTtcclxuICAgICAgICBpZiAoIXN5bmNHcm91cHMuc3luYy5sZW5ndGgpIHJldHVybiBudWxsO1xyXG5cclxuICAgICAgICByZXR1cm4gKGNvbnRyb2w6IEFic3RyYWN0Q29udHJvbCk6IFZhbGlkYXRpb25FcnJvcnMgPT4ge1xyXG4gICAgICAgICAgICBjb25zdCBjb250cm9sQ29udGV4dFZhbHVlcyA9IHRoaXMuZ2V0Q29udHJvbENvbnRleHRWYWx1ZXMoY29udHJvbCwgcHJvcGVydHkpO1xyXG5cclxuICAgICAgICAgICAgY29uc3QgdGVzdFJlc3VsdHMgPSB0aGlzLnJ1bGVzRW5naW5lU3ZjXHJcbiAgICAgICAgICAgICAgICAucnVuVGVzdHMoY29udHJvbENvbnRleHRWYWx1ZXMucmVsYXRpdmUsIHN5bmNHcm91cHMuc3luYywge1xyXG4gICAgICAgICAgICAgICAgICAgIHJvb3REYXRhOiBjb250cm9sQ29udGV4dFZhbHVlcy5yb290LFxyXG4gICAgICAgICAgICAgICAgICAgIGNvbnRyb2xTdGF0ZTogQ29udHJvbFN0YXRlLmNyZWF0ZShjb250cm9sKVxyXG4gICAgICAgICAgICAgICAgfSk7XHJcblxyXG4gICAgICAgICAgICBpZiAodGVzdFJlc3VsdHMucmVzdWx0cy5sZW5ndGgpIHtcclxuICAgICAgICAgICAgICAgIHRoaXMudHJhY2VTdmMudHJhY2UoYFZhbGlkYXRlZCBwcm9wZXJ0eSBcIiR7cHJvcGVydHkuYWJzb2x1dGVQYXRofVwiLiBgICtcclxuICAgICAgICAgICAgICAgICAgICB0aGlzLmJ1aWxkVGVzdFJlc3VsdFN0YXRzU3RyaW5nKHRlc3RSZXN1bHRzKSk7XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIHJldHVybiB0aGlzLm1hcFRvUmVhY3RpdmVGb3Jtc1ZhbGlkYXRpb25FcnJvcnModGVzdFJlc3VsdHMpO1xyXG4gICAgICAgIH07XHJcbiAgICB9XHJcblxyXG4gICAgcHJpdmF0ZSBidWlsZEFzeW5jVmFsaWRhdG9yRnVuY3Rpb248VD4ocHJvcGVydHk6IFByb3BlcnR5QmFzZTxUPik6IEFzeW5jVmFsaWRhdG9yRm4ge1xyXG4gICAgICAgIGNvbnN0IHJhd0FzeW5jRnVuYyA9IHRoaXMuYnVpbGRBc3luY1ZhbGlkYXRvckZ1bmN0aW9uUmF3KHByb3BlcnR5KTtcclxuXHJcbiAgICAgICAgaWYgKCFyYXdBc3luY0Z1bmMpIHJldHVybiBudWxsO1xyXG5cclxuICAgICAgICBjb25zdCB2YWx1ZXMgPSBuZXcgQmVoYXZpb3JTdWJqZWN0PEFic3RyYWN0Q29udHJvbD4obnVsbCk7XHJcbiAgICAgICAgY29uc3QgdmFsaWQkID0gdmFsdWVzLnBpcGUoXHJcbiAgICAgICAgICAgIHRoaXMuYXBwbHlBc3luY1ZhbGlkVmFsdWVDaGFuZ2VPcHRpb25zKHByb3BlcnR5LnZhbHVlQ2hhbmdlT3B0aW9ucy5zZWxmLmFzeW5jVmFsaWQpLFxyXG4gICAgICAgICAgICBzd2l0Y2hNYXAoeCA9PiB7XHJcbiAgICAgICAgICAgICAgICAvLyBwYXNzIHRocm91Z2ggbWVhbnMgd2UgZGlkIG5vdCBleGVjdXRlIHRoZSBuZy1mb3JtLXJ1bGVzIGFzeW5jIHRlc3RzXHJcbiAgICAgICAgICAgICAgICBpZiAoeC5wYXNzdGhyb3VnaCkge1xyXG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IGN1cnJlbnRFcnJvcnMgPSB4LmNvbnRyb2wuZXJyb3JzIHx8IHt9O1xyXG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IGxhc3ROZ0Zvcm1SdWxlc0Vycm9ycyA9IHRoaXMuZ2V0TGFzdEVycm9yRm9yQ29udHJvbCh4LmNvbnRyb2wpO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAvLyByZXR1cm4gdGhlIGxhc3QgbmctZm9ybS1ydWxlcyBlcnJvcnMgKGlmIGFueSkgYWxvbmdzaWRlIG5vbiBuZy1mb3JtLXJ1bGVzIGVycm9ycy5cclxuICAgICAgICAgICAgICAgICAgICAvLyB0aGlzIGhhbmRsZXMgc2NlbmFyaW8gd2hlcmUgZGVib3VuY2UgYW5kIGRpc3RpbmN0IGFyZSB1c2VkIGFuZCBzdGF0ZSBnb2VzIGZyb206XHJcbiAgICAgICAgICAgICAgICAgICAgLy8gICAgaW52YWxpZCAtPiBtYWtlIGNoYW5nZXMgYW5kIGJhY2sgdGhlbSBvdXQgLT4gdmFsaWRcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gb2YoT2JqZWN0LmFzc2lnbihjdXJyZW50RXJyb3JzLCB7IG5nRm9ybVJ1bGVzOiBsYXN0TmdGb3JtUnVsZXNFcnJvcnMgfSBhcyBSZWFjdGl2ZUZvcm1zVmFsaWRhdGlvbkVycm9ycykpO1xyXG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gcmF3QXN5bmNGdW5jKHguY29udHJvbCk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH0pLFxyXG4gICAgICAgICAgICB0YWtlKDEpXHJcbiAgICAgICAgKTtcclxuXHJcbiAgICAgICAgcmV0dXJuIChjb250cm9sOiBBYnN0cmFjdENvbnRyb2wpOiBQcm9taXNlPFZhbGlkYXRpb25FcnJvcnM+IHwgT2JzZXJ2YWJsZTxWYWxpZGF0aW9uRXJyb3JzPiA9PiB7XHJcbiAgICAgICAgICAgIHZhbHVlcy5uZXh0KGNvbnRyb2wpO1xyXG4gICAgICAgICAgICByZXR1cm4gdmFsaWQkO1xyXG4gICAgICAgIH07XHJcbiAgICB9XHJcblxyXG4gICAgcHJpdmF0ZSBidWlsZEFzeW5jVmFsaWRhdG9yRnVuY3Rpb25SYXc8VD4ocHJvcGVydHk6IFByb3BlcnR5QmFzZTxUPik6IEFzeW5jVmFsaWRhdG9yRm4ge1xyXG4gICAgICAgIGNvbnN0IHN5bmNHcm91cHMgPSB0aGlzLnJ1bGVzRW5naW5lU3ZjLmdyb3VwVGVzdHNCeVN5bmNUeXBlKHByb3BlcnR5LnZhbGlkKTtcclxuICAgICAgICBpZiAoIXN5bmNHcm91cHMuYXN5bmMubGVuZ3RoKSByZXR1cm4gbnVsbDtcclxuXHJcbiAgICAgICAgcmV0dXJuIChjb250cm9sOiBBYnN0cmFjdENvbnRyb2wpID0+IHtcclxuICAgICAgICAgICAgY29uc3QgY29udHJvbENvbnRleHRWYWx1ZXMgPSB0aGlzLmdldENvbnRyb2xDb250ZXh0VmFsdWVzKGNvbnRyb2wsIHByb3BlcnR5KTtcclxuXHJcbiAgICAgICAgICAgIHJldHVybiB0aGlzLnJ1bGVzRW5naW5lU3ZjLnJ1blRlc3RzQXN5bmMoY29udHJvbENvbnRleHRWYWx1ZXMucmVsYXRpdmUsIHN5bmNHcm91cHMuYXN5bmMsIHtcclxuICAgICAgICAgICAgICAgIHJvb3REYXRhOiBjb250cm9sQ29udGV4dFZhbHVlcy5yb290LFxyXG4gICAgICAgICAgICAgICAgY29udHJvbFN0YXRlOiBDb250cm9sU3RhdGUuY3JlYXRlKGNvbnRyb2wpXHJcbiAgICAgICAgICAgIH0pLnBpcGUoXHJcbiAgICAgICAgICAgICAgICB0YXAodGVzdFJlc3VsdHMgPT4ge1xyXG4gICAgICAgICAgICAgICAgICAgIGlmICh0ZXN0UmVzdWx0cy5yZXN1bHRzLmxlbmd0aCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnRyYWNlU3ZjLnRyYWNlKGBWYWxpZGF0ZWQgKGFzeW5jKSBwcm9wZXJ0eSBcIiR7cHJvcGVydHkuYWJzb2x1dGVQYXRofVwiLiBgICtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuYnVpbGRUZXN0UmVzdWx0U3RhdHNTdHJpbmcodGVzdFJlc3VsdHMpKTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9KSxcclxuICAgICAgICAgICAgICAgIG1hcCh0aGlzLm1hcFRvUmVhY3RpdmVGb3Jtc1ZhbGlkYXRpb25FcnJvcnMpLFxyXG4gICAgICAgICAgICAgICAgdGFwKHggPT4gdGhpcy5zZXRMYXN0RXJyb3JGb3JDb250cm9sKGNvbnRyb2wsICh4IHx8IHt9KS5uZ0Zvcm1SdWxlcykpXHJcbiAgICAgICAgICAgICk7XHJcbiAgICAgICAgfTtcclxuICAgIH1cclxuXHJcbiAgICBwcml2YXRlIHJlc2V0RGVwZW5kZW5jeVN1YnNjcmlwdGlvbnM8VD4oXHJcbiAgICAgICAgcGFyZW50Q29udHJvbDogQWJzdHJhY3RDb250cm9sLFxyXG4gICAgICAgIHByb3BlcnRpZXM6IFByb3BlcnR5QmFzZTxUPltdLFxyXG4gICAgKTogdm9pZCB7XHJcbiAgICAgICAgdGhpcy5yZW1vdmVEZXBlbmRlbmN5U3Vic2NyaXB0aW9ucyhwcm9wZXJ0aWVzKTtcclxuICAgICAgICB0aGlzLmFkZERlcGVuZGVuY3lTdWJzY3JpcHRpb25zKHBhcmVudENvbnRyb2wsIHByb3BlcnRpZXMpO1xyXG4gICAgfVxyXG5cclxuICAgIHByaXZhdGUgcmVtb3ZlRGVwZW5kZW5jeVN1YnNjcmlwdGlvbnM8VD4oXHJcbiAgICAgICAgcHJvcGVydGllczogUHJvcGVydHlCYXNlPFQ+W11cclxuICAgICk6IHZvaWQge1xyXG4gICAgICAgIChwcm9wZXJ0aWVzIHx8IFtdKS5mb3JFYWNoKHByb3BlcnR5ID0+IHtcclxuICAgICAgICAgICAgcHJvcGVydHkuY2xlYXJEZXBlbmRlbmN5UHJvcGVydHlTdWJzY3JpcHRpb25zKCk7XHJcblxyXG4gICAgICAgICAgICBpZiAocHJvcGVydHkucHJvcGVydGllcykge1xyXG4gICAgICAgICAgICAgICAgdGhpcy5yZW1vdmVEZXBlbmRlbmN5U3Vic2NyaXB0aW9ucyhwcm9wZXJ0eS5wcm9wZXJ0aWVzKTtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgaWYgKHByb3BlcnR5LmFycmF5SXRlbVByb3BlcnR5KSB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLnJlbW92ZURlcGVuZGVuY3lTdWJzY3JpcHRpb25zKFtwcm9wZXJ0eS5hcnJheUl0ZW1Qcm9wZXJ0eV0pO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfSk7XHJcbiAgICB9XHJcblxyXG4gICAgcHJpdmF0ZSBhZGREZXBlbmRlbmN5U3Vic2NyaXB0aW9uczxUPihcclxuICAgICAgICBwYXJlbnRDb250cm9sOiBBYnN0cmFjdENvbnRyb2wsXHJcbiAgICAgICAgcHJvcGVydGllczogUHJvcGVydHlCYXNlPFQ+W10sXHJcbiAgICAgICAgYXJyYXlJbmRleD86IG51bWJlclxyXG4gICAgKTogdm9pZCB7XHJcbiAgICAgICAgKHByb3BlcnRpZXMgfHwgW10pLmZvckVhY2gocHJvcGVydHkgPT4ge1xyXG4gICAgICAgICAgICBjb25zdCBwcm9wZXJ0eUNvbnRyb2wgPSB0aGlzLmdldFByb3BlcnR5RnJvbVBhcmVudChwYXJlbnRDb250cm9sLCBwcm9wZXJ0eSwgYXJyYXlJbmRleCk7XHJcbiAgICAgICAgICAgIGlmICghcHJvcGVydHlDb250cm9sKSByZXR1cm47XHJcblxyXG4gICAgICAgICAgICB0aGlzLnNldHVwRWRpdGFiaWxpdHlEZXBlbmRlbmN5U3Vic2NyaXB0aW9ucyhwcm9wZXJ0eUNvbnRyb2wsIHBhcmVudENvbnRyb2wsIHByb3BlcnR5KTtcclxuICAgICAgICAgICAgdGhpcy5zZXR1cFZhbGlkYXRpb25EZXBlbmRlbmN5U3Vic2NyaXB0aW9ucyhwcm9wZXJ0eUNvbnRyb2wsIHBhcmVudENvbnRyb2wsIHByb3BlcnR5KTtcclxuXHJcbiAgICAgICAgICAgIGlmIChwcm9wZXJ0eS5wcm9wZXJ0aWVzKSB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLmFkZERlcGVuZGVuY3lTdWJzY3JpcHRpb25zKHByb3BlcnR5Q29udHJvbCwgcHJvcGVydHkucHJvcGVydGllcyk7XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIGlmIChwcm9wZXJ0eS5hcnJheUl0ZW1Qcm9wZXJ0eSkge1xyXG4gICAgICAgICAgICAgICAgLy8gaWYgdGhlcmUgaXMgYW4gYXJyYXlJdGVtUHJvcGVydHkgd2Uga25vdyB0aGF0IHdlIGFyZSB3b3JraW5nIHdpdGggYSBGb3JtQXJyYXkgY29udHJvbFxyXG4gICAgICAgICAgICAgICAgY29uc3QgZm9ybUFycmF5Q29udHJvbCA9IChwcm9wZXJ0eUNvbnRyb2wgYXMgRm9ybUFycmF5KTtcclxuICAgICAgICAgICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgZm9ybUFycmF5Q29udHJvbC5sZW5ndGg7IGkrKykge1xyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMuYWRkRGVwZW5kZW5jeVN1YnNjcmlwdGlvbnMoZm9ybUFycmF5Q29udHJvbCwgW3Byb3BlcnR5LmFycmF5SXRlbVByb3BlcnR5XSwgaSk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9KTtcclxuICAgIH1cclxuXHJcbiAgICBwcml2YXRlIHNldHVwVmFsaWRhdGlvbkRlcGVuZGVuY3lTdWJzY3JpcHRpb25zPFQ+KFxyXG4gICAgICAgIHByb3BlcnR5Q29udHJvbDogQWJzdHJhY3RDb250cm9sLCBwYXJlbnRDb250cm9sOiBBYnN0cmFjdENvbnRyb2wsIHByb3BlcnR5OiBQcm9wZXJ0eUJhc2U8VD5cclxuICAgICk6IHZvaWQge1xyXG4gICAgICAgIGNvbnN0IGRlcGVuZGVuY3lQcm9wTmFtZXMgPSB0aGlzLnJ1bGVzRW5naW5lU3ZjLmdldERlcGVuZGVuY3lQcm9wZXJ0aWVzKHByb3BlcnR5LnZhbGlkKTtcclxuXHJcbiAgICAgICAgZGVwZW5kZW5jeVByb3BOYW1lcy5mb3JFYWNoKGQgPT4ge1xyXG4gICAgICAgICAgICBjb25zdCBkZXBlbmRlbmN5Q29udHJvbCA9IHRoaXMuZmluZENvbnRyb2xSZWxhdGl2ZWx5KHBhcmVudENvbnRyb2wsIGQpO1xyXG5cclxuICAgICAgICAgICAgaWYgKCFkZXBlbmRlbmN5Q29udHJvbCkgcmV0dXJuO1xyXG5cclxuICAgICAgICAgICAgY29uc3Qgc3ViJCA9IGRlcGVuZGVuY3lDb250cm9sLnZhbHVlQ2hhbmdlc1xyXG4gICAgICAgICAgICAgICAgLnBpcGUoXHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5hcHBseVZhbHVlQ2hhbmdlT3B0aW9ucyhwcm9wZXJ0eS52YWx1ZUNoYW5nZU9wdGlvbnMuZGVwZW5kZW5jeVByb3BlcnRpZXMudmFsaWQpXHJcbiAgICAgICAgICAgICAgICApXHJcbiAgICAgICAgICAgICAgICAuc3Vic2NyaWJlKHZhbHVlID0+IHtcclxuICAgICAgICAgICAgICAgICAgICB0aGlzLnNldEZvcmNlQXN5bmNWYWxpZGF0aW9uVGVzdEZvckNvbnRyb2wocHJvcGVydHlDb250cm9sLCB0cnVlKTtcclxuICAgICAgICAgICAgICAgICAgICBwcm9wZXJ0eUNvbnRyb2wudXBkYXRlVmFsdWVBbmRWYWxpZGl0eSh7IG9ubHlTZWxmOiB0cnVlLCBlbWl0RXZlbnQ6IGZhbHNlIH0pO1xyXG4gICAgICAgICAgICAgICAgfSk7XHJcblxyXG4gICAgICAgICAgICBwcm9wZXJ0eS5hZGREZXBlbmRlbmN5UHJvcGVydHlTdWJzY3JpcHRpb24oc3ViJCk7XHJcbiAgICAgICAgfSk7XHJcbiAgICB9XHJcblxyXG4gICAgcHJpdmF0ZSBzZXR1cEVkaXRhYmlsaXR5RGVwZW5kZW5jeVN1YnNjcmlwdGlvbnM8VD4oXHJcbiAgICAgICAgcHJvcGVydHlDb250cm9sOiBBYnN0cmFjdENvbnRyb2wsXHJcbiAgICAgICAgcGFyZW50Q29udHJvbDogQWJzdHJhY3RDb250cm9sLFxyXG4gICAgICAgIHByb3BlcnR5OiBQcm9wZXJ0eUJhc2U8VD5cclxuICAgICk6IHZvaWQge1xyXG4gICAgICAgIGNvbnN0IGRlcGVuZGVuY3lQcm9wTmFtZXMgPSB0aGlzLnJ1bGVzRW5naW5lU3ZjLmdldERlcGVuZGVuY3lQcm9wZXJ0aWVzKHByb3BlcnR5LmVkaXQpO1xyXG5cclxuICAgICAgICBkZXBlbmRlbmN5UHJvcE5hbWVzLmZvckVhY2goZHBuID0+IHtcclxuICAgICAgICAgICAgY29uc3QgZGVwZW5kZW5jeUNvbnRyb2wgPSB0aGlzLmZpbmRDb250cm9sUmVsYXRpdmVseShwYXJlbnRDb250cm9sLCBkcG4pO1xyXG5cclxuICAgICAgICAgICAgaWYgKCFkZXBlbmRlbmN5Q29udHJvbCkgcmV0dXJuO1xyXG5cclxuICAgICAgICAgICAgLy8gc2V0dXAgY29udHJvbCB0byBwZXJmb3JtIGVkaXQgdGVzdHMgd2hlbiBkZXBlbmRlbmN5IHByb3BlcnR5IGNoYW5nZXNcclxuICAgICAgICAgICAgY29uc3Qgc3ViJCA9IGRlcGVuZGVuY3lDb250cm9sLnZhbHVlQ2hhbmdlc1xyXG4gICAgICAgICAgICAgICAgLnBpcGUoXHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5hcHBseVZhbHVlQ2hhbmdlT3B0aW9ucyhwcm9wZXJ0eS52YWx1ZUNoYW5nZU9wdGlvbnMuZGVwZW5kZW5jeVByb3BlcnRpZXMuZWRpdClcclxuICAgICAgICAgICAgICAgIClcclxuICAgICAgICAgICAgICAgIC5zdWJzY3JpYmUodmFsdWUgPT4ge1xyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMucGVyc2lzdEVkaXRUZXN0cyhwcm9wZXJ0eUNvbnRyb2wsIHByb3BlcnR5KTtcclxuICAgICAgICAgICAgICAgIH0pO1xyXG5cclxuICAgICAgICAgICAgcHJvcGVydHkuYWRkRGVwZW5kZW5jeVByb3BlcnR5U3Vic2NyaXB0aW9uKHN1YiQpO1xyXG4gICAgICAgIH0pO1xyXG4gICAgfVxyXG5cclxuICAgIHByaXZhdGUgcGVyc2lzdEVkaXRUZXN0czxUPihwcm9wZXJ0eUNvbnRyb2w6IEFic3RyYWN0Q29udHJvbCwgcHJvcGVydHk6IFByb3BlcnR5QmFzZTxUPik6IHZvaWQge1xyXG4gICAgICAgIGNvbnN0IGNvbnRyb2xDb250ZXh0VmFsdWVzID0gdGhpcy5nZXRDb250cm9sQ29udGV4dFZhbHVlcyhwcm9wZXJ0eUNvbnRyb2wsIHByb3BlcnR5KTtcclxuXHJcbiAgICAgICAgdGhpcy5ydWxlc0VuZ2luZVN2Yy5lZGl0YWJsZShjb250cm9sQ29udGV4dFZhbHVlcy5yZWxhdGl2ZSwgcHJvcGVydHksIHtcclxuICAgICAgICAgICAgcm9vdERhdGE6IGNvbnRyb2xDb250ZXh0VmFsdWVzLnJvb3QsXHJcbiAgICAgICAgICAgIGNvbnRyb2xTdGF0ZTogQ29udHJvbFN0YXRlLmNyZWF0ZShwcm9wZXJ0eUNvbnRyb2wpXHJcbiAgICAgICAgfSkuc3Vic2NyaWJlKHRlc3RSZXN1bHRzID0+IHtcclxuICAgICAgICAgICAgaWYgKHRlc3RSZXN1bHRzLnJlc3VsdHMubGVuZ3RoKSB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLnRyYWNlU3ZjLnRyYWNlKGBFZGl0YWJsZSBwcm9wZXJ0eSBcIiR7cHJvcGVydHkuYWJzb2x1dGVQYXRofVwiLiBgICtcclxuICAgICAgICAgICAgICAgICAgICB0aGlzLmJ1aWxkVGVzdFJlc3VsdFN0YXRzU3RyaW5nKHRlc3RSZXN1bHRzKSk7XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIGlmICh0ZXN0UmVzdWx0cy5wYXNzZWQgJiYgcHJvcGVydHlDb250cm9sLmRpc2FibGVkKVxyXG4gICAgICAgICAgICAgICAgcHJvcGVydHlDb250cm9sLmVuYWJsZSh7IGVtaXRFdmVudDogZmFsc2UgfSk7XHJcbiAgICAgICAgICAgIGVsc2UgaWYgKCF0ZXN0UmVzdWx0cy5wYXNzZWQgJiYgcHJvcGVydHlDb250cm9sLmVuYWJsZWQpXHJcbiAgICAgICAgICAgICAgICBwcm9wZXJ0eUNvbnRyb2wuZGlzYWJsZSh7IGVtaXRFdmVudDogZmFsc2UgfSk7XHJcbiAgICAgICAgfSk7XHJcbiAgICB9XHJcblxyXG4gICAgcHJpdmF0ZSBhcHBseUFzeW5jVmFsaWRWYWx1ZUNoYW5nZU9wdGlvbnMoXHJcbiAgICAgICAgdmFsdWVDaGFuZ2VPcHRpb25zOiBWYWx1ZUNoYW5nZU9wdGlvbnNcclxuICAgICk6IE9wZXJhdG9yRnVuY3Rpb248QWJzdHJhY3RDb250cm9sLCBBc3luY1ZhbGlkYXRpb25QYXNzdGhyb3VnaGFibGU+IHtcclxuICAgICAgICByZXR1cm4gKHNvdXJjZSQ6IE9ic2VydmFibGU8QWJzdHJhY3RDb250cm9sPik6IE9ic2VydmFibGU8QXN5bmNWYWxpZGF0aW9uUGFzc3Rocm91Z2hhYmxlPiA9PiB7XHJcbiAgICAgICAgICAgIGxldCBsYXN0VmFsdWU6IGFueTtcclxuICAgICAgICAgICAgbGV0IGlzRm9yY2U6IGJvb2xlYW47XHJcblxyXG4gICAgICAgICAgICByZXR1cm4gc291cmNlJC5waXBlKFxyXG4gICAgICAgICAgICAgICAgdGFwKGNvbnRyb2wgPT4ge1xyXG4gICAgICAgICAgICAgICAgICAgIGlzRm9yY2UgPSB0aGlzLmRvZXNDb250cm9sSGF2ZUZvcmNlZEFzeW5jVmFsaWRhdGlvbihjb250cm9sKTtcclxuICAgICAgICAgICAgICAgICAgICB0aGlzLnNldEZvcmNlQXN5bmNWYWxpZGF0aW9uVGVzdEZvckNvbnRyb2woY29udHJvbCwgZmFsc2UpO1xyXG4gICAgICAgICAgICAgICAgfSksXHJcbiAgICAgICAgICAgICAgICBkZWJvdW5jZSh4ID0+IHtcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gaXNGb3JjZSB8fCB2YWx1ZUNoYW5nZU9wdGlvbnMuZGVib3VuY2VNaWxsaXNlY29uZHMgPiAwXHJcbiAgICAgICAgICAgICAgICAgICAgICAgID8gdGltZXIodmFsdWVDaGFuZ2VPcHRpb25zLmRlYm91bmNlTWlsbGlzZWNvbmRzKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICA6IEVNUFRZO1xyXG4gICAgICAgICAgICAgICAgfSksXHJcbiAgICAgICAgICAgICAgICBtYXAoY29udHJvbCA9PiB7XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgY29udHJvbDogY29udHJvbCxcclxuICAgICAgICAgICAgICAgICAgICAgICAgcGFzc3Rocm91Z2g6ICEoY29udHJvbC52YWx1ZSAhPT0gbGFzdFZhbHVlIHx8ICF2YWx1ZUNoYW5nZU9wdGlvbnMuZGlzdGluY3RVbnRpbENoYW5nZWQgfHwgaXNGb3JjZSlcclxuICAgICAgICAgICAgICAgICAgICB9IGFzIEFzeW5jVmFsaWRhdGlvblBhc3N0aHJvdWdoYWJsZTtcclxuICAgICAgICAgICAgICAgIH0pLFxyXG4gICAgICAgICAgICAgICAgdGFwKHggPT4ge1xyXG4gICAgICAgICAgICAgICAgICAgIGlmICgheC5wYXNzdGhyb3VnaCkgbGFzdFZhbHVlID0geC5jb250cm9sLnZhbHVlO1xyXG4gICAgICAgICAgICAgICAgfSlcclxuICAgICAgICAgICAgKTtcclxuICAgICAgICB9O1xyXG4gICAgfVxyXG5cclxuICAgIHByaXZhdGUgYXBwbHlWYWx1ZUNoYW5nZU9wdGlvbnModmFsdWVDaGFuZ2VPcHRpb25zOiBWYWx1ZUNoYW5nZU9wdGlvbnMpOiBPcGVyYXRvckZ1bmN0aW9uPGFueSwgYW55PiB7XHJcbiAgICAgICAgcmV0dXJuIChzb3VyY2UkOiBPYnNlcnZhYmxlPGFueT4pOiBPYnNlcnZhYmxlPGFueT4gPT4ge1xyXG4gICAgICAgICAgICByZXR1cm4gc291cmNlJC5waXBlKFxyXG4gICAgICAgICAgICAgICAgZGVib3VuY2UoeCA9PiB7XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHZhbHVlQ2hhbmdlT3B0aW9ucy5kZWJvdW5jZU1pbGxpc2Vjb25kcyA+IDBcclxuICAgICAgICAgICAgICAgICAgICAgICAgPyB0aW1lcih2YWx1ZUNoYW5nZU9wdGlvbnMuZGVib3VuY2VNaWxsaXNlY29uZHMpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIDogRU1QVFk7XHJcbiAgICAgICAgICAgICAgICB9KSxcclxuICAgICAgICAgICAgICAgIHZhbHVlQ2hhbmdlT3B0aW9ucy5kaXN0aW5jdFVudGlsQ2hhbmdlZCA/IGRpc3RpbmN0VW50aWxDaGFuZ2VkKCkgOiB0YXAoKVxyXG4gICAgICAgICAgICApO1xyXG4gICAgICAgIH07XHJcbiAgICB9XHJcblxyXG4gICAgcHJpdmF0ZSBnZXRDb250cm9sQ29udGV4dFZhbHVlczxUPihjb250cm9sOiBBYnN0cmFjdENvbnRyb2wsIHByb3BlcnR5OiBQcm9wZXJ0eTxUPiB8IEFycmF5SXRlbVByb3BlcnR5PFQ+KTogQ29udHJvbENvbnRleHRWYWx1ZXMge1xyXG4gICAgICAgIGNvbnN0IHJvb3RWYWx1ZSA9IChjb250cm9sLnJvb3QgYXMgRm9ybUdyb3VwKS5nZXRSYXdWYWx1ZSgpO1xyXG5cclxuICAgICAgICAvLyB1c2UgdGhlIGNvbnRyb2wgdmFsdWUgaWYgYW4gYXJyYXkgaXRlbSwgb3RoZXJ3aXNlIHVzZSB0aGUgcGFyZW50IGNvbnRyb2xcclxuICAgICAgICBjb25zdCByZWxhdGl2ZVZhbHVlID0gUHJvcGVydHlCYXNlLmlzQXJyYXlJdGVtUHJvcGVydHkocHJvcGVydHkpXHJcbiAgICAgICAgICAgID8gY29udHJvbC52YWx1ZVxyXG4gICAgICAgICAgICA6IGNvbnRyb2wucGFyZW50LmdldFJhd1ZhbHVlKCk7XHJcblxyXG4gICAgICAgIHJldHVybiB7XHJcbiAgICAgICAgICAgIHJvb3Q6IHJvb3RWYWx1ZSxcclxuICAgICAgICAgICAgcmVsYXRpdmU6IHJlbGF0aXZlVmFsdWVcclxuICAgICAgICB9O1xyXG4gICAgfVxyXG5cclxuICAgIHByaXZhdGUgZ2V0UHJvcGVydHlGcm9tUGFyZW50PFQ+KFxyXG4gICAgICAgIHBhcmVudENvbnRyb2w6IEFic3RyYWN0Q29udHJvbCxcclxuICAgICAgICBwcm9wZXJ0eTogUHJvcGVydHlCYXNlPFQ+LFxyXG4gICAgICAgIGFycmF5SW5kZXg/OiBudW1iZXJcclxuICAgICkge1xyXG4gICAgICAgIHJldHVybiBQcm9wZXJ0eUJhc2UuaXNBcnJheUl0ZW1Qcm9wZXJ0eShwcm9wZXJ0eSlcclxuICAgICAgICAgICAgPyAocGFyZW50Q29udHJvbCBhcyBGb3JtQXJyYXkpLmF0KGFycmF5SW5kZXgpXHJcbiAgICAgICAgICAgIDogcGFyZW50Q29udHJvbC5nZXQoKHByb3BlcnR5IGFzIFByb3BlcnR5PFQ+KS5uYW1lKTtcclxuICAgIH1cclxuXHJcbiAgICBwcml2YXRlIG1hcFRvUmVhY3RpdmVGb3Jtc1ZhbGlkYXRpb25FcnJvcnM8VD4odGVzdFJlc3VsdHM6IFRlc3RSZXN1bHRzQmFzZTxUPik6IFJlYWN0aXZlRm9ybXNWYWxpZGF0aW9uRXJyb3JzIHtcclxuICAgICAgICAvLyBpZiBwYXNzZWQsIEFuZ3VsYXIgcmVhY3RpdmUgZm9ybXMgd2FudHMgdXMgdG8gcmV0dXJuIG51bGwsIG90aGVyd2lzZSByZXR1cm4gYW4gb2JqZWN0IHdpdGggdGhlIHZhbGlkYXRpb24gaW5mb1xyXG4gICAgICAgIGlmICghdGVzdFJlc3VsdHMgfHwgdGVzdFJlc3VsdHMucGFzc2VkKSByZXR1cm4gbnVsbDtcclxuXHJcbiAgICAgICAgY29uc3QgZmFpbGVkOiB7IFtrZXk6IHN0cmluZ106IFJlYWN0aXZlRm9ybXNGYWlsZWRWYWxkYXRpb24gfSA9IHt9O1xyXG5cclxuICAgICAgICB0ZXN0UmVzdWx0cy5mYWlsZWRSZXN1bHRzLmZvckVhY2godGVzdCA9PiB7XHJcbiAgICAgICAgICAgIGZhaWxlZFt0ZXN0Lm5hbWVdID0geyBtZXNzYWdlOiB0ZXN0Lm1lc3NhZ2UgfTtcclxuICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgcmV0dXJuIHtcclxuICAgICAgICAgICAgbmdGb3JtUnVsZXM6IHtcclxuICAgICAgICAgICAgICAgIG1lc3NhZ2U6IHRlc3RSZXN1bHRzLm1lc3NhZ2UsXHJcbiAgICAgICAgICAgICAgICBmYWlsZWQ6IGZhaWxlZFxyXG4gICAgICAgICAgICB9IGFzIFJlYWN0aXZlRm9ybXNWYWxpZGF0aW9uRXJyb3JzRGF0YVxyXG4gICAgICAgIH07XHJcbiAgICB9XHJcblxyXG4gICAgcHJpdmF0ZSBmaW5kQ29udHJvbFJlbGF0aXZlbHkoY29udHJvbDogQWJzdHJhY3RDb250cm9sLCBwYXRoOiBzdHJpbmcpIHtcclxuICAgICAgICBjb25zdCByZWxhdGl2ZVBhdGhzID0gdGhpcy5idWlsZENvbnRyb2xSZWxhdGl2ZVBhdGhBcnJheShwYXRoKTtcclxuXHJcbiAgICAgICAgaWYgKCFyZWxhdGl2ZVBhdGhzLmxlbmd0aCkgcmV0dXJuIG51bGw7XHJcblxyXG4gICAgICAgIGxldCByZXN1bHQ6IEFic3RyYWN0Q29udHJvbDtcclxuICAgICAgICByZWxhdGl2ZVBhdGhzLmZvckVhY2gocGF0aFNlZ21lbnQgPT4ge1xyXG4gICAgICAgICAgICByZXN1bHQgPSB0aGlzLmdldENvbnRyb2xCeVBhdGhTZWdtZW50KHJlc3VsdCB8fCBjb250cm9sLCBwYXRoU2VnbWVudCk7XHJcbiAgICAgICAgICAgIGlmICghcmVzdWx0KSByZXR1cm47XHJcbiAgICAgICAgfSk7XHJcblxyXG4gICAgICAgIHJldHVybiByZXN1bHQ7XHJcbiAgICB9XHJcblxyXG4gICAgcHJpdmF0ZSBidWlsZENvbnRyb2xSZWxhdGl2ZVBhdGhBcnJheShyZWxhdGl2ZVBhdGg6IHN0cmluZyk6IHN0cmluZ1tdIHtcclxuICAgICAgICBjb25zdCByZXN1bHQ6IHN0cmluZ1tdID0gW107XHJcblxyXG4gICAgICAgIGlmICghcmVsYXRpdmVQYXRoIHx8IHR5cGVvZiByZWxhdGl2ZVBhdGggIT09IFwic3RyaW5nXCIpIHJldHVybiByZXN1bHQ7XHJcblxyXG4gICAgICAgIC8vIHRha2VzIGNhcmUgb2YgJy4vJywgJy4uLycsIGFuZCAnLydcclxuICAgICAgICBjb25zdCBzbGFzaFNlcGFyYXRlZCA9IHJlbGF0aXZlUGF0aC5zcGxpdChcIi9cIik7XHJcblxyXG4gICAgICAgIHNsYXNoU2VwYXJhdGVkLmZvckVhY2goc2xhc2hJdGVtID0+IHtcclxuICAgICAgICAgICAgY29uc3QgZG90U2VwYXJhdGVkID0gc2xhc2hJdGVtLnNwbGl0KFwiLlwiKVxyXG4gICAgICAgICAgICAgICAgLmZpbHRlcihkb3RJdGVtID0+ICEhZG90SXRlbSk7XHJcblxyXG4gICAgICAgICAgICBpZiAoZG90U2VwYXJhdGVkLmxlbmd0aClcclxuICAgICAgICAgICAgICAgIHJlc3VsdC5wdXNoKC4uLmRvdFNlcGFyYXRlZCk7XHJcbiAgICAgICAgICAgIGVsc2VcclxuICAgICAgICAgICAgICAgIHJlc3VsdC5wdXNoKHNsYXNoSXRlbSk7XHJcbiAgICAgICAgfSk7XHJcblxyXG4gICAgICAgIHJldHVybiByZXN1bHQ7XHJcbiAgICB9XHJcblxyXG4gICAgcHJpdmF0ZSBnZXRDb250cm9sQnlQYXRoU2VnbWVudChjb250cm9sOiBBYnN0cmFjdENvbnRyb2wsIHBhdGhTZWdtZW50OiBzdHJpbmcpOiBBYnN0cmFjdENvbnRyb2wge1xyXG4gICAgICAgIHN3aXRjaCAocGF0aFNlZ21lbnQpIHtcclxuICAgICAgICAgICAgY2FzZSBcIlwiOlxyXG4gICAgICAgICAgICAgICAgcmV0dXJuIGNvbnRyb2wucm9vdDtcclxuICAgICAgICAgICAgY2FzZSBcIi4uXCI6XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gY29udHJvbC5wYXJlbnQ7XHJcbiAgICAgICAgICAgIGNhc2UgXCIuXCI6XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gY29udHJvbDtcclxuICAgICAgICAgICAgZGVmYXVsdDpcclxuICAgICAgICAgICAgICAgIHJldHVybiBjb250cm9sLmdldChwYXRoU2VnbWVudCk7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIHByaXZhdGUgYnVpbGRUZXN0UmVzdWx0U3RhdHNTdHJpbmc8VD4odGVzdFJlc3VsdHM6IFRlc3RSZXN1bHRzQmFzZTxUPikge1xyXG4gICAgICAgIHJldHVybiBgRXhlY3V0ZWQgJHt0ZXN0UmVzdWx0cy5yZXN1bHRzLmxlbmd0aH0gdGVzdHMgYCArXHJcbiAgICAgICAgICAgIGAoJHt0ZXN0UmVzdWx0cy5wYXNzZWRSZXN1bHRzLmxlbmd0aH0gUEFTUyB8IGAgK1xyXG4gICAgICAgICAgICBgJHt0ZXN0UmVzdWx0cy5mYWlsZWRSZXN1bHRzLmxlbmd0aH0gRkFJTCB8IGBcclxuICAgICAgICAgICAgKyBgJHt0ZXN0UmVzdWx0cy5za2lwcGVkUmVzdWx0cy5sZW5ndGh9IFNLSVApYDtcclxuICAgIH1cclxuXHJcbiAgICBwcml2YXRlIGF0dGFjaE1vZGVsU2V0dGluZ3NUb0Zvcm08VD4oZm9ybUdyb3VwOiBGb3JtR3JvdXAsIG1vZGVsU2V0dGluZ3M6IEFic3RyYWN0TW9kZWxTZXR0aW5nczxUPik6IHZvaWQge1xyXG4gICAgICAgIGZvcm1Hcm91cFtSZWFjdGl2ZUZvcm1zUnVsZVNlcnZpY2UuRk9STV9NT0RFTF9TRVRUSU5HU19QUk9QRVJUWV9OQU1FXSA9IG1vZGVsU2V0dGluZ3M7XHJcbiAgICB9XHJcblxyXG4gICAgcHJpdmF0ZSBnZXRNb2RlbFNldHRpbmdzRnJvbUZvcm08VD4oZm9ybUdyb3VwOiBGb3JtR3JvdXApOiBBYnN0cmFjdE1vZGVsU2V0dGluZ3M8VD4ge1xyXG4gICAgICAgIHJldHVybiBmb3JtR3JvdXBbUmVhY3RpdmVGb3Jtc1J1bGVTZXJ2aWNlLkZPUk1fTU9ERUxfU0VUVElOR1NfUFJPUEVSVFlfTkFNRV0gYXMgQWJzdHJhY3RNb2RlbFNldHRpbmdzPFQ+O1xyXG4gICAgfVxyXG5cclxuICAgIHByaXZhdGUgc2V0Rm9yY2VBc3luY1ZhbGlkYXRpb25UZXN0Rm9yQ29udHJvbChjb250cm9sOiBBYnN0cmFjdENvbnRyb2wsIGZvcmNlOiBib29sZWFuKTogdm9pZCB7XHJcbiAgICAgICAgY29udHJvbFtSZWFjdGl2ZUZvcm1zUnVsZVNlcnZpY2UuRk9SQ0VfQVNZTkNfVkFMSURfVEVTVF9SVU5fUFJPUEVSVFlfTkFNRV0gPSBmb3JjZTtcclxuICAgIH1cclxuXHJcbiAgICBwcml2YXRlIHNldExhc3RFcnJvckZvckNvbnRyb2woY29udHJvbDogQWJzdHJhY3RDb250cm9sLCBlcnJvcnM6IFJlYWN0aXZlRm9ybXNWYWxpZGF0aW9uRXJyb3JzRGF0YSk6IHZvaWQge1xyXG4gICAgICAgIGNvbnRyb2xbUmVhY3RpdmVGb3Jtc1J1bGVTZXJ2aWNlLkNPTlRST0xfTEFTVF9FUlJPUl0gPSBlcnJvcnM7XHJcbiAgICB9XHJcblxyXG4gICAgcHJpdmF0ZSBnZXRMYXN0RXJyb3JGb3JDb250cm9sKGNvbnRyb2w6IEFic3RyYWN0Q29udHJvbCk6IFJlYWN0aXZlRm9ybXNWYWxpZGF0aW9uRXJyb3JzRGF0YSB7XHJcbiAgICAgICAgcmV0dXJuIGNvbnRyb2xbUmVhY3RpdmVGb3Jtc1J1bGVTZXJ2aWNlLkNPTlRST0xfTEFTVF9FUlJPUl07XHJcbiAgICB9XHJcblxyXG4gICAgcHJpdmF0ZSBkb2VzQ29udHJvbEhhdmVGb3JjZWRBc3luY1ZhbGlkYXRpb24oY29udHJvbDogQWJzdHJhY3RDb250cm9sKTogYm9vbGVhbiB7XHJcbiAgICAgICAgcmV0dXJuICEhKGNvbnRyb2xbUmVhY3RpdmVGb3Jtc1J1bGVTZXJ2aWNlLkZPUkNFX0FTWU5DX1ZBTElEX1RFU1RfUlVOX1BST1BFUlRZX05BTUVdKTtcclxuICAgIH1cclxuXHJcbiAgICBwcml2YXRlIHRyaWdnZXJWYWx1ZUNoYW5nZShjb250cm9sOiBBYnN0cmFjdENvbnRyb2wpOiB2b2lkIHtcclxuICAgICAgICBjb250cm9sLnBhdGNoVmFsdWUoY29udHJvbC52YWx1ZSk7XHJcbiAgICB9XHJcbn1cclxuXHJcbmludGVyZmFjZSBDb250cm9sQ29udGV4dFZhbHVlcyB7XHJcbiAgICByb290OiBhbnk7XHJcbiAgICByZWxhdGl2ZTogYW55O1xyXG59XHJcblxyXG5pbnRlcmZhY2UgQXN5bmNWYWxpZGF0aW9uUGFzc3Rocm91Z2hhYmxlIHtcclxuICAgIGNvbnRyb2w6IEFic3RyYWN0Q29udHJvbDtcclxuICAgIHBhc3N0aHJvdWdoOiBib29sZWFuO1xyXG59XHJcbiJdfQ==